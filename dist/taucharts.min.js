/*!
 * /*
 * taucharts@2.7.2 (2019-04-22)
 * Copyright 2019 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 * 
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3-selection"),require("d3-array"),require("d3-scale"),require("topojson-client"),require("d3-transition"),require("d3-format"),require("d3-time-format"),require("d3-brush"),require("d3-color"),require("d3-axis"),require("d3-geo"),require("d3-quadtree"),require("d3-shape"),require("d3-time")):"function"==typeof define&&define.amd?define(["d3-selection","d3-array","d3-scale","topojson-client","d3-transition","d3-format","d3-time-format","d3-brush","d3-color","d3-axis","d3-geo","d3-quadtree","d3-shape","d3-time"],e):"object"==typeof exports?exports.Taucharts=e(require("d3-selection"),require("d3-array"),require("d3-scale"),require("topojson-client"),require("d3-transition"),require("d3-format"),require("d3-time-format"),require("d3-brush"),require("d3-color"),require("d3-axis"),require("d3-geo"),require("d3-quadtree"),require("d3-shape"),require("d3-time")):t.Taucharts=e(t.d3,t.d3,t.d3,t.topojson,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(window,function(t,e,n,r,i,a,o,s,u,l,c,f,d,h){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=21)}([function(e,n){e.exports=t},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"traverseJSON",function(){return mt}),n.d(r,"traverseSpec",function(){return yt}),n.d(r,"clone",function(){return kt}),n.d(r,"isDate",function(){return At}),n.d(r,"isObject",function(){return Ot}),n.d(r,"niceZeroBased",function(){return Pt}),n.d(r,"niceTimeDomain",function(){return Lt}),n.d(r,"generateHash",function(){return Ft}),n.d(r,"generateRatioFunction",function(){return Dt}),n.d(r,"isSpecRectCoordsOnly",function(){return jt}),n.d(r,"throttleLastEvent",function(){return It}),n.d(r,"splitEvenly",function(){return zt}),n.d(r,"extRGBColor",function(){return Bt}),n.d(r,"extCSSClass",function(){return Vt}),n.d(r,"toRadian",function(){return Ht}),n.d(r,"normalizeAngle",function(){return Wt}),n.d(r,"range",function(){return Gt}),n.d(r,"hasXOverflow",function(){return Ut}),n.d(r,"hasYOverflow",function(){return Xt}),n.d(r,"flatten",function(){return qt}),n.d(r,"unique",function(){return Yt}),n.d(r,"groupBy",function(){return $t}),n.d(r,"union",function(){return Kt}),n.d(r,"intersection",function(){return Jt}),n.d(r,"defaults",function(){return Qt}),n.d(r,"omit",function(){return Zt}),n.d(r,"memoize",function(){return te}),n.d(r,"createMultiSorter",function(){return ee}),n.d(r,"pick",function(){return ne}),n.d(r,"escape",function(){return re}),n.d(r,"template",function(){return ie}),n.d(r,"escapeHtml",function(){return ae}),n.d(r,"xml",function(){return le}),n.d(r,"take",function(){return ce}),n.d(r,"isChartElement",function(){return de}),n.d(r,"isFacetUnit",function(){return he});var i={};n.r(i),n.d(i,"appendTo",function(){return me}),n.d(i,"getScrollbarSize",function(){return ye}),n.d(i,"setScrollPadding",function(){return ve}),n.d(i,"getStyle",function(){return be}),n.d(i,"getStyleAsNum",function(){return xe}),n.d(i,"getContainerSize",function(){return _e}),n.d(i,"getAxisTickLabelSize",function(){return we}),n.d(i,"getLabelSize",function(){return Ee}),n.d(i,"getCharSize",function(){return Se}),n.d(i,"selectOrAppend",function(){return Me}),n.d(i,"selectImmediate",function(){return Te}),n.d(i,"selectAllImmediate",function(){return Ce}),n.d(i,"sortChildren",function(){return ke}),n.d(i,"classes",function(){return Ae}),n.d(i,"dispatchMouseEvent",function(){return Oe});var a={};n.r(a),n.d(a,"translate",function(){return Pe}),n.d(a,"rotate",function(){return Le}),n.d(a,"getOrientation",function(){return Ne}),n.d(a,"parseTransformTranslate",function(){return Re}),n.d(a,"isIntersect",function(){return Fe}),n.d(a,"getDeepTransformTranslate",function(){return De}),n.d(a,"raiseElements",function(){return je});var o=n(0),s=n(2),u=n(3),l={},c={};function f(t){var e=c[t];return e||(e=function(){for(var e,n,r=this,i=0,a=[];r=r.handler;){if("function"==typeof(n=r.callbacks[t])){if(!e)for(e=[this],i=0;i<arguments.length;i++)e.push(arguments[i]);a.unshift({fn:n,context:r.context,args:e})}if("function"==typeof(n=r.callbacks["*"])){if(!e)for(e=[this],i=0;i<arguments.length;i++)e.push(arguments[i]);a.unshift({fn:n,context:r.context,args:[{sender:this,type:t,args:e}]})}}a.forEach(function(t){return t.fn.apply(t.context,t.args)})},c[t]=e),e}var d,h=function(){function t(){this.handler=null,this.emit_destroy=f("destroy")}return t.prototype.addHandler=function(t,e){e=e||this,this.handler={callbacks:t,context:e,handler:this.handler}},t.prototype.on=function(t,e,n){var r={};return r[t]=e,this.addHandler(r,n),r},t.prototype.fire=function(t,e){f.call(this,t).call(this,e)},t.prototype.removeHandler=function(t,e){var n,r=this;for(e=e||this;n=r,r=r.handler;)if(r.callbacks===t&&r.context===e)return r.callbacks=l,void(n.handler=r.handler)},t.prototype.destroy=function(){this.emit_destroy(),this.handler=null},t}(),p=(d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),g=function(){return(g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},m=(g({},o),function(t){function e(e){var n=t.call(this)||this;return n.screenModel=null,n._elementNameSpace=e.namespace||"default",n._elementScalesHub={},n}return p(e,t),e.prototype.regScale=function(t,e){return this._elementScalesHub[t]=e,this},e.prototype.getScale=function(t){return this._elementScalesHub[t]||null},e.prototype.fireNameSpaceEvent=function(t,e){var n=this._elementNameSpace;this.fire(t+"."+n,e)},e.prototype.subscribe=function(t,e,n){void 0===e&&(e=function(t){return t}),void 0===n&&(n=function(t){return t});var r=this,i={};[{event:"mouseover",limit:0},{event:"mouseout",limit:0},{event:"click",limit:0},{event:"mousemove",limit:"requestAnimationFrame"}].forEach(function(a){var s=a.event,u=a.limit;t.on(s,It(i,s,function(t){var i={data:e.call(this,t),event:n.call(this,o.event,t)};r.fire(s,i),r.fireNameSpaceEvent(s,i)},u))})},e.prototype.allocateRect=function(){return{left:0,top:0,width:0,height:0}},e.prototype.defineGrammarModel=function(t){return{}},e.prototype.getGrammarRules=function(){return[]},e.prototype.getAdjustScalesRules=function(){return[]},e.prototype.createScreenModel=function(t){return null},e.prototype.getClosestElement=function(t,e){return null},e.prototype.addInteraction=function(){},e.prototype.draw=function(){this.config.options.container=this.config.options.slot(this.config.uid),this.drawFrames(this.config.frames)},e.prototype.data=function(){return this.config.frames.reduce(function(t,e){return t.concat(e.part())},[])},e.prototype.node=function(){return this},e}(h)),y=function(t){return{day:{cast:function(e){var n=new Date(e);return new Date(n[t.setHours](0,0,0,0))},next:function(e){var n=new Date(e),r=new Date(n[t.setDate](n[t.getDate]()+1));return this.cast(r)}},week:{cast:function(e){var n=new Date(e);return n=new Date(n[t.setHours](0,0,0,0)),new Date(n[t.setDate](n[t.getDate]()-n[t.getDay]()))},next:function(e){var n=new Date(e),r=new Date(n[t.setDate](n[t.getDate]()+7));return this.cast(r)}},month:{cast:function(e){var n=new Date(e);return n=new Date(n[t.setHours](0,0,0,0)),n=new Date(n[t.setDate](1))},next:function(e){var n=new Date(e),r=new Date(n[t.setMonth](n[t.getMonth]()+1));return this.cast(r)}},quarter:{cast:function(e){var n=new Date(e);n=new Date(n[t.setHours](0,0,0,0));var r=(n=new Date(n[t.setDate](1)))[t.getMonth](),i=r-r%3;return new Date(n[t.setMonth](i))},next:function(e){var n=new Date(e),r=new Date(n[t.setMonth](n[t.getMonth]()+3));return this.cast(r)}},year:{cast:function(e){var n=new Date(e);return n=new Date(n[t.setHours](0,0,0,0)),n=new Date(n[t.setDate](1)),n=new Date(n[t.setMonth](0))},next:function(e){var n=new Date(e),r=new Date(n[t.setFullYear](n[t.getFullYear]()+1));return this.cast(r)}}}},v=y({setHours:"setHours",setDate:"setDate",getDate:"getDate",setMonth:"setMonth",getDay:"getDay",getMonth:"getMonth",setFullYear:"setFullYear",getFullYear:"getFullYear"}),b=y({setHours:"setUTCHours",setDate:"setUTCDate",getDate:"getUTCDate",setMonth:"setUTCMonth",getDay:"getUTCDay",getMonth:"getUTCMonth",setFullYear:"setUTCFullYear",getFullYear:"getUTCFullYear"}),x={add:function(t,e,n){return((void 0===n?{utc:!1}:n).utc?b:v)[t.toLowerCase()]=e,this},get:function(t,e){return((void 0===e?{utc:!1}:e).utc?b:v)[(t||"").toLowerCase()]||null},generate:function(t,e,n,r){var i=(void 0===r?{utc:!1}:r).utc,a=[],o=x.get(n,{utc:i});if(o){var s=o.cast(new Date(e)),u=o.cast(new Date(t));for(a.push(u);(u=o.next(new Date(u)))<=s;)a.push(u)}return a}},_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),w=function(t){function e(e,n,r){var i=t.call(this)||this;return i.name="TauChartError",i.message=e,i.errorCode=n,i.errorArgs=r,i}return _(e,t),e}(Error),E={STACKED_FIELD_NOT_NUMBER:"STACKED_FIELD_NOT_NUMBER",NO_DATA:"NO_DATA",NOT_SUPPORTED_TYPE_CHART:"NOT_SUPPORTED_TYPE_CHART",UNKNOWN_UNIT_TYPE:"UNKNOWN_UNIT_TYPE",INVALID_LOG_DOMAIN:"INVALID_LOG_DOMAIN"},S={},M={get:function(t){return S[t]},reg:function(t,e){return S[t]=e,this}},T="taucharts_synthetic_record";M.reg("identity",function(){return{}}).reg("flip",function(t){var e=t.scaleY,n=t.scaleX,r=n.domain(),i=n.discrete?r[0]:Math.max(0,Math.min.apply(Math,r)),a=n.value(i)+-.5*n.stepSize(i);return{flip:!0,scaleX:e,scaleY:n,xi:function(t){return e.value(t[e.dim])},yi:function(t){return n.value(t[n.dim])},y0:function(){return a}}}).reg("obsoleteVerticalStackOrder",function(){return{obsoleteVerticalStackOrder:!0}}).reg("positioningByColor",function(t){return(t.scaleX.discrete?function(t){var e=t.data().reduce(function(e,n){var r=n[t.scaleX.dim],i=n[t.scaleColor.dim];return e.hasOwnProperty(r)||(e[r]=[]),e[r].indexOf(i)<0&&e[r].push(i),e},{}),n=t.scaleX,r=t.scaleColor,i=r.discrete?r.domain():r.originalSeries().sort(function(t,e){return t-e}),a=i.length||1,o=i.reduce(function(t,e,n){return t[e]=n,t},{});return Object.keys(e).forEach(function(t){return e[t].sort(function(t,e){return o[t]-o[e]})}),{xi:function(r){var i=r[t.scaleX.dim],o=e[i]||[r[t.scaleColor.dim]],s=o.length,u=o.indexOf(r[t.scaleColor.dim]),l=function(t){return n.stepSize(t[n.dim])*(a/(1+a))}(r)/(a+1);return t.xi(r)-(s+1)*l/2+(1+u)*l}}}:function(){return{}})(t)}).reg("groupOrderByAvg",function(t){var e=t.data(),n=e.reduce(function(e,n){var r=t.group(n);return e[r]=e[r]||[],e[r].push(n),e},{}),r=Object.keys(n).map(function(e){return[e,(r=n[e],r.map(t.yi).reduce(function(t,e){return t+e},0)/r.length)];var r}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]});return{order:function(t){var e=r.indexOf(t);return e<0?Number.MAX_VALUE:e}}}).reg("stack",function(t){var e=t.data(),n=t.scaleX,r=t.scaleY;if(r.discrete||r.domain().some(function(t){return"number"!=typeof t}))throw new w("Stacked field ["+r.dim+"] should be a number",E.STACKED_FIELD_NOT_NUMBER,{field:r.dim});var i=function(t){return function(e){var i=e[n.dim],a=e[r.dim],o=a>=0?t.positive:t.negative,s=o[i]||0,u=s+a;return o[i]=u,{nextStack:u,prevStack:s}}},a=i({positive:{},negative:{}}),o=i({positive:{},negative:{}}),s=function(e){return te(e,t.id)},u=Number.MAX_VALUE,l=Number.MIN_VALUE,c=function(t){return u=t<u?t:u,l=t>l?t:l,r.value(t)},f=s(function(t){return c(a(t).nextStack)}),d=s(function(t){return c(o(t).prevStack)}),h=function(e){return t.group(e)+"/"+(e[r.dim]>=0?1:-1)},p=$t(e,h),g=Object.keys(p).sort(t.flip||!t.flip&&t.obsoleteVerticalStackOrder?function(e,n){return t.order(e)-t.order(n)}:function(e,n){return t.order(n)-t.order(e)}).reduce(function(t,e){return t.concat(p[e])},[]);return g.forEach(function(t){f(t),d(t)}),r.fixup(function(t){var e={};return(!t.hasOwnProperty("max")||t.max<l)&&(e.max=l),(!t.hasOwnProperty("min")||t.min>u)&&(e.min=u),e}),{group:h,data:function(){return g},yi:f,y0:d}}).reg("size_distribute_evenly",function(t,e){var n=e.minLimit,r=e.maxLimit,i=e.defMin,a=e.defMax,o=t.data(),s=function(t,e){return t-e},u=t.scaleX.discrete?t.scaleX.stepSize()/2:Number.MAX_VALUE,l=o.map(function(e){return t.xi(e)}).sort(s),c=l[0],f=l.slice(1).map(function(t){var e=t-c;return c=t,e}).filter(function(t){return t>0}).sort(s).concat(Number.MAX_VALUE)[0],d=Math.min(f,u),h="number"==typeof n?n:i,p={minSize:h,maxSize:"number"==typeof r?r:Math.max(h,Math.min(a,d))};return t.scaleSize.fixup(function(t){var e={};return t.fixed?t.maxSize>p.maxSize&&(e.maxSize=p.maxSize):(e.fixed=!0,e.minSize=p.minSize,e.maxSize=p.maxSize),e}),{}}).reg("adjustStaticSizeScale",function(t,e){var n=e.minLimit,r=e.maxLimit,i=e.defMin,a=e.defMax,o={minSize:"number"==typeof n?n:i,maxSize:"number"==typeof r?r:a};return t.scaleSize.fixup(function(t){var e={};return t.fixed||(e.fixed=!0,e.minSize=o.minSize,e.maxSize=o.maxSize),e}),{}}).reg("adjustSigmaSizeScale",function(t,e){var n,r,i,a,o=e.minLimit,s=e.maxLimit,u=e.defMin,l=e.defMax,c=function(t,e){return t-e},f=t.data().map(function(e){return t.xi(e)}).sort(c),d=f[0],h=f.slice(1).map(function(t){var e=t-d;return d=t,e}).filter(function(t){return t>0}).sort(c).concat(Number.MAX_VALUE)[0],p=t.scaleX.discrete?t.scaleX.stepSize()/2:Number.MAX_VALUE,g=Math.min(h,p),m="number"==typeof o?o:u,y="number"==typeof s?s:l,v={minSize:m,maxSize:Math.max(m,Math.min(y,(n=g,r=(m+y)/2,i=y,a=m,Math.round(r+(i-r)/(1+Math.exp(-(n-a)/.5))))))};return t.scaleSize.fixup(function(t){var e={};return t.fixed?t.maxSize>v.maxSize&&(e.maxSize=v.maxSize):(e.fixed=!0,e.minSize=v.minSize,e.maxSize=v.maxSize),e}),{}}).reg("avoidScalesOverflow",function(t,e){var n,r,i=e.sizeDirection,a=function(t,e){return!t||t.discrete||"logarithmic"===t.scaleType||i.indexOf(e)<0},o=a(t.scaleX,"x"),s=a(t.scaleY,"y");if(o&&s)return{};t.scaleSize.fixup(function(t){return n=t.minSize,r=t.maxSize,t});var u=t.data().reduce(function(e,i){var a,u,l=t.size(i),c=(l>=n?l:n+l*(r-n))/2;return o||(a=t.xi(i),e.left=Math.min(e.left,a-c),e.right=Math.max(e.right,a+c)),s||(u=t.yi(i),e.top=Math.min(e.top,u-c),e.bottom=Math.max(e.bottom,u+c)),e},{top:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE,left:Number.MAX_VALUE}),l=function(e,n,r,i){var a=e.domain(),o=Math.abs(e.value(a[1])-e.value(a[0])),s=(a[1]-a[0])/o;if(0===o)return 1;var u=Math.max(0,-n),l=Math.max(0,r-o),c=t.flip?l:u,f=t.flip?u:l,d=Number(a[0])-(i?f:c)*s,h=Number(a[1])+(i?c:f)*s;return e.fixup(function(t){var e={};if(t.fixedBorders){var i=t.fixedBorders.slice(),a=i[0],o=i[1];(a>n||o<r)&&(e.min=Math.min(t.min,d),e.max=Math.max(t.max,h),a=Math.min(n,a),o=Math.max(r,o)),e.fixedBorders=[a,o]}else e.fixed=!0,e.min=d,e.max=h,e.nice=!1,e.fixedBorders=[n,r];return e}),o/(c+o+f)},c=o?1:l(t.scaleX,u.left,u.right,!1),f=s?1:l(t.scaleY,u.top,u.bottom,!0),d=Math.min(n*c,n*f),h=Math.min(r*c,r*f);return t.scaleSize.fixup(function(){return{minSize:d,maxSize:h}}),{}}).reg("fillGaps",function(t,e){var n=e.isStack,r=e.xPeriod,i=e.utc,a=$t(t.data(),t.group),o=Object.keys(a).sort(function(e,n){return t.order(e)-t.order(n)}).reduce(function(t,e){return t.concat([a[e]])},[]),s=t.scaleX.dim,u=t.scaleY.dim,l=t.scaleColor.dim,c=t.scaleSplit.dim,f=function(t){return t[u]>=0?1:-1},d=function(e,n,r){var i,a=[e,t.id(n),r].join(" ");return(i={})[s]=e,i[u]=1e-10*r,i[c]=n[c],i[l]=n[l],i[T]=!0,i[T+"id"]=a,i},h=function(t,e,n){var r=$t(e,function(t){return t[s]}),i=e[0];return t.reduce(function(t,e){return t.push.apply(t,r[e]||[d(e,i,n)]),t},[])},p=function(t,e){return t-e},g=function(){return Yt(o.reduce(function(t,e){return t.concat(e.map(function(t){return t[s]}))},[])).sort(p)},m=r?function(){var e=g(),n=Math.max.apply(Math,e.map(function(t){return Number(t)})),a=t.scaleX.domain(),o=x.generate(a[0],a[1],r,{utc:i}).filter(function(t){return t>=a[0]&&t<=a[1]}),s=0,u=[],l=x.get(r,{utc:i});return o.forEach(function(t){var r=Number(t);if(!(r>=n)){for(var i=s;i<e.length;i++)if(Number(l.cast(e[i]))===r)return void s++;u.push(t)}}),e.concat(u).sort(p)}():g(),y=o.map(function(e){return e.sort(function(e,n){return t.xi(e)-t.xi(n)})}).reduce(n?function(t,e){var n=$t(e,function(t){return String(f(t))});return Object.keys(n).reduce(function(t,e){return t.concat(h(m,n[e],e))},t)}:function(t,e){$t(e,function(t){return String(f(t))});var n=Math.max.apply(Math,e.map(function(t){return t[s]}));return t.concat(h(m.filter(function(t){return t<=n}),e,0))},[]);return{data:function(){return y},size:function(e){return e[T]?t.scaleSize(0):t.size(e)},id:function(e){return e[T]?e[T+"id"]:t.id(e)}}});var C=n(5);function k(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return 2===e.length?e[0]*(1-t)+e[1]*t:3===e.length?e[0]*(1-t)*(1-t)+2*e[1]*(1-t)*t+e[2]*t*t:e[0]*(1-t)*(1-t)*(1-t)+3*e[1]*(1-t)*(1-t)*t+3*e[2]*(1-t)*t*t+e[3]*t*t*t}function A(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e.map(function(t){return t.x}),i=e.map(function(t){return t.y});return{x:k.apply(void 0,[t].concat(r)),y:k.apply(void 0,[t].concat(i))}}function O(t,e,n,r,i){var a=A(t,e,n),o=A(t,e,n,r),s=A(t,n,r,i),u=A(t,r,i);return[e,a,o,A(t,o,s),s,u,i]}function P(t,e,n){var r;return void 0===n&&(n="polyline"),function(i){return 0===i?t:1===i?e:(r||(r=("cubic"===n?function(t,e){for(var n=2;n<t.length-1;n+=3)t[n-1].isCubicControl=!0,t[n].isCubicControl=!0;for(n=2;n<e.length-1;n+=3)e[n-1].isCubicControl=!0,e[n].isCubicControl=!0;var r,i;for(t=t.filter(function(t){return!t.isInterpolated}),n=t.length-2;n>=0;n--)i=t[n+1],(r=t[n]).isCubicControl||i.isCubicControl||(t.splice(n+1,0,A(1/3,i,r),A(2/3,i,r)),t[n+1].isCubicControl=!0,t[n+2].isCubicControl=!0);var a=t.filter(function(t,e){return e%3==0}),o=e.filter(function(t,e){return e%3==0}),s=a.map(function(t){return t.id}),u=o.map(function(t){return t.id}),l=s.reduce(function(e,n){return e[n]=t.findIndex(function(t){return t.id===n}),e},{}),c=u.reduce(function(t,n){return t[n]=e.findIndex(function(t){return t.id===n}),t},{}),f=s.filter(function(t){return u.indexOf(t)>=0}),d=a.filter(function(t){return!t.positionIsBeingChanged}),h=o.filter(function(t){return!t.positionIsBeingChanged}),p=H(d,h),g=H(h,d),m=[];f.forEach(function(n,r){var i,a,o,s=l[n],u=c[n];if(0===r&&(s>0||u>0)&&m.push(L({polylineFrom:t.slice(0,s+1),polylineTo:e.slice(0,u+1),toOppositeScale:0===u?p:g,isCubic:!0})),r>0){var d=l[f[r-1]],h=c[f[r-1]];s-d>3||u-h>3?m.push(N({polylineFrom:t.slice(d,s+1),polylineTo:e.slice(h,u+1),isCubic:!0})):m.push((i={polylineFrom:t.slice(d,s+1),polylineTo:e.slice(h,u+1)},a=i.polylineFrom,o=i.polylineTo,function(t){return z(a.slice(1,3),o.slice(1,3),t)}))}m.push(R({pointFrom:t[s],pointTo:e[u]})),r===f.length-1&&(t.length-s-1>0||e.length-u-1>0)&&m.push(L({polylineFrom:t.slice(s),polylineTo:e.slice(u),toOppositeScale:e.length-u==1?p:g,isCubic:!0}))}),0===m.length&&(e.length>0&&0===f.length||t.length>0&&0===f.length)&&m.push(F({polylineFrom:t.slice(0),polylineTo:e.slice(0),isCubic:!0}));return function(t){var e=[];return m.forEach(function(n){var r=n(t);D(e,r)}),e}}:function(t,e){var n=(t=t.filter(function(t){return!t.isInterpolated})).map(function(t){return t.id}),r=e.map(function(t){return t.id}),i=n.filter(function(t){return r.indexOf(t)>=0}),a=t.filter(function(t){return!t.positionIsBeingChanged}),o=e.filter(function(t){return!t.positionIsBeingChanged}),s=H(a,o),u=H(o,a),l=[];i.forEach(function(a,o){var c=n.indexOf(a),f=r.indexOf(a);if(0===o&&(c>0||f>0)&&l.push(L({isCubic:!1,polylineFrom:t.slice(0,c+1),polylineTo:e.slice(0,f+1),toOppositeScale:0===f?s:u})),o>0){var d=n.indexOf(i[o-1]),h=r.indexOf(i[o-1]);(c-d>1||f-h>1)&&l.push(N({isCubic:!1,polylineFrom:t.slice(d,c+1),polylineTo:e.slice(h,f+1)}))}l.push(R({pointFrom:t[c],pointTo:e[f]})),o===i.length-1&&(t.length-c-1>0||e.length-f-1>0)&&l.push(L({isCubic:!1,polylineFrom:t.slice(c),polylineTo:e.slice(f),toOppositeScale:e.length-f==1?s:u}))}),0===l.length&&(e.length>0&&0===i.length||t.length>0&&0===i.length)&&l.push(F({isCubic:!1,polylineFrom:t.slice(0),polylineTo:e.slice(0)}));return function(t){var e=[];return l.forEach(function(n){var r=n(t);D(e,r)}),e}})(t,e)),r(i))}}function L(t){var e=t.polylineFrom,n=t.polylineTo,r=t.isCubic,i=t.toOppositeScale,a=e.length>n.length?e:n,o=1===n.length,s=e[0].id!==n[0].id,u=Boolean(s!==o);return function(t){var e=(r?V:B)({t:t,polyline:a,decreasing:o,rightToLeft:u});o===u?e.shift():e.pop();var n=z(e.map(i),e,o?1-t:t);return n.forEach(function(t){return t.positionIsBeingChanged=!0}),n}}function N(t){var e=t.polylineFrom,n=t.polylineTo,r=t.isCubic,i=e.length,a=n.length;if(a!==i){var o=a<i,s=o?e:n,u=(r?function(t){var e=t.smallerPolyline,n=t.biggerPolyline,r=t.decreasing,i=(e.length-1)/3,a=(n.length-1)/3,o=Math.floor(a/i)+1,s=a%i,u=Gt(i).map(function(t){return o+Number(t<s)}),l=[e[0]],c=3;return u.forEach(function(t){if(t>2){var i=function(t,e){for(var n,r,i=[e[0]],a=0;a<t.length;a++)n=0===a?t[0]:t[a]/(1-t[a-1]),r=G(n,e),D(i,r.slice(1,4)),e=r.slice(3);return D(i,e.slice(1)),i}(Gt(1,t-1).map(function(e){return e/(t-1)}),e.slice(c-3,c+1));Gt(t-2).forEach(function(t){return i[3*(t+1)].id=n[l.length-1+3*t].id}),r&&i.forEach(function(t,e){e>0&&e<i.length-1&&(t.isInterpolated=!0)}),D(l,i.slice(1))}else{var a=Object.assign({},e[c-2]),o=Object.assign({},e[c-1]),s=Object.assign({},e[c]);r||(s.id=n[l.length+2].id),l.push(a,o,s)}c+=3}),l}:function(t){var e=t.smallerPolyline,n=t.biggerPolyline,r=t.decreasing,i=e.length-1,a=n.length-1,o=Math.floor(a/i)+1,s=a%i,u=Gt(i).map(function(t){return o+Number(t<s)}),l=[e[0]],c=1;return u.forEach(function(t){Gt(1,t).forEach(function(i){var a;i===t-1?(a=Object.assign({},e[c]),r||(a.id=n[l.length].id)):((a=I(e[c-1],e[c],i/(t-1))).id=n[l.length].id,r&&(a.isInterpolated=!0)),l.push(a)}),c++}),l})({smallerPolyline:o?n:e,biggerPolyline:s,decreasing:o}),l=s.slice(1,s.length-1),c=u.slice(1,u.length-1);return function(t){var e=z(c,l,o?1-t:t);return e.forEach(function(t){return t.positionIsBeingChanged=!0}),e}}var f=e.slice(1,e.length-1),d=n.slice(1,n.length-1);return function(t){var e=z(f,d,t);return e.forEach(function(t){return t.positionIsBeingChanged=!0}),e}}function R(t){var e=t.pointFrom,n=t.pointTo;return function(t){return[I(e,n,t)]}}function F(t){var e=t.polylineFrom,n=t.polylineTo,r=t.isCubic,i=0===n.length,a=i,o=i?e:n;return function(t){var e=(r?V:B)({t:t,polyline:o,decreasing:i,rightToLeft:a});return e.forEach(function(t,e){e>0&&(t.positionIsBeingChanged=!0)}),e}}function D(t,e){return Array.prototype.push.apply(t,e)}function j(t,e,n){return void 0===e?t:"number"==typeof e?t+n*(e-t):e}function I(t,e,n){if(t===e)return e;var r={};return Object.keys(t).forEach(function(i){return r[i]=j(t[i],e[i],n)}),void 0!==e.id&&(r.id=e.id),r}function z(t,e,n){return t.map(function(t,r){return I(t,e[r],n)})}function B(t){var e=t.t,n=t.polyline,r=t.decreasing,i=t.rightToLeft,a=Boolean(r)!==Boolean(i),o=function(t,e){var n=0;if(t>0){for(var r,i,a,o,s=[0],u=0,l=1;l<e.length;l++)a=e[l-1].x,o=e[l-1].y,r=e[l].x,i=e[l].y,u+=Math.sqrt((r-a)*(r-a)+(i-o)*(i-o)),s.push(u);var c=t*u;for(l=1;l<s.length;l++)if(c<=s[l]){n=Math.min(1,(l-1+(c-s[l-1])/(s[l]-s[l-1]))/(e.length-1));break}}var f=Math.floor((e.length-1)*n)+1,d=e.length-f,h=f,p=e.slice(0,f);if(n<1){var g=n*(e.length-1)%1,m=I(e[f-1],e[f],g);D(p,Gt(d).map(function(t){return Object.assign({},m,{id:e[h+t].id,isInterpolated:!0})}))}return p}(r?1-e:e,a?n.slice(0).reverse():n);return a&&o.reverse(),o}function V(t){var e=t.t,n=t.polyline,r=t.decreasing,i=t.rightToLeft,a=Boolean(r)!==Boolean(i),o=function(t,e){var n=(e.length-1)/3+1,r=0;if(t>0){for(var i,a,o,s,u,l,c,f,d=[0],h=0,p=1;p<n;p++)o=e[3*p-3].x,s=e[3*p-3].y,u=e[3*p-2].x,l=e[3*p-2].y,c=e[3*p-1].x,f=e[3*p-1].y,i=e[3*p].x,a=e[3*p].y,h+=(W(o,s,u,l)+W(u,l,c,f)+W(c,f,i,a)+W(i,a,o,s))/2,d.push(h);var g=t*h;for(p=1;p<d.length;p++)if(g<=d[p]){r=Math.min(1,(p-1+(g-d[p-1])/(d[p]-d[p-1]))/(n-1));break}}var m=Math.floor((n-1)*r)+1,y=n-m,v=3*m,b=e.slice(0,3*(m-1)+1);if(r<1){var x=G(r*(n-1)%1,e.slice(3*(m-1),3*m+1)).slice(1,4);x.forEach(function(t){return t.isInterpolated=!0}),x[2].id=e[v].id,D(b,x),Gt(1,y).forEach(function(t){D(b,[{x:x[2].x,y:x[2].y,isCubicControl:!0,isInterpolated:!0},{x:x[2].x,y:x[2].y,isCubicControl:!0,isInterpolated:!0},Object.assign({},x[2],{id:e[v+3*t].id,isInterpolated:!0})])})}return b}(r?1-e:e,a?n.slice(0).reverse():n);return a&&o.reverse(),o}function H(t,e){var n,r,i,a,o=[],s=[],u=0,l=t.length,c=e.length;for(n=0;n<l;n++)for(i=t[n],r=u;r<c;r++)if(a=e[r],i.id===a.id){u=r+1,o.push(i),s.push(a);break}if(o.length<1||s.length<1)return function(t){return t};var f=Object.keys(o[0]).filter(function(t){return"number"==typeof o[0][t]}).filter(function(t){return"id"!==t}),d={},h=function(t,e,n,r){return function(i){return r+(i-e)*(r-n)/(e-t)}};return f.forEach(function(t){for(var e,n,r=o[0][t],i=s[0][t],a=o.length-1;a>0;a--)if((e=o[a][t])!==r)return n=s[a][t],void(d[t]=h(r,e,i,n));d[t]=function(t,e){return function(n){return n-t+e}}(r,i)}),function(t){var e=Object.assign({},t);return f.forEach(function(n){e[n]=d[n](t[n])}),e}}function W(t,e,n,r){return Math.sqrt((n-t)*(n-t)+(r-e)*(r-e))}function G(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=O(t,n,r,i,a);return[o[1],o[2],o[4],o[5]].forEach(function(t){return t.isCubicControl=!0}),Object.keys(a).forEach(function(e){"x"!==e&&"y"!==e&&"id"!==e&&(o[3][e]=j(n[e],a[e],t))}),o}function U(t,e){if(t.length<2)return t.slice(0);if(2===t.length)return[t[0],{x:X(t[0].x,t[1].x,1/3),y:X(t[0].y,t[1].y,1/3)},{x:X(t[0].x,t[1].x,2/3),y:X(t[0].y,t[1].y,2/3)},t[1]];for(var n,r,i,a,o,s,u,l,c,f,d,h,p,g,m=new Array(3*(t.length-1)+1),y=m.length-1,v=0;v<t.length;v++)m[3*v]=t[v],v>0&&(m[3*v-2]=A(1/3,t[v-1],t[v]),m[3*v-1]=A(2/3,t[v-1],t[v]));for(var b=m.slice(0),x=0;x<3;x++){for(m[1]={x:X(m[0].x,m[3].x,1/3),y:X(m[0].y,X(m[3].y,m[2].y,1.5),2/3)},m[y-1]={x:X(m[y].x,m[y-3].x,1/3),y:X(m[y].y,X(m[y-3].y,m[y-2].y,1.5),2/3)},e&&((m[1].y-m[0].y)*(m[3].y-m[2].y)<0&&(m[1]={x:m[1].x,y:m[0].y}),(m[y-1].y-m[y].y)*(m[y-3].y-m[y-2].y)<0&&(m[y-1]={x:m[y-1].x,y:m[y].y})),v=6;v<b.length;v+=3)n=b[v-5],r=b[v-3],i=b[v-1],(r.x-n.x)*(i.x-r.x)*1e12<1?(a=X(n.x,r.x,.5),s=X(r.x,i.x,.5),o=X(n.y,r.y,.5),u=X(r.y,i.y,.5)):(f=(r.x-n.x)/(i.x-n.x),l=(r.x-n.x*(1-f)*(1-f)-i.x*f*f)/(2*(1-f)*f),c=(r.y-n.y*(1-f)*(1-f)-i.y*f*f)/(2*(1-f)*f),a=X(n.x,l,f),s=X(l,i.x,f),o=X(n.y,c,f),u=X(c,i.y,f),e&&(h=r.x-a,p=s-r.x,d=(u-r.y)/p,(r.y-n.y)*(i.y-r.y)<=0?d=0:(r.y>n.y==u>i.y&&(p=X(p*(g=(i.y-r.y)/(u-r.y)),p,1/(1+Math.abs(g))),d=(i.y-r.y)/p),r.y>n.y==o<n.y&&(h=X(h*(g=(r.y-n.y)/(r.y-o)),h,1/(1+Math.abs(g))),d=(r.y-n.y)/h)),a=r.x-h,s=r.x+p,o=r.y-d*h,u=r.y+d*p)),m[v-4]={x:a,y:o},m[v-2]={x:s,y:u};b=m.slice(0)}return b}function X(t,e,n){return t+n*(e-t)}var q={linear:function(t){return t},step:function(t){for(var e,n,r,i,a=[],o=void 0!==t[0].id,s=void 0!==t[0].size,u=1;u<t.length;u++)e=t[u-1],n=t[u],r={x:(e.x+n.x)/2,y:e.y},i={x:(e.x+n.x)/2,y:n.y},o&&(r.id=e.id+"-"+n.id+"-1",i.id=e.id+"-"+n.id+"-2"),s&&(r.size=e.size,i.size=n.size),1===u&&a.push(e),a.push(r,i,n);return a},"step-before":function(t){for(var e,n,r,i=[],a=void 0!==t[0].id,o=void 0!==t[0].size,s=1;s<t.length;s++)e=t[s-1],n=t[s],r={x:e.x,y:n.y},a&&(r.id=e.id+"-"+n.id),o&&(r.size=n.size),1===s&&i.push(e),i.push(r,n);return i},"step-after":function(t){for(var e,n,r,i=[],a=void 0!==t[0].id,o=void 0!==t[0].size,s=1;s<t.length;s++)e=t[s-1],r={x:(n=t[s]).x,y:e.y},a&&(r.id=e.id+"-"+n.id),o&&(r.size=e.size),1===s&&i.push(e),i.push(r,n);return i}},Y={smooth:function(t){return U(t,!1)},"smooth-keep-extremum":function(t){return U(t,!0)}};function $(t){return q[t]||Y[t]}function K(t){return void 0!==Y[t]?"cubic":"polyline"}var J=function(){return(J=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Q=J({},o,C),Z=function(){return te(function(t){return t.node().getComputedTextLength()},function(t){return t.node().textContent.length})},tt=function(t,e,n){n=n||Z(),t.each(function(){var t=Q.select(this.parentNode).data()[0],r=e(t),i=Q.select(this),a=i.text().split(/\s+/),o=!1,s=a.reduce(function(t,e,a){if(o)return t;var s=a>0?[t,e].join(" "):e,u=n(i.text(s));if(u<r)t=s;else{var l=Math.floor(r/u*s.length);t=s.substr(0,l-4)+"...",o=!0}return t},"");i.text(s)})},et=function(t,e,n,r,i,a){a=a||Z();var o=function(t,e,n,r,i,a,o){var s=o*n+a;return t.append("tspan").attr("x",r).attr("y",i).attr("dy",s+"em").text(e)};t.each(function(){var t=Q.select(this.parentNode).data()[0],s=e(t),u=Q.select(this),l=u.text().split(/\s+/),c=u.attr("x"),f=u.attr("y"),d=parseFloat(u.attr("dy"));u.text(null);var h=o(u,null,1.1,c,f,d,0),p=!1,g=l.length-1,m=l.reduce(function(t,e,r){if(p)return t;var i=t.length===n||r===g,o=t[t.length-1],u=""!==o?o+" "+e:e,l=a(h.text(u)),c=l>s;if(c&&i){var f=Math.floor(s/l*u.length);t[t.length-1]=u.substr(0,f-4)+"...",p=!0}return c&&!i&&t.push(e),c||(t[t.length-1]=u),t},[""]).filter(function(t){return t.length>0});f=i?-1*(m.length-1)*Math.floor(.5*r):f,m.forEach(function(t,e){return o(u,t,1.1,c,f,d,e)}),h.remove()})};var nt=function(t,e,n){return e>0&&!document.hidden&&((t=t.transition(n).duration(e)).attr=rt),t.onTransitionEnd=function(t){return ot(this,t),this},t},rt=function(t,e){var n,r,i=this,a=Q.transition.prototype.attr.apply(this,arguments);if(0===arguments.length)throw new Error("Unexpected `transition().attr()` arguments.");1===arguments.length?r=t:arguments.length>1&&((n={})[t]=e,r=n);var o="__transitionAttrs__",s="__lastTransitions__",u=at();this.each(function(){var t=this,e={};for(var n in r)"function"==typeof r[n]?e[n]=r[n].apply(this,arguments):e[n]=r[n];this[o]=Object.assign(this[o]||{},e),this[o][s]||Object.defineProperty(this[o],s,{value:{}}),Object.keys(e).forEach(function(e){return t[o][s][e]=u})});var l=function(){var t=this;this[o]&&(Object.keys(r).filter(function(e){return t[o][s][e]===u}).forEach(function(e){return delete t[o][e]}),0===Object.keys(this[o]).length&&delete this[o])};return this.on("interrupt."+u,function(){return i.each(l)}),this.on("end."+u,function(){return i.each(l)}),a},it=0,at=function(){return++it},ot=function(t,e){if(Q.transition.prototype.isPrototypeOf(t)&&!t.empty()){var n=function(){return e.call(null,t)};return t.on("interrupt.d3_on_transition_end",n),t.on("end.d3_on_transition_end",n),t}e.call(null,t)},st=function(t,e,n,r){var i=r||function(t){return t},a=function(){i(this)};return function(r){var i=r;return e&&(i=i.call(ct(Qt(e,n)))),i=(i=nt(i,t)).call(ct(n)),t>0?i.on("end.d3_animationInterceptor",function(){return i.each(a)}):i.each(a),i}},ut=function(t,e){var n=t.node();return t.selectAll(e).filter(function(){return this.parentNode===n})},lt=function(t,e,n,r,i){void 0===i&&(i="linear");var a="__pathPoints__";return function(t){var o=this;this[a]||(this[a]=n.map(function(){return[]}));var s=n.map(function(e,n){var s=Yt(t,r).map(e),u=($(i)||$("linear"))(s),l=o[a][n];return{pointsFrom:l,pointsTo:u,interpolate:P(l,u,K(i))}});return function(t){if(0===t){var n=s.map(function(t){return t.pointsFrom});return e.apply(void 0,n)}if(1===t){var r=s.map(function(t){return t.pointsTo});return o[a]=r,e.apply(void 0,r)}var i=s.map(function(e){return e.interpolate(t)});return o[a]=i,e.apply(void 0,i)}}},ct=function(t){return function(e){return Object.keys(t).forEach(function(n){return e.attr(n,t[n])}),e}},ft=function(t){return function(e){return Object.keys(t).forEach(function(n){return e.classed(n,t[n])}),e}},dt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ht=function(t){function e(e){var n=t.call(this,e)||this;n.config=e,n.config.guide=Qt(n.config.guide||{},{animationSpeed:0,enableColorToBarPosition:!1}),n.config.guide.size=n.config.guide.size||{};var r=n.config.stack,i=n.config.guide.enableColorToBarPosition,a=[e.flip&&M.get("flip"),r&&M.get("stack"),i&&M.get("positioningByColor")];return n.decorators=(n.config.transformRules||a).concat(e.transformModel||[]),n.adjusters=(n.config.adjustRules||[]).concat(e.adjustScales||[]),n}return dt(e,t),e.prototype.defineGrammarModel=function(t){var e=this,n=this.config;this.regScale("x",t("pos",n.x,[0,n.options.width])).regScale("y",t("pos",n.y,[n.options.height,0])).regScale("y",t("pos",n.y,function(t){return["ordinal","period"].indexOf(t.type)>=0?[0,n.options.height]:[n.options.height,0]})).regScale("size",t("size",n.size,{})).regScale("color",t("color",n.color,{})).regScale("split",t("split",n.split,{})).regScale("label",t("label",n.label,{})).regScale("identity",t("identity",n.identity,{}));var r=this.getScale("x"),i=this.getScale("y"),a=this.getScale("size"),o=this.getScale("label"),s=this.getScale("color"),u=this.getScale("split"),l=this.getScale("identity"),c=i.domain(),f=i.discrete?c[0]:Math.max(0,Math.min.apply(Math,c)),d=i.value(f)+.5*i.stepSize(f),h=s.domain(),p={data:function(){return e.data()},flip:!1,scaleX:r,scaleY:i,scaleSize:a,scaleLabel:o,scaleColor:s,scaleSplit:u,scaleIdentity:l,color:function(t){return s.value(t[s.dim])},label:function(t){return o.value(t[o.dim])},group:function(t){return t[s.dim]+"(@taucharts@)"+t[u.dim]},order:function(t){var e=t.split("(@taucharts@)")[0],n=h.indexOf(e);return n<0?Number.MAX_VALUE:n},size:function(t){return a.value(t[a.dim])},id:function(t){return l.value(t[l.dim],t)},xi:function(t){return r.value(t[r.dim])},yi:function(t){return i.value(t[i.dim])},y0:function(){return d}};return p.data().forEach(function(t){return p.id(t)}),p},e.prototype.getGrammarRules=function(){return this.decorators.filter(function(t){return t})},e.prototype.getAdjustScalesRules=function(){return(this.adjusters||[]).filter(function(t){return t})},e.prototype.createScreenModel=function(t){var e=t.flip,n=function(t,e,n){return t?e:n};return{flip:e,id:t.id,x:n(e,t.yi,t.xi),y:n(e,t.xi,t.yi),x0:n(e,t.y0,t.xi),y0:n(e,t.xi,t.y0),size:t.size,group:t.group,order:t.order,label:t.label,color:function(e){return t.scaleColor.toColor(t.color(e))},class:function(e){return t.scaleColor.toClass(t.color(e))},model:t,toFibers:function(){var e=$t(t.data(),t.group);return Object.keys(e).sort(function(e,n){return t.order(e)-t.order(n)}).reduce(function(t,n){return t.concat([e[n]])},[])}}},e.prototype.drawFrames=function(){var t=this,e=this.config.options,n=function(e){return n=t.screenModel.size(e)/2,r=4,i=Math.pow(10,r),Math.round(i*n)/i;var n,r,i},r=st,i=function(e,n,i){var a=t.config.guide.animationSpeed,s=e.selectAll("."+n).data(function(t){return[t]},t.screenModel.id);s.exit().call(r(a,null,{width:0},function(t){return o.select(t).remove()})),s.call(r(a,null,i)),s.enter().append("rect").style("stroke-width",0).call(r(a,{width:0},i))},a=this.config.flip,s=a?"y":"x",u=a?"x":"y",l=a?"x0":"y0",c=a?"height":"width",f=a?"width":"height",d=function(e){var r,a,o;i(e,"lvl-top",((r={})[c]=function(t){return n(t)},r[f]=1,r[s]=function(e){return t.screenModel[s](e)-n(e)/2},r[u]=function(e){return t.screenModel[u](e)},r.fill=function(e){return t.screenModel.color(e)},r.class=function(e){return"lvl-top "+t.screenModel.class(e)},r)),i(e,"lvl-btm",((a={})[c]=function(t){return n(t)},a[f]=1,a[s]=function(e){return t.screenModel[s](e)-n(e)/2},a[u]=function(e){return t.screenModel[l](e)},a.fill=function(e){return t.screenModel.color(e)},a.class=function(e){return"lvl-btm "+t.screenModel.class(e)},a)),i(e,"lvl-link",((o={})[c]=.5,o[f]=function(e){return Math.abs(t.screenModel[u](e)-t.screenModel[l](e))},o[s]=function(e){return t.screenModel[s](e)-.25},o[u]=function(e){return Math.min(t.screenModel[u](e),t.screenModel[l](e))},o.fill=function(e){return t.screenModel.color(e)},o.class=function(e){return"lvl-link "+t.screenModel.class(e)},o))},h=function(e){e.attr("class","frame-id-"+t.config.uid).call(function(e){var n=e.selectAll(".generic").data(function(t){return t},t.screenModel.id);n.exit().remove(),n.call(d),n.enter().append("g").attr("class","generic").call(d)})},p=$t(this.data(),t.screenModel.group),g=Object.keys(p).sort(function(e,n){return t.screenModel.order(e)-t.screenModel.order(n)}).reduce(function(t,e){return t.concat([p[e]])},[]),m=e.container.selectAll(".frame-id-"+t.config.uid).data(g);m.exit().remove(),m.call(h),m.enter().append("g").call(h)},e}(m),pt=function(){return(pt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},gt=pt({},s,u);function mt(t,e,n,r){var i=r(n(t),t);return(i[e]||[]).forEach(function(t){return mt(t,e,n,r)}),i}function yt(t,e,n,r){void 0===r&&(r=0),e(t,r)&&(t.units||[]).map(function(t){return yt(t,e,n,r+1)}),n(t,r)}var vt=function(){var t=[];function e(t){for(var e in t)this[e]=t[e]}function n(){this.copiedObjects=[];var t=this;this.recursiveDeepCopy=function(e){return t.deepCopy(e)},this.depth=0}function r(t,e){var r=new n;return e&&(r.maxDepth=e),r.deepCopy(t)}return e.prototype={constructor:e,canCopy:function(t){return!1},create:function(t){},populate:function(t,e,n){}},n.prototype={constructor:n,maxDepth:256,cacheResult:function(t,e){this.copiedObjects.push([t,e])},getCachedResult:function(t){for(var e=this.copiedObjects,n=e.length,r=0;r<n;r++)if(e[r][0]===t)return e[r][1]},deepCopy:function(e){if(null===e)return null;if("object"!=typeof e)return e;var n=this.getCachedResult(e);if(n)return n;for(var r=0;r<t.length;r++){var i=t[r];if(i.canCopy(e))return this.applyDeepCopier(i,e)}throw new Error("no DeepCopier is able to copy "+e)},applyDeepCopier:function(t,e){var n=t.create(e);if(this.cacheResult(e,n),this.depth++,this.depth>this.maxDepth)throw new Error("Exceeded max recursion depth in deep copy.");return t.populate(this.recursiveDeepCopy,e,n),this.depth--,n}},r.DeepCopier=e,r.deepCopiers=t,r.register=function(n){n instanceof e||(n=new e(n)),t.unshift(n)},r.register({canCopy:function(){return!0},create:function(t){return t instanceof t.constructor?"object"==typeof(e=t.constructor.prototype)?JSON.parse(JSON.stringify(e)):e:{};var e},populate:function(t,e,n){for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}}),r.register({canCopy:function(t){return t instanceof Array},create:function(t){return new t.constructor},populate:function(t,e,n){for(var r=0;r<e.length;r++)n.push(t(e[r]));return n}}),r.register({canCopy:function(t){return t instanceof Date},create:function(t){return new Date(t)}}),r}(),bt=function(t){return/^(#|rgb\(|rgba\()/.test(t)},xt=/(.)^/,_t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},wt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Et=/\\|'|\r|\n|\u2028|\u2029/g,St="(?:"+Object.keys(_t).join("|")+")",Mt=RegExp(St),Tt=RegExp(St,"g"),Ct={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};function kt(t){return vt(t)}function At(t){return t instanceof Date&&!isNaN(Number(t))}function Ot(t){return null!=t&&"object"==typeof t}function Pt(t){var e=parseFloat(Math.min.apply(Math,t).toFixed(15)),n=parseFloat(Math.max.apply(Math,t).toFixed(15));e===n&&(n-=(n>=0?-1:1)*(n||1)/10);for(var r=[e=Math.min(0,e),n=Math.max(0,n)],i=r[1]-r[0],a=Math.pow(10,Math.floor(Math.log(i/10)/Math.LN10)),o=10/i*a,s=[[.15,10],[.35,5],[.75,2],[1,1],[2,1]],u=-1;o>s[++u][0];);a*=s[u][1],r[0]=Math.floor(r[0]/a)*a,r[1]=Math.ceil(r[1]/a)*a;var l=e-r[0],c=r[1]-n,f=a/2;if(e<0){var d=l>=f?-l:0;r[0]=r[0]-d}if(n>0){var h=c>=f?-c:0;r[1]=r[1]+h}return[parseFloat(r[0].toFixed(15)),parseFloat(r[1].toFixed(15))]}function Lt(t,e,n){var r=(void 0===n?{utc:!1}:n).utc,i=gt.extent(t),a=i[0],o=i[1],s=+o-+a,u=r?gt.scaleUtc:gt.scaleTime;if(0===s){return a=new Date(a.getTime()-864e5),o=new Date(o.getTime()+864e5),u().domain([a,o]).nice(e).domain()}var l=u().domain([a,o]).nice(e);if(e)return l.domain();var c=u().domain([a,o]).nice(e).domain(),f=c[0],d=c[1],h=l.ticks(),p=h.length-1;return(+a-+f)/(+h[1]-+f)<.5&&(a=f),(+d-+o)/(+d-+h[p-1])<.5&&(o=d),[a,o]}var Nt=0,Rt={};function Ft(t){var e=btoa(encodeURIComponent(t)).replace(/=/g,"_");return Rt.hasOwnProperty(e)||(Rt[e]="H"+ ++Nt),Rt[e]}function Dt(t,e,n){var r=0,i=null,a=te(function(t,e){return Yt(t.map(function(t){return e.reduce(function(e,n){return e.concat(At(r=t[n])?r.getTime():r);var r},[])}),function(t){return JSON.stringify(t)}).reduce(function(t,e){var n=e[0];return t[n]=t[n]||0,t[n]+=1,t},{})},function(t,e){var n=i===t?r:++r;return i=t,e.join("")+"-"+n});return function(r,i,o){var s=o.length,u=n.getSpec(),l=u.sources["/"].data,c=u.unit.units[0].guide||{};c.padding=c.padding||{l:0,r:0,t:0,b:0};var f=0;"x"===t?f=c.padding.l+c.padding.r:"y"===t&&(f=c.padding.t+c.padding.b);var d,h=(i-s*f)/(d=a(l,e),Object.keys(d).reduce(function(t,e){return t+d[e]},0));return(function(t,e){return a(l,t)[e]}(e,r)*h+f)/i}}function jt(t){var e=!0;try{yt(t,function(t){if(0===t.type.indexOf("COORDS.")&&"COORDS.RECT"!==t.type)throw new Error("Not applicable")},function(t){return t})}catch(t){"Not applicable"===t.message&&(e=!1)}return e}function It(t,e,n,r){if(void 0===r&&(r=0),"requestAnimationFrame"===r){var i=!1;return function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];i||(requestAnimationFrame(function(){i=!1}),n.apply(this,r),i=!0),t.e=e,t.ts=Date.now()}}return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o={e:e,ts:Date.now()};(t.e&&t.e===o.e?o.ts-t.ts:r)>=r&&n.apply(this,i),t.e=o.e,t.ts=o.ts}}function zt(t,e){var n=t[0],r=t[1],i=(r-n)/(e-1),a=e>=2?Gt(e-2).map(function(t){return n+i*(t+1)}):[];return[n].concat(a,[r])}function Bt(t){return bt(t)?t:""}function Vt(t){return bt(t)?"":t}function Ht(t){return t/180*Math.PI}function Wt(t){return Math.abs(t)>=360&&(t%=360),t<0&&(t=360+t),t}function Gt(t,e){1===arguments.length&&(e=t,t=0);for(var n=[],r=t;r<e;r++)n.push(r);return n}function Ut(t,e,n,r){return t+e*(90===n?-1:1)-r>100}function Xt(t,e,n,r){return t+e*(-90===n?-1:1)-r>20}function qt(t){return Array.isArray(t)?[].concat.apply([],t.map(function(t){return qt(t)})):t}function Yt(t,e){for(var n={},r=[],i=t.length,a=e||function(t){return String(t)},o=0;o<i;++o){var s=t[o],u=a(s);n.hasOwnProperty(u)||(n[u]=!0,r.push(s))}return r}function $t(t,e){return t.reduce(function(t,n){var r=e(n);return t[r]=t[r]||[],t[r].push(n),t},{})}function Kt(t,e){return Yt(t.concat(e))}function Jt(t,e){return t.filter(function(t){return-1!==e.indexOf(t)})}function Qt(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e.length;if(0===r||!t)return t;for(var i=0;i<r;i++)for(var a=e[i],o=Ot(a)?Object.keys(a):[],s=o.length,u=0;u<s;u++){var l=o[u];void 0===t[l]&&(t[l]=a[l])}return t}function Zt(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=Object.assign({},t);return e.forEach(function(t){delete r[t]}),r}function te(t,e){var n=function(r){var i=n.cache,a=String(e?e.apply(this,arguments):r);return i.hasOwnProperty(a)||(i[a]=t.apply(this,arguments)),i[a]};return n.cache={},n}function ee(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e,n){var r=0;return t.every(function(t){return 0===(r=t(e,n))}),r}}function ne(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return null==t?{}:e.reduce(function(e,n){var r=t[n];return r&&(e[n]=r),e},{})}function re(t){return t=null==t?"":String(t),Mt.test(t)?t.replace(Tt,function(t){return _t[t]}):t}function ie(t,e,n){!e&&n&&(e=n),e=Qt({},e,Ct);var r=RegExp([(e.escape||xt).source,(e.interpolate||xt).source,(e.evaluate||xt).source].join("|")+"|$","g"),i=0,a="__p+='";t.replace(r,function(e,n,r,o,s){return a+=t.slice(i,s).replace(Et,function(t){return"\\"+wt[t]}),i=s+e.length,n?a+="'+\n((__t=("+n+"))==null?'':utils.escape(__t))+\n'":r?a+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(a+="';\n"+o+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var o=new Function(e.variable||"obj",a)}catch(t){throw t.source=a,t}var s=function(t){return o.call(this,t)},u=e.variable||"obj";return s.source="function("+u+"){\n"+a+"}",s}function ae(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var oe="  ",se=32,ue=["img","input","br","embed","link","meta","area","base","basefont","bgsound","col","command","frame","hr","image","isindex","keygen","menuitem","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","rect"].reduce(function(t,e){return t[e]=!0,t},{});function le(t){var e=2,n=arguments[1];("object"!=typeof arguments[1]||Array.isArray(arguments[1]))&&(e=1,n={});var r=qt(Array.prototype.slice.call(arguments,e)),i=1===r.length&&"<"!==r[0].trim()[0],a=ue[t];if(a&&r.length>0)throw new Error('Tag "'+t+'" is void but content is assigned to it');var o="<"+t,s=Object.keys(n).map(function(t){return" "+t+'="'+n[t]+'"'}).join("");s.length>se&&(s=Object.keys(n).map(function(t){return"\n"+oe+t+'="'+n[t]+'"'}).join(""));var u=i?r[0]:"\n"+r.map(function(t){return String(t).split("\n").map(function(t){return""+oe+t}).join("\n")}).join("\n")+"\n";return""+o+s+(a?"/>":">"+u+"</"+t+">")}function ce(t){var e=t,n={then:function(t){return e=t(e),n},result:function(){return e}};return n}var fe=[ht];function de(t){return fe.some(function(e){return t instanceof e})}function he(t){return(t.units||[]).some(function(t){return t.hasOwnProperty("units")})}var pe=document.createElement("div"),ge=new WeakMap;function me(t,e){var n;return t instanceof Node?n=t:(pe.insertAdjacentHTML("afterbegin",t),n=pe.childNodes[0]),e.appendChild(n),n}function ye(t){if(ge.has(t))return ge.get(t);var e=t.style.overflow;t.style.overflow="scroll";var n={width:t.offsetWidth-t.clientWidth,height:t.offsetHeight-t.clientHeight};return t.style.overflow=e,ge.set(t,n),n}function ve(t,e){var n="horizontal"===(e=e||"both")||"both"===e,r="vertical"===e||"both"===e,i=ye(t),a=r?i.width+"px":"0",o=n?i.height+"px":"0";t.style.overflow="hidden",t.style.padding="0 "+a+" "+o+" 0";var s=t.scrollWidth>t.clientWidth,u=t.scrollHeight>t.clientHeight,l=r&&!u?i.width+"px":"0",c=n&&!s?i.height+"px":"0";return t.style.padding="0 "+l+" "+c+" 0",t.style.overflow="",t.style.overflowX=s?"scroll":"hidden",t.style.overflowY=u?"scroll":"hidden",i}function be(t,e){return window.getComputedStyle(t).getPropertyValue(e)}function xe(t,e){return parseInt(be(t,e)||"0",10)}function _e(t){var e=xe(t,"padding-left"),n=xe(t,"padding-right"),r=xe(t,"padding-bottom"),i=xe(t,"padding-top"),a=xe(t,"border-top-width")+xe(t,"border-left-width")+xe(t,"border-right-width")+xe(t,"border-bottom-width"),o=t.getBoundingClientRect();return{width:o.width-e-n-2*a,height:o.height-r-i-2*a}}function we(t){var e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.width="100px",e.style.height="100px",e.style.border="1px solid green",e.style.top="0",document.body.appendChild(e),e.innerHTML='<svg class="tau-chart__svg">\n                <g class="tau-chart__cell cell">\n                <g class="x axis">\n                <g class="tick"><text></text></g>\n                </g>\n                </g>\n                </svg>';var n=e.querySelector(".x.axis .tick text");n.textContent=t;var r={width:0,height:0},i=n.getBoundingClientRect();r.width=i.right-i.left,r.height=i.bottom-i.top;var a=0!==t.length?r.width/t.length:0;return r.width=r.width+1.5*a,document.body.removeChild(e),r}function Ee(t,e){var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,a="string"==typeof n?n:n+"px",o=t.map(function(t){for(var e=0,n=0;e<=t.length-1;e++){n+=Se(t.charAt(e),{fontSize:a,fontFamily:r,fontWeight:i}).width}return n}).sort(function(t,e){return e-t})[0],s=t.length,u=parseInt(a);return{width:o,height:u*s+.39*u*s}}var Se=te(function(t,e){var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,a=document.createElement("div");a.style.position="absolute",a.style.visibility="hidden",a.style.border="0px",a.style.top="0",a.style.fontSize=n,a.style.fontFamily=r,a.style.fontWeight=i,document.body.appendChild(a),a.innerHTML=" "===t?"&nbsp;":t;var o={width:0,height:0},s=a.getBoundingClientRect();return o.width=s.right-s.left,o.height=s.bottom-s.top,document.body.removeChild(a),o},function(t,e){return t+"_"+JSON.stringify(e)});function Me(t,e){var n={".":function(t,e){return e.classed(t,!0)},"#":function(t,e){return e.attr("id",t)}},r=Object.keys(n).join("");if(e.indexOf(" ")>=0)throw new Error("Selector should not contain whitespaces.");if(r.indexOf(e[0])>=0)throw new Error("Selector must have tag at the beginning.");var i,a=t instanceof Element,s=a?o.select(t):t,u=function(t){return a?t.node():t},l=s.selectAll(e).filter(function(){return this.parentNode===s.node()}).filter(function(t,e){return 0===e});if(!l.empty())return u(l);for(var c,f=-1,d=null,h=1,p=e.length;h<=p;h++)(h==p||r.indexOf(e[h])>=0)&&(c=e.substring(f+1,h),f<0?i=s.append(c):n[d].call(null,c,i),d=e[h],f=h);return u(i)}function Te(t,e){return Ce(t,e)[0]||null}function Ce(t,e){for(var n=[],r=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,i=t.firstElementChild;Boolean(i);i=i.nextElementSibling)r.call(i,e)&&n.push(i);return n}function ke(t,e){if(t.childElementCount>0){var n,r,i=Array.prototype.filter.call(t.childNodes,function(t){return t.nodeType===Node.ELEMENT_NODE}),a=i.slice().sort(e),o=i.reduce(function(t,e,n){return t.set(e,n),t},new Map),s=a.reduce(function(t,e,i){var s=o.get(e),u=i-s;return u!==r&&(n&&t.push(n),r=u,n={from:s,to:i,elements:[]}),n.elements.push(e),i===a.length-1&&t.push(n),t},[]),u=s.slice().sort(function(t,e){return t.from-e.from}),l=u.reduce(function(t,e,n){return t.set(e,n),t},new Map),c=function(t){for(var e,n,r,i=s.map(function(t,e){return{elements:t.elements,from:l.get(t),to:e}}).sort(ee(function(t,e){return t.elements.length-e.elements.length},t?function(t,e){return e.to-t.to}:function(t,e){return t.to-e.to})),a=0;a<i.length;a++){if((n=i[a]).from>n.to)for(e=a+1;e<i.length;e++)(r=i[e]).from>=n.to&&r.from<n.from&&r.from++;if(n.from<n.to)for(e=a+1;e<i.length;e++)(r=i[e]).from>n.from&&r.from<=n.to&&r.from--}return i.filter(function(t){return t.from!==t.to})},f=c(!0),d=c(!1),h=f.length<d.length?f:d,p=u.map(function(t){return t.elements});h.forEach(function(e){var n,r=p.splice(e.from,1)[0],i=p[e.to],a=i?i[0]:null;1===e.elements.length?n=r[0]:(n=document.createDocumentFragment(),r.forEach(function(t){n.appendChild(t)})),t.insertBefore(n,a),p.splice(e.to,0,r)})}}function Ae(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[];return t.filter(function(t){return Boolean(t)}).forEach(function(t){"string"==typeof t?n.push(t):"object"==typeof t&&n.push.apply(n,Object.keys(t).filter(function(e){return Boolean(t[e])}))}),Yt(n).join(" ").trim().replace(/\s{2,}/g," ")}function Oe(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=document.createEvent("MouseEvents"),o=[!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null],s=r.concat(o.slice(r.length));(n=a).initMouseEvent.apply(n,[e].concat(s)),t.dispatchEvent(a)}function Pe(t,e){return"translate("+t+","+e+")"}function Le(t){return"rotate("+t+")"}function Ne(t){return["bottom","top"].indexOf(t.toLowerCase())>=0?"h":"v"}function Re(t){var e={x:0,y:0},n=t.indexOf("translate(");if(n>=0){var r=t.indexOf(")",n+10),i=t.substring(n+10,r).trim().replace(","," ").replace(/\s+/," ").split(" ");e.x=parseFloat(i[0]),i.length>1&&(e.y=parseFloat(i[1]))}return e}function Fe(t,e,n,r,i,a,o,s){var u,l,c,f,d,h;return h=((c=o-i)*(e-a)-(f=s-a)*(t-i))/(-c*(l=r-e)+(u=n-t)*f),(d=(-l*(t-i)+u*(e-a))/(-c*l+u*f))>=0&&d<=1&&h>=0&&h<=1}function De(t){for(var e,n,r={x:0,y:0},i=t;i&&"SVG"!==i.nodeName.toUpperCase();)(n=i.getAttribute("transform"))&&(e=Re(n),r.x+=e.x,r.y+=e.y),i=i.parentNode;return r}function je(t,e,n){var r=t.selectAll(e).filter(n);if(!r.empty()){var i=o.select(r.node().parentNode).selectAll(e).filter(function(t){return!n(t)}).nodes(),a=i[i.length-1];if(a){var s=Array.prototype.indexOf.call(a.parentNode.childNodes,a),u=a.nextSibling;r.each(function(){Array.prototype.indexOf.call(this.parentNode.childNodes,this)>s||this.parentNode.insertBefore(this,u)})}}}var Ie=function(t){return At(t)?t.getTime():t},ze={cross:function(t,e,n){var r=t(),i=Yt(r.map(function(t){return t[e]}),Ie),a=Yt(r.map(function(t){return t[n]}),Ie),o=0===i.length?[null]:i;return(0===a.length?[null]:a).reduce(function(t,r){return t.concat(o.map(function(t){var i={};return e&&(i[e]=Ie(t)),n&&(i[n]=Ie(r)),i}))},[])},cross_period:function(t,e,n,r,i,a){var o=t(),s=!!a&&a.utcTime,u=Yt(o.map(function(t){return t[e]}),Ie),l=Yt(o.map(function(t){return t[n]}),Ie),c=0===u.length?[null]:u,f=0===l.length?[null]:l;return r&&(c=x.generate(Math.min.apply(Math,u),Math.max.apply(Math,u),r,{utc:s})),i&&(f=x.generate(Math.min.apply(Math,l),Math.max.apply(Math,l),i,{utc:s})),f.reduce(function(t,r){return t.concat(c.map(function(t){var i={};return e&&(i[e]=Ie(t)),n&&(i[n]=Ie(r)),i}))},[])},groupBy:function(t,e){return Yt(t().map(function(t){return t[e]}),Ie).map(function(t){var n;return(n={})[e]=Ie(t),n})},none:function(){return[null]}},Be=function(){function t(t,e,n){var r=t.key,i=t.pipe,a=t.source,o=t.units;void 0===n&&(n={}),this.key=r,this.pipe=i||[],this.source=a,this.units=o,this._frame={key:r,source:a,pipe:this.pipe},this._data=e,this._pipeReducer=function(t,e){return n[e.type](t,e.args)}}return t.prototype.hash=function(){return Ft([this._frame.pipe,this._frame.key,this._frame.source].map(function(t){return JSON.stringify(t)}).join(""))},t.prototype.full=function(){return this._data},t.prototype.part=function(t){return void 0===t&&(t=function(t){return t}),this._frame.pipe.map(t).reduce(this._pipeReducer,this._data)},t}(),Ve=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),He=function(t){return At(t)?t.getTime():t},We=function(t){var e=this;Object.keys(t).forEach(function(n){return e[n]=t[n]})},Ge=function(t,e,n){return t.map(function(t){return"string"==typeof t?n.get(t):t}).filter(function(t){return t}).reduce(function(t,e){return n=t,void 0===(r=e(t,{}))&&(r={}),Object.assign(new We(n),r);var n,r},e)},Ue=function(t){function e(e,n,r,i){var a=t.call(this)||this;return Qt(e.scales,{size_null:{type:"size",source:"?"},split_null:{type:"value",source:"?"},label_null:{type:"value",source:"?"},color_null:{type:"color",source:"?"},identity_null:{type:"identity",source:"?"},"size:default":{type:"size",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"},"label:default":{type:"value",source:"?"},"identity:default":{type:"identity",source:"?"}}),e.settings=e.settings||{},a.config=e,a.sources=e.sources,a.scales=e.scales,a.unitSet=r,a.grammarRules=i,a.scalesHub=n,a.transformations=Object.assign(e.transformations||{},{where:function(t,e){var n=Object.keys(e||{}).map(function(t){return function(n){return He(n[t])===e[t]}});return t.filter(function(t){return n.every(function(e){return e(t)})})}}),a}return Ve(e,t),e.traverseSpec=function(t,e,n,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var a=[],o=function(t,e,n,r,i){a.push(function(){e(t,r,i)}),t.frames&&t.frames.forEach(function(r){(r.units||[]).map(function(i){return o(i,e,n,t,r)})}),a.push(function(){return n(t,r,i)})};return o(t.unit,e,n,r,i),a},e.prototype.unfoldStructure=function(){return this.root=this._expandUnitsStructure(this.config.unit),this.config},e.prototype.getDrawScenarioQueue=function(t){var e=this,n=this.grammarRules,r=this._flattenDrawScenario(t,function(t,r,i){var a=!1===r.expression.inherit?null:i,o=e._createFrameScalesFactoryMethod(a),s=e.unitSet.create(r.type,Object.assign({},r,{options:t.allocateRect(i.key)})),u=new We(s.defineGrammarModel(o)),l=Ge(s.getGrammarRules(),u,n);return Ge(s.getAdjustScalesRules(),l,n),s.node().screenModel=s.createScreenModel(l),s}),i=this._flattenDrawScenario(t,function(t,r,i){var a=!1===r.expression.inherit?null:i,o=e._createFrameScalesFactoryMethod(a),s=e.unitSet.create(r.type,Object.assign({},r,{options:t.allocateRect(i.key)})),u=new We(s.defineGrammarModel(o)),l=Ge(s.getGrammarRules(),u,n);return s.node().screenModel=s.createScreenModel(l),s.parentUnit=t,s.addInteraction(),s});return r.concat(function(){Object.keys(e.scales).forEach(function(t){return e.scalesHub.createScaleInfo(e.scales[t]).commit()})}).concat(i)},e.prototype._flattenDrawScenario=function(t,n){var r={},i=[],a=[t],o=e.traverseSpec({unit:this.root},function(t,e,o){var s;t.uid=(s=Ft((e?e.uid+"/":"")+JSON.stringify(Object.keys(t).filter(function(e){return"string"==typeof t[e]}).reduce(function(e,n){return e[n]=t[n],e},{}))+"-"+JSON.stringify(o.pipe)),r.hasOwnProperty(s)?s+="-"+ ++r[s]:r[s]=0,s),t.guide=kt(t.guide);var u,l=n(a[0],t,o);i.push(l),0===t.type.indexOf("COORDS.")&&(u=l,a.unshift(u))},function(t){0===t.type.indexOf("COORDS.")&&a.shift()},null,this._datify({source:this.root.expression.source,pipe:[]}));return o.push(function(){return i}),o},e.prototype._expandUnitsStructure=function(t,e){var n=this;void 0===e&&(e=[]);var r=this;if(!1===t.expression.operator)t.frames=t.frames.map(function(t){return r._datify(t)});else{var i=this._parseExpression(t.expression,e,t.guide);t.transformation=t.transformation||[],t.frames=i.exec().map(function(n){var a=(i.inherit?e:[]).concat([{type:"where",args:n}]).concat(t.transformation);return r._datify({key:n,pipe:a,source:i.source,units:t.units?t.units.map(function(t){var e=kt(t);return e.guide=t.guide,e}):[]})})}return t.frames.forEach(function(t){return t.units.forEach(function(e){return n._expandUnitsStructure(e,t.pipe)})}),t},e.prototype._createFrameScalesFactoryMethod=function(t){var e=this;return function(n,r,i){var a=r||n+":default";return e.scalesHub.createScaleInfo(e.scales[a],t).create("function"==typeof i?i(e.scales[a]):i)}},e.prototype._datify=function(t){return new Be(t,this.sources[t.source].data,this.transformations)},e.prototype._parseExpression=function(t,e,n){var r=this,i=t.operator||"none",a=t.source,o=!1!==t.inherit,s=t.params,u={source:a,pipe:o?e:[]},l=function(){return r._datify(u).part()},c=ze[i];if(!c)throw new Error(i+" operator is not supported");return{source:a,inherit:o,func:c,args:s,exec:function(){return c.apply(void 0,[l].concat(s||[],[n]))}}},e}(h),Xe="tau-chart__",qe=n(10),Ye=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();qe.Tooltip.defaults.baseClass=Xe+"tooltip";var $e=["top","bottom"];var Ke,Je,Qe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ye(e,t),e.prototype._pickPlace=function(t){if(!this.options.auto)return this.options.place;var e,n,r,i,a,o,s,u,l=0|this.options.winBound,c=(e=l,r=window,i=document.documentElement,a=(r.pageYOffset||i.scrollTop)-i.clientTop,o=(r.pageXOffset||i.scrollLeft)-i.clientTop,s=r.innerWidth||i.clientWidth,u=r.innerHeight||i.clientHeight,{top:(n={top:a,right:o+s,bottom:a+u,left:o,width:s,height:u}).top+e,right:n.right-e,bottom:n.bottom-e,left:n.left+e,width:n.width-2*e,height:n.height-2*e}),f=this.options.place.split("-"),d=this.spacing;if(-1!==$e.indexOf(f[0]))switch(t.top-this.height-d<=c.top?f[0]="bottom":t.bottom+this.height+d>=c.bottom&&(f[0]="top"),f[1]){case"left":t.right-this.width<=c.left&&(f[1]="right");break;case"right":t.left+this.width>=c.right&&(f[1]="left");break;default:t.left+t.width/2+this.width/2>=c.right?f[1]="left":t.right-t.width/2-this.width/2<=c.left&&(f[1]="right")}else switch(t.left-this.width-d<=c.left?f[0]="right":t.right+this.width+d>=c.right&&(f[0]="left"),f[1]){case"top":t.bottom-this.height<=c.top&&(f[1]="bottom");break;case"bottom":t.top+this.height>=c.bottom&&(f[1]="top");break;default:t.top+t.height/2+this.height/2>=c.bottom?f[1]="top":t.bottom-t.height/2-this.height/2<=c.top&&(f[1]="bottom")}return f.join("-")},e}(qe.Tooltip),Ze=function(){function t(t,e){this.chart=e,this.handlers=new Map,this.plugins=t.map(this.initPlugin,this)}return t.prototype.initPlugin=function(t){var e=this;t.init&&t.init(this.chart);var n=[];this.handlers.set(t,n);var r=function(r,i){n.push(e.chart.on(r,i,t))};return t.destroy&&r("destroy",t.destroy.bind(t)),Object.keys(t).forEach(function(e){if(0===e.indexOf("on")){var n=e.substr(2).toLowerCase();r(n,t[e].bind(t))}}),t},t.prototype.destroyPlugin=function(t){var e=this;t.destroy&&t.destroy(),this.handlers.get(t).forEach(function(n){e.chart.removeHandler(n,t)})},t.prototype.destroy=function(){var t=this;this.plugins.forEach(function(e){return t.destroyPlugin(e)})},t}(),tn={},en={},nn={reg:function(t,e,n){return n?(en[t]=n,tn[t]=function(t,e){this.___tauchartsseed___=new e(this.init(t))},tn[t].prototype=Object.assign({init:function(t){return t},defineGrammarModel:function(t){return this.node().defineGrammarModel(t)},getGrammarRules:function(t){return this.node().getGrammarRules(t)},getAdjustScalesRules:function(t){return this.node().getAdjustScalesRules(t)},createScreenModel:function(t){return this.node().createScreenModel(t)},addInteraction:function(){this.node().addInteraction()},node:function(){return this.___tauchartsseed___},draw:function(){this.node().draw()}},e)):tn[t]=e,this},get:function(t){if(!tn.hasOwnProperty(t))throw new w("Unknown unit type: "+t,E.UNKNOWN_UNIT_TYPE);return tn[t]},create:function(t,e){var n,r=this.get(t);en[t]?n=new r(e,this.get(en[t])):n=new r(e);return n}},rn={},an={},on={reg:function(t,e,n){return void 0===n&&(n=function(t){return t}),rn[t]=e,an[t]=n,on},get:function(t){return rn[t]},instance:function(t){return void 0===t&&(t={}),{create:function(e,n,r){return new(on.get(e))(n,(0,an[e])(r,t))}}}},sn=function(){function t(t,e,n){this.registry=t,this.sources=e,this.scales=n}return t.prototype.createScaleInfo=function(t,e){void 0===e&&(e=null);var n=t.dim,r=t.source,i=(this.sources[r].dims[n]||{}).type,a=this.sources[r].data,o=e||new Be({source:r},a);return t.dimType=i,this.registry.create(t.type,o,t)},t.prototype.createScaleInfoByName=function(t,e){return void 0===e&&(e=null),this.createScaleInfo(this.scales[t],e)},t}(),un=function(t,e,n){var r=!0,i=null;try{t.reduce(function(t,r){var a=function(t,e){var n=r[e],i=Ot(n)?JSON.stringify(n):n;return t.push(i),t},o=e.reduce(a,[]).join("/"),s=n.reduce(a,[]).join("/");if(t.hasOwnProperty(o)){var u=t[o];if(u!==s)throw i={type:"RelationIsNotAFunction",keyX:e.join("/"),keyY:n.join("/"),valX:o,errY:[u,s]},new Error("RelationIsNotAFunction")}else t[o]=s;return t},{})}catch(t){if("RelationIsNotAFunction"!==t.message)throw t;r=!1}return{result:r,error:i}},ln=function(t,e){var n=Object.keys(t).reduce(function(e,n){var r=t[n];return r.hasOwnProperty("hasNull")&&!r.hasNull||"measure"!==r.type&&"period"!==r.scale||e.push(n),e},[]);return function(t){var r=!n.some(function(e){return!t.hasOwnProperty(e)||null===t[e]});return r||e(t),r}},cn=function(t){var e={category:"ordinal",order:"ordinal",measure:"linear"},n={};return Object.keys(t).forEach(function(r){var i=t[r],a=(i.type||"category").toLowerCase();n[r]=Object.assign({},i,{type:a,scale:i.scale||e[a],value:i.value})}),n},fn=function(t){var e={type:"category",scale:"ordinal"};return t.reduce(function(t,n){return Object.keys(n).forEach(function(r){var i=n.hasOwnProperty(r)?n[r]:null;if(t[r]=t[r]||{type:null,hasNull:!1},null===i)t[r].hasNull=!0;else{var a=function(t,e){var n=e;return At(t)?(n.type="measure",n.scale="time"):Ot(t)?(n.type="order",n.scale="ordinal"):Number.isFinite(t)&&(n.type="measure",n.scale="linear"),n}(i,kt(e)),o=a.type,s=a.scale,u=null!==t[r].type&&t[r].type!==o;t[r].type=u?e.type:o,t[r].scale=u?e.scale:s}}),t},{})},dn=function(t,e,n){var r=t,i=["period","time"].indexOf(n.scale)>=0?function(t){return new Date(t)}:function(t){return t},a=t.reduce(function(t,e,n){return t.set(e,n),t},new Map);if("measure"===n.type||"period"===n.scale)r=t.slice().sort(ee(function(t,n){return i(t[e])-i(n[e])},function(t,e){return a.get(t)-a.get(e)}));else if(n.order){var o=n.order.reduce(function(t,e,n){return t[e]=n,t},{}),s=n.order.length,u="(___"+e+"___)";r=t.map(function(t){var n=o[t[e]];return n=n>=0?n:s,t[u]=n,t}).sort(ee(function(t,e){return t[u]-e[u]},function(t,e){return a.get(t)-a.get(e)})).map(function(t){return delete t[u],t})}return r},hn=function(t,e){var n=document.createElement("div");return n.classList.add(Xe+t),e&&e.appendChild(n),n},pn=function(){var t=hn("layout"),e=hn("layout__header",t),n=hn("layout__container",t),r=hn("layout__sidebar",n),i=hn("layout__content",n),a=hn("layout__content__wrap",i),o=hn("layout__sidebar-right",n);return{layout:t,header:e,content:a,contentContainer:i,leftSidebar:r,rightSidebar:hn("layout__sidebar-right__wrap",o),rightSidebarContainer:o,footer:hn("layout__footer",t)}},gn=function(){function t(t){this.spec=t,this.dist={sources:{"?":{dims:{},data:[{}]},"/":{dims:{},data:[]}},scales:{x_null:{type:"ordinal",source:"?"},y_null:{type:"ordinal",source:"?"},size_null:{type:"size",source:"?"},color_null:{type:"color",source:"?"},split_null:{type:"value",source:"?"},"pos:default":{type:"ordinal",source:"?"},"size:default":{type:"size",source:"?"},"label:default":{type:"value",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"}},settings:t.settings}}return t.prototype.convert=function(){var t=this.spec,e=this.dist;return this.ruleAssignSourceDims(t,e),this.ruleAssignStructure(t,e),this.ruleAssignSourceData(t,e),this.ruleApplyDefaults(e),e},t.prototype.ruleApplyDefaults=function(t){var e=t.settings||{},n=function(t,e,r){e(t,r),(t.units||[]).map(function(r){return n(r,e,t)})};n(t.unit,function(t,n){if(t.namespace="chart",t.guide=Qt(t.guide||{},{animationSpeed:e.animationSpeed||0,utcTime:e.utcTime||!1}),n&&!t.hasOwnProperty("units")){t=Qt(t,{x:n.x,y:n.y});var r=kt(n.guide)||{};t.guide.x=Qt(t.guide.x||{},r.x),t.guide.y=Qt(t.guide.y||{},r.y),t.expression.inherit=n.expression.inherit}return!n||t.guide&&t.guide.hasOwnProperty("obsoleteVerticalStackOrder")||(t.guide=Object.assign(t.guide||{},{obsoleteVerticalStackOrder:(n.guide||{}).obsoleteVerticalStackOrder})),t},null)},t.prototype.ruleAssignSourceData=function(t,e){var n=t.spec.dimensions||{},r=e.sources["/"].dims,i=function(t,e){var n=t[e];return Ot(n)&&!At(n)&&Object.keys(n).forEach(function(r){return t[e+"."+r]=n[r]}),t};e.sources["/"].data=t.data.map(function(t){var e=Object.keys(t).reduce(i,t);return Object.keys(r).reduce(function(t,e){return t.hasOwnProperty(e)||(t[e]=null),null!==t[e]&&n[e]&&["period","time"].indexOf(n[e].scale)>=0&&(t[e]=new Date(t[e])),t},e)})},t.prototype.ruleAssignSourceDims=function(t,e){var n=t.spec.dimensions;e.sources["/"].dims=Object.keys(n).reduce(function(t,e){return t[e]={type:n[e].type},t},{})},t.prototype.ruleAssignStructure=function(t,e){var n=this,r=function(t){var i=kt(Zt(t,"unit"));return n.ruleCreateScales(t,i,e.settings),i.expression=n.ruleInferExpression(t),t.unit&&(i.units=t.unit.map(r)),i},i=r(t.spec.unit);i.expression.inherit=!1,e.unit=i},t.prototype.ruleCreateScales=function(t,e,n){var r=this,i=t.guide||{};["identity","color","size","label","x","y","split"].forEach(function(a){t.hasOwnProperty(a)&&(e[a]=r.scalesPool(a,t[a],i[a]||{},n))})},t.prototype.ruleInferDim=function(t,e){var n=t,r=this.spec.spec.dimensions;if(!r.hasOwnProperty(n))return n;e.hasOwnProperty("tickLabel")?n=t+"."+e.tickLabel:r[t].value&&(n=t+"."+r[t].value);var i=this.dist.sources["/"].dims;return i.hasOwnProperty(n)||(i[n]={type:i[t].type},delete i[t]),n},t.prototype.scalesPool=function(t,e,n,r){var i=t+"_"+e;if(this.dist.scales.hasOwnProperty(i))return i;var a=this.spec.spec.dimensions,o={};if("color"===t&&null!==e&&(o={type:"color",source:"/",dim:this.ruleInferDim(e,n)},n.hasOwnProperty("brewer")&&(o.brewer=n.brewer),a[e]&&a[e].hasOwnProperty("order")&&(o.order=a[e].order),n.hasOwnProperty("min")&&(o.min=n.min),n.hasOwnProperty("max")&&(o.max=n.max),n.hasOwnProperty("nice")&&(o.nice=n.nice)),"size"===t&&null!==e&&(o={type:"size",source:"/",dim:this.ruleInferDim(e,n)},n.hasOwnProperty("func")&&(o.func=n.func),n.hasOwnProperty("min")&&(o.min=n.min),n.hasOwnProperty("max")&&(o.max=n.max),n.hasOwnProperty("minSize")&&(o.minSize=n.minSize),n.hasOwnProperty("maxSize")&&(o.maxSize=n.maxSize)),"label"===t&&null!==e&&(o={type:"value",source:"/",dim:this.ruleInferDim(e,n)}),"split"===t&&null!==e&&(o={type:"value",source:"/",dim:this.ruleInferDim(e,n)}),"identity"===t&&null!==e&&(o={type:"identity",source:"/",dim:this.ruleInferDim(e,n)}),a.hasOwnProperty(e)&&("x"===t||"y"===t)){if(o={type:a[e].scale,source:"/",dim:this.ruleInferDim(e,n)},a[e].hasOwnProperty("order")&&(o.order=a[e].order),n.hasOwnProperty("min")&&(o.min=n.min),n.hasOwnProperty("max")&&(o.max=n.max),n.hasOwnProperty("autoScale")?o.autoScale=n.autoScale:o.autoScale=!0,n.hasOwnProperty("nice")?o.nice=n.nice:o.nice=o.autoScale,n.hasOwnProperty("niceInterval")?o.niceInterval=n.niceInterval:o.niceInterval=null,n.hasOwnProperty("tickPeriod")&&(o.period=n.tickPeriod,o.type="period"),n.hasOwnProperty("tickPeriod")&&n.hasOwnProperty("timeInterval"))throw new Error('Use "tickPeriod" for period scale, "timeInterval" for time scale, but not both');if(n.hasOwnProperty("timeInterval")){o.period=n.timeInterval,o.type="time";var s=x.get(o.period,{utc:r.utcTime});n.hasOwnProperty("min")&&(o.min=s.cast(new Date(n.min))),n.hasOwnProperty("max")&&(o.max=s.cast(new Date(n.max)))}o.fitToFrameByDims=n.fitToFrameByDims,o.ratio=n.ratio}return this.dist.scales[i]=o,i},t.prototype.getScaleConfig=function(t,e){var n=t+"_"+e;return this.dist.scales[n]},t.prototype.ruleInferExpression=function(t){var e={operator:"none",params:[]},n=t.guide||{},r=n.x||{},i=n.y||{},a=this.getScaleConfig("x",t.x),o=this.getScaleConfig("y",t.y);return 0===t.type.indexOf("ELEMENT.")?t.color&&(e={operator:"groupBy",params:[this.ruleInferDim(t.color,n.color||{})]}):"COORDS.RECT"===t.type&&1===t.unit.length&&"COORDS.RECT"===t.unit[0].type&&(e=a.period||o.period?{operator:"cross_period",params:[this.ruleInferDim(t.x,r),this.ruleInferDim(t.y,i),a.period,o.period]}:{operator:"cross",params:[this.ruleInferDim(t.x,r),this.ruleInferDim(t.y,i)]}),Object.assign({inherit:!0,source:"/"},e)},t}(),mn=n(6),yn=n(7),vn=function(){return(vn=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},bn=vn({},mn,yn),xn=bn.format(".4s"),_n=bn.format(".2r"),wn=bn.format(".1e"),En=(Ke=/\.0+([^\d].*)?$/,Je=/(\.\d+?)0+([^\d].*)?$/,function(t){return t.replace(Ke,"$1").replace(Je,"$1$2")}),Sn={_identity:function(t,e){return String(null==t?e:t)},"x-num-auto":function(t){if(isNaN(t))return"NaN";var e=Math.abs(t);return En(e<1?0===e?"0":e<1e-6?wn(t):_n(t):xn(t))},percent:function(t){return parseFloat((100*t).toFixed(2)).toString()+"%"},day:bn.timeFormat("%d-%b-%Y"),"day-utc":bn.utcFormat("%d-%b-%Y"),"day-short":bn.timeFormat("%d-%b"),"day-short-utc":bn.utcFormat("%d-%b"),week:bn.timeFormat("%d-%b-%Y"),"week-utc":bn.utcFormat("%d-%b-%Y"),"week-short":bn.timeFormat("%d-%b"),"week-short-utc":bn.utcFormat("%d-%b"),month:function(t){var e=0===new Date(t).getMonth()?"%B, %Y":"%B";return bn.timeFormat(e)(t)},"month-utc":function(t){var e=0===new Date(t).getUTCMonth()?"%B, %Y":"%B";return bn.utcFormat(e)(t)},"month-short":function(t){var e=0===new Date(t).getMonth()?"%b '%y":"%b";return bn.timeFormat(e)(t)},"month-short-utc":function(t){var e=0===new Date(t).getUTCMonth()?"%b '%y":"%b";return bn.utcFormat(e)(t)},"month-year":bn.timeFormat("%B, %Y"),"month-year-utc":bn.utcFormat("%B, %Y"),quarter:function(t){var e=new Date(t),n=e.getMonth();return"Q"+((n-n%3)/3+1)+" "+e.getFullYear()},"quarter-utc":function(t){var e=new Date(t),n=e.getUTCMonth();return"Q"+((n-n%3)/3+1)+" "+e.getUTCFullYear()},year:bn.timeFormat("%Y"),"year-utc":bn.utcFormat("%Y"),"x-time-auto":null},Mn={get:function(t,e){var n=Sn._identity,r=Sn.hasOwnProperty(t),i=r?Sn[t]:n;return r&&(i=Sn[t]),!r&&t&&(i=function(e){return(At(e)?bn.timeFormat(t):bn.format(t))(e)}),r||t||(i=n),null!==i?function(t){return i(t,e||"")}:null},add:function(t,e){Sn[t]=e}},Tn=function(t){return t.reduce(function(t,e){return t+e},0)};var Cn=function(t,e){var n=e.guide||{},r={x:["label"],y:["label"],size:["label"],color:["label"],padding:[]};return Object.keys(r).forEach(function(e){var i=r[e];!function(t,e,n,r){var i=t.hasOwnProperty(n)?t[n]:{};i=i||{},r.forEach(function(t){Object.assign(e.guide[n][t],i[t])})}(n,t,e,i)}),Object.assign(t.guide,Object.keys(n).reduce(function(t,e){return r.hasOwnProperty(e)||(t[e]=n[e]),t},{})),t},kn=function(t,e,n){return t[e]=Qt(t[e]||{},{label:""}),t[e].label=Ot(t[e].label)?t[e].label:{text:t[e].label},t[e].label=Qt(t[e].label,n||{},{padding:32,rotate:0,textAnchor:"middle",cssClass:"label",dock:null}),t[e]},An=function(t,e,n){return t[e]=Qt(t[e],n||{},{padding:0,density:30,rotate:0,tickPeriod:null,tickFormat:null,autoScale:!0}),t[e].tickFormat=t[e].tickFormat||t[e].tickPeriod,t[e].nice=t[e].hasOwnProperty("nice")?t[e].nice:t[e].autoScale,t[e]},On=function(t){var e=t.units||[],n=!t.hasOwnProperty("units"),r=!e.some(function(t){return t.hasOwnProperty("units")});return{type:t.type,isLeaf:n,isLeafParent:!n&&r}},Pn=function(t,e,n,r){if(0===t.length)return{width:0,height:0};if(null===e){var i=n("TauChart Library");return i.width=.625*r,i}t.every(function(t){return"number"==typeof t})&&(t=u.scaleLinear().domain(t).ticks());var a=t.reduce(function(t,n){var r=e(n).toString().length;return!t.computed||r>t.computed?{value:n,computed:r}:t},{}).value;return n(e(a))},Ln=function(t,e){var n=t.dimType,r=t.scaleType,i=[n,r,"*"].join(":"),a=[n,r].join(":");return e[i]||e[a]||e[n]||null},Nn=function(t,e,n){return t.hasOwnProperty(e+":"+n)?t[e+":"+n]:t[""+e]},Rn=function(t,e){return["day","week","month"].indexOf(t)>=0&&(t+="-short"+(e?"-utc":"")),t},Fn=function(t,e){var n=t.width,r=t.height,i=Math.abs(Ht(e));return{width:Math.max(Math.cos(i)*n,r),height:Math.max(Math.sin(i)*n,r)}},Dn=function(t,e){void 0===e&&(e="x");var n=Wt(t),r="x"===e?[[0,45,"middle"],[45,135,"start"],[135,225,"middle"],[225,315,"end"],[315,360,"middle"]]:[[0,90,"end"],[90,135,"middle"],[135,225,"start"],[225,315,"middle"],[315,360,"end"]],i=r.findIndex(function(t){return n>=t[0]&&n<t[1]});return r[i][2]},jn=function(t,e,n){var r=Math.ceil(t.width/e);return{height:Math.min(r,n)*t.height,width:e}};function In(t,e,n,r,i,a){var o=n.values,s=r.values,u=n.isEmpty||t.x.hideTicks,l=r.isEmpty||t.y.hideTicks,c=Pn(o,Mn.get(t.x.tickFormat,t.x.tickFormatNullAlias),e.getAxisTickLabelSize,e.xAxisTickLabelLimit),f=Pn(s,Mn.get(t.y.tickFormat,t.y.tickFormatNullAlias),e.getAxisTickLabelSize,e.yAxisTickLabelLimit),d=c,h=f;c.width>e.xAxisTickLabelLimit&&(t.x.tickFormatWordWrap=!0,t.x.tickFormatWordWrapLines=e.xTickWordWrapLinesLimit,d=jn(c,e.xAxisTickLabelLimit,e.xTickWordWrapLinesLimit)),f.width>e.yAxisTickLabelLimit&&(t.y.tickFormatWordWrap=!0,t.y.tickFormatWordWrapLines=e.yTickWordWrapLinesLimit,h=jn(f,e.yAxisTickLabelLimit,e.yTickWordWrapLinesLimit)),a&&(t.y.tickFormatWordWrap=!1,t.y.tickFormatWordWrapLines=1,(h=jn(f,2*e.yAxisTickLabelLimit,1)).width=20);var p=u?0:1,g=l?0:1,m=t.x.label,y=t.y.label,v=m.text&&!m.hide?1:0,b=y.text&&!y.hide?1:0,x=Fn(d,t.x.rotate),_=Fn(h,t.y.rotate);i?(m.padding=(-e.xAxisPadding-e.xFontLabelHeight)/2+e.xFontLabelHeight,m.paddingNoTicks=m.padding,y.padding=(-e.yAxisPadding-e.yFontLabelHeight)/2,y.paddingNoTicks=y.padding,v=0,b=0):(m.padding=Tn([p*(e.xTickWidth+x.height),v*(e.distToXAxisLabel+e.xFontLabelHeight)]),m.paddingNoTicks=v*(e.distToXAxisLabel+e.xFontLabelHeight),y.padding=Tn([g*(e.yTickWidth+_.width),b*e.distToYAxisLabel]),y.paddingNoTicks=b*e.distToYAxisLabel),a&&(y.padding=0,y.paddingNoTicks=0);var w=e.xFontLabelDescenderLineHeight;return t.padding=Object.assign(t.padding,{b:t.x.hide?0:Tn([t.x.padding,p*(e.xTickWidth+x.height),v*(e.distToXAxisLabel+e.xFontLabelHeight+w)]),l:t.y.hide?0:Tn([t.y.padding,a?0:g*(e.yTickWidth+_.width),b*(e.distToYAxisLabel+e.yFontLabelHeight)])}),t.paddingNoTicks=Object.assign({},t.paddingNoTicks,{b:t.x.hide?0:Tn([t.x.padding,v*(e.distToXAxisLabel+e.xFontLabelHeight+w)]),l:t.y.hide?0:Tn([t.y.padding,b*(e.distToYAxisLabel+e.yFontLabelHeight)])}),t.x=Object.assign(t.x,{density:x.width+2*Nn(e,"xDensityPadding",n.dimType),tickFontHeight:c.height,$minimalDomain:o.length,$maxTickTextW:d.width,$maxTickTextH:d.height,tickFormatWordWrapLimit:e.xAxisTickLabelLimit}),t.y=Object.assign(t.y,{density:_.height+2*Nn(e,"yDensityPadding",r.dimType),tickFontHeight:f.height,$minimalDomain:s.length,$maxTickTextW:h.width,$maxTickTextH:h.height,tickFormatWordWrapLimit:e.yAxisTickLabelLimit}),t}var zn=function(t){var e=t.unit,n=t.meta,r=t.settings,i=t.allowXVertical,a=t.allowYVertical,o=t.inlineLabels,s=n.dimension(e.x),u=n.dimension(e.y),l=n.scaleMeta(e.x,e.guide.x),c=n.scaleMeta(e.y,e.guide.y),f=l.isEmpty,d=c.isEmpty;e.guide.x.tickFormat=Rn(e.guide.x.tickFormat||Ln(s,r.defaultFormats),r.utcTime),e.guide.y.tickFormat=Rn(e.guide.y.tickFormat||Ln(u,r.defaultFormats),r.utcTime);var h=!!i&&!("measure"===s.dimType),p=!!a&&!("measure"===u.dimType);if(e.guide.x.padding=f?0:r.xAxisPadding,e.guide.x.paddingNoTicks=e.guide.x.padding,e.guide.y.padding=d?0:r.yAxisPadding,e.guide.y.paddingNoTicks=e.guide.y.padding,e.guide.x.rotate=h?-90:0,e.guide.x.textAnchor=Dn(e.guide.x.rotate,"x"),e.guide.y.rotate=p?-90:0,e.guide.y.textAnchor=Dn(e.guide.y.rotate,"y"),e.guide=In(e.guide,r,l,c,o,he(e)),o){var g=e.guide.x.label,m=e.guide.y.label;g.cssClass+=" inline",g.dock="right",g.textAnchor="end",m.cssClass+=" inline",m.dock="right",m.textAnchor="end"}return e},Bn={NONE:function(t,e,n){var r=kt(t);return Vn(kt(r.unit),r.unit,function(t,e){return e.guide.x.tickFontHeight=n.getAxisTickLabelSize("X").height,e.guide.y.tickFontHeight=n.getAxisTickLabelSize("Y").height,e.guide.x.tickFormatWordWrapLimit=n.xAxisTickLabelLimit,e.guide.y.tickFormatWordWrapLimit=n.yAxisTickLabelLimit,e}),r},"BUILD-LABELS":function(t,e){var n=kt(t),r=[],i=[],a=null,o=null;mt(n.unit,"units",On,function(t,n){if(t.isLeaf)return n;!a&&n.x&&(a=n),!o&&n.y&&(o=n),n.guide=n.guide||{},n.guide.x=n.guide.x||{label:{text:""}},n.guide.y=n.guide.y||{label:{text:""}},n.guide.x.label=Ot(n.guide.x.label)?n.guide.x.label:{text:n.guide.x.label&&n.guide.x.label.text?n.guide.x.label.text:""},n.guide.y.label=Ot(n.guide.y.label)?n.guide.y.label:{text:n.guide.y.label&&n.guide.y.label.text?n.guide.y.label.text:""},n.x&&(n.guide.x.label.text=n.guide.x.label.text||e.dimension(n.x).dimName),n.y&&(n.guide.y.label.text=n.guide.y.label.text||e.dimension(n.y).dimName);var s=n.guide.x.label.text;s&&(r.push(s),n.guide.x.tickFormatNullAlias=n.guide.x.hasOwnProperty("tickFormatNullAlias")?n.guide.x.tickFormatNullAlias:"No "+s,n.guide.x.label.text="",n.guide.x.label._original_text=s);var u=n.guide.y.label.text;return u&&(i.push(u),n.guide.y.tickFormatNullAlias=n.guide.y.hasOwnProperty("tickFormatNullAlias")?n.guide.y.tickFormatNullAlias:"No "+u,n.guide.y.label.text="",n.guide.y.label._original_text=u),n});return a&&(a.guide.x.label.text=a.guide.x.label.hide?"":r.join("  ")),o&&(o.guide.y.label.text=o.guide.y.label.hide?"":i.join("  ")),n},"BUILD-GUIDE":function(t,e,n){var r=kt(t);return Vn(kt(r.unit),r.unit,function(t,r){if(t.isLeaf)return r;var i=!t.isLeaf&&!t.isLeafParent,a=e.scaleMeta(r.x,r.guide.x),o=e.scaleMeta(r.y,r.guide.y),s=!i&&Boolean(a.dimType)&&"measure"!==a.dimType;return r.guide.x.rotate=r.guide.x.rotate||(s?-90:0),r.guide.x.textAnchor=Dn(r.guide.x.rotate),r.guide.x.tickFormat=r.guide.x.tickFormat||Ln(a,n.defaultFormats),r.guide.y.tickFormat=r.guide.y.tickFormat||Ln(o,n.defaultFormats),r.guide.x.padding=i?0:n.xAxisPadding,r.guide.x.paddingNoTicks=r.guide.x.padding,r.guide.y.padding=i?0:n.yAxisPadding,r.guide.y.paddingNoTicks=r.guide.y.padding,r.guide=In(r.guide,Qt({distToXAxisLabel:a.isEmpty?n.xTickWidth:n.distToXAxisLabel,distToYAxisLabel:o.isEmpty?n.yTickWidth:n.distToYAxisLabel},n),a,o,null,he(r)),r.guide.x=Object.assign(r.guide.x,{cssClass:i?r.guide.x.cssClass+" facet-axis":r.guide.x.cssClass,avoidCollisions:!!i||r.guide.x.avoidCollisions}),r.guide.y=Object.assign(r.guide.y,{cssClass:i?r.guide.y.cssClass+" facet-axis":r.guide.y.cssClass,avoidCollisions:!i&&r.guide.y.avoidCollisions}),r.guide=Object.assign(r.guide,{showGridLines:r.guide.hasOwnProperty("showGridLines")?r.guide.showGridLines:t.isLeafParent?"xy":""}),r}),r},"BUILD-COMPACT":function(t,e,n){var r=kt(t);return Vn(kt(r.unit),r.unit,function(t,r){return t.isLeaf?r:(r.guide.hasOwnProperty("showGridLines")||(r.guide.showGridLines=t.isLeafParent?"xy":""),t.isLeafParent?zn({unit:r,meta:e,settings:Qt({xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},n),allowXVertical:!0,allowYVertical:!1,inlineLabels:!0}):(r.guide.x.cssClass+=" facet-axis compact",r.guide.x.avoidCollisions=!0,r.guide.y.cssClass+=" facet-axis compact",r.guide.y.avoidCollisions=!0,zn({unit:r,meta:e,settings:Qt({xAxisPadding:0,yAxisPadding:0,distToXAxisLabel:0,distToYAxisLabel:0,xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},n),allowXVertical:!1,allowYVertical:!0,inlineLabels:!1})))}),r},AUTO:function(t,e,n){return["BUILD-LABELS","BUILD-GUIDE"].reduce(function(t,r){return Bn[r](t,e,n)},t)},COMPACT:function(t,e,n){return["BUILD-LABELS","BUILD-COMPACT"].reduce(function(t,r){return Bn[r](t,e,n)},t)}},Vn=function(t,e,n){var r,i=((r=e).options=r.options||{},r.guide=r.guide||{},r.guide.padding=Qt(r.guide.padding||{},{l:0,b:0,r:0,t:0}),r.guide.x=kn(r.guide,"x"),r.guide.x=An(r.guide,"x",{cssClass:"x axis",scaleOrient:"bottom",textAnchor:"middle"}),r.guide.y=kn(r.guide,"y",{rotate:-90}),r.guide.y=An(r.guide,"y",{cssClass:"y axis",scaleOrient:"left",textAnchor:"end"}),r.guide.size=kn(r.guide,"size"),r.guide.color=kn(r.guide,"color"),r);i=n(On(i),i);var a=Zt(i=Cn(i,t),"units");return(i.units||[]).forEach(function(t){return Vn(kt(t),(r=a,(e=t).guide=e.guide||{},e.guide.padding=e.guide.padding||{l:0,t:0,r:0,b:0},e.hasOwnProperty("units")||((e=Qt(e,r)).guide=Qt(e.guide,kt(r.guide)),e.guide.x=Qt(e.guide.x,kt(r.guide.x)),e.guide.y=Qt(e.guide.y,kt(r.guide.y))),e),n);var e,r}),i},Hn=function(t,e,n,r){var i={dimension:function(t){var e=n.scales[t],r=n.sources[e.source].dims[e.dim]||{};return{dimName:e.dim,dimType:r.type,scaleType:e.type}},scaleMeta:function(t){var e=r("pos",t).domain(),i=n.scales[t],a=n.sources[i.source].dims[i.dim]||{};return{dimName:i.dim,dimType:a.type,scaleType:i.type,values:e,isEmpty:null==a.type}}},a=(Bn[t]||Bn.NONE)({unit:kt(n.unit)},i,e);return n.unit=a.unit,n},Wn=function(){function t(t){this.spec=t,this.isApplicable=jt(t.unit)}return t.prototype.transform=function(t){var e=this.spec;if(!this.isApplicable)return e;var n=e.settings.size,r=e.settings.specEngine.find(function(t){return n.width<=t.width||n.height<=t.height});return Hn(r.name,e.settings,e,function(e,n){return t.getScaleInfo(n||e+":default")})},t}(),Gn=function(){function t(){}return t.optimizeXAxisLabel=function(t,e){var n=e.xAxisTickLabelLimit,r=function(t){if(!t.guide.x.hide&&!t.guide.x.hideTicks&&0!==t.guide.x.rotate){t.guide.x.rotate=0,t.guide.x.textAnchor="middle";var e=0-Math.min(n,t.guide.x.$maxTickTextW)+t.guide.x.$maxTickTextH;i(t,e)}(t.units||[]).filter(function(t){return"COORDS.RECT"===t.type}).forEach(function(t){return r(t)})},i=function(e,n){t!==e&&"extract-axes"===e.guide.autoLayout?(t.guide.x.padding+=n,t.guide.padding.b+=n):(e.guide.x.label.padding+=e.guide.x.label.padding>0?n:0,e.guide.padding.b+=e.guide.padding.b>0?n:0)};r(t)},t.hideAxisTicks=function(t,e,n){var r=function(t){var e="x"===n?"b":"l",i=t.guide;if(!i[n].hide&&!i[n].hideTicks){he(t)&&"y"===n||(i[n].hideTicks=!0);var a=i[n].label.text&&!i[n].label.hide;i.padding[e]=i.paddingNoTicks?i.paddingNoTicks[e]:0,i[n].padding=i[n].paddingNoTicks||0,i[n].label.padding=a?i[n].label.paddingNoTicks:0}(t.units||[]).filter(function(t){return"COORDS.RECT"===t.type}).forEach(function(t){return r(t)})};r(t)},t.facetsLabelsAtTop=function(t,e){var n=function(t){var e=t.units||[];if(he(t)){var r=t.guide;r.y.facetAxis=!0,r.y.rotate=0,r.y.textAnchor="start",e.forEach(function(t){t.guide.padding.t=20})}e.filter(function(t){return"COORDS.RECT"===t.type}).forEach(function(t){return n(t)})};n(t)},t}(),Un=function(t){return t.$maxTickTextW},Xn=function(t){return 0==t.rotate?t.$maxTickTextW:t.$maxTickTextH},qn=function(t){return t.density},Yn=function(t){var e=[],n=[],r=function(t){if("COORDS.RECT"===t.type&&t.units&&t.units[0]&&"COORDS.RECT"===t.units[0].type){var i=t.x.replace(/^x_/,""),a=t.y.replace(/^y_/,"");"null"!==i&&e.push(i),"null"!==a&&n.push(a),t.units.forEach(r)}};r(t.unit);var i={},a={},o=function(t){"COORDS.RECT"===t.type&&t.frames.forEach(function(t){t.key&&(Object.keys(t.key).forEach(function(r){e.indexOf(r)>=0&&(i.hasOwnProperty(r)||(i[r]=[]),i[r].indexOf(t.key[r])<0&&i[r].push(t.key[r])),n.indexOf(r)>=0&&(a.hasOwnProperty(r)||(a[r]=[]),a[r].indexOf(t.key[r])<0&&a[r].push(t.key[r]))}),t.units&&t.units.forEach(o))})};return o(t.unit),{xFacetCount:Object.keys(i).reduce(function(t,e){return t*i[e].length},1),yFacetCount:Object.keys(a).reduce(function(t,e){return t*a[e].length},1)}},$n={"entire-view":function(t,e,n,r){var i=n.unit.guide,a=Yn(n),o=a.xFacetCount,s=a.yFacetCount;s>0&&Gn.facetsLabelsAtTop(n.unit,n.settings);var u=i.paddingNoTicks?i.padding.l-i.paddingNoTicks.l:0,l=i.paddingNoTicks?i.padding.b-i.paddingNoTicks.b:0,c=i.paddingNoTicks&&t.height-l<n.settings.minChartHeight||s*n.settings.minFacetHeight+l>t.height||o*n.settings.minFacetWidth+u>t.width,f=i.paddingNoTicks&&t.width-u<n.settings.minChartWidth||s*n.settings.minFacetHeight+l>t.height||o*n.settings.minFacetWidth+u>t.width;c&&Gn.hideAxisTicks(n.unit,n.settings,"x"),f&&Gn.hideAxisTicks(n.unit,n.settings,"y");var d=t.width;if(e("x",n.unit,Un)<=t.width)r(n.unit,n.settings);else{var h=e("x",n.unit,Xn);if(h>t.width){var p=Math.max(t.width,e("x",n.unit,qn));d=Math.min(h,p)}}var g=Math.max(t.height,e("y",n.unit,qn));return!c&&d>t.width&&Gn.hideAxisTicks(n.unit,n.settings,"x"),!f&&g>t.height&&Gn.hideAxisTicks(n.unit,n.settings,"y"),{newW:t.width,newH:t.height}},minimal:function(t,e,n){return{newW:e("x",n.unit,qn),newH:e("y",n.unit,qn)}},normal:function(t,e,n,r){Yn(n).yFacetCount>0&&Gn.facetsLabelsAtTop(n.unit,n.settings);var i=n.unit.guide;i.paddingNoTicks&&(t.width-i.padding.l+i.paddingNoTicks.l<n.settings.minChartWidth&&Gn.hideAxisTicks(n.unit,n.settings,"y"),t.height-i.padding.b+i.paddingNoTicks.b<n.settings.minChartHeight&&Gn.hideAxisTicks(n.unit,n.settings,"x"));var a=t.width;if(e("x",n.unit,Un)<=t.width)r(n.unit,n.settings);else{var o=e("x",n.unit,Xn);if(o>t.width){var s=Math.max(t.width,e("x",n.unit,qn));a=Math.min(o,s)}}return{newW:a,newH:Math.max(t.height,e("y",n.unit,qn))}},"fit-width":function(t,e,n,r){var i=n.unit.guide,a=i.paddingNoTicks?i.padding.l-i.paddingNoTicks.l:0;return(i.paddingNoTicks&&t.width-a<n.settings.minChartWidth||Yn(n).xFacetCount*n.settings.minFacetWidth+a>t.width)&&Gn.hideAxisTicks(n.unit,n.settings,"y"),e("x",n.unit,Un)<=t.width&&r(n.unit,n.settings),{newW:t.width,newH:e("y",n.unit,qn)}},"fit-height":function(t,e,n){var r=n.unit.guide,i=r.paddingNoTicks?r.padding.b-r.paddingNoTicks.b:0;return(r.paddingNoTicks&&t.height-i<n.settings.minChartHeight||Yn(n).yFacetCount*n.settings.minFacetHeight+i>t.height)&&Gn.hideAxisTicks(n.unit,n.settings,"x"),{newW:e("x",n.unit,qn),newH:t.height}}},Kn=function(){function t(t){this.spec=t,this.isApplicable=jt(t.unit)}return t.prototype.transform=function(t){var e=this.spec;if(!this.isApplicable)return e;var n=e.settings.fitModel;if(!n)return e;var r=e.scales,i=function(t,e){return t.discrete?e*t.domain().length:4*e},a=function(e,n,o,s){void 0===s&&(s=null);var u="x"===e?n.x:n.y,l="x"===e?n.y:n.x,c=n.guide,f=o("x"===e?c.x:c.y),d=n.units[0],h="x"===e?c.padding.l+c.padding.r:c.padding.b+c.padding.t;if("ELEMENT.INTERVAL"===d.type&&"y"===e===Boolean(d.flip)&&d.label&&!t.getScaleInfo(d.label,s).isEmpty()){var p,g=2*(c.label&&c.label.fontSize?c.label.fontSize:10),m=t.getScaleInfo(u,s);if(m.discrete&&(null==d.guide.enableColorToBarPosition?!d.stack:d.guide.enableColorToBarPosition)){var y=d.color;if(y){var v=t.getScaleInfo(y,s);if(v.discrete){v.domain();p=v}}}var b=n.frames.reduce(function(t,e){return t+function(t){var e=t.part(),n=Yt(e.map(function(t){return t[m.dim]})).length,r=1;if(p){var i=e.reduce(function(t,e){var n=e[m.dim],r=e[p.dim];return t[n]=t[n]||{},t[n][r]||(t[n][r]=!0),t},{}),a=Object.keys(i).map(function(t){return Object.keys(i[t]).length});r=Math.max.apply(Math,a)}return n*r*g}(e)},0),x=i(m,f);return h+Math.max(b,x)}if("COORDS.RECT"!==d.type){var _=t.getScaleInfo(u,s);return h+i(_,f)}var w,E,S=(w=n.frames,E=r[l].dim,w.reduce(function(t,e){var n=(e.key||{})[E];return t[n]=t[n]||[],t[n].push(e),t},{})),M=Object.keys(S).map(function(t){return S[t].map(function(t){return a(e,t.units[0],o,t)}).reduce(function(t,e){return t+e},0)});return h+Math.max.apply(Math,M)},o=e.settings.size,s=o.width,u=o.height,l=$n[n];if(l){var c=l(o,a,e,Gn.optimizeXAxisLabel);s=c.newW,u=c.newH}return e.settings.size=function(n,r,i){var a=e.settings.getScrollbarSize(t.getLayout().contentContainer),o=r.width>n.width&&r.width<=n.width*i?n.width:r.width,s=r.height>n.height&&r.height<=n.height*i?n.height:r.height,u=n.width-o,l=n.height-s>=0?0:a.width;return{height:s-(u>=0?0:a.height),width:o-l}}(o,{width:s,height:u},e.settings.avoidScrollAtRatio),e},t}(),Jn=function(){function t(t){this.spec=t,this.isApplicable=t.settings.autoRatio&&jt(t.unit)}return t.prototype.transform=function(t){var e=this.spec;if(!this.isApplicable)return e;try{this.ruleApplyRatio(e,t)}catch(t){if("Not applicable"!==t.message)throw t}return e},t.prototype.ruleApplyRatio=function(t,e){var n=function(t){return"COORDS.RECT"===t.type||"RECT"===t.type},r=function(t,e,n,i){void 0===i&&(i=0),e(t,i)&&(t.units||[]).map(function(t){return r(t,e,n,i+1)}),n(t,i)},i=[],a=[];r(t.unit,function(t,e){if(e>1||!n(t))throw new Error("Not applicable");return i.push(t.x),a.push(t.y),1===(t.units||[]).map(function(t){if(!n(t)&&0!==t.type.indexOf("ELEMENT."))throw new Error("Not applicable");return t}).filter(n).length},function(){return 0});var o=function(e){return t.scales[e]},s=function(t){return"/"===t.source&&!t.ratio&&!t.fitToFrameByDims},u=function(t){return"ordinal"===t.type||"period"===t.type&&!t.period},l=i.map(o).filter(s),c=a.map(o).filter(s);if([l.length,c.length].some(function(t){return 2===t})){var f=function(t){return t.dim},d=function(t,e,n){t.fitToFrameByDims=n.slice(0,e).map(f)},h=function(t,n){2===n.filter(u).length&&(n.forEach(d),n[0].ratio=Dt(t,n.map(f),e))};h("x",l),h("y",c)}},t}(),Qn=function(){function t(t){this.spec=t,this.isApplicable="EXTRACT"===t.settings.layoutEngine&&jt(t.unit)}return t.prototype.transform=function(){var t=this.spec;if(!this.isApplicable)return t;try{this.ruleExtractAxes(t)}catch(t){if("Not applicable"!==t.message)throw t;console.log("[TauCharts]: can't extract axes for the given chart specification")}return t},t.prototype.ruleExtractAxes=function(t){var e=function(t){return"COORDS.RECT"===t.type||"RECT"===t.type},n=function(t){return t?10:0},r={l:0,r:10,t:10,b:0},i={l:0,b:0},a=[],o=[];yt(t.unit,function(t,n){if(n>1||!e(t))throw new Error("Not applicable");t.guide=t.guide||{};var s=t.guide,u=s.padding||{l:0,r:0,t:0,b:0},l=s.paddingNoTicks||{l:0,b:0};return r.l+=u.l,r.r+=u.r,r.t+=u.t,r.b+=u.b,i.l+=l.l,i.b+=l.b,a.push(Object.assign({},r)),o.push(Object.assign({},i)),1===(t.units||[]).map(function(t){if(!e(t)&&0!==t.type.indexOf("ELEMENT."))throw new Error("Not applicable");return t}).filter(e).length},function(t){var e=a.pop(),s=o.pop(),u=t.guide||{};u.x=u.x||{},u.x.padding=u.x.padding||0,u.x.paddingNoTicks=u.x.paddingNoTicks||0,u.y=u.y||{},u.y.padding=u.y.padding||0,u.y.paddingNoTicks=u.y.paddingNoTicks||0,u.padding={l:n(t.y),r:n(1),t:n(1),b:n(t.x)},u.paddingNoTicks={l:0,b:0},u.autoLayout="extract-axes",u.x.padding+=r.b-e.b,u.y.padding+=r.l-e.l,u.x.paddingNoTicks+=i.b-s.b,u.y.paddingNoTicks+=i.l-s.l}),t.unit.guide.padding=r,t.unit.guide.paddingNoTicks=i},t}(),Zn=function(){function t(t){var e=void 0===t?{}:t,n=e.src,r=void 0===n?null:n,i=e.timeout,a=void 0===i?Number.MAX_SAFE_INTEGER:i,o=e.syncInterval,s=void 0===o?Number.MAX_SAFE_INTEGER:o,u=e.callbacks,l=void 0===u?{}:u,c=this;this.setTimeoutDuration(a),this.setSyncInterval(s),this.setCallbacks(l),this._running=!1,this._queue=[],this._result=r,this._syncDuration=0,this._asyncDuration=0,this._requestedFrameId=null,this._visibilityChangeHandler=function(){if(c._running&&c._requestedFrameId){var t=c._getCancelFrameFunction(),e=c._getRequestFrameFunction();t(c._requestedFrameId),c._requestedFrameId=e(c._requestedFrameCallback)}},this._tasksCount=0,this._finishedTasksCount=0}return t.prototype.setTimeoutDuration=function(e){t.checkType(e,"number","timeout"),this._timeout=e},t.prototype.setSyncInterval=function(e){t.checkType(e,"number","syncInterval"),this._syncInterval=e},t.prototype.setCallbacks=function(e){t.checkType(e,"object","callbacks"),this._callbacks=Object.assign(this._callbacks||{},e)},t.prototype.addTask=function(t){return this._queue.push(t),this._tasksCount++,this},t.prototype.run=function(){if(this._running)throw new Error("Task Runner is already running");this._running=!0,t.runnersInProgress++,document.addEventListener("visibilitychange",this._visibilityChangeHandler),this._loopTasks()},t.prototype.isRunning=function(){return this._running},t.prototype._loopTasks=function(){for(var e,n,r,i,a=0,o=this._syncInterval/t.runnersInProgress;this._running&&!(r=this._asyncDuration>this._timeout)&&!(i=a>o)&&(e=this._queue.shift());){if(null===(n=this._runTask(e)))return;this._syncDuration+=n,this._asyncDuration+=n,a+=n}r&&this._queue.length>0&&(this.stop(),this._callbacks.timeout&&this._callbacks.timeout.call(null,this._asyncDuration,this)),!r&&i&&this._queue.length>0&&this._requestFrame(),0===this._queue.length&&(this.stop(),this._callbacks.done&&this._callbacks.done.call(null,this._result,this))},t.prototype._runTask=function(t){var e=performance.now();if(this._callbacks.error)try{this._result=t.call(null,this._result,this)}catch(t){return this.stop(),this._callbacks.error.call(null,t,this),null}else this._result=t.call(null,this._result,this);var n=performance.now()-e;return this._finishedTasksCount++,this._callbacks.progress&&this._callbacks.progress.call(null,this._finishedTasksCount/this._tasksCount,this),n},t.prototype._requestFrame=function(){var t=this,e=performance.now(),n=function(){t._requestedFrameId=null;var n=performance.now();t._asyncDuration+=n-e,t._loopTasks()},r=this._getRequestFrameFunction();this._requestedFrameCallback=n,this._requestedFrameId=r(n)},t.prototype._getRequestFrameFunction=function(){var t=this;return document.hidden?function(e){return t._requestedFrameType="idle",window.requestIdleCallback(e,{timeout:17})}:function(e){return t._requestedFrameType="animation",requestAnimationFrame(e)}},t.prototype._getCancelFrameFunction=function(){switch(this._requestedFrameType){case"animation":return function(t){return cancelAnimationFrame(t)};case"idle":return function(t){return window.cancelIdleCallback(t)}}},t.prototype.stop=function(){if(!this._running)throw new Error("Task Runner is already stopped");(this._running=!1,t.runnersInProgress--,document.removeEventListener("visibilitychange",this._visibilityChangeHandler),this._requestedFrameId)&&(this._getCancelFrameFunction()(this._requestedFrameId),this._requestedFrameId=null)},t.checkType=function(t,e,n){if(typeof t!==e)throw new Error('Task Runner "'+n+'" property is not "'+e+'"')},t}();Zn.runnersInProgress=0;var tr=Zn,er=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),nr=function(){return(nr=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},rr=nr({},o),ir=Me,ar=Te,or=function(t){function e(e){var n=t.call(this)||this;return n._nodes=[],n._svg=null,n._filtersStore={filters:{},tick:0},n._layout=pn(),n.transformers=[Jn,Wn],n.onUnitsStructureExpandedTransformers=[Qn,Kn],n._chartDataModel=function(t){return t},n._reportProgress=null,n._taskRunner=null,n._renderingPhase=null,n.applyConfig(e),n}return er(e,t),e.prototype.on=function(e,n,r){return t.prototype.on.call(this,e,n,r)},e.prototype.updateConfig=function(t){this.applyConfig(t),this.refresh()},e.prototype.applyConfig=function(t){this._filtersStore.filters={},t=this.setupConfigSettings(t),this.configGPL=this.createGPLConfig(t),this._originData=Object.assign({},this.configGPL.sources),this._liveSpec=this.configGPL,this._emptyContainer=t.emptyContainer||"",this.setupPlugins(t)},e.prototype.createGPLConfig=function(t){var n;return this.isGPLConfig(t)?n=t:(t=this.setupConfig(t),n=new gn(t).convert()),n=e.setupPeriodData(n)},e.prototype.isGPLConfig=function(t){return 2===["sources","scales"].filter(function(e){return t.hasOwnProperty(e)}).length},e.prototype.setupPlugins=function(t){var e=t.plugins||[];this._plugins&&this._plugins.destroy(),this._plugins=new Ze(e,this)},e.prototype.setupConfigSettings=function(t){var n;return this._dataRefs=this._dataRefs||(n=0,{references:new WeakMap,refCounter:function(){return++n}}),t.settings=e.setupSettings(Qt(t.settings||{},this._dataRefs)),t},e.prototype.destroy=function(){this.destroyNodes(),rr.select(this._svg).remove(),rr.select(this._layout.layout).remove(),this._cancelRendering(),t.prototype.destroy.call(this)},e.prototype.setupChartSourceModel=function(t){this._chartDataModel=t},e.prototype.setupConfig=function(t){if(!t.spec||!t.spec.unit)throw new Error("Provide spec for plot");var n=Qt(t,{spec:{},data:[],plugins:[],settings:{}});n.spec.dimensions=e.setupMetaInfo(n.spec.dimensions,n.data);var r=n.settings.log;return n.settings.excludeNull&&this.addFilter({tag:"default",src:"/",predicate:ln(n.spec.dimensions,function(t){return r([t,"point was excluded, because it has undefined values."],"WARN")})}),n},e.setupPeriodData=function(t){var n=e.__api__.tickPeriod,r=t.settings.log;return Object.keys(t.scales).map(function(e){return t.scales[e]}).filter(function(t){return"period"===t.type}).forEach(function(e){n.get(e.period,{utc:t.settings.utcTime})||(r(['Unknown period "'+e.period+'".',"Docs: https://api.taucharts.com/plugins/customticks.html#how-to-add-custom-tick-period"],"WARN"),e.period=null)}),t},e.setupMetaInfo=function(t,e){var n=t||fn(e);return cn(n)},e.setupSettings=function(t){var n=e.globalSettings,r=Qt(t||{},Object.keys(n).reduce(function(t,e){return t[e]="function"==typeof n[e]?n[e]:kt(n[e]),t},{}));return Array.isArray(r.specEngine)||(r.specEngine=[{width:Number.MAX_VALUE,name:r.specEngine}]),r},e.prototype.insertToLeftSidebar=function(t){return me(t,this._layout.leftSidebar)},e.prototype.insertToRightSidebar=function(t){return me(t,this._layout.rightSidebar)},e.prototype.insertToFooter=function(t){return me(t,this._layout.footer)},e.prototype.insertToHeader=function(t){return me(t,this._layout.header)},e.prototype.addBalloon=function(t){return new Qe("",t||{})},e.prototype.destroyNodes=function(){this._nodes.forEach(function(t){return t.destroy()}),this._nodes=[],this._renderedItems=[]},e.prototype.onUnitDraw=function(t){var e=this;this._nodes.push(t),this.fire("unitdraw",t),["click","mouseover","mouseout"].forEach(function(n){return t.on(n,function(t,r){e.fire("element"+n,{element:t,data:r.data,event:r.event})})})},e.prototype.onUnitsStructureExpanded=function(t){var e=this;this.onUnitsStructureExpandedTransformers.forEach(function(n){return new n(t).transform(e)}),this.fire("unitsstructureexpanded",t)},e.prototype._getClosestElementPerUnit=function(t,e){return this._renderedItems.filter(function(t){return t.getClosestElement}).map(function(n){var r=n.getClosestElement(t,e);return{unit:n.node(),closest:r}})},e.prototype.disablePointerEvents=function(){this._layout.layout.style.pointerEvents="none"},e.prototype.enablePointerEvents=function(){this._layout.layout.style.pointerEvents=""},e.prototype._handlePointerEvent=function(t){var e=this._svg.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,i="click"===t.type?"data-click":"data-hover",a=null,o=null,s=null,u=this._getClosestElementPerUnit(n,r),l=u.filter(function(t){return t.closest}).sort(function(t,e){return t.closest.distance===e.closest.distance?t.closest.secondaryDistance-e.closest.secondaryDistance:t.closest.distance-e.closest.distance});if(l.length>0){var c=l.findIndex(function(t){return t.closest.distance!==l[0].closest.distance||t.closest.secondaryDistance!==l[0].closest.secondaryDistance}),f=c<0?l:l.slice(0,c);if(1===f.length)a=f[0].closest.data,o=f[0].closest.node,s=f[0].unit;else{var d=f.reduce(function(t,e){return t+e.closest.x},0)/f.length,h=f.reduce(function(t,e){return t+e.closest.y},0)/f.length,p=Math.atan2(h-r,d-n)+Math.PI,g=Math.round((f.length-1)*p/2/Math.PI),m=f[g].closest;a=m.data,o=m.node,s=f[g].unit}}u.forEach(function(e){return e.unit.fire(i,{event:t,data:a,node:o,unit:s})})},e.prototype._initPointerEvents=function(){var t=this;this._liveSpec.settings.syncPointerEvents||(this._pointerAnimationFrameId=null);var e=rr.select(this._svg),n=this._liveSpec.settings.syncPointerEvents?function(t){return function(){return t(o.event)}}:function(e){return function(){var n=o.event;t._pointerAnimationFrameId&&"mousemove"!==n.type&&t._cancelPointerAnimationFrame(),t._pointerAnimationFrameId||(t._pointerAnimationFrameId=requestAnimationFrame(function(){t._pointerAnimationFrameId=null,e(n)}))}},r=function(e){return t._handlePointerEvent(e)};e.on("mousemove",n(r)),e.on("click",n(r)),e.on("mouseleave",n(function(e){"none"!==window.getComputedStyle(t._svg).pointerEvents&&t.select(function(){return!0}).forEach(function(t){return t.fire("data-hover",{event:e,data:null,node:null,unit:null})})}))},e.prototype._cancelPointerAnimationFrame=function(){cancelAnimationFrame(this._pointerAnimationFrameId),this._pointerAnimationFrameId=null},e.prototype._setupTaskRunner=function(t){var e=this;return this._resetTaskRunner(),this._taskRunner=new tr({timeout:t.settings.renderingTimeout||Number.MAX_SAFE_INTEGER,syncInterval:t.settings.asyncRendering?t.settings.syncRenderingInterval:Number.MAX_SAFE_INTEGER,callbacks:{done:function(){e._completeRendering(),e._renderingPhase=null},timeout:function(t,n){e._displayTimeoutWarning({timeout:t,proceed:function(){e.disablePointerEvents(),n.setTimeoutDuration(Number.MAX_SAFE_INTEGER),n.run()},cancel:function(){e._cancelRendering()}}),e.enablePointerEvents(),e.fire("renderingtimeout",t)},progress:function(t){var n={spec:0,draw:1}[e._renderingPhase]/2+t/2;e._reportProgress(n)},error:t.settings.handleRenderingErrors?function(n){e._cancelRendering(),e._displayRenderingError(n),e.fire("renderingerror",n),t.settings.log(["An error occured during chart rendering.",'Set "handleRenderingErrors: false" in chart settings to debug.',"Error message: "+n.message].join(" "),"ERROR")}:null}}),this._taskRunner},e.prototype._resetTaskRunner=function(){this._taskRunner&&this._taskRunner.isRunning()&&(this._taskRunner.stop(),this._taskRunner=null)},e.prototype.renderTo=function(t,e){this._resetProgressLayout(),this.disablePointerEvents(),this._insertLayout(t,e);var n=this._createLiveSpec();if(!n)return this._svg=null,this._layout.content.innerHTML=this._emptyContainer,void this.enablePointerEvents();var r=this._createGPL(n),i=this._setupTaskRunner(n);this._scheduleDrawScenario(i,r),this._scheduleDrawing(i,r),i.run()},e.prototype._insertLayout=function(t,e){this._target=t,this._defaultSize=Object.assign({},e);var n=rr.select(t).node();if(null===n)throw new Error("Target element not found");this._layout.layout.parentNode!==n&&n.appendChild(this._layout.layout);var r=this._layout.content,i=ye(this._layout.contentContainer);this._layout.contentContainer.style.padding="0 "+i.width+"px "+i.height+"px 0",ve(this._layout.rightSidebarContainer,"vertical");var a=Object.assign({},e)||{};if(!a.width||!a.height){var o=r.parentElement,s=o.scrollLeft,u=o.scrollTop;r.style.display="none",a=Qt(a,_e(r.parentNode)),r.style.display="",r.parentElement.scrollLeft=s,r.parentElement.scrollTop=u,a.height||(a.height=_e(this._layout.layout).height)}this.configGPL.settings.size=a},e.prototype._createLiveSpec=function(){var t=this;return this._liveSpec=kt(Zt(this.configGPL,"plugins")),this._liveSpec.sources=this.getDataSources(),this._liveSpec.settings=this.configGPL.settings,this._experimentalSetupAnimationSpeed(this._liveSpec),this.isEmptySources(this._liveSpec.sources)?null:(this._liveSpec=this.transformers.reduce(function(e,n){return new n(e).transform(t)},this._liveSpec),this.destroyNodes(),this.fire("specready",this._liveSpec),this._liveSpec)},e.prototype._experimentalSetupAnimationSpeed=function(t){t.settings.initialAnimationSpeed=t.settings.initialAnimationSpeed||t.settings.animationSpeed;var e=t.settings.experimentalShouldAnimate(t)?t.settings.initialAnimationSpeed:0;t.settings.animationSpeed=e;var n=function(t){t.guide=t.guide||{},t.guide.animationSpeed=e,t.units&&t.units.forEach(n)};n(t.unit)},e.prototype._createGPL=function(t){var e=new Ue(t,this.getScaleFactory(),nn,M),n=e.unfoldStructure();return this.onUnitsStructureExpanded(n),e},e.prototype._scheduleDrawScenario=function(t,e){var n=this,r=rr.select(this._layout.content),i=e.config.settings.size;t.addTask(function(){return n._renderingPhase="spec"}),e.getDrawScenarioQueue({allocateRect:function(){return{slot:function(t){return r.selectAll(".uid_"+t)},frameId:"root",left:0,top:0,width:i.width,containerWidth:i.width,height:i.height,containerHeight:i.height}}}).forEach(function(e){return t.addTask(e)})},e.prototype._scheduleDrawing=function(t,e){var n=this,r=e.config.settings.size;t.addTask(function(t){n._renderingPhase="draw",n._renderRoot({scenario:t,newSize:r}),n._cancelPointerAnimationFrame(),n._scheduleRenderScenario(t)})},e.prototype._resetProgressLayout=function(){this._createProgressBar(),this._clearRenderingError(),this._clearTimeoutWarning()},e.prototype._renderRoot=function(t){var e=this,n=t.scenario,r=t.newSize,i=rr.select(this._layout.content),a=n[0].config.uid,o=ir(i,"svg").attr("width",Math.floor(r.width)).attr("height",Math.floor(r.height));o.attr("class")||o.attr("class",Xe+"svg"),this._svg=o.node(),this._initPointerEvents(),this.fire("beforerender",this._svg);var s=o.selectAll("g.frame-root").data([a],function(t){return t});s.enter().append("g").classed(Xe+"cell cell frame-root uid_"+a,!0).merge(s).call(function(t){t.classed("tau-active",!0),nt(t,e.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1)}),s.exit().call(function(t){t.classed("tau-active",!1),nt(t,e.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1e-6).remove()})},e.prototype._scheduleRenderScenario=function(t){var e=this;t.forEach(function(t){e._taskRunner.addTask(function(){t.draw(),e.onUnitDraw(t.node()),e._renderedItems.push(t)})})},e.prototype._completeRendering=function(){ve(this._layout.contentContainer),this._layout.rightSidebar.style.maxHeight=this._liveSpec.settings.size.height+"px",this.enablePointerEvents(),this._svg&&this.fire("render",this._svg),ve(this._layout.rightSidebarContainer,"vertical")},e.prototype._cancelRendering=function(){this.enablePointerEvents(),this._resetTaskRunner(),this._cancelPointerAnimationFrame()},e.prototype._createProgressBar=function(){var t=rr.select(this._layout.header),e=ir(t,"div."+Xe+"progress");e.select("div."+Xe+"progress__value").remove();var n=e.append("div").classed(Xe+"progress__value",!0).style("width",0);this._reportProgress=function(t){requestAnimationFrame(function(){e.classed(Xe+"progress_active",t<1),n.style("width",100*t+"%")})}},e.prototype._displayRenderingError=function(t){this._layout.layout.classList.add(Xe+"layout_rendering-error")},e.prototype._clearRenderingError=function(){this._layout.layout.classList.remove(Xe+"layout_rendering-error")},e.prototype.getScaleFactory=function(t){return void 0===t&&(t=null),new sn(on.instance(this._liveSpec.settings),t||this._liveSpec.sources,this._liveSpec.scales)},e.prototype.getScaleInfo=function(t,e){return void 0===e&&(e=null),this.getScaleFactory().createScaleInfoByName(t,e)},e.prototype.getSourceFiltersIterator=function(t){var e=this,n=qt(Object.keys(this._filtersStore.filters).map(function(t){return e._filtersStore.filters[t]})).filter(function(e){return!t(e)}).map(function(t){return t.predicate});return function(t){return n.reduce(function(e,n){return e&&n(t)},!0)}},e.prototype.getDataSources=function(t){var e=this;void 0===t&&(t={});var n=this._chartDataModel(this._originData);return Object.keys(n).filter(function(t){return"?"!==t}).reduce(function(r,i){var a=n[i],o=e.getSourceFiltersIterator(function(e){return function(n){return t.excludeFilter&&-1!==t.excludeFilter.indexOf(n.tag)||n.src!==e}}(i));return r[i]={dims:a.dims,data:a.data.filter(o)},r},{"?":n["?"]})},e.prototype.isEmptySources=function(t){return!Object.keys(t).filter(function(t){return"?"!==t}).filter(function(e){return t[e].data.length>0}).length},e.prototype.getChartModelData=function(t,e){return void 0===t&&(t={}),void 0===e&&(e="/"),this.getDataSources(t)[e].data},e.prototype.getDataDims=function(t){return void 0===t&&(t="/"),this._originData[t].dims},e.prototype.getData=function(t){return void 0===t&&(t="/"),this._originData[t].data},e.prototype.setData=function(t,e){void 0===e&&(e="/"),this._originData[e].data=t,this.refresh()},e.prototype.getSVG=function(){return this._svg},e.prototype.addFilter=function(t){t.src=t.src||"/";var e=t.tag,n=this._filtersStore.filters[e]=this._filtersStore.filters[e]||[],r=this._filtersStore.tick++;return t.id=r,n.push(t),r},e.prototype.removeFilter=function(t){var e=this;return Object.keys(this._filtersStore.filters).map(function(n){e._filtersStore.filters[n]=e._filtersStore.filters[n].filter(function(e){return e.id!==t})}),this},e.prototype.refresh=function(){this._target&&this.renderTo(this._target,this._defaultSize)},e.prototype.resize=function(t){void 0===t&&(t={}),this.renderTo(this._target,t)},e.prototype.select=function(t){return this._nodes.filter(t)},e.prototype.traverseSpec=function(t,e){var n=function(t,e,r,i){e(t,r,i),t.frames?t.frames.forEach(function(r){(r.units||[]).map(function(i){return n(i,e,t,r)})}):(t.units||[]).map(function(r){return n(r,e,t,null)})};n(t.unit,e,null,null)},e.prototype.getSpec=function(){return this._liveSpec},e.prototype.getLayout=function(){return this._layout},e.prototype._displayTimeoutWarning=function(t){var e=this,n=t.proceed,r=t.cancel,i=t.timeout,a=Math.round(100/3/1.5),o=function(t){return Math.round(100/3/1.5*t)};this._layout.content.style.height="100%",this._layout.content.insertAdjacentHTML("beforeend",'\n            <div class="'+Xe+'rendering-timeout-warning">\n            <svg\n                viewBox="0 0 200 100">\n                <text\n                    text-anchor="middle"\n                    font-size="'+a+'">\n                    <tspan x="100" y="'+o(1)+'">Rendering took more than '+Math.round(i)/1e3+'s</tspan>\n                    <tspan x="100" y="'+o(2)+'">Would you like to continue?</tspan>\n                </text>\n                <text\n                    class="'+Xe+'rendering-timeout-continue-btn"\n                    text-anchor="end"\n                    font-size="'+a+'"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="'+(100-a/3)+'"\n                    y="'+o(3)+'">\n                    Continue\n                </text>\n                <text\n                    class="'+Xe+'rendering-timeout-cancel-btn"\n                    text-anchor="start"\n                    font-size="'+a+'"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="'+(100+a/3)+'"\n                    y="'+o(3)+'">\n                    Cancel\n                </text>\n            </svg>\n            </div>\n        '),this._layout.content.querySelector("."+Xe+"rendering-timeout-continue-btn").addEventListener("click",function(){e._clearTimeoutWarning(),n.call(e)}),this._layout.content.querySelector("."+Xe+"rendering-timeout-cancel-btn").addEventListener("click",function(){e._clearTimeoutWarning(),r.call(e)})},e.prototype._clearTimeoutWarning=function(){var t=ar(this._layout.content,"."+Xe+"rendering-timeout-warning");t&&(this._layout.content.removeChild(t),this._layout.content.style.height="")},e}(h),sr={},ur={},lr=function(t){var e="Chart type "+t+" is not supported.";throw console.log(e),console.log("Use one of "+Object.keys(sr).join(", ")+"."),new w(e,E.NOT_SUPPORTED_TYPE_CHART)},cr={validate:function(t,e){return ur.hasOwnProperty(t)||lr(t),ur[t].reduce(function(t,n){return t.concat(n(e)||[])},[])},get:function(t){var e=sr[t];return"function"!=typeof e&&lr(t),e},add:function(t,e,n){return void 0===n&&(n=[]),sr[t]=e,ur[t]=n,cr},getAllRegisteredTypes:function(){return sr}},fr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),dr=function(t){function e(n){var r=t.call(this,n)||this;return n.autoResize&&e.winAware.push(r),r}return fr(e,t),e.prototype.applyConfig=function(e){var n=cr.validate(e.type,e);if(n.length>0)throw new Error(n[0]);var r=cr.get(e.type);(e=Qt(e,{autoResize:!0})).settings=or.setupSettings(e.settings),e.dimensions=or.setupMetaInfo(e.dimensions,e.data),t.prototype.applyConfig.call(this,r(e))},e.prototype.destroy=function(){var n=e.winAware.indexOf(this);-1!==n&&e.winAware.splice(n,1),t.prototype.destroy.call(this)},e}(or);function hr(t){return t}dr.winAware=[],dr.resizeOnWindowEvent=function(){var t;function e(){t=0;for(var e=0,n=dr.winAware.length;e<n;e++)dr.winAware[e].resize()}return function(){!t&&dr.winAware.length&&(t=window.requestAnimationFrame(e))}}(),window.addEventListener("resize",dr.resizeOnWindowEvent);var pr=1e-6;function gr(t){return"translate("+(t+.5)+",0)"}function mr(t){return"translate(0,"+(t+.5)+")"}var yr={top:1,right:2,bottom:3,left:4};function vr(t){var e=yr[t.scaleGuide.scaleOrient],n=t.scale,r=t.scaleGuide,i=r.label,a=Qt(t,{tickSize:6,tickPadding:3,gridOnly:!1}),o=a.ticksCount,s=a.tickFormat,u=a.tickSize,l=a.tickPadding,c=a.gridOnly,f="linear"===n.scaleType,d="ordinal"===n.scaleType||"period"===n.scaleType,h=e===yr.top||e===yr.bottom,p=e===yr.top||e===yr.left?-1:1,g=h?"x":"y",m=h?"y":"x",y=h?gr:mr,v=h?1:-1;return function(a){var b;if(n.ticks){b=n.ticks(o);for(var x=Math.floor(1.25*o);b.length>x&&x>2&&b.length>2;)b=n.ticks(--x)}else b=n.domain();r.hideTicks&&(b=c?b.filter(function(t){return 0==t}):[]);var _=null==s?n.tickFormat?n.tickFormat(o):hr:s,w=Math.max(u,0)+l,E=n.range(),S=E[0]+.5,M=E[E.length-1]+.5,T=(n.bandwidth?function(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return t(n)+e}}:hr)(n);if(r.facetAxis){var C=T;T=function(t){return C(t)-n.stepSize(t)/2}}var k,A=a.selection?a:null,O=A?A.selection():a,P=function(t){for(var e=t.node();e&&"svg"!==e.tagName;)e=e.parentNode;return e}(O).getBoundingClientRect();function L(t){var n=Wt(r.rotate);if(t.attr("transform",Le(n)),Math.abs(n/90)%2>0){var i=n<180?1:-1,a=h?.5:-2,o=e===yr.top||e===yr.left?-1:1,s=a*(e===yr.top||e===yr.bottom?o<0?0:.71:.32);t.attr("x",9*i).attr("y",0).attr("dx",h?null:s+"em").attr("dy",s+"em")}}function N(t,e){void 0===e&&(e=0);var i=function(t){return Math.max(n.stepSize(t),r.tickFormatWordWrapLimit,e)};r.tickFormatWordWrap?et(t,i,r.tickFormatWordWrapLines,r.tickFontHeight,!h):tt(t,i)}function R(t){!function(t,e){var n=e?-10:20,r=e?0:1,i=e?1:-1,a=[];t.each(function(){var t=Q.select(this),e=t.attr("transform").replace("translate(","").replace(" ",",").split(",")[r],n=i*parseFloat(e),o=t.select("text"),s=o.node().getBBox().width/2,u=n-s,l=n+s;a.push({c:n,s:u,e:l,l:0,textRef:o,tickRef:t})});var o,s=a.sort(function(t,e){return t.c-e.c});o=function(t,r,i){var a,o,s,u=t.e>r.s,l=i.s<r.e;if(u||l){r.l=(a=t.l,o={"[T][1]":-1,"[T][-1]":0,"[T][0]":1,"[F][0]":-1},s="["+u.toString().toUpperCase().charAt(0)+"]["+a+"]",o.hasOwnProperty(s)?o[s]:0);var c=r.textRef.size(),f=r.textRef.text();c>1&&(f=f.replace(/([\.]*$)/gi,"")+"...");var d=11*r.l,h=e?parseFloat(r.textRef.attr("y"))+d:0,p=e?0:d,g=e?d:0,m=function(t){var e=0;if(!t)return e;var n=t.indexOf("rotate(");if(n>=0){var r=t.indexOf(")",n+7),i=t.substring(n+7,r);e=parseFloat(i.trim())}return e}(r.textRef.attr("transform"));r.textRef.text(function(t,e){return 0===e?f:""}).attr("transform","translate("+p+","+g+") rotate("+m+")");var y={x1:0,x2:0,y1:h+(e?-1:5),y2:n};e||(y.transform="rotate(-90)"),Me(r.tickRef,"line.label-ref").call(ct(y))}else r.tickRef.selectAll("line.label-ref").remove();return r},s.map(function(t,e,n){return o(n[e-1]||{e:-1/0,s:-1/0,l:0},t,n[e+1]||{e:1/0,s:1/0,l:0})})}(t,h)}O.attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===yr.right?"start":e===yr.left?"end":"middle"),c||(k=r.hideTicks||r.hide?[]:[null],ce(O.selectAll(".domain").data(k)).then(function(t){return A&&t.exit().transition(A).attr("opacity",0).remove(),t.merge(t.enter().insert("path",".tick").attr("class","domain").attr("opacity",1).attr("stroke","#000"))}).then(function(t){return A?t.transition(A):t}).then(function(t){t.attr("d",e===yr.left||e==yr.right?"M"+p*u+","+S+"H0.5V"+M+"H"+p*u:"M"+S+","+p*u+"V0.5H"+M+"V"+p*u)}));var F=ce(O.selectAll(".tick").data(b,function(t){return String(n(t))}).order()).then(function(t){var e=t.exit(),n=t.enter().append("g").attr("class","tick");return{tickExit:e,tickEnter:n,tick:t.merge(n)}}).then(function(t){if(f){var e=n.ticks(),r=n.domain(),i=b.length-1,a=e.length>1&&r[0]*r[1]<0&&-r[0]>(e[1]-e[0])/2&&r[1]>(e[i]-e[i-1])/2;t.tick.classed("zero-tick",function(t){return 0==t&&a})}return t}).result();!function(t){ce(t).then(function(t){var e=t.tickEnter,n=t.tickExit,r=t.tick;return A?(e.attr("opacity",pr).attr("transform",function(t){var e=T(t);return y(e)}),{tick:r.transition(A),tickExit:n.transition(A).attr("opacity",pr).attr("transform",function(t){var e=T(t);return isFinite(e)?y(e):this.getAttribute("transform")})}):{tick:r,tickExit:n}}).then(function(t){var e=t.tick;t.tickExit.remove(),e.attr("opacity",1).attr("transform",function(t){return y(T(t))})})}(F),r.facetAxis||function(t){var e=p*u,r=d?function(t){return v*n.stepSize(t)/2}:null;ce(t).then(function(t){var n=t.tick,i=t.tickEnter,a=n.select("line"),o=i.append("line").attr("stroke","#000").attr(m+"2",e);return d&&o.attr(g+"1",r).attr(g+"2",r),a.merge(o)}).then(function(t){return A?t.transition(A):t}).then(function(t){t.attr(m+"2",e),d&&t.attr(g+"1",r).attr(g+"2",r)})}(F),d&&c&&d&&b&&b.length&&ce(O.selectAll(".extra-tick-line").data([null])).then(function(t){return t.merge(t.enter().insert("line",".tick").attr("class","extra-tick-line").attr("stroke","#000"))}).then(function(t){return A?t.transition(A):t}).then(function(t){t.attr(g+"1",S).attr(g+"2",S).attr(m+"1",0).attr(m+"2",p*u)}),c||(function(i){var a=r.textAnchor,o=p*w,s=e===yr.top?"0em":e===yr.bottom?"0.71em":"0.32em";function u(e){if(r.facetAxis)return e.attr("dx",18-t.position[0]).attr("dy",16)}ce(i).then(function(t){var e=t.tick,n=t.tickEnter,r=e.select("text"),i=n.append("text").attr("fill","#000").attr(m,o).attr("dy",s);return L(i),u(i),r.merge(i)}).then(function(t){if(t.text(_).attr("text-anchor",a),!1===h&&!0===r.facetAxis){var e=Re(O.node().parentNode.getAttribute("transform"));N(t,P.width-Math.abs(e.x))}else N(t);return h&&"time"===n.scaleType&&function(t){if(!(b.length<2)){var e=0,n=-1,r=t.nodes();r.forEach(function(t,r){var i=t.textContent||"",a=i.length;a>e&&(e=a,n=r)});var i=T(b[1])-T(b[0]),a=!1;if(n>=0){var o=r[n].getBoundingClientRect();a=i-o.width<8}O.classed(Xe+"time-axis-overflow",a)}}(t),!h||"time"!==n.scaleType&&"linear"!==n.scaleType||function(t){if(0!==b.length){var e=b[0],n=b[b.length-1],r=O.append("line").attr("x1",T(e)).attr("x2",T(e)).attr("y1",0).attr("y2",1),i=O.append("line").attr("x1",T(n)).attr("x2",T(n)).attr("y1",0).attr("y2",1),a={left:r.node().getBoundingClientRect().left-P.left,right:P.right-i.node().getBoundingClientRect().right};r.remove(),i.remove();var o=function(t,e,n){var r=t.getBoundingClientRect(),i=e>0?"right":"left",o=(T(n),a[i]),s=Math.ceil(r.width/2-o+1);t.setAttribute("dx",String(s>0?-e*s:0))},s=t.filter(function(t){return t===e}).node(),u=t.filter(function(t){return t===n}).node();t.attr("dx",null),o(s,-1,e),o(u,1,n)}}(t),t}).then(function(t){return A?t.transition(A):t}).then(function(t){t.attr(m,o),L(t),u(t),d&&r.avoidCollisions&&!r.facetAxis&&(A?A.on("end.fixTickTextCollision",function(){return R(i.tick)}):R(i.tick))})}(F),i.hide||function(){var t=i,e=Me(O,"text.label").attr("class",Ae("label",t.cssClass)).attr("transform",Le(t.rotate)).attr("text-anchor",t.textAnchor);ce(e).then(function(t){return A?t.transition(A):t}).then(function(e){var n=v*t.padding,r=Math.abs(M-S),i=h?r:0;e.attr("x",i).attr("y",n).attr("text-anchor","end")});for(var n=t.text.split("  "),r=n.length-1;r>0;r--)n.splice(r,0,"  ");e.selectAll("tspan").data(n).enter().append("tspan").attr("class",function(t,e){return e%2?"label-token-delimiter label-token-delimiter-"+e:"label-token label-token-"+e}).text(function(t){return t}).exit().remove()}())}}function br(t){return vr({scale:t.scale,scaleGuide:t.scaleGuide,ticksCount:t.ticksCount,tickSize:t.tickSize,gridOnly:!0,position:t.position})}var xr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_r=Me,wr=function(t){var e=t<=20?1:.75;return Math.max(2,Math.round(t*e))},Er=function(t){function e(e){var n=t.call(this,e)||this;n.config=e,n.config.guide=Qt(n.config.guide||{},{showGridLines:"xy",padding:{l:50,r:0,t:0,b:50}}),n.config.guide.x=n.config.guide.x||{},n.config.guide.x=Qt(n.config.guide.x,{cssClass:"x axis",textAnchor:"middle",padding:10,hide:!1,scaleOrient:"bottom",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof n.config.guide.x.label&&(n.config.guide.x.label={text:n.config.guide.x.label}),n.config.guide.x.label=Qt(n.config.guide.x.label,{text:"X",rotate:0,padding:40,textAnchor:"middle"}),n.config.guide.y=n.config.guide.y||{},n.config.guide.y=Qt(n.config.guide.y,{cssClass:"y axis",textAnchor:"start",padding:10,hide:!1,scaleOrient:"left",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof n.config.guide.y.label&&(n.config.guide.y.label={text:n.config.guide.y.label}),n.config.guide.y.label=Qt(n.config.guide.y.label,{text:"Y",rotate:-90,padding:20,textAnchor:"middle"});var r=n.config,i=r.guide;if("extract-axes"===i.autoLayout){var a=r.options.containerHeight-(r.options.top+r.options.height);i.x.hide=i.x.hide||Math.floor(a)>0,i.y.hide=i.y.hide||Math.floor(r.options.left)>0}var o=n.config.options,s=n.config.guide.padding;return n.L=o.left+s.l,n.T=o.top+s.t,n.W=o.width-(s.l+s.r),n.H=o.height-(s.t+s.b),n}return xr(e,t),e.prototype.defineGrammarModel=function(t){var e=this.W,n=this.H;return this.xScale=t("pos",this.config.x,[0,e]),this.yScale=t("pos",this.config.y,function(t){return["ordinal","period"].indexOf(t.type)>=0?[0,n]:[n,0]}),this.regScale("x",this.xScale).regScale("y",this.yScale),{scaleX:this.xScale,scaleY:this.yScale,xi:function(){return e/2},yi:function(){return n/2},sizeX:function(){return e},sizeY:function(){return n}}},e.prototype.getGrammarRules=function(){return[function(t){var e=t.scaleX,n=t.scaleY;return{xi:function(n){return n?e(n[e.dim]):t.xi(n)},yi:function(e){return e?n(e[n.dim]):t.yi(e)},sizeX:function(n){return n?e.stepSize(n[e.dim]):t.sizeX(n)},sizeY:function(e){return e?n.stepSize(e[n.dim]):t.sizeY(e)}}}]},e.prototype.createScreenModel=function(t){return t},e.prototype.allocateRect=function(t){var e=this,n=this.screenModel;return{slot:function(t){return e.config.options.container.selectAll(".uid_"+t)},left:n.xi(t)-n.sizeX(t)/2,top:n.yi(t)-n.sizeY(t)/2,width:n.sizeX(t),height:n.sizeY(t),containerWidth:this.W,containerHeight:this.H}},e.prototype.drawFrames=function(t){var e=Object.assign({},this.config),n=e.options,r=this.W,i=this.H;if(e.x=this.xScale,e.y=this.yScale,e.x.scaleObj=this.xScale,e.y.scaleObj=this.yScale,e.x.guide=e.guide.x,e.y.guide=e.guide.y,e.x.guide.label.size=r,e.y.guide.label.size=i,(n.container.attr("transform")?nt(n.container,this.config.guide.animationSpeed,"cartesianContainerTransform"):n.container).attr("transform",Pe(this.L,this.T)),e.x.guide.hide)this._removeDimAxis(n.container,e.x);else{var a="top"===e.x.guide.scaleOrient?[0,0-e.guide.x.padding]:[0,i+e.guide.x.padding];this._drawDimAxis(n.container,e.x,a,r)}if(e.y.guide.hide)this._removeDimAxis(n.container,e.y);else{var o="right"===e.y.guide.scaleOrient?[r+e.guide.y.padding,0]:[0-e.guide.y.padding,0];this._drawDimAxis(n.container,e.y,o,i)}var s=t.reduce(function(t,e){return t.concat((e.units||[]).map(function(t){return t.uid}))},[]),u=this._drawGrid(n.container,e,r,i,n),l=ut(u,".cell").data(s,function(t){return t});l.enter().append("g").attr("class",function(t){return Xe+"cell cell uid_"+t}).merge(l).classed("tau-active",!0),nt(l,this.config.guide.animationSpeed).attr("opacity",1),nt(l.exit().classed("tau-active",!1),this.config.guide.animationSpeed).attr("opacity",1e-6).remove()},e.prototype._drawDimAxis=function(t,e,n,r){var i=Mn.get(e.guide.tickFormat,e.guide.tickFormatNullAlias),o=vr({scale:e.scaleObj,scaleGuide:e.guide,ticksCount:i?wr(r/e.guide.density):null,tickFormat:i||null,position:n}),s=this.config.guide.animationSpeed;_r(t,this._getAxisSelector(e)).classed("tau-active",!0).classed(e.guide.cssClass,!0).call(function(t){var e=nt(t,s,"axisTransition"),r=t.attr("transform");Pe.apply(a,n)!==r&&(r?e:t).attr("transform",Pe.apply(a,n)),e.call(o),e.attr("opacity",1)})},e.prototype._removeDimAxis=function(t,e){var n=ut(t,this._getAxisSelector(e)).classed("tau-active",!1);nt(n,this.config.guide.animationSpeed,"axisTransition").attr("opacity",1e-6).remove()},e.prototype._getAxisSelector=function(t){return"g."+("h"===Ne(t.guide.scaleOrient)?"x":"y")+".axis"},e.prototype._drawGrid=function(t,e,n,r){var i=this;return _r(t,"g.grid").attr("transform",Pe(0,0)).call(function(t){var a=t,o=i.config.guide.animationSpeed,s=(e.guide.showGridLines||"").toLowerCase();if(s.length>0){var u=_r(a,"g.grid-lines");if(s.indexOf("x")>-1){var l=e.x,c=Mn.get(l.guide.tickFormat),f=br({scale:l.scaleObj,scaleGuide:l.guide,tickSize:r,ticksCount:c?wr(n/l.guide.density):null}),d=_r(u,"g.grid-lines-x");nt(d,o).call(f)}if(s.indexOf("y")>-1){var h=e.y,p=(c=Mn.get(h.guide.tickFormat),br({scale:h.scaleObj,scaleGuide:h.guide,tickSize:-n,ticksCount:c?wr(r/h.guide.density):null})),g=_r(u,"g.grid-lines-y");nt(g,o).call(p)}}})},e}(m),Sr=n(11),Mr=n(8),Tr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Cr=function(){return(Cr=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},kr=Cr({},Sr,Mr,o),Ar=function(t){function e(e){var n=t.call(this,e)||this;n.config=e,n.config.guide=Qt(n.config.guide||{},{padding:{l:50,r:50,t:50,b:50},enableBrushing:!1}),n.columnsBrushes={},n.columnsSelections={},n.on("force-brush",function(t,e){return n._forceBrushing(e)});var r=n.config.options,i=n.config.guide.padding;return n.L=r.left+i.l,n.T=r.top+i.t,n.W=r.width-(i.l+i.r),n.H=r.height-(i.t+i.b),n}return Tr(e,t),e.prototype.defineGrammarModel=function(t){var e=this.config,n=this.W,r=this.H;this.columnsScalesMap=e.columns.reduce(function(e,n){return e[n]=t("pos",n,[0,r]),e},{});var i=n/(e.columns.length-1),a=e.columns.reduce(function(t,e,n){return t[e]=n*i,t},{});return this.xBase=function(t){return a[t]},this.regScale("columns",this.columnsScalesMap),{}},e.prototype.allocateRect=function(){var t=this;return{slot:function(e){return t.config.options.container.selectAll(".uid_"+e)},left:0,top:0,width:this.W,height:this.H,containerWidth:this.W,containerHeight:this.H}},e.prototype.drawFrames=function(t){var e=this,n=Object.assign({},this.config),r=n.options,i=this._fnDrawGrid(r.container,n,r.frameId,Object.keys(this.columnsScalesMap).reduce(function(t,n){return t.concat([e.columnsScalesMap[n].getHash()])},[]).join("_")),a=i.selectAll(".parent-frame-"+r.frameId).data(t,function(t){return t.hash()});a.exit().remove(),a.enter().append("g").attr("class",function(t){return Xe+"cell cell parent-frame-"+r.frameId+" frame-"+t.hash()}).merge(a).each(function(t){var e,n,i,a;e=r.frameId,n=kr.select(this),i=t,(a=n.selectAll(".layer_"+e).data(i.units,function(t){return t.uid})).exit().remove(),a.enter().append("g").attr("class",function(t){return"layer_"+e+" uid_"+t.uid})});var o=this._fnDrawColumns(i,n);n.guide.enableBrushing&&this._enableBrushing(o)},e.prototype._fnDrawGrid=function(t,e,n,r){var i=t.selectAll(".grid_"+n).data([r],function(t){return t});return i.exit().remove(),i.enter().append("g").attr("class","grid grid_"+n).attr("transform",Pe(this.L,this.T)).merge(i)},e.prototype._fnDrawColumns=function(t,e){var n=e.guide.columns||{},r=this.xBase,i=this.columnsScalesMap,a=kr.axisLeft(),o=t.selectAll(".column").data(e.columns,function(t){return t});return o.exit().remove(),o.enter().append("g").attr("class","column").attr("transform",function(t){return Pe(r(t),0)}).call(function(t){t.append("g").attr("class","y axis").each(function(t){var e=i[t].dim,r=a.scale(i[t]),o=n[e]||{},s=Mn.get(o.tickFormat,o.tickFormatNullAlias);null!==s&&r.tickFormat(s),kr.select(this).call(r)}).append("text").attr("class","label").attr("text-anchor","middle").attr("y",-9).text(function(t){return((n[t]||{}).label||{}).text||i[t].dim})}).merge(o)},e.prototype._enableBrushing=function(t){var e=this,n=this.columnsSelections,r=this.columnsScalesMap,i=this.columnsBrushes,a=!0,s=function(t){return t},u=function(t){return t},l=function(){var t=Object.keys(i).find(function(t){return i[t]===o.event.target});if(n[t]=o.event.selection,a){var s=Object.keys(i).filter(function(t){return n[t]}).map(function(t){var e=[];if(r[t].discrete){var i=n[t];e=r[t].domain().filter(function(e){var n=r[t](e);return i[0]<=n&&i[1]>=n})}else{var a=n[t].map(r[t].invert);e=[a[0],a[1]]}return{dim:r[t].dim,func:r[t].discrete?"inset":"between",args:e}});e.fire("brush",s)}};return t.selectAll(".brush").remove(),t.append("g").attr("class","brush").each(function(t){var e=r[t].range();i[t]=kr.brushY().extent([[0,e[0]],[16,e[1]]]).on("start",s).on("brush",l).on("end",u),kr.select(this).classed("brush-"+Ft(t),!0).call(i[t]),a=!1,i[t].move(kr.select(this),e),a=!0}).selectAll("rect").attr("transform","translate(-8,0)").attr("width",16),t},e.prototype._forceBrushing=function(t){void 0===t&&(t={});var e=this.columnsBrushes,n=this.columnsScalesMap;this.columnsSelections;Object.keys(t).filter(function(r){return e[r]&&n[r]&&t[r]}).forEach(function(r){var i=t[r],a=[];if(n[r].discrete){var o=i.map(n[r]).filter(function(t){return t>=0}),s=n[r].stepSize()/2;a=[Math.min.apply(Math,o)-s,Math.max.apply(Math,o)+s]}else a=[i[0],i[1]];var u=Ft(r);e[r](kr.select(".brush-"+u)),e[r].move(kr.select(".brush-"+u),a.map(n[r]))})},e}(m),Or=n(12);var Pr=n(4),Lr=function(){var t,e=[],n=[],r=1,i=1,a={},o=!1,s=function(t){var r=e.length,i=0,a=e[t].x-n[t].x,o=n[t].y-e[t].y,s=Math.sqrt(a*a+o*o);s>0&&(i+=.2*s),o/=s,i+=(a/=s)>0&&o>0?0:a<0&&o>0?3:a<0&&o<0?6:9;for(var u,l,f,d,h=e[t].x,p=e[t].y-e[t].height+2,g=e[t].x+e[t].width,m=e[t].y+2,y=0;y<r;y++)y!=t&&(c(n[t].x,e[t].x,n[y].x,e[y].x,n[t].y,e[t].y,n[y].y,e[y].y)&&(i+=1),u=e[y].x,f=e[y].y-e[y].height+2,l=e[y].x+e[y].width,d=e[y].y+2,i+=30*(Math.max(0,Math.min(l,g)-Math.max(u,h))*Math.max(0,Math.min(d,m)-Math.max(f,p)))),u=n[y].x-n[y].r,f=n[y].y-n[y].r,l=n[y].x+n[y].r,d=n[y].y+n[y].r,i+=30*(Math.max(0,Math.min(l,g)-Math.max(u,h))*Math.max(0,Math.min(d,m)-Math.max(f,p)));return i},u=function(a){var u,l=Math.floor(Math.random()*e.length),c=e[l].x,f=e[l].y;u=o?t(l,e,n):s(l),e[l].x+=5*(Math.random()-.5),e[l].y+=5*(Math.random()-.5),e[l].x>r&&(e[l].x=c),e[l].x<0&&(e[l].x=c),e[l].y>i&&(e[l].y=f),e[l].y<0&&(e[l].y=f);var d=(o?t(l,e,n):s(l))-u;Math.random()<Math.exp(-d/a)?1:(e[l].x=c,e[l].y=f,1)},l=function(a){var u,l=Math.floor(Math.random()*e.length),c=e[l].x,f=e[l].y;u=o?t(l,e,n):s(l);var d=.5*(Math.random()-.5),h=Math.sin(d),p=Math.cos(d);e[l].x-=n[l].x,e[l].y-=n[l].y;var g=e[l].x*p-e[l].y*h,m=e[l].x*h+e[l].y*p;e[l].x=g+n[l].x,e[l].y=m+n[l].y,e[l].x>r&&(e[l].x=c),e[l].x<0&&(e[l].x=c),e[l].y>i&&(e[l].y=f),e[l].y<0&&(e[l].y=f);var y=(o?t(l,e,n):s(l))-u;Math.random()<Math.exp(-y/a)?1:(e[l].x=c,e[l].y=f,1)},c=function(t,e,n,r,i,a,o,s){var u,l,c;return l=((e-t)*(i-o)-(a-i)*(t-n))/(c=(s-o)*(e-t)-(r-n)*(a-i)),!((u=((r-n)*(i-o)-(s-o)*(t-n))/c)<0||u>1||l<0||l>1)},f=function(t,e,n){return t-e/n};return a.start=function(t){for(var n=e.length,r=1,i=0;i<t;i++){for(var a=0;a<n;a++)Math.random()<.5?u(r):l(r);r=f(r,1,t)}},a.width=function(t){return arguments.length?(r=t,a):r},a.height=function(t){return arguments.length?(i=t,a):i},a.label=function(t){return arguments.length?(e=t,a):e},a.anchor=function(t){return arguments.length?(n=t,a):n},a.alt_energy=function(e){return arguments.length?(t=e,o=!0,a):s},a.alt_schedule=function(){return arguments.length?a:f},a},Nr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rr=function(){return(Rr=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Fr=Rr({},s,Or,o),Dr=["land","continents","georegions","countries","regions","subunits","states","counties"],jr=function(t){function e(e){var n=t.call(this,e)||this;return n.config=e,n.config.guide=Qt(n.config.guide||{},{defaultFill:"rgba(128,128,128,0.25)",padding:{l:0,r:0,t:0,b:0},showNames:!0}),n.contourToFill=null,n.on("highlight-area",function(t,e){return n._highlightArea(e)}),n.on("highlight-point",function(t,e){return n._highlightPoint(e)}),n.on("highlight",function(t,e){return n._highlightPoint(e)}),n}return Nr(e,t),e.prototype.defineGrammarModel=function(t){var e=this.config,n=e.options,r=e.guide.padding,i=n.width-(r.l+r.r),a=n.height-(r.t+r.b);return this.latScale=t("pos",e.latitude,[0,a]),this.lonScale=t("pos",e.longitude,[i,0]),this.sizeScale=t("size",e.size),this.colorScale=t("color",e.color),this.codeScale=t("value",e.code),this.fillScale=t("fill",e.fill),this.W=i,this.H=a,this.regScale("latitude",this.latScale).regScale("longitude",this.lonScale).regScale("size",this.sizeScale).regScale("color",this.colorScale).regScale("code",this.codeScale).regScale("fill",this.fillScale),{}},e.prototype.drawFrames=function(t){var e,n,r,i=this,a=this.config.guide;"string"==typeof a.sourcemap?(e=a.sourcemap,n=function(e,n){if(e)throw e;i._drawMap(t,n)},(r=new XMLHttpRequest).onload=function(){if(r.status>=200&&r.status<300){var t=r.responseText;try{n(null,JSON.parse(t))}catch(t){n(t,null)}}else n(new Error(r.status+": "+r.statusText),null)},r.onerror=function(t){n(t.error,null)},r.open("GET",e,!0),r.send(null)):this._drawMap(t,a.sourcemap)},e.prototype._calcLabels=function(t,e,n){var r=this.W,i=this.H,a={};return e.forEach(function(e){var o=(Pr.feature(t,t.objects[e]).features||[]).map(function(t){var i=t.properties||{},a=n.centroid(t),o=n.bounds(t),s=a[0],u=a[1],l=o[1][0]-o[0][0],c=i.name||"",f=i.abbr||c,d=l<5.5*c.length?f:c,h=l<13.75,p=h?r-s-16.5:0;return{id:e+"-"+t.id,sx:s,sy:u,x:s+p,y:u,width:5.5*d.length,height:10,name:d,r:p,isRef:h}}).filter(function(t){return!Number.isNaN(t.x)&&!Number.isNaN(t.y)}),s=o.map(function(t){return{x:t.sx,y:t.sy,r:t.r}});Lr().label(o).anchor(s).width(r).height(i).start(10),o.filter(function(t){return!t.isRef}).map(function(t){return t.x=t.sx,t.y=t.sy,t}).reduce(function(t,e){return t[e.id]=e,t},a);var u=o.filter(function(t){return t.isRef});u.length<6&&u.reduce(function(t,e){return t[e.id]=e,t},a)}),a},e.prototype._drawMap=function(t,e){var n,r,i=this,a=this,s=this.config.guide,u=this.config.options,l=this.config.options.container,c=this.latScale,f=this.lonScale,d=this.sizeScale,h=this.colorScale,p=this.codeScale,g=this.fillScale,m=this.W,y=this.H,v=Dr.filter(function(t){return(e.objects||{}).hasOwnProperty(t)});if(0===v.length)throw new Error("Invalid map: should contain some contours");if(g.dim){if(!p.georole)throw console.log("Specify [georole] for code scale"),new Error("[georole] is missing");if(-1===v.indexOf(p.georole))throw console.log('There is no contour for georole "'+p.georole+'"'),console.log("Available contours are: "+v.join(" | ")),new Error("Invalid [georole]");n=p.georole}else n=v[v.length-1];if(this.contourToFill=n,c.dim&&f.dim){var b=Fr.extent(c.domain()),x=Fr.extent(f.domain());r=[(x[1]+x[0])/2,(b[1]+b[0])/2]}var _=this._createProjection(e,v[0],r),w=Fr.geoPath().projection(_),E=l.selectAll(".map-container").data([""+m+y+r+v.join("-")],function(t){return t});E.exit().remove();var S=E.enter().append("g").call(function(t){var n=t;n.attr("class","map-container");var r={},i=v.reduceRight(function(t,e){return t.concat(e)},[]);if(s.showNames&&(r=a._calcLabels(e,i,w)),i.forEach(function(t,i){var a=function(e){return r[t+"-"+e.id]};n.selectAll(".map-contour-"+t).data(Pr.feature(e,e.objects[t]).features||[]).enter().append("g").call(function(e){var n=e;n.attr("class","map-contour-"+t+" map-contour-level map-contour-level-"+i).attr("fill","none"),n.append("title").text(function(t){return(t.properties||{}).name}),n.append("path").attr("d",w),n.append("text").attr("class","place-label-"+t).attr("transform",function(t){var e=a(t);return e?"translate("+[e.x,e.y]+")":""}).text(function(t){var e=a(t);return e?e.name:""}),n.append("line").attr("class","place-label-link-"+t).attr("stroke","gray").attr("stroke-width",.25).attr("x1",function(t){var e=a(t);return e&&e.isRef?e.sx:0}).attr("y1",function(t){var e=a(t);return e&&e.isRef?e.sy:0}).attr("x2",function(t){var e=a(t);return e&&e.isRef?e.x-.6*e.name.length*5.5:0}).attr("y2",function(t){var e=a(t);return e&&e.isRef?e.y-3.5:0})})}),e.objects.hasOwnProperty("places")){var o=Pr.feature(e,e.objects.places),u=o.features.map(function(t){var e=_(t.geometry.coordinates);return{x:e[0]+3.5,y:e[1]+3.5,width:5.5*t.properties.name.length,height:12,name:t.properties.name}}),l=o.features.map(function(t){var e=_(t.geometry.coordinates);return{x:e[0],y:e[1],r:2.5}});Lr().label(u).anchor(l).width(m).height(y).start(100),n.selectAll(".place").data(l).enter().append("circle").attr("class","place").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("r",function(t){return t.r+"px"}),n.selectAll(".place-label").data(u).enter().append("text").attr("class","place-label").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).text(function(t){return t.name})}}).merge(E);this.groupByCode=t.reduce(function(t,e){return e.part().reduce(function(t,e){return t[(e[p.dim]||"").toLowerCase()]=e,t},t)},{});var M=this._resolveFeature.bind(this);if(S.selectAll(".map-contour-"+n).data(Pr.feature(e,e.objects[n]).features).call(function(t){t.classed("map-contour",!0).attr("fill",function(t){var e=M(t);return null===e?s.defaultFill:g(e[g.dim])})}).on("mouseover",function(t){return i.fire("area-mouseover",{data:M(t),event:o.event})}).on("mouseout",function(t){return i.fire("area-mouseout",{data:M(t),event:o.event})}).on("click",function(t){return i.fire("area-click",{data:M(t),event:o.event})}),!c.dim||!f.dim)return[];var T=function(t){return t.attr("r",function(t){return d(t[d.dim])}).attr("transform",function(t){var e=t.data;return"translate("+_([e[f.dim],e[c.dim]])+")"}).attr("class",function(t){var e=t.data;return h(e[h.dim])}).attr("opacity",.5).on("mouseover",function(t){var e=t.data;return a.fire("point-mouseover",{data:e,event:o.event})}).on("mouseout",function(t){var e=t.data;return a.fire("point-mouseout",{data:e,event:o.event})}).on("click",function(t){var e=t.data;return a.fire("point-click",{data:e,event:o.event})})},C=S.selectAll(".frame").data(t.map(function(t){return{tags:t.key||{},hash:t.hash(),data:t.part()}}),function(t){return t.hash});return C.exit().remove(),C.enter().append("g").merge(C).call(function(t){t.attr("class",function(t){return"frame frame-"+t.hash}).call(function(t){var e=t.selectAll("circle").data(function(t){return t.data.map(function(t){return{data:t,uid:u.uid}})});e.exit().remove(),e.call(T),e.enter().append("circle").call(T)})}),[]},e.prototype._resolveFeature=function(t){var e,n=this.groupByCode,r=t.properties,i=["c1","c2","c3","abbr","name"].filter(function(t){return r.hasOwnProperty(t)&&r[t]&&n.hasOwnProperty(r[t].toLowerCase())});if(0===i.length)e=null;else if(i.length>0){var a=r[i[0]].toLowerCase();e=n[a]}return e},e.prototype._highlightArea=function(t){var e=this,n=this.config.options.container,r=this.contourToFill;n.selectAll(".map-contour-"+r).classed("map-contour-highlighted",function(n){return t(e._resolveFeature(n))})},e.prototype._highlightPoint=function(t){this.config.options.container.selectAll("circle").classed("map-point-highlighted",function(e){var n=e.data;return t(n)}).attr("opacity",function(e){var n=e.data;return t(n)?.5:.1})},e.prototype._createProjection=function(t,e,n){var r=this.W,i=this.H,a=this.config.guide,o=100,s=[r/2,i/2],u=n||t.center,l=a.projection||t.projection||"mercator",c=this._createD3Projection(l,u,o,s),f=Fr.geoPath().projection(c).bounds(Pr.feature(t,t.objects[e])),d=o*r/(f[1][0]-f[0][0]),h=o*i/(f[1][1]-f[0][1]);return o=d<h?d:h,s=[r-(f[0][0]+f[1][0])/2,i-(f[0][1]+f[1][1])/2],this._createD3Projection(l,u,o,s)},e.prototype._createD3Projection=function(t,e,n,r){var i="geo"+t.substring(0,1).toUpperCase()+t.substring(1),a=Fr[i];if(!a)throw console.log('Unknown projection "'+t+'"'),console.log("See available projection types here: https://github.com/mbostock/d3/wiki/Geo-Projections"),new Error('Invalid map: unknown projection "'+t+'"');var o=a();return[{method:"scale",args:n},{method:"center",args:e},{method:"translate",args:r}].filter(function(t){return t.args}).reduce(function(t,e){return t[e.method]&&(t=t[e.method](e.args)),t},o)},e}(m),Ir=function(t){return function(){return t}},zr=function(){function t(t){this.model=t.model,this.x=t.x||Ir(0),this.y=t.y||Ir(0),this.dx=t.dx||Ir(0),this.dy=t.dy||Ir(0),this.w=t.w||Ir(0),this.h=t.h||Ir(0),this.hide=t.hide||Ir(!1),this.label=t.label||Ir(""),this.color=t.color||Ir(""),this.angle=t.angle||Ir(0),this.labelLinesAndSeparator=t.labelLinesAndSeparator||Ir({lines:[],linesWidths:[],separator:""})}return t.seed=function(e,n){var r=n.fontColor,i=n.flip,a=n.formatter,o=n.labelRectSize,s=n.paddingKoeff,u=void 0===s?.5:s,l=n.lineBreakAvailable,c=n.lineBreakSeparator,f=i?e.yi:e.xi,d=i?e.xi:e.yi,h=function(t){return a(e.label(t))},p=function(t){var e=l?h(t).split(c):[h(t)];return{lines:e,linesWidths:e.map(function(t){return o([t]).width}),separator:c}};return new t({model:e,x:function(t){return f(t)},y:function(t){return d(t)},dy:function(t){return o(p(t).lines).height*u},w:function(t){return o(p(t).lines).width},h:function(t){return o(p(t).lines).height},label:h,labelLinesAndSeparator:p,color:function(){return r},angle:function(){return 0}})},t.compose=function(e,n){return void 0===n&&(n={}),Object.keys(n).reduce(function(t,e){return t[e]=n[e],t},new t(e))},t}(),Br={},Vr=function(){function t(){}return t.regRule=function(t,e){return Br[t]=e,this},t.getRule=function(t){return Br[t]},t}(),Hr=function(t,e){var n=t.lines,r=t.linesWidths,i=t.separator;return n.map(function(t,n){var i=function(t,e,n){return n<e?Math.max(1,Math.floor(n*t.length/e))-1:t.length}(t,r[n],e);return i<t.length?function(t,e){return 0===e?"":t.slice(0,e).replace(/\.+$/g,"")+""}(t,i):t}).join(i)},Wr=function(t,e){var n=5-(t.labelLinesAndSeparator(e).lines.length-1);return n<1?1:n},Gr=function(t,e){return t.discrete||!t.discrete&&e[t.dim]>=0},Ur=function(t,e){return!t.discrete&&e[t.dim]<0},Xr=function(t,e){return t.w(e)/2+Math.floor(t.model.size(e)/Wr(t,e))},qr=function(t,e){return t.h(e)/2+Math.floor(t.model.size(e)/Wr(t,e))},Yr=function(t){return function(e){return{dx:function(n){var r=e.model.scaleY;if("+"===t[2]&&!Gr(r,n))return e.dx(n);if("-"===t[2]&&!Ur(r,n))return e.dx(n);var i=t[1],a=t[0]===t[0].toUpperCase()?1:0;return e.dx(n)+i*a*e.model.size(n)/2+i*Xr(e,n)}}}},$r=function(t){return function(e){return{dy:function(n){var r=e.model.scaleY;if("+"===t[2]&&!Gr(r,n))return e.dy(n);if("-"===t[2]&&!Ur(r,n))return e.dy(n);var i=t[1],a=t[0]===t[0].toUpperCase()?1:0;return e.dy(n)+i*a*e.model.size(n)/2+i*qr(e,n)}}}};Vr.regRule("l",Yr(["l",-1,null])).regRule("L",Yr(["L",-1,null])).regRule("l+",Yr(["l",-1,"+"])).regRule("l-",Yr(["l",-1,"-"])).regRule("L+",Yr(["L",-1,"+"])).regRule("L-",Yr(["L",-1,"-"])).regRule("r",Yr(["r",1,null])).regRule("R",Yr(["R",1,null])).regRule("r+",Yr(["r",1,"+"])).regRule("r-",Yr(["r",1,"-"])).regRule("R+",Yr(["R",1,"+"])).regRule("R-",Yr(["R",1,"-"])).regRule("t",$r(["t",-1,null])).regRule("T",$r(["T",-1,null])).regRule("t+",$r(["t",-1,"+"])).regRule("t-",$r(["t",-1,"-"])).regRule("T+",$r(["T",-1,"+"])).regRule("T-",$r(["T",-1,"-"])).regRule("b",$r(["b",1,null])).regRule("B",$r(["B",1,null])).regRule("b+",$r(["b",1,"+"])).regRule("b-",$r(["b",1,"-"])).regRule("B+",$r(["B",1,"+"])).regRule("B-",$r(["B",1,"-"])).regRule("rotate-on-size-overflow",function(t,e){var n=e.data,r=e.lineBreakAvailable,i={};if(n.reduce(function(e,n){return e+(function(e){return t.model.size(e)<t.w(e)}(n)?1:0)},0)/n.length>.5){var a=r?-.5:.5;i={angle:function(){return-90},w:function(e){return t.h(e)},h:function(e){return t.w(e)},dx:function(e){return t.h(e)*a-2},dy:function(){return 0}}}return i}).regRule("hide-by-label-height-vertical",function(t){return{hide:function(e){var n,r;return 0===t.angle(e)?(r=t.h(e),n=Math.abs(t.model.y0(e)-t.model.yi(e))):(r=t.w(e),n=t.model.size(e)),r>n||t.hide(e)}}}).regRule("cut-label-vertical",function(t){return{h:function(e){var n=t.h(e);if(Math.abs(t.angle(e))>0){var r=Math.abs(t.model.y0(e)-t.model.yi(e));return r<n?r:n}return n},w:function(e){var n=t.w(e);if(0===t.angle(e)){var r=t.model.size(e);return r<n?r:n}return n},label:function(e){var n;return n=0===t.angle(e)?t.model.size(e):Math.abs(t.model.y0(e)-t.model.yi(e)),Hr(t.labelLinesAndSeparator(e),n)},dy:function(e){var n=t.dy(e);if(0!==t.angle(e)){var r=t.h(e),i=Math.abs(t.model.y0(e)-t.model.yi(e));return i<r?i*n/r:n}return n}}}).regRule("cut-outer-label-vertical",function(t){return{h:function(e,n){var r=t.h(e);if(Math.abs(t.angle(e))>0){var i=t.model.y0(e)<t.model.yi(e)?n.maxHeight-t.model.yi(e):t.model.yi(e);return i<r?i:r}return r},w:function(e){var n=t.w(e);if(0===t.angle(e)){var r=t.model.size(e);return r<n?r:n}return n},label:function(e,n){var r;return r=0===t.angle(e)?t.model.size(e):t.model.y0(e)<t.model.yi(e)?n.maxHeight-t.model.yi(e):t.model.yi(e),Hr(t.labelLinesAndSeparator(e),r)},dy:function(e,n){var r=t.dy(e);if(0!==t.angle(e)){var i=t.h(e),a=t.model.y0(e)<t.model.yi(e)?n.maxHeight-t.model.yi(e):t.model.yi(e);return a<i?a*r/i:r}return r}}}).regRule("from-beginning",function(t){var e=function(e){return t.model.y0(e)};return t.model.flip?{x:e}:{y:e}}).regRule("to-end",function(t){var e=function(e){return t.model.yi(e)};return t.model.flip?{x:e}:{y:e}}).regRule("towards",function(t){var e=t.model.flip?Xr:qr,n=function(n){return function(t,e){return t.model.yi(e)-t.model.y0(e)>=0?1:-1}(t,n)*e(t,n)};return t.model.flip?{dx:n}:{dy:n}}).regRule("inside-start-then-outside-end-horizontal",function(t,e){var n=[Vr.getRule("from-beginning"),Vr.getRule("towards"),Vr.getRule("cut-label-horizontal")].reduce(function(t,n){return zr.compose(t,n(t,e))},t),r=[Vr.getRule("to-end"),Vr.getRule("towards"),Vr.getRule("cut-outer-label-horizontal")].reduce(function(t,n){return zr.compose(t,n(t,e))},t);return Object.assign({},n,["x","dx","hide","label"].reduce(function(t,e){return t[e]=function(t){return(function(t){return n.label(t).length>=r.label(t).length}(t)?n:r)[e](t)},t},{}))}).regRule("inside-start-then-outside-end-vertical",function(t,e){var n=[Vr.getRule("from-beginning"),Vr.getRule("towards"),Vr.getRule("cut-label-vertical")].reduce(function(t,n){return zr.compose(t,n(t,e))},t),r=[Vr.getRule("to-end"),Vr.getRule("towards"),Vr.getRule("cut-outer-label-vertical")].reduce(function(t,n){return zr.compose(t,n(t,e))},t);return Object.assign({},n,["y","dy","hide","label"].reduce(function(t,e){return t[e]=function(t){return(function(t){return n.label(t).length>=r.label(t).length}(t)?n:r)[e](t)},t},{}))}).regRule("outside-then-inside-horizontal",function(t,e){var n=["r+","l-","cut-outer-label-horizontal"].map(Vr.getRule).reduce(function(t,n){return zr.compose(t,n(t,e))},t),r=["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"].map(Vr.getRule).reduce(function(t,n){return zr.compose(t,n(t,e))},t);return Object.assign({},n,["x","dx","hide","label"].reduce(function(t,e){return t[e]=function(t){return(function(t){return r.label(t).length>n.label(t).length}(t)?r:n)[e](t)},t},{}))}).regRule("outside-then-inside-vertical",function(t,e){var n=["t+","b-","cut-outer-label-vertical"].map(Vr.getRule).reduce(function(t,n){return zr.compose(t,n(t,e))},t),r=["t-","b+","hide-by-label-height-vertical","cut-label-vertical"].map(Vr.getRule).reduce(function(t,n){return zr.compose(t,n(t,e))},t);return Object.assign({},n,["y","dy","hide","label"].reduce(function(t,i){return t[i]=function(t){return(function(t){var r=n.y(t,e)+n.dy(t,e);return r<=0||r>=e.maxHeight}(t)?r:n)[i](t,e)},t},{}))}).regRule("hide-by-label-height-horizontal",function(t){return{hide:function(e){return t.model.size(e)<t.h(e)||t.hide(e)}}}).regRule("cut-label-horizontal",function(t){return{dx:function(e){var n=t.w(e),r=Math.abs(t.model.y0(e)-t.model.yi(e)),i=t.dx(e);return r<n?r*i/n:i},w:function(e){var n=t.w(e),r=Math.abs(t.model.y0(e)-t.model.yi(e));return r<n?r:n},label:function(e){var n=Math.abs(t.model.y0(e)-t.model.yi(e));return Hr(t.labelLinesAndSeparator(e),n)}}}).regRule("cut-outer-label-horizontal",function(t,e){return{dx:function(n){var r=t.w(n),i=t.model.y0(n)<t.model.yi(n)?e.maxWidth-t.model.yi(n):t.model.yi(n),a=t.dx(n);return i<r?i*a/r:a},w:function(n){var r=t.w(n),i=t.model.y0(n)<t.model.yi(n)?e.maxWidth-t.model.yi(n):t.model.yi(n);return i<r?i:r},label:function(n){var r=t.model.y0(n)<t.model.yi(n)?e.maxWidth-t.model.yi(n):t.model.yi(n);return Hr(t.labelLinesAndSeparator(n),r)}}}).regRule("keep-within-diameter-or-top",function(t){return{dy:function(e){return t.model.size(e)/t.w(e)<1?t.dy(e)-t.h(e)/2-t.model.size(e)/2:t.dy(e)}}}).regRule("keep-in-box",function(t,e){var n=e.maxWidth,r=e.maxHeight;return{dx:function(e){var r=t.dx(e),i=t.x(e)+r,a=t.w(e),o=0-(i-a/2);if(o>0)return r+o;var s=i+a/2-n;return s>0?r-s:r},dy:function(e){var n=t.dy(e),i=t.y(e)+n,a=t.h(e);if(0-(i-a/2)>0)return 0;var o=i+a/2-r;return o>0?n-o:n}}}).regRule("multiline-label-left-align",function(t){return{dy:function(e){var n=t.dy(e);return-90===t.angle(e)?n+t.h(e)/2:n}}}).regRule("multiline-label-vertical-center-align",function(t){return{dy:function(e){return t.dy(e)-t.h(e)/2}}}).regRule("multiline-hide-on-container-overflow",function(t,e){var n=e.maxWidth,r=e.maxHeight;return{hide:function(e){var i=t.angle(e),a=t.x(e)+t.dx(e),o=t.y(e)+t.dy(e);return!(!Ut(a,t.w(e),i,n)&&!Xt(o,t.h(e),i,r))||t.hide(e)}}});var Kr=function(){function t(t){this.minError=Number.MAX_VALUE,this.items=t.items,this.revision=this.items.map(function(t){return{i:t.i,x:t.x,y:t.y}}),this.penalties=t.penalties,this.transactor=t.transactor,this.cooling_schedule=t.cooling_schedule||function(t,e,n){return t-e/n}}return t.prototype.energy=function(t){return this.penalties.reduce(function(e,n){return e+n(t)},0)},t.prototype.move=function(t){var e=Math.floor(Math.random()*this.items.length),n=this.transactor(this.items[e]),r=this.energy(e);this.items[e]=n.modify();var i=this.energy(e),a=i-r,o=a<0?1:Math.exp(-a/t);Math.random()>=o?this.items[e]=n.revert():i<this.minError&&(this.minError=i,this.revision=this.items.map(function(t){return{i:t.i,x:t.x,y:t.y}}))},t.prototype.start=function(t){var e=1,n=this.items.length;t:for(var r=0;r<t;r++){for(var i=0;i<n;i++)if(this.move(e),this.minError<=10)break t;e=this.cooling_schedule(e,1,t)}return this.revision},t}(),Jr=function(t,e,n,r,i,a,o,s){return Fe(t,i,e,a,n,o,r,s)},Qr={},Zr=function(){function t(){}return t.reg=function(t,e){return Qr[t]=e,this},t.get=function(t){return Qr[t]},t}();Zr.reg("auto:avoid-label-label-overlap",function(t,e,n){return void 0===n&&(n=1),function(e){var r=t[e].x,i=t[e].y-t[e].h+2,a=t[e].x+t[e].w,o=t[e].y+2;return t.reduce(function(t,s,u){var l=Number(u!==e),c=s.x,f=s.y-s.h+2,d=s.x+s.w,h=s.y+2;return t+l*(Math.max(0,Math.min(d,a)-Math.max(c,r))*Math.max(0,Math.min(h,o)-Math.max(f,i))*n)},0)}}).reg("auto:avoid-label-anchor-overlap",function(t,e,n){return void 0===n&&(n=1),function(e){var r=t[e],i=r.x-r.w/2,a=r.x+r.w/2,o=r.y-r.h/2+2,s=r.y+r.h/2+2;return t.reduce(function(t,e){var r=e.x0-e.size/2,u=e.x0+e.size/2,l=e.y0-e.size/2,c=e.y0+e.size/2;return t+Math.max(0,Math.min(u,a)-Math.max(r,i))*Math.max(0,Math.min(c,s)-Math.max(l,o))*n},0)}}).reg("auto:avoid-label-edges-overlap",function(t,e,n){return void 0===n&&(n=1),function(r){var i=t[r],a=i.x-i.w/2,o=i.x+i.w/2,s=i.y-i.h/2,u=i.y+i.h/2;return e.reduce(function(t,e){var r=Jr(a,o,e.x0,e.x1,s,u,e.y0,e.y1),i=Jr(a,o,e.x0,e.x1,u,s,e.y0,e.y1);return t+(Number(r)+Number(i))*n},0)}});var ti=function(t,e,n,r,i,a,o,s){return Fe(t,i,e,a,n,o,r,s)},ei=function(){function t(t,e,n,r){var i=r.width,a=r.height,o=r.container;this.container=o,this.model=t,this.flip=e,this.w=i,this.h=a,this.guide=Qt(n||{},{fontFamily:"Helvetica Neue, Segoe UI, Open Sans, Ubuntu, sans-serif",fontWeight:"normal",fontSize:10,fontColor:"#000",hideEqualLabels:!1,lineBreak:!1,lineBreakSeparator:"",position:[],tickFormat:null,tickFormatNullAlias:""})}return t.prototype.draw=function(t){var e=this,n=this.model,r=this.guide,i=r.lineBreak,a=r.lineBreakSeparator,s=zr.seed(n,{fontColor:r.fontColor,flip:e.flip,formatter:Mn.get(r.tickFormat,r.tickFormatNullAlias),labelRectSize:function(t){return Ee(t,r)},lineBreakAvailable:i,lineBreakSeparator:a,paddingKoeff:i?0:.5}),u={lineBreakAvailable:i,maxWidth:e.w,maxHeight:e.h,data:t.reduce(function(t,e){return t.concat(e)},[])},l=this.applyFixedPositionRules(r,u,s,i,this.flip),c=t.reduce(function(t,e){var n=e.map(function(t){return{data:t,x:l.x(t)+l.dx(t),y:l.y(t)+l.dy(t),w:l.w(t),h:l.h(t,u),hide:l.hide(t),extr:null,size:l.model.size(t),angle:l.angle(t),label:l.label(t),labelLinesAndSeparator:l.labelLinesAndSeparator(t),color:l.color(t)}});return t.text=t.text.concat(n),t.edges=t.edges.concat(function(t,e){for(var n=t.length-1,r=[],i=0;i<=n;i++){var a=0===i?i:i-1,o=i,s=i===n?i:i+1;r.push(e(t[a],t[o],t[s]))}return r}(n,function(t,e,n){return e.y===Math.max(e.y,t.y,n.y)?e.extr="min":e.y===Math.min(e.y,t.y,n.y)?e.extr="max":e.extr="norm",{x0:t.x,x1:e.x,y0:t.y,y1:e.y}})),t},{text:[],edges:[]});c.text=c.text.filter(function(t){return t.label}).map(function(t,e){return Object.assign(t,{i:e})});var f=i?["auto:hide-on-label-label-overlap","auto:adjust-on-multiline-label-overflow"]:this.guide.position,d=f.filter(function(t){return 0===t.indexOf("auto:avoid")});c=c.text.length>0&&d.length>0?this.autoPosition(c,d):c;var h=f.reduce(function(t,e){var n;return Object.assign(t,((n={})[e]=!0,n))},{});c.text=c.text=h["auto:adjust-on-label-overflow"]?this.adjustOnOverflow(c.text,u):c.text,c.text=c.text=h["auto:adjust-on-multiline-label-overflow"]?this.adjustOnMultilineOverflow(c.text,u):c.text,c.text=h["auto:hide-on-label-edges-overlap"]?this.hideOnLabelEdgesOverlap(c.text,c.edges):c.text,c.text=h["auto:hide-on-label-label-overlap"]?this.hideOnLabelLabelOverlap(c.text):c.text,c.text=h["auto:hide-on-label-anchor-overlap"]?this.hideOnLabelAnchorOverlap(c.text):c.text;var p=c.text,g=function(t){return function(e,n){return p[n][t]}},m=g("x"),y=g("y"),v=g("angle"),b=g("color"),x=g("label"),_=function(t){if(t.style("fill",b).style("font-size",e.guide.fontSize+"px").style("display",function(t,e){return p[e].hide?"none":null}).attr("class","i-role-label").attr("text-anchor","middle").attr("transform",function(t,e){return"translate("+m(t,e)+","+y(t,e)+") rotate("+v(t,e)+")"}),i){t.each(function(t,e){var n=o.select(this),r=v(t,e);n.text(null),x(t,e).split(a).forEach(function(t,e){n.append("tspan").attr("text-anchor",0!==r?"start":"middle").attr("x",0).attr("y",0).attr("dy",1.2*(e+1)+"em").text(t)})})}else t.text(x)};r.hideEqualLabels&&p.filter(function(t){return!t.hide}).filter(function(t,e,n){return e<n.length-1&&t.label===n[e+1].label}).forEach(function(t){return t.hide=!0});var w=this.container.selectAll(".i-role-label").data(p.map(function(t){return t.data}));return w.exit().remove(),w.call(_),w.enter().append("text").call(_),w},t.prototype.applyFixedPositionRules=function(t,e,n,r,i){var a=t.position.filter(function(t){return-1===t.indexOf("auto:")});return r&&(i&&a.push("multiline-label-vertical-center-align"),a.push("multiline-label-left-align","multiline-hide-on-container-overflow")),a.map(Vr.getRule).reduce(function(t,n){return zr.compose(t,n(t,e))},n)},t.prototype.autoPosition=function(t,e){var n=function(t,e){var n=4+(t.size+t.w)/2,r=2+(t.size+t.h)/2;return{x:n*Math.cos(e),y:r*Math.sin(e)}},r=t.edges,i=t.text.map(function(t){var e={max:-Math.PI/2,min:Math.PI/2,norm:Math.random()*Math.PI*2},r=n(t,e[t.extr]);return{i:t.i,x0:t.x,y0:t.y,x:t.x+r.x,y:t.y+r.y,w:t.w,h:t.h,size:t.size,hide:t.hide,extr:t.extr}}).filter(function(t){return!t.hide}),a=new Kr({items:i,transactor:function(t){var e=t.x,r=t.y;return{modify:function(){var e={max:-Math.PI,min:Math.PI,norm:2*Math.PI}[t.extr],r=e/4+Math.random()*(2*e)/4,i=n(t,r);return t.x=t.x0+i.x,t.y=t.y0+i.y,t},revert:function(){return t.x=e,t.y=r,t}}},penalties:e.map(function(t){return Zr.get(t)}).filter(function(t){return t}).map(function(t){return t(i,r)})}).start(5);return t.text=a.reduce(function(t,e){var n=t[e.i];return n.x=e.x,n.y=e.y,t},t.text),t},t.prototype.hideOnLabelEdgesOverlap=function(t,e){var n=this;return t.filter(function(t){return!t.hide}).forEach(function(t){(function(t,e){var r=n.getLabelRect(t);return e.reduce(function(t,e){var n=ti(r.x0,r.x1,e.x0,e.x1,r.y0,r.y1,e.y0,e.y1),i=ti(r.x0,r.x1,e.x0,e.x1,r.y1,r.y0,e.y0,e.y1);return t+2*(Number(n)+Number(i))},0)})(t,e)>0&&(t.hide=!0)}),t},t.prototype.hideOnLabelLabelOverlap=function(t){var e=this,n={min:0,max:1,norm:2},r={"min/min":function(t,e){return e.y-t.y},"max/max":function(t,e){return t.y-e.y},"min/max":function(){return-1},"min/norm":function(){return-1},"max/norm":function(){return-1},"norm/norm":function(t,e){return t.y-e.y}};return t.filter(function(t){return!t.hide}).sort(function(t,e){return n[t.extr]-n[e.extr]}).forEach(function(i){t.forEach(function(t){i.i!==t.i&&function(t,i){var a=e.getLabelRect(t),o=e.getLabelRect(i),s=Number(!t.hide&&!i.hide);if(s*Math.max(0,Math.min(o.x1,a.x1)-Math.max(a.x0,o.x0))*(s*Math.max(0,Math.min(o.y1,a.y1)-Math.max(a.y0,o.y0)))>0){var u=[t,i];u.sort(function(t,e){return n[t.extr]-n[e.extr]}),(r[u[0].extr+"/"+u[1].extr](u[0],u[1])<0?u[0]:u[1]).hide=!0}}(i,t)})}),t},t.prototype.getLabelRect=function(t,e){return void 0===e&&(e=0),{x0:t.x-t.w/2-e,x1:t.x+t.w/2+e,y0:t.y-t.h/2-e,y1:t.y+t.h/2+e}},t.prototype.getPointRect=function(t,e){return void 0===e&&(e=0),{x0:t.x-t.size/2-e,x1:t.x+t.size/2+e,y0:t.y-t.size/2-e,y1:t.y+t.size/2+e}},t.prototype.hideOnLabelAnchorOverlap=function(t){var e=this,n=function(t,n){var r=e.getLabelRect(t,2),i=e.getPointRect(n,2);return Math.max(0,Math.min(i.x1,r.x1)-Math.max(i.x0,r.x0))*Math.max(0,Math.min(i.y1,r.y1)-Math.max(i.y0,r.y0))>.001};return t.filter(function(t){return!t.hide}).forEach(function(e){for(var r=t.length,i=0;i<r;i++){var a=t[i];if(e.i!==a.i&&n(e,a)){e.hide=!0;break}}}),t},t.prototype.adjustOnOverflow=function(t,e){var n=e.maxWidth,r=e.maxHeight;return t.map(function(t){return t.hide||(t.x=Math.min(Math.max(t.x,t.w/2),n-t.w/2),t.y=Math.max(Math.min(t.y,r-t.h/2),t.h/2)),t})},t.prototype.adjustOnMultilineOverflow=function(t,e){var n=e.maxWidth;return t.map(function(t){return t.hide||0!==t.angle||(t.x=Math.min(Math.max(t.x,t.w/2),n-t.w/2)),t})},t}(),ni=n(13),ri=function(){return(ri=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ii=ri({},ni,o),ai={init:function(t){var e=Object.assign({},t);e.guide=Qt(e.guide||{},{animationSpeed:0,avoidScalesOverflow:!0,enableColorToBarPosition:!1,maxHighlightDistance:32}),e.guide.size=e.guide.size||{},e.guide.label=Qt(e.guide.label||{},{position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-anchor-overlap"]});var n=e.guide.avoidScalesOverflow,r=e.guide.enableColorToBarPosition;return e.transformRules=[function(t){var e=[t.scaleX,t.scaleY].sort(function(t,e){var n=t.discrete?1:0;return(e.discrete?1:0)*e.domain().length-n*t.domain().length})[0];return t.scaleY===e?M.get("flip")(t):M.get("identity")(t)},e.stack&&M.get("stack"),r&&M.get("positioningByColor")].filter(function(t){return t}),e.adjustRules=[e.stack&&M.get("adjustYScale"),function(t,n){var r=t.scaleSize.isEmptyScale(),i=Qt(e.guide.size,{defMinSize:10,defMaxSize:r?10:40,enableDistributeEvenly:!r}),a=Object.assign({},n,{defMin:i.defMinSize,defMax:i.defMaxSize,minLimit:i.minSize,maxLimit:i.maxSize});return(i.enableDistributeEvenly?M.get("adjustSigmaSizeScale"):M.get("adjustStaticSizeScale"))(t,a)},n&&function(t,e){var n=Object.assign({},e,{sizeDirection:"xy"});return M.get("avoidScalesOverflow")(t,n)}].filter(function(t){return t}),e},addInteraction:function(){var t=this,e=this.node();e.on("highlight",function(e,n){return t.highlight(n)}),e.on("data-hover",function(e,n){return t.highlight((r=n.data,i=null,function(t){return t===r||i}));var r,i})},draw:function(){var t=this.node(),e=t.config,n=e.options;n.container=n.slot(e.uid);var r,i=function(t){return nt(t,e.guide.animationSpeed)},a=Xe+"dot dot i-role-element i-role-datum",o=t.screenModel,s={fill:function(t){return o.color(t)},class:function(t){return a+" "+o.class(t)}},u={r:function(t){return Math.round(1e4*o.size(t)/2)/1e4},cx:function(t){return o.x(t)},cy:function(t){return o.y(t)}},l=[],c=o.toFibers();this._getGroupOrder=(r=c.reduce(function(t,e,n){return t.set(e,n),t},new Map),function(t){return r.get(t)});var f=n.container.selectAll(".frame").data(c,function(t){return o.group(t[0])});f.enter().append("g").attr("opacity",0).merge(f).call(function(e){e.attr("class","frame").call(function(e){var n=e.selectAll("circle").data(function(t){return t},o.id),r=n.enter().append("circle").call(ct(u)).merge(n).call(ct(s));i(r).call(ct(u)),i(n.exit()).attr("r",0).remove(),l.push.apply(l,r.nodes()),t.subscribe(r)}),i(e).attr("opacity",1)});this._boundsInfo=this._getBoundsInfo(l),i(f.exit()).attr("opacity",0).remove().selectAll("circle").attr("r",0),t.subscribe(new ei(o.model,o.flip,e.guide.label,n).draw(c))},_getBoundsInfo:function(t){if(0===t.length)return null;var e=this.node().screenModel,n=t.map(function(t){var n=ii.select(t).data()[0];return{node:t,data:n,x:e.x(n),y:e.y(n),r:e.size(n)/2}}).filter(function(t){return!isNaN(t.x)&&!isNaN(t.y)}),r=n.reduce(function(t,e){var n=e.x,r=e.y;return t.left=Math.min(n,t.left),t.right=Math.max(n,t.right),t.top=Math.min(r,t.top),t.bottom=Math.max(r,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),i=n.reduce(function(t,e){var n=e.x+","+e.y;return t[n]||(t[n]=[]),t[n].push(e),t},{});return{bounds:r,tree:ii.quadtree().x(function(t){return t[0].x}).y(function(t){return t[0].y}).addAll(Object.keys(i).map(function(t){return i[t]}))}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,r=n.bounds,i=n.tree,a=De(this.node().config.options.container.node()),o=t-a.x,s=e-a.y,u=this.node().config.guide.maxHighlightDistance;if(o<r.left-u||o>r.right+u||s<r.top-u||s>r.bottom+u)return null;var l=(i.find(o,s)||[]).map(function(t){var e=Math.sqrt(Math.pow(o-t.x,2)+Math.pow(s-t.y,2));if(e>u)return null;var n=e<t.r?t.r-e:e;return{node:t.node,data:t.data,x:t.x,y:t.y,distance:e,secondaryDistance:n}}).filter(function(t){return t}).sort(function(t,e){return t.secondaryDistance-e.secondaryDistance}),c=l.findIndex(function(t){return t.distance!==l[0].distance||t.secondaryDistance!==l[0].secondaryDistance}),f=c<0?l:l.slice(0,c);if(1===f.length)return f[0];var d=f.reduce(function(t,e){return t+e.x},0)/f.length,h=f.reduce(function(t,e){return t+e.y},0)/f.length,p=Math.atan2(h-s,d-o)+Math.PI;return f[Math.round((f.length-1)*p/2/Math.PI)]},highlight:function(t){var e,n=this.node().config.options.container,r=((e={})["tau-chart__highlighted"]=function(e){return!0===t(e)},e["tau-chart__dimmed"]=function(e){return!1===t(e)},e);n.selectAll(".dot").call(ft(r)),n.selectAll(".i-role-label").call(ft(r)),this._sortElements(t)},_sortElements:function(t){var e=this,n=this.node().config.options.container,r=new Map,i=new Map;n.selectAll(".frame").each(function(e){r.set(this,e.some(t)),i.set(this,e)});var a=ee(function(t,e){return r.get(t)-r.get(e)},function(t,n){return e._getGroupOrder(i.get(t))-e._getGroupOrder(i.get(n))});ke(n.node(),function(t,e){return"g"===t.tagName&&"g"===e.tagName?a(t,e):t.tagName.localeCompare(e.tagName)}),je(n,".dot",t)}},oi=n(9),si="taucharts_synthetic_record";function ui(t){return!0!==t[si]}function li(t){return function(e){var n=t.stack,r=e.scaleX.period,i="linear"===e.scaleY.scaleType,a=!t.guide.x||null==t.guide.x.fillGaps;return!a&&t.guide.x.fillGaps||a&&(n||r&&i)?M.get("fillGaps")(e,{isStack:n,xPeriod:r,utc:t.guide.utcTime}):{}}}function ci(t){if(0===t.length)return"";if(1===t.length)return di(t[0]);for(var e=[],n=1;n<t.length;n++)e.push(hi(t[n-1],t[n]));return e.join(" ")}function fi(t){if(0===t.length)return"";if(1===t.length)return di(t[0]);for(var e=[],n=3;n<t.length;n+=3)e.push(pi(t[n-3],t[n-2],t[n-1],t[n]));return e.join(" ")}function di(t){var e=t.size/2;return["M"+t.x+","+(t.y-e),"A"+e+","+e+" 0 0 1",t.x+","+(t.y+e),"A"+e+","+e+" 0 0 1",t.x+","+(t.y-e),"Z"].join(" ")}function hi(t,e){var n=_i(t,e);return n?["M"+n.left[0].x+","+n.left[0].y,"L"+n.left[1].x+","+n.left[1].y,"A"+e.size/2+","+e.size/2+" 0 "+Number(t.size<e.size)+" 1",n.right[1].x+","+n.right[1].y,"L"+n.right[0].x+","+n.right[0].y,"A"+t.size/2+","+t.size/2+" 0 "+Number(t.size>e.size)+" 1",n.left[0].x+","+n.left[0].y,"Z"].join(" "):di(t.size>e.size?t:e)}function pi(t,e,n,r){var i=function(t,e,n,r){var i=yi(t,r);if(0===i||i+t.size/2<=r.size/2||i+r.size/2<=t.size/2)return null;var a=function(i){var a=i?[r,n,e,t]:[t,e,n,r],o=bi.apply(void 0,[1/12*2].concat(a)),s=bi.apply(void 0,[.5].concat(o.slice(0,4))),u=s[3],l=s[6],c=_i(a[0],u),f=_i(u,l),d=[c.left[0],A(.5,c.left[1],f.left[0]),f.left[1]],h=[c.right[0],A(.5,c.right[1],f.right[0]),f.right[1]],p=xi.apply(void 0,d)[1],g=xi.apply(void 0,h)[1],m=A(4,c.left[0],p),y=A(4,c.right[0],g);return{left:i?[y,h[0]]:[d[0],m],right:i?[m,d[0]]:[h[0],y]}},o=a(!1),s=a(!0);return{left:o.left.concat(s.left),right:o.right.concat(s.right)}}(t,e,n,r);if(!i)return hi(t,r);var a=mi(gi(t,i.right[0]),gi(t,i.left[0])),o=mi(gi(r,i.right[1]),gi(r,i.left[1]));return["M"+i.left[0].x+","+i.left[0].y,"C"+i.left[1].x+","+i.left[1].y,i.left[2].x+","+i.left[2].y,i.left[3].x+","+i.left[3].y,"A"+r.size/2+","+r.size/2+" 0 "+Number(a>Math.PI)+" 1",i.right[3].x+","+i.right[3].y,"C"+i.right[2].x+","+i.right[2].y,i.right[1].x+","+i.right[1].y,i.right[0].x+","+i.right[0].y,"A"+t.size/2+","+t.size/2+" 0 "+Number(o>Math.PI)+" 1",i.left[0].x+","+i.left[0].y,"Z"].join(" ")}function gi(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function mi(t,e){return e<t&&(e+=2*Math.PI),e-t}function yi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=1;r<t.length;r++)n+=Math.sqrt((t[r].x-t[r-1].x)*(t[r].x-t[r-1].x)+(t[r].y-t[r-1].y)*(t[r].y-t[r-1].y));return n}function vi(t,e,n){return{x:t.x+e*Math.cos(n),y:t.y+e*Math.sin(n)}}function bi(t,e,n,r,i){var a=O(t,e,n,r,i),o=1/(1+yi(a[3],a[4],a[5],a[6],a[3])/yi(a[0],a[1],a[2],a[3],a[0]));return a[3].size=e.size*(1-o)+i.size*o,a}function xi(t,e,n){var r=A(yi(t,e)/yi(t,e,n),t,n);return[t,A(2,r,e),n]}function _i(t,e){var n=yi(t,e);if(0===n||n+t.size/2<=e.size/2||n+e.size/2<=t.size/2)return null;var r=gi(t,e),i=Math.asin((t.size-e.size)/n/2),a=r-Math.PI/2+i,o=r+Math.PI/2-i;return{left:[vi(t,t.size/2,a),vi(e,e.size/2,a)],right:[vi(t,t.size/2,o),vi(e,e.size/2,o)]}}var wi=function(){return(wi=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};var Ei={circle:{element:"circle",getInitialAttrs:function(t,e){var n=t.config.guide,r=t.screenModel;return{r:"hover"===n.showAnchors?0:function(t){return r.size(t)/2},cx:function(t){return e.x(t)},cy:function(t){return e.y(t)}}},getHighlightAttrs:function(t,e,n){t.config.guide;var r=t.screenModel,i="hover"===t.config.guide.showAnchors;return{r:i?function(t){return n(t)?Math.max(4,r.size(t)/2):0}:function(t){var e=r.size(t)/2;return n(t)&&(e=Math.max(4,Math.ceil(1.25*e))),e}}}},"vertical-stick":{element:"path",getInitialAttrs:function(t,e){var n=t.config.guide,r=t.screenModel;return{"shape-rendering":"crispEdges",d:function(t){var i=e.x(t),a=e.y(t),o=e.x0(t),s=e.y0(t),u="hover"===n.showAnchors?0:r.size(t)/2;return ci([{x:i,y:a,size:u},{x:o,y:s,size:u}])}}},getHighlightAttrs:function(t,e,n){t.config.guide;var r=t.screenModel,i="hover"===t.config.guide.showAnchors;return{d:function(t){var a=e.x(t),o=e.y(t),s=e.x0(t),u=e.y0(t),l=i?n(t)?Math.max(4,r.size(t)/2):0:n(t)?Math.max(4,Math.ceil(r.size(t)/2*1.25)):r.size(t)/2;return ci([{x:a,y:o,size:l},{x:s,y:u,size:l}])}}}}};function Si(t,e,n){var r=n.sort(function(t,e){return t.distance===e.distance?t.secondaryDistance-e.secondaryDistance:t.distance-e.distance}),i=r.findIndex(function(t){return t.distance!==r[0].distance||t.secondaryDistance!==r[0].secondaryDistance}),a=i<0?r:r.slice(0,i);if(1===a.length)return a[0];var o=a.reduce(function(t,e){return t+e.x},0)/a.length,s=a.reduce(function(t,e){return t+e.y},0)/a.length,u=Math.atan2(s-e,o-t)+Math.PI;return a[Math.round((a.length-1)*u/2/Math.PI)]}var Mi=Xe+"dot-line dot-line i-role-dot i-role-datum "+Xe+"dot",Ti={init:function(t){var e=t;return e.guide=Qt(e.guide||{},{animationSpeed:0,cssClass:"",maxHighlightDistance:32,widthCssClass:"",color:{},label:{}}),e.guide.label=Qt(e.guide.label,{fontSize:11,hideEqualLabels:!0,position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:avoid-label-edges-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-edges-overlap"]}),e.guide.color=Qt(e.guide.color||{},{fill:null}),["never","hover","always"].indexOf(e.guide.showAnchors)<0&&(e.guide.showAnchors="hover"),e.transformRules=[],e.adjustRules=[],e},baseModel:function(t){var e={gog:t.model,x:t.x,y:t.y,x0:t.x0,y0:t.y0,size:t.size,group:t.group,order:t.order,color:t.color,class:t.class,groupAttributes:{},pathAttributesUpdateInit:{},pathAttributesUpdateDone:{},pathAttributesEnterInit:{},pathAttributesEnterDone:{},pathElement:null,dotAttributes:{r:function(t){return Math.round(1e4*e.size(t)/2)/1e4},cx:function(t){return e.x(t)},cy:function(t){return e.y(t)},fill:function(t){return e.color(t)},class:function(t){return Mi+" "+e.class(t)}},dotAttributesDefault:{r:0,cy:function(t){return e.y0(t)}}};return e},addInteraction:function(){var t=this,e=this.node(),n=this.node().config;e.on("highlight",function(e,n){return t.highlight(n)}),e.on("highlight-data-points",function(e,n){return t.highlightDataPoints(n)}),"never"!==n.guide.showAnchors&&e.on("data-hover",function(e,n){return t.highlightDataPoints((r=n.data,i=null,function(t){return t===r||i}));var r,i})},draw:function(){var t=this.node(),e=t.config,n=e.guide,r=e.options;r.container=r.slot(e.uid);var i=t.screenModel,a=this.buildModel(i);this.domElementModel=a;var s=st,u=function(r){r.call(ct(a.groupAttributes));var u,l=r.selectAll((u=Mi,u.split(/\s+/g).map(function(t){return"."+t}).join(""))).data(function(t){return t.length<=1?t:[]},i.id);l.exit().call(s(n.animationSpeed,null,{r:0},function(t){return o.select(t).remove()})),l.call(s(n.animationSpeed,null,a.dotAttributes));var c=l.enter().append("circle").call(s(n.animationSpeed,a.dotAttributesDefault,a.dotAttributes)).merge(l);t.subscribe(c);var f=r.selectAll(a.pathElement+":not(.i-data-anchor)").data(function(t){return t.length>1?[t]:[]},d);f.exit().remove(),f.call(s(n.animationSpeed,a.pathAttributesUpdateInit,a.pathAttributesUpdateDone,a.afterPathUpdate));f.enter().append(a.pathElement).call(s(n.animationSpeed,a.pathAttributesEnterInit,a.pathAttributesEnterDone,a.afterPathUpdate)).merge(f).call(function(t){e.guide.animationSpeed>0&&!document.hidden?(t.attr(a.pathTween.attr,function(t){return a.pathTween.fn.call(this,t)(0)}),nt(t,e.guide.animationSpeed,"pathTransition").attrTween(a.pathTween.attr,a.pathTween.fn)):t.attr(a.pathTween.attr,function(t){return a.pathTween.fn.call(this,t)(1)})});if(t.subscribe(c),"never"!==n.showAnchors){var h=function(t,e,n){var r=e.anchorShape,i=t.config.guide,a=t.screenModel,o=wi({},Ei[r].getInitialAttrs(t,e),{opacity:"hover"===i.showAnchors?0:1,fill:function(t){return a.color(t)},class:"i-data-anchor"}),s=n.selectAll(".i-data-anchor").data(function(t){return t.filter(ui)},a.id);return s.exit().remove(),s.call(st(i.animationSpeed,null,o)),s.enter().append(Ei[e.anchorShape].element).call(st(i.animationSpeed,{r:0},o)).merge(s)}(t,a,r);t.subscribe(h)}},l=i.toFibers(),c=l.map(function(t){return t.filter(ui)}),f=r.container.selectAll(".frame"),d=function(){var t=f.empty()?[]:f.data(),e=new Map;f.each(function(t){e.set(t,Number(this.getAttribute("data-id")))});var n=t.reduce(function(t,e){return t.set(e,e.map(i.id)),t},new Map),r=new Map,a=Math.max.apply(Math,[0].concat(Array.from(e.values())));return function(t){if(r.has(t))return r.get(t);var o,s=t.map(function(t){return i.id(t)}),u=(Array.from(n.entries()).find(function(t){var e=t[1];return s.some(function(t){return e.some(function(e){return e===t})})})||[null])[0];return o=u?e.get(u):++a,r.set(t,o),o}}();this._getDataSetId=d;var h=f.data(l,d);h.exit().remove(),h.call(u),h.enter().append("g").attr("data-id",d).call(u),h.order(),this._boundsInfo=this._getBoundsInfo(r.container.selectAll(".i-data-anchor").nodes()),t.subscribe(new ei(i.model,e.flip,e.guide.label,r).draw(c))},_getBoundsInfo:function(t){if(0===t.length)return null;var e=this.node().screenModel,n=this.node().config.flip,r=t.map(function(t){var n=o.select(t).data()[0];return{node:t,data:n,x:e.x(n),y:e.y(n)}}).filter(function(t){return!isNaN(t.x)&&!isNaN(t.y)}),i=r.reduce(function(t,e){var n=e.x,r=e.y;return t.left=Math.min(n,t.left),t.right=Math.max(n,t.right),t.top=Math.min(r,t.top),t.bottom=Math.max(r,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=Yt(r.map(n?function(t){return t.y}:function(t){return t.x})).sort(function(t,e){return t-e}),s=a.reduce(function(t,e){return t[e]=[],t},{});r.forEach(function(t){var e=a.find(n?function(e){return t.y===e}:function(e){return t.x===e});s[e].push(t)});var u=function(t){if(1===t.length)return s[t[0]];var e=Math.ceil(t.length/2);return{middle:(t[e-1]+t[e])/2,lower:u(t.slice(0,e)),greater:u(t.slice(e))}};return{bounds:i,tree:u(a)}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,r=n.bounds,i=n.tree,a=this.node().config.options.container,o=this.node().config.flip,s=De(a.node()),u=this.node().config.guide.maxHighlightDistance;if(t<r.left+s.x-u||t>r.right+s.x+u||e<r.top+s.y-u||e>r.bottom+s.y+u)return null;var l=o?e-s.y:t-s.x,c=function t(e){return Array.isArray(e)?e:t(l>e.middle?e.greater:e.lower)}(i).map(function(n){var r=n.x+s.x,i=n.y+s.y,a=Math.abs(o?e-i:t-r),u=Math.abs(o?t-r:e-i);return{node:n.node,data:n.data,distance:a,secondaryDistance:u,x:r,y:i}});return Si(t,e,c)},highlight:function(t){var e,n,r=this.node().config.options.container,i="tau-chart__highlighted",a="tau-chart__dimmed",o=r.selectAll(".i-role-path"),s=o.data().filter(function(e){return e.filter(ui).some(t)}),u=s.length>0;o.call(ft(((e={})[i]=function(t){return u&&s.indexOf(t)>=0},e[a]=function(t){return u&&s.indexOf(t)<0},e)));var l=((n={})[i]=function(e){return!0===t(e)},n[a]=function(e){return!1===t(e)},n);r.selectAll(".i-role-dot").call(ft(l)),r.selectAll(".i-role-label").call(ft(l)),this._sortElements(t)},highlightDataPoints:function(t){var e=this.node(),n=function(t,e,n){var r=e.anchorShape,i=t.screenModel,a="hover"===t.config.guide.showAnchors;return t.config.options.container.selectAll(".i-data-anchor").call(ct(Ei[r].getHighlightAttrs(t,e,n))).attr("opacity",a?function(t){return n(t)?1:0}:function(){return 1}).attr("fill",function(t){return i.color(t)}).attr("class",function(t){return Ae("i-data-anchor",i.class(t))}).classed(Xe+"highlighted",n)}(e,this.domElementModel,t),r=e.config.options.container,i=e.config.flip,a=n.filter(t),o=r.select(".cursor-line");if(a.empty())o.remove();else{o.empty()&&(o=r.append("line"));var s=e.screenModel.model,u=s.xi(a.data()[0]),l=s.xi(a.data()[0]),c=s.scaleY.domain(),f=s.scaleY(c[0]),d=s.scaleY(c[1]);o.attr("class","cursor-line").attr("x1",i?f:u).attr("y1",i?u:f).attr("x2",i?d:l).attr("y2",i?l:d)}this._sortElements(t)},_sortElements:function(t){var e=this.node().config.options.container,n=new Map,r=new Map,i=this._getDataSetId;e.selectAll(".i-role-path").each(function(e){n.set(this,i(e)),r.set(this,e.filter(ui).some(t))});var a=ee(function(t,e){return r.get(t)-r.get(e)},function(t,e){return n.get(t)-n.get(e)}),o={line:0,g:1,text:2};ke(e.node(),function(t,e){return"g"===t.tagName&&"g"===e.tagName?a(t,e):o[t.tagName]-o[e.tagName]})}},Ci=[1,2,3,4,5],ki=Ci.map(function(t){return Xe+"line-opacity-"+t}),Ai=Ci.map(function(t){return Xe+"line-width-"+t});function Oi(t){return ki[t-1]||ki[4]}function Pi(t,e){return t.length<2?"":String.prototype.concat.apply("",t.concat(e.slice().reverse()).map(function(t,e){return(0===e?"":" ")+t.x+","+t.y}))}function Li(t,e){if(t.length<2)return"";var n=function(t){var e=t.map(function(t,e){return""+((e-1)%3==0?"C":"")+t.x+","+t.y+" "});return String.prototype.concat.apply("",e)};return"M"+n(t)+"L"+n(e.slice().reverse())+"Z"}var Ni=function(){return(Ni=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Ri=Ni({},oi,o),Fi={draw:Ti.draw,highlight:Ti.highlight,highlightDataPoints:Ti.highlightDataPoints,addInteraction:Ti.addInteraction,_sortElements:Ti._sortElements,init:function(t){var e=Ti.init(t),n=e.stack;return e.transformRules=[e.flip&&M.get("flip"),e.guide.obsoleteVerticalStackOrder&&M.get("obsoleteVerticalStackOrder"),!n&&M.get("groupOrderByAvg"),li(e),n&&M.get("stack")],e.adjustRules=[function(t,n){var r=t.scaleSize.isEmptyScale(),i=Qt(e.guide.size||{},{defMinSize:2,defMaxSize:r?6:40}),a=Object.assign({},n,{defMin:i.defMinSize,defMax:i.defMaxSize,minLimit:i.minSize,maxLimit:i.maxSize});return M.get("adjustStaticSizeScale")(t,a)}],e},buildModel:function(t){var e=Ti.baseModel(t),n=this.node().config.guide,r=Oi(t.model.scaleColor.domain().length),i=Xe+"area area i-role-path "+r+" "+n.cssClass+" ";e.groupAttributes={class:function(t){return i+" "+e.class(t[0])+" frame"}};var a={fill:function(t){return e.color(t[0])},stroke:function(t){var n=e.color(t[0]);return n.length>0&&(n=Ri.rgb(n).darker(1)),n}};e.pathAttributesEnterInit=a,e.pathAttributesUpdateDone=a;var o="polyline"===K(n.interpolate);return e.pathElement=o?"polygon":"path",e.anchorShape="vertical-stick",e.pathTween={attr:o?"points":"d",fn:lt(0,o?Pi:Li,[function(n){return{id:t.id(n),x:e.x(n),y:e.y(n)}},function(n){return{id:t.id(n),x:e.x0(n),y:e.y0(n)}}],t.id,n.interpolate)},e},_getBoundsInfo:function(t){if(0===t.length)return null;var e,n,r=this.node().screenModel,i=this.node().config.flip,a=t.map(function(t){var e=Ri.select(t).data()[0];return{node:t,data:e,x:r.x(e),y:r.y(e),y0:r.y0(e),group:r.group(e)}}),o=a.reduce(function(t,e){var n=e.x,r=e.y,i=e.y0;return t.left=Math.min(n,t.left),t.right=Math.max(n,t.right),t.top=Math.min(r,i,t.top),t.bottom=Math.max(r,i,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),s=Yt(a.map(i?function(t){return t.y}:function(t){return t.x})).sort(function(t,e){return t-e}),u=s.reduce(function(t,e){return t[e]=[],t},{});if(a.forEach(function(t){var e=s.find(i?function(e){return t.y===e}:function(e){return t.x===e});u[e].push(t)}),e=Object.keys(a.reduce(function(t,e){return t[e.group]=!0,t},{})),n=e.reduce(function(t,e,n){return t[e]=n,t},{}),s.forEach(function(t){var r=u[t];if(r.sort(function(t,e){return n[t.group]-n[e.group]}),r.length<e.length)for(var i=0;i<e.length;i++){var a=!1,o=void 0,s=void 0;if(i===r.length?(o=s=0===i?0:r[i-1].y,a=!0):r[i].group!==e[i]&&(o=s=r[i].y0,a=!0),a){var l={x:t,y:o,y0:s,data:null,node:null,group:e[i]};r.splice(i,0,l)}}}),1===s.length)return{bounds:o,tree:{start:s[0],end:s[0],isLeaf:!0,items:{start:u[s[0]],end:u[s[0]]}}};var l=function(t){if(2===t.length){var e=t[0],n=t[1];return{start:e,end:n,isLeaf:!0,items:{start:u[e],end:u[n]}}}var r=t.length%2==0?t.length/2:(t.length-1)/2;t[r];return{start:t[0],end:t[t.length-1],isLeaf:!1,left:l(t.slice(0,r+1)),right:l(t.slice(r))}};return{bounds:o,tree:l(s)}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,r=n.bounds,i=n.tree,a=this.node().config.options.container,o=this.node().config.flip,s=De(a.node()),u=this.node().config.guide.maxHighlightDistance;if(t<r.left+s.x-u||t>r.right+s.x+u||e<r.top+s.y-u||e>r.bottom+s.y+u)return null;var l=o?e-s.y:t-s.x,c=function t(e){if(e.isLeaf)return e;var n=e.left.end;return t(l<n?e.left:e.right)}(i),f=c.end===c.start?0:(l-c.start)/(c.end-c.start);f<0&&(f=0),f>1&&(f=1);var d,h=(d=c.items.start.reduce(function(t,e){return t[e.group]={start:e,end:null,y:null,y0:null},t},{}),c.items.end.forEach(function(t){void 0!==d[t.group]?d[t.group].end=t:delete d[t.group]}),Object.keys(d).forEach(function(t){var e=d[t];e.end?(e.y=e.start.y+f*(e.end.y-e.start.y),e.y0=e.start.y0+f*(e.end.y0-e.start.y0)):delete d[t]}),Object.keys(d).map(function(t){return d[t]}).map(function(t){return{y:t.y,y0:t.y0,el:f<.5?t.start:t.end}}).filter(function(t){return null!=t.el.data})),p=e-s.y,g=h.filter(function(t){return p>=t.y&&p<=t.y0}),m=(g.length>0?g:h).map(function(t){return t.el}).map(function(n){var r=n.x+s.x,i=n.y+s.y,a=Math.abs(o?e-i:t-r),u=Math.abs(o?t-r:e-i);return{node:n.node,data:n.data,distance:a,secondaryDistance:u,x:r,y:i}});return Si(t,e,m)}},Di={draw:Ti.draw,getClosestElement:Ti.getClosestElement,highlight:Ti.highlight,highlightDataPoints:Ti.highlightDataPoints,addInteraction:Ti.addInteraction,_getBoundsInfo:Ti._getBoundsInfo,_sortElements:Ti._sortElements,init:function(t){var e=Ti.init(t);return e.transformRules=[e.flip&&M.get("flip")],e.adjustRules=[function(t,n){var r=t.scaleSize.isEmptyScale(),i=Qt(e.guide.size||{},{defMinSize:2,defMaxSize:r?6:40}),a=Object.assign({},n,{defMin:i.defMinSize,defMax:i.defMaxSize,minLimit:i.minSize,maxLimit:i.maxSize});return M.get("adjustStaticSizeScale")(t,a)}],e},buildModel:function(t){var e=Ti.baseModel(t),n=this.node().config.guide,r=Oi(t.model.scaleColor.domain().length),i=Xe+"area area i-role-path "+r+" "+n.cssClass+" ";e.groupAttributes={class:function(t){return i+" "+e.class(t[0])+" frame"}};var a,o,s={fill:function(t){return e.color(t[0])},stroke:function(t){return e.color(t[0])}};return e.pathAttributesEnterInit=s,e.pathAttributesUpdateDone=s,e.pathElement="polygon",e.anchorShape="circle",e.pathTween={attr:"points",fn:lt(0,(a=function(t){return t.x},o=function(t){return t.y},function(t){return t.map(function(t){return[a(t),o(t)].join(",")}).join(" ")}),[function(n){return{id:t.id(n),x:e.x(n),y:e.y(n)}}],t.id)},e}};function ji(t){if(t.length<2)return"";for(var e="",n=0;n<t.length;n++)e+=(0===n?"M":" L")+t[n].x+","+t[n].y;return e}function Ii(t){if(t.length<4)return"";for(var e="M"+t[0].x+","+t[0].y,n=3;n<t.length;n+=3)e+=" C"+t[n-2].x+","+t[n-2].y+" "+t[n-1].x+","+t[n-1].y+" "+t[n].x+","+t[n].y;return e}var zi={draw:Ti.draw,getClosestElement:Ti.getClosestElement,highlight:Ti.highlight,highlightDataPoints:Ti.highlightDataPoints,addInteraction:Ti.addInteraction,_getBoundsInfo:Ti._getBoundsInfo,_sortElements:Ti._sortElements,init:function(t){var e=Ti.init(t),n=e.stack;e.guide=Qt(e.guide||{},{avoidScalesOverflow:!0,interpolate:"linear"}),e.transformRules=[e.flip&&M.get("flip"),!n&&M.get("groupOrderByAvg"),li(e),n&&M.get("stack")];var r=e.guide.avoidScalesOverflow,i=function(t){return t.scaleSize.isEmptyScale()};return e.adjustRules=[function(t,n){var r=Qt(e.guide.size||{},{defMinSize:2,defMaxSize:i(t)?6:40}),a=Object.assign({},n,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return M.get("adjustStaticSizeScale")(t,a)},r&&function(t,e){if(i(t))return function(){return{}};var n=Object.assign({},e,{sizeDirection:"xy"});return M.get("avoidScalesOverflow")(t,n)}].filter(function(t){return t}),e},buildModel:function(t){var e,n,r=this.node().config,i=r.guide,a=r.options,o=!t.model.scaleSize.dim,s=o?i.widthCssClass||(e=a.width,n=0,e>=160&&e<320?n=1:e>=320&&e<480?n=2:e>=480&&e<640?n=3:e>=640&&(n=4),Ai[n]):"",u=Oi(t.model.scaleColor.domain().length),l=o?"line":"area",c=""+Xe+l+" "+l+" i-role-path "+s+" "+u+" "+i.cssClass+" ",f=o?{stroke:function(t){return h.color(t[0])},class:"i-role-datum"}:{fill:function(t){return h.color(t[0])}},d="cubic"===K(i.interpolate)?o?Ii:fi:o?ji:ci,h=Ti.baseModel(t),p=o?function(e){return{id:t.id(e),x:h.x(e),y:h.y(e)}}:function(e){return{id:t.id(e),x:h.x(e),y:h.y(e),size:h.size(e)}};return h.groupAttributes={class:function(t){return c+" "+h.class(t[0])+" frame"}},h.pathElement="path",h.anchorShape="circle",h.pathAttributesEnterInit=f,h.pathAttributesUpdateDone=f,h.pathTween={attr:"d",fn:lt(0,d,[p],t.id,i.interpolate)},h}},Bi=function(t){return o.select(t).data()[0]},Vi={init:function(t){var e=Object.assign({},t);e.guide=e.guide||{},e.guide=Qt(e.guide,{animationSpeed:0,avoidScalesOverflow:!0,maxHighlightDistance:32,prettify:!0,sortByBarHeight:!0,enableColorToBarPosition:null!=e.guide.enableColorToBarPosition?e.guide.enableColorToBarPosition:!e.stack}),e.guide.size=Qt(e.guide.size||{},{enableDistributeEvenly:!0}),e.guide.label=Qt(e.guide.label||{},{position:e.flip?e.stack?["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"]:["outside-then-inside-horizontal","auto:hide-on-label-label-overlap"]:e.stack?["rotate-on-size-overflow","t-","b+","hide-by-label-height-vertical","cut-label-vertical","auto:hide-on-label-label-overlap"]:["rotate-on-size-overflow","outside-then-inside-vertical","auto:hide-on-label-label-overlap"]});var n=e.guide.avoidScalesOverflow,r=e.guide.enableColorToBarPosition,i=e.guide.size.enableDistributeEvenly;return e.transformRules=[e.flip&&M.get("flip"),e.guide.obsoleteVerticalStackOrder&&M.get("obsoleteVerticalStackOrder"),e.stack&&M.get("stack"),r&&M.get("positioningByColor")].filter(function(t){return t}),e.adjustRules=[i&&function(t,n){var r=Qt(e.guide.size||{},{defMinSize:e.guide.prettify?3:0,defMaxSize:e.guide.prettify?40:Number.MAX_VALUE}),i=Object.assign({},n,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return M.get("size_distribute_evenly")(t,i)},n&&i&&function(t,e){var n=Object.assign({},e,{sizeDirection:"x"});return M.get("avoidScalesOverflow")(t,n)},e.stack&&M.get("adjustYScale")].filter(function(t){return t}),e},addInteraction:function(){var t=this,e=this.node();e.on("highlight",function(e,n){return t.highlight(n)}),e.on("data-hover",function(e,n){return t.highlight((r=n.data,i=null,function(t){return t===r||i}));var r,i})},draw:function(){var t,e,n=this.node(),r=n.config,i=r.options;i.container=i.slot(r.uid);var a=r.guide.prettify,s="i-role-element i-role-datum bar "+Xe+"bar",u=n.screenModel,l=this.buildModel(u,{prettify:a,minBarH:1,minBarW:1,baseCssClass:s}),c=st,f=r.flip?"y":"x",d=r.flip?"x":"y",h=r.flip?"width":"height",p=r.flip?"height":"width",g=u.toFibers(),m=g.reduce(function(t,e){return t.concat(e)},[]),y=l.class,v=Zt(l,"class"),b=i.container.selectAll(".bar").data(m,u.id);b.exit().classed("tau-removing",!0).call(c(r.guide.animationSpeed,null,((t={})[f]=function(){var t=o.select(this);return t.attr(f)-0+(t.attr(p)-0)/2},t[d]=function(){return this.getAttribute("data-zero")},t[p]=0,t[h]=0,t),function(t){var e=o.select(t);e.classed("tau-removing")&&e.remove()})),b.call(c(r.guide.animationSpeed,null,v));var x=b.enter().append("rect").call(c(r.guide.animationSpeed,(e={},e[d]=u[d+"0"],e[h]=0,e),v)).merge(b).attr("class",y).attr("data-zero",u[d+"0"]);n.subscribe(new ei(u.model,u.model.flip,r.guide.label,i).draw(g));var _,w=(_=m.reduce(function(t,e,n){return t.set(e,n+1),t},new Map),function(t,e){return(_.get(Bi(t))||-1)-(_.get(Bi(e))||-1)});this._barsSorter=r.guide.sortByBarHeight?r.flip?function(t,e){var n=Bi(t),r=Bi(e),i=l.width(n),a=l.width(r);if(i===a){var o=l.y(n),s=l.y(r);return o===s?w(t,e):o-s}return a-i}:function(t,e){var n=Bi(t),r=Bi(e),i=l.height(n),a=l.height(r);if(i===a){var o=l.x(n),s=l.x(r);return o===s?w(t,e):o-s}return a-i}:w;var E={rect:0,text:1};this._typeSorter=function(t,e){return E[t.tagName]-E[e.tagName]},this._sortElements(this._typeSorter,this._barsSorter),n.subscribe(x),this._boundsInfo=this._getBoundsInfo(x.nodes())},buildModel:function(t,e){var n,r=e.prettify,i=e.minBarH,a=e.minBarW,o=e.baseCssClass,s=function(e){var n=t.size(e);return r&&(n=Math.max(a,n)),n},u=function(e){return e[t.model.scaleY.dim]};if(t.flip){var l=function(e){return Math.abs(t.x(e)-t.x0(e))};n={y:function(e){return t.y(e)-.5*s(e)},x:function(e){var n=Math.min(t.x0(e),t.x(e));if(r){var a=l(e),o=u(e),s=0;return 0===o&&(s=0),o>0&&(s=a),o<0&&(s=0-i),a<i?n+s:n}return n},height:function(t){return s(t)},width:function(t){var e=l(t);return r?0===u(t)?e:Math.max(i,e):e}}}else{var c=function(e){return Math.abs(t.y(e)-t.y0(e))};n={x:function(e){return t.x(e)-.5*s(e)},y:function(e){var n=Math.min(t.y0(e),t.y(e));r&&(n=c(e)<i&&u(e)>0?n-i:n);return n},width:function(t){return s(t)},height:function(t){var e=c(t);return r&&(e=0===u(t)?e:Math.max(i,e)),e}}}return Object.assign(n,{class:function(e){return o+" "+t.class(e)},fill:function(e){return t.color(e)}})},_sortElements:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ke(this.node().config.options.container.node(),ee.apply(r,t))},_getBoundsInfo:function(t){if(0===t.length)return null;var e=this.node().screenModel,n=this.node().config.flip,r=t.map(function(t){var n=o.select(t).data()[0],r=e.x(n),i=e.x0(n),a=e.y(n),s=e.y0(n),u=Math.abs(r-i),l=Math.abs(a-s),c=(r+i)/2,f=(a+s)/2;return{node:t,data:n,cx:c,cy:f,box:{top:f-l/2,right:c+u/2,bottom:f+l/2,left:c-u/2},invert:a>s}}),i=r.reduce(function(t,e){var n=e.box;return t.left=Math.min(n.left,t.left),t.right=Math.max(n.right,t.right),t.top=Math.min(n.top,t.top),t.bottom=Math.max(n.bottom,t.bottom),t},{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=Yt(r.map(n?function(t){return t.cy}:function(t){return t.cx})).sort(function(t,e){return t-e}),s=a.reduce(function(t,e){return t[e]=[],t},{});r.forEach(function(t){var e=a.find(n?function(e){return t.cy===e}:function(e){return t.cx===e});s[e].push(t)});var u=function(t){if(1===t.length)return s[t];var e=Math.ceil(t.length/2);return{middle:(t[e-1]+t[e])/2,lower:u(t.slice(0,e)),greater:u(t.slice(e))}};return{bounds:i,tree:u(a)}},getClosestElement:function(t,e){if(!this._boundsInfo)return null;var n=this._boundsInfo,r=n.bounds,i=n.tree,a=this.node().config.options.container,o=this.node().config.flip,s=De(a.node()),u=t-s.x,l=e-s.y,c=this.node().config.guide.maxHighlightDistance;if(u<r.left-c||u>r.right+c||l<r.top-c||l>r.bottom+c)return null;var f=o?l:u,d=o?u:l;return function t(e){return Array.isArray(e)?e:t(f>e.middle?e.greater:e.lower)}(i).map(function(t){var e,n,r=o?t.box.left:t.box.top,i=o?t.box.right:t.box.bottom,a=(n=i,(e=d)>=r&&e<=n);if(!a&&Math.abs(d-r)>c&&Math.abs(d-i)>c)return null;var s=Math.abs(d-(t.invert!==o?i:r));return Object.assign(t,{distToValue:s,cursorInside:a})}).filter(function(t){return t}).sort(function(t,e){return t.cursorInside!==e.cursorInside?e.cursorInside-t.cursorInside:Math.abs(t.distToValue)-Math.abs(e.distToValue)}).map(function(t){var e=t.cx,n=t.cy,r=Math.abs(o?l-n:u-e),i=Math.abs(o?u-e:l-n);return{node:t.node,data:t.data,distance:r,secondaryDistance:i,x:e,y:n}})[0]||null},highlight:function(t){var e,n=this.node().config.options.container,r=((e={})["tau-chart__highlighted"]=function(e){return!0===t(e)},e["tau-chart__dimmed"]=function(e){return!1===t(e)},e);n.selectAll(".bar").call(ft(r)),n.selectAll(".i-role-label").call(ft(r)),this._sortElements(function(e,n){return t(Bi(e))-t(Bi(n))},this._typeSorter,this._barsSorter)}},Hi=n(14),Wi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gi=function(t){function e(e){var n=t.call(this,e)||this;return n.config=e,n.config.guide=Qt(n.config.guide||{},{}),n.on("highlight",function(t,e){return n.highlight(e)}),n}return Wi(e,t),e.prototype.defineGrammarModel=function(t){var e=this.config,n=e.options;this.color=t("color",e.color,{}),this.scalesMap=e.columns.reduce(function(e,r){return e[r]=t("pos",r,[0,n.height]),e},{});var r=n.width/(e.columns.length-1),i=e.columns.reduce(function(t,e,n){return t[e]=n*r,t},{});return this.xBase=function(t){return i[t]},this.regScale("columns",this.scalesMap).regScale("color",this.color),{}},e.prototype.drawFrames=function(t){var e=this.config,n=this.config.options,r=this.scalesMap,i=this.xBase,a=this.color,o=Hi.line(),s=function(t){t.attr("d",function(t){return o(e.columns.map(function(e){return[i(e),r[e](t[r[e].dim])]}))})},u=function(t){t.attr("stroke",function(t){return a.toColor(a(t[a.dim]))}),t.attr("class",function(t){return Xe+"__line line "+a.toClass(a(t[a.dim]))+" foreground"})},l=function(t){var e=t.selectAll(".background").data(function(t){return t.part()});e.exit().remove(),e.call(s),e.enter().append("path").attr("class","background line").call(s);var n=t.selectAll(".foreground").data(function(t){return t.part()});n.exit().remove(),n.call(function(t){s(t),u(t)}),n.enter().append("path").call(function(t){s(t),u(t)})},c=n.container.selectAll(".lines-frame").data(t,function(t){return t.hash()});c.exit().remove(),c.call(l),c.enter().append("g").attr("class","lines-frame").call(l),this.subscribe(n.container.selectAll(".lines-frame .foreground"))},e.prototype.highlight=function(t){this.config.options.container.selectAll(".lines-frame .foreground").style("visibility",function(e){return t(e)?"":"hidden"})},e}(m),Ui=function(){function t(t,e){var n,r=this;if(this._fields={},Array.isArray(e.fitToFrameByDims)&&e.fitToFrameByDims.length){n=t.part(function(t){var n={};return"where"===t.type&&t.args?(n.type=t.type,n.args=e.fitToFrameByDims.reduce(function(e,n){return t.args.hasOwnProperty(n)&&(e[n]=t.args[n]),e},{})):n=t,n})}else n=t.full();var i=this.getVarSet(n,e);e.order&&(i=Kt(Jt(e.order,i),i)),this.vars=i;var a=i.map(function(t){return t});this.scaleConfig=e,this.scaleConfig.nice=this.scaleConfig.hasOwnProperty("nice")?this.scaleConfig.nice:this.scaleConfig.autoScale,this.addField("dim",this.scaleConfig.dim).addField("scaleDim",this.scaleConfig.dim).addField("scaleType",this.scaleConfig.type).addField("source",this.scaleConfig.source).addField("domain",function(){return r.vars}).addField("isInteger",a.every(Number.isInteger)).addField("originalSeries",function(){return a}).addField("isContains",function(t){return r.isInDomain(t)}).addField("isEmptyScale",function(){return r.isEmpty()}).addField("fixup",function(t){var e=r.scaleConfig;e.__fixup__=e.__fixup__||{},e.__fixup__=Object.assign(e.__fixup__,t(Object.assign({},e,e.__fixup__)))}).addField("commit",function(){r.scaleConfig=Object.assign(r.scaleConfig,r.scaleConfig.__fixup__),delete r.scaleConfig.__fixup__})}return t.prototype.isInDomain=function(t){return this.domain().indexOf(t)>=0},t.prototype.addField=function(t,e){return this._fields[t]=e,this[t]=e,this},t.prototype.getField=function(t){return this._fields[t]},t.prototype.isEmpty=function(){return!Boolean(this._fields.dim)},t.prototype.toBaseScale=function(t,e){var n=this;void 0===e&&(e=null);var r=Object.keys(this._fields).reduce(function(t,e){return t[e]=n._fields[e],t},t);return r.getHash=function(){return Ft([n.vars,e].map(function(t){return JSON.stringify}).join(""))},r.value=r,r},t.prototype.getVarSet=function(t,e){return Yt(e.hasOwnProperty("series")?e.series:t.map(function(t){return t[e.dim]}),"date"===e.dimType?function(t){return new Date(t).getTime()}:function(t){return t})},t}(),Xi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qi=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r._references=n.references,r._refCounter=n.refCounter,r.addField("scaleType","identity"),r}return Xi(e,t),e.prototype.create=function(){var t=this._references,e=this._refCounter;return this.toBaseScale(function(n,r){if(null==n){var i=t.get(r);null==i&&(i=e(),t.set(r,i))}else i=n;return i})},e}(Ui),Yi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$i=function(){return($i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Ki=$i({},s,u),Ji=function(t){function e(e,n){var r=t.call(this,e,n)||this,i="measure"!==n.dimType,a=r.scaleConfig.brewer||(i?Gt(20).map(function(t){return"color20-"+(1+t)}):["#eee","#000"]),o=r.scaleConfig;if(!i){var s=Ki.extent(r.vars),u=function(t){return Number.isFinite(t)||At(t)},l=u(o.min)?o.min:s[0],c=u(o.max)?o.max:s[1],f=[l,s[0]].filter(u),d=[c,s[1]].filter(u);if(s=[f.sort(function(t,e){return t-e})[0],d.sort(function(t,e){return e-t})[0]],o.nice&&s[0]<0&&s[1]>0){var h=Math.max.apply(Math,s.map(Math.abs));s=[-h,h]}r.vars=s}return r.addField("scaleType","color").addField("discrete",i).addField("brewer",a).addField("toColor",Bt).addField("toClass",Vt),r}return Yi(e,t),e.prototype.create=function(){var t=this.discrete,e=this.vars,n=this.getField("brewer"),r=t?this.createDiscreteScale(e,n):this.createContinuesScale(e,n);return this.toBaseScale(r)},e.prototype.createDiscreteScale=function(t,e){var n,r=function(t,e){var n=t.map(function(t){return String(t).toString()});return Ki.scaleOrdinal().range(e).domain(n)},i=function(t){return function(e){return t(String(e).toString())}};if(Array.isArray(e))n=i(r(t,e));else if("function"==typeof e)n=function(n){return e(n,i(r(t,Gt(20).map(function(t){return"color20-"+(1+t)}))))};else{if(!Ot(e))throw new Error("This brewer is not supported");n=function(t,e){var n=Object.keys(t),r=n.map(function(e){return t[e]}),i=Ki.scaleOrdinal().range(r).domain(n);return function(n){return t.hasOwnProperty(n)?i(String(n)):e(n)}}(e,function(){return"color-default"})}return n},e.prototype.createContinuesScale=function(t,e){if(!Array.isArray(e))throw new Error("This brewer is not supported");return Ki.scaleLinear().domain(zt(t.map(function(t){return t-0}),e.length)).range(e)},e}(Ui),Qi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zi={sqrt:function(t){return Math.sqrt(t)},linear:function(t){return t}},ta=function(t){function e(e,n){var r=t.call(this,e,n)||this,i=r.scaleConfig,a=s.extent(r.vars),o=Number.isFinite(i.min)?i.min:a[0],u=Number.isFinite(i.max)?i.max:a[1];return r.vars=[Math.min.apply(Math,[o,a[0]].filter(Number.isFinite)),Math.max.apply(Math,[u,a[1]].filter(Number.isFinite))],r.addField("scaleType","size"),r.addField("funcType",n.func||"sqrt"),r}return Qi(e,t),e.prototype.isInDomain=function(t){var e=this.domain().sort(),n=e[0],r=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(r)&&t<=r&&t>=n},e.prototype.create=function(){var t,e=this.scaleConfig,n=this.vars,r=Qt({},e,{func:"sqrt",minSize:0,maxSize:1}),i=r.func,a=r.minSize,o=r.maxSize,s=Zi[i],u=n.filter(function(t){return Number.isFinite(Number(t))});if(0===u.length)t=function(){return o};else{var l,c,f=Math.min.apply(Math,u),d=Math.max.apply(Math,u),h=s(Math.max(Math.abs(f),Math.abs(d),d-f));c=f<0?f:0,l=0===h?1:(o-a)/h,t=function(t){var e=null!==t?parseFloat(t):0;return Number.isFinite(e)?a+s(e-c)*l:o}}return this.toBaseScale(t)},e}(Ui),ea=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),na=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.addField("scaleType","ordinal").addField("discrete",!0),r}return ea(e,t),e.prototype.create=function(t){var e=this.scaleConfig,n=this.vars,r=u.scalePoint().domain(n).range(t).padding(.5),i=Math.max.apply(Math,t),a=function(t){return"function"==typeof e.ratio?e.ratio(t,i,n):"object"==typeof e.ratio?e.ratio[t]:1/n.length},o=function(t){return e.ratio?i-n.slice(n.indexOf(t)+1).reduce(function(t,e){return t+i*a(e)},i*a(t)*.5):r(t)};return Object.keys(r).forEach(function(t){return o[t]=r[t]}),o.stepSize=function(t){return a(t)*i},this.toBaseScale(o,t)},e}(Ui),ra=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ia=function(){return(ia=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},aa=ia({},s,u),oa=function(t){function e(e,n){var r=t.call(this,e,n)||this,i=r.scaleConfig,a=r.vars,o=aa.extent(a),s=null===i.min||void 0===i.min?o[0]:new Date(i.min).getTime(),u=null===i.max||void 0===i.max?o[1]:new Date(i.max).getTime(),l=[new Date(Math.min(s,o[0])),new Date(Math.max(u,o[1]))],c=x.get(i.period,{utc:i.utcTime});return i.fitToFrameByDims||null===c?r.vars=Yt(a.map(function(t){return new Date(t)}),function(t){return t.getTime()}).sort(function(t,e){return Number(e)-Number(t)}):r.vars=x.generate(l[0],l[1],i.period,{utc:i.utcTime}),r.periodGenerator=c,r.addField("scaleType","period").addField("utcTime",r.scaleConfig.utcTime).addField("period",r.scaleConfig.period).addField("discrete",!0),r}return ra(e,t),e.prototype.isInDomain=function(t){var e=this.periodGenerator,n=new Date(t),r=(e?e.cast(n):n).getTime();return this.domain().map(function(t){return t.getTime()}).indexOf(r)>=0},e.prototype.create=function(t){var e=this.periodGenerator,n=this.vars,r=this.vars.map(function(t){return t.getTime()}),i=this.scaleConfig,a=aa.scalePoint().domain(n).range(t).padding(.5),o=aa.scalePoint().domain(r.map(String)).range(t).padding(.5),s=Math.max.apply(Math,t),u=function(t){var e=new Date(t).getTime();return"function"==typeof i.ratio?i.ratio(e,s,r):"object"==typeof i.ratio?i.ratio[e]:1/n.length},l=function(t){var n=new Date(t),a=(e?e.cast(n):n).getTime();return i.ratio?s-r.slice(r.indexOf(a)+1).reduce(function(t,e){return t+s*u(e)},s*u(t)*.5):o(String(a))};return Object.keys(a).forEach(function(t){return l[t]=a[t]}),l.stepSize=function(t){return u(t)*s},this.toBaseScale(l,t)},e}(Ui),sa=n(15),ua=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),la=function(){return(la=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ca=la({},s,u,sa),fa=function(t){function e(e,n){var r,i=t.call(this,e,n)||this,a=i.scaleConfig,o=i.vars,s=a.period?x.get(i.scaleConfig.period,{utc:a.utcTime}):null,u=ca.extent(o).map(s?function(t){return s.cast(new Date(t))}:function(t){return new Date(t)}),l=null==a.min?u[0]:new Date(a.min).getTime(),c=null==a.max?u[1]:new Date(a.max).getTime();if(o=[new Date(Math.min(l,Number(u[0]))),new Date(Math.max(c,Number(u[1])))],i.niceIntervalFn=null,a.nice&&!s){var f=a.niceInterval,d=f&&da(f)?a.utcTime?ca["utc"+(r=f)[0].toUpperCase()+r.slice(1)]:da(f):null;i.niceIntervalFn=d||null,i.vars=Lt(o,i.niceIntervalFn,{utc:a.utcTime})}else i.vars=o;if(s&&Number(i.vars[0])===Number(i.vars[1])){var h=i.vars[0];i.vars[0]=s.cast(new Date(Number(h)-1)),i.vars[1]=s.next(h)}return i.periodGenerator=s,i.addField("scaleType","time").addField("utcTime",i.scaleConfig.utcTime).addField("period",i.scaleConfig.period),i}return ua(e,t),e.prototype.isInDomain=function(t){var e=new Date(t);this.scaleConfig.period&&(e=this.periodGenerator.cast(e));var n=this.domain(),r=n[0],i=n[n.length-1];return!Number.isNaN(r)&&!Number.isNaN(i)&&e<=i&&e>=r},e.prototype.create=function(t){var e=this,n=this.vars,r=this.scaleConfig.utcTime,i=this.periodGenerator,a=(r?ca.scaleUtc:ca.scaleTime)().domain(n).range(t),o=function(t){var e=n[0],r=n[1];return t>r&&(t=r),t<e&&(t=e),a(new Date(t))};if(this.scaleConfig.period){var s=n[0],u=n[1];a.ticks;a.ticks=function(t){return"number"!=typeof t&&(t=10),function(t,e,n,r){void 0===r&&(r=10);var i=t[0],a=t[1],o=x.get(e,{utc:n}),s=Number(i),u=Number(a),l=Number(o.next(o.cast(i)))-Number(o.cast(i));if((u-s)/l<=r)return x.generate(i,a,e,{utc:n}).filter(function(t){return t>=i&&t<=a});return function(t,e,n){void 0===n&&(n=10);var r,i,a=Number(t[0]),o=Number(t[1]),s=Math.abs(o-a)/n,u=ca.bisector(function(t){return t.duration}).right(ga,s);if(u===ga.length)r=e?ca.utcYear:ca.timeYear,i=ca.tickStep(a/pa.year.duration,o/pa.year.duration,n);else if(u){var l=s/ga[u-1].duration,c=ga[u].duration/s,f=ga[l<c?u-1:u];r=e?f.time.utc:f.time.interval,i=f.step}else r=e?ca.utcMillisecond:ca.timeMillisecond,i=ca.tickStep(a,o,n);return r.every(i).range(new Date(a),new Date(o+1))}(t,n,r)}([s,u],e.scaleConfig.period,r,t)};for(var l=i.cast(s);l<s;)l=i.next(l);var c=i.cast(u);o=function(t){var e=i.cast(t);return e<l&&(e=l),e>c&&(e=c),a(e)}}return Object.keys(a).forEach(function(t){return o[t]=a[t]}),o.stepSize=function(){return 0},this.toBaseScale(o,t)},e}(Ui);function da(t){return ca["time"+t[0].toUpperCase()+t.slice(1)]}var ha,pa={second:{duration:1e3,interval:ca.timeSecond,utc:ca.utcSecond},minute:{duration:6e4,interval:ca.timeMinute,utc:ca.utcMinute},hour:{duration:36e5,interval:ca.timeHour,utc:ca.utcHour},day:{duration:864e5,interval:ca.timeDay,utc:ca.utcDay},week:{duration:6048e5,interval:ca.timeWeek,utc:ca.utcWeek},month:{duration:2592e6,interval:ca.timeMonth,utc:ca.utcMonth},year:{duration:31536e6,interval:ca.timeYear,utc:ca.utcYear}},ga=[(ha=function(t,e){return{time:t,step:e,duration:e*t.duration}})(pa.second,1),ha(pa.second,5),ha(pa.second,15),ha(pa.second,30),ha(pa.minute,1),ha(pa.minute,5),ha(pa.minute,15),ha(pa.minute,30),ha(pa.hour,1),ha(pa.hour,3),ha(pa.hour,6),ha(pa.hour,12),ha(pa.day,1),ha(pa.day,2),ha(pa.week,1),ha(pa.month,1),ha(pa.month,3),ha(pa.year,1)];var ma=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ya=function(){return(ya=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},va=ya({},s,u),ba=function(t){function e(e,n){var r=t.call(this,e,n)||this,i=r.scaleConfig,a=va.extent(r.vars),o=Number.isFinite(i.min)?i.min:a[0],s=Number.isFinite(i.max)?i.max:a[1];if(a=[Math.min.apply(Math,[o,a[0]].filter(Number.isFinite)),Math.max.apply(Math,[s,a[1]].filter(Number.isFinite))],r.vars=i.nice?Pt(a):va.extent(a),r.vars[0]===r.vars[1]){var u=Math.pow(10,Math.floor(Math.log(r.vars[0])/Math.LN10));r.vars[0]-=u,r.vars[1]+=u||10}return r.addField("scaleType","linear").addField("discrete",!1),r}return ma(e,t),e.prototype.isInDomain=function(t){var e=this.domain(),n=e[0],r=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(r)&&t<=r&&t>=n},e.prototype.create=function(t){var e=this.vars,n=this.extendScale(va.scaleLinear());return n.domain(e).range(t).clamp(!0),this.toBaseScale(n,t)},e.prototype.extendScale=function(t){var e=this,n=t.copy,r=t.ticks;return Object.assign(t,{stepSize:function(){return 0},copy:function(){return e.extendScale(n.call(t))},ticks:this.getField("isInteger")?function(e){return r.call(t,e).filter(Number.isInteger)}:t.ticks}),t},e}(Ui),xa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_a=function(){return(_a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},wa=_a({},s,u),Ea=function(t){function e(e,n){var r=t.call(this,e,n)||this,i=r.scaleConfig,a=wa.extent(r.vars),o=Number.isFinite(i.min)?i.min:a[0],s=Number.isFinite(i.max)?i.max:a[1];return Ma(a=[Math.min.apply(Math,[o,a[0]].filter(Number.isFinite)),Math.max.apply(Math,[s,a[1]].filter(Number.isFinite))]),i.nice&&(a=function(t){var e=t[0]>0,n=t.map(function(t){return Math.abs(t)}),r=Math.max.apply(Math,n),i=Math.min.apply(Math,n).toExponential().split("e"),a=r.toExponential().split("e"),o=parseFloat(Math.floor(Number(i[0]))+"e"+i[1]),s=parseFloat(Math.ceil(Number(a[0]))+"e"+a[1]);return e?[o,s]:[-s,-o]}(a)),r.vars=a,r.addField("scaleType","logarithmic").addField("discrete",!1),r}return xa(e,t),e.prototype.isInDomain=function(t){var e=this.domain(),n=e[0],r=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(r)&&t<=r&&t>=n},e.prototype.create=function(t){var e=this.vars;Ma(e);var n=function t(e){var n=e.copy;e.ticks=function(t){for(var n=[],r=wa.extent(e.domain()),i=Math.floor(Sa(r[0])),a=Math.ceil(Sa(r[1])),o=Math.ceil(10*(a-i)/(10*Math.ceil(t/10))),s=i;s<=a;s+=o)for(var u=1;u<=10;u++){var l=Math.pow(u,o)*Math.pow(10,s);(l=parseFloat(l.toExponential(0)))>=r[0]&&l<=r[1]&&n.push(l)}return n};e.copy=function(){var r=n.call(e);return t(r),r};return e}(wa.scaleLog()).domain(e).range(t);return n.stepSize=function(){return 0},this.toBaseScale(n,t)},e}(Ui);function Sa(t){return Math.log(t)/Math.LN10}function Ma(t){if(t[0]*t[1]<=0)throw new w("Logarithmic scale domain cannot cross zero.",E.INVALID_LOG_DOMAIN)}var Ta,Ca=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ka=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.addField("scaleType","value").addField("georole",n.georole),r}return Ca(e,t),e.prototype.create=function(){return this.toBaseScale(function(t){return t})},e}(Ui),Aa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oa=function(){return(Oa=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Pa=Oa({},s,u),La=function(t){function e(e,n){var r=t.call(this,e,n)||this,i=r.scaleConfig,a=Pa.extent(r.vars),o=Number.isFinite(i.min)?i.min:a[0],s=Number.isFinite(i.max)?i.max:a[1];a=[Math.min(o,a[0]),Math.max(s,a[1])],r.vars=i.nice?Pt(a):Pa.extent(a);var u=Gt(10).map(function(t){return"rgba(90,180,90,"+(.2+t*(.8/9)).toFixed(2)+")"}),l=i.brewer||u;return r.addField("scaleType","fill").addField("brewer",l),r}return Aa(e,t),e.prototype.isInDomain=function(t){var e=this.domain(),n=e[0],r=e[e.length-1];return!Number.isNaN(n)&&!Number.isNaN(r)&&t<=r&&t>=n},e.prototype.create=function(){var t=this.vars,e=this.getField("brewer");if(!Array.isArray(e))throw new Error("This brewer is not supported");var n=e.length,r=(t[1]-t[0])/n,i=Gt(n-1).map(function(t){return t+1}).reduce(function(e,n){return e.concat([t[0]+n*r])},[]),a=Pa.scaleThreshold().domain(i).range(e);return this.toBaseScale(a)},e}(Ui),Na=function(t){return t||null},Ra=function(t,e){return void 0===e&&(e=null),Array.isArray(t)?0===t.length?[e]:t:[t]},Fa=function(t,e){return{type:t,x:e.x,y:e.y,identity:e.identity,size:e.size,color:e.color,split:e.split,label:e.label,guide:{color:e.colorGuide,obsoleteVerticalStackOrder:e.obsoleteVerticalStackOrder,size:e.sizeGuide},flip:e.flip,stack:e.stack}},Da={SUCCESS:"SUCCESS",WARNING:"WARNING",FAIL:"FAIL"},ja=((Ta={})[Da.SUCCESS]=function(t){return t},Ta[Da.FAIL]=function(t,e){throw new Error((e.messages||[]).join("\n")||["This configuration is not supported,","See https://api.taucharts.com/basic/facet.html#easy-approach-for-creating-facet-chart"].join(" "))},Ta[Da.WARNING]=function(t,e,n){var r=e.axis,i=e.indexMeasureAxis[0],a=t[i],o=t.filter(function(t){return t!==a});o.push(a);var s=n[i][r]||{},u=n[n.length-1][r]||{};return n[n.length-1][r]=s,n[i][r]=u,o},Ta);function Ia(t,e,n){return e.reduce(function(e,r,i){var a=t[r];return a?e.status!=Da.FAIL&&("measure"===a.type&&(e.countMeasureAxis++,e.indexMeasureAxis.push(i)),"measure"!==a.type&&1===e.countMeasureAxis?e.status=Da.WARNING:e.countMeasureAxis>1&&(e.status=Da.FAIL,e.messages.push('There is more than one measure dimension for "'+n+'" axis'))):(e.status=Da.FAIL,r?e.messages.push('"'+r+'" dimension is undefined for "'+n+'" axis'):e.messages.push('"'+n+'" axis should be specified')),e},{status:Da.SUCCESS,countMeasureAxis:0,indexMeasureAxis:[],messages:[],axis:n})}function za(t){for(var e=Ra(t.x),n=Ra(t.y),r=Math.max(e.length,n.length),i=Ra(t.guide||{},{}),a=r-i.length,o=0;o<a;o++)i.push({});i=i.slice(0,r);var s=Ia(t.dimensions,e,"x"),u=Ia(t.dimensions,n,"y");e=ja[s.status](e,s,i),n=ja[u.status](n,u,i);var l=["identity","color","size","label","split"].reduce(function(e,n){var r=t[n],i=function(t,e,n){return null==e?e:String(e)}(t.dimensions,r);return null!=i&&(e[n]=i),e},{});return Object.assign({},t,{x:e,y:n,guide:i},l)}function Ba(t,e){for(var n=e.x,r=e.y,i=e.guide,a=Math.max(n.length,r.length),o={type:"COORDS.RECT",unit:[]},s=[].concat(n),u=[].concat(r),l=[].concat(i),c=a;c>0;c--){var f=s.pop(),d=u.pop(),h=l.pop()||{};c===a?(o.x=f,o.y=d,o.unit.push(Fa(t,{x:Na(f),y:Na(d),identity:e.identity,split:e.split,color:e.color,label:e.label,size:e.size,flip:e.flip,stack:e.stack,colorGuide:h.color,obsoleteVerticalStackOrder:h.obsoleteVerticalStackOrder,sizeGuide:h.size})),o.guide=Qt(h,{x:{label:f},y:{label:d}})):o={type:"COORDS.RECT",x:Na(f),y:Na(d),unit:[o],guide:Qt(h,{x:{label:f},y:{label:d}})}}return e.spec={dimensions:e.dimensions,unit:o},e}var Va=function(t){var e,n,r,i=za(t);return n=((e=i).flip?e.y:e.x).indexOf(e.color)>=0,r=e.guide[e.guide.length-1],n&&!r.hasOwnProperty("enableColorToBarPosition")&&(r.enableColorToBarPosition=!1),Ba("ELEMENT.INTERVAL",i=e)},Ha=function(t){var e=za(t),n=e.data,r=e.settings.log,i=(0,{horizontal:function(t){return{prop:t.x[t.x.length-1],flip:!1}},vertical:function(t){return{prop:t.y[t.y.length-1],flip:!0}},auto:function(t){var e,i=t.x,a=t.y,o=i[i.length-1],s=i.slice(0,i.length-1),u=a[a.length-1],l=a.slice(0,a.length-1),c=t.color,f=s.concat(l).concat([c]).filter(function(t){return null!==t}),d=-1,h=[[[o].concat(f),u],[[u].concat(f),o]],p=null;return h.some(function(t,e){var i=t[0],a=t[1],o=un(n,i,[a]);return o.result?d=e:r(["Attempt to find a functional relation between",t[0]+" and "+t[1]+" is failed.","There are several "+o.error.keyY+" values (e.g. "+o.error.errY.join(",")+")","for ("+o.error.keyX+" = "+o.error.valX+")."].join(" ")),o.result})?(e=h[d][0][0],p=0!==d):(r("All attempts are failed. Gonna transform AREA to general PATH."),e=null),{prop:e,flip:p}}}["boolean"!=typeof e.flip?"auto":e.flip?"vertical":"horizontal"])(e);return null!==i.prop&&(e.data=dn(n,i.prop,e.dimensions[i.prop]),e.flip=i.flip),Ba("ELEMENT.AREA",e)},Wa=function(){function t(t){this.unitRef=t}return t.prototype.value=function(){return this.unitRef},t.prototype.clone=function(){return JSON.parse(JSON.stringify(this.unitRef))},t.prototype.traverse=function(t){var e=function(t,n,r){n(t,r),(t.units||[]).map(function(r){return e(r,n,t)})};return e(this.unitRef,t,null),this},t.prototype.reduce=function(t,e){var n=e;return this.traverse(function(e,r){return n=t(n,e,r)}),n},t.prototype.addFrame=function(t){return this.unitRef.frames=this.unitRef.frames||[],t.key.__layerid__=["L",(new Date).getTime(),this.unitRef.frames.length].join(""),t.source=t.hasOwnProperty("source")?t.source:this.unitRef.expression.source,t.pipe=t.pipe||[],this.unitRef.frames.push(t),this},t.prototype.addTransformation=function(t,e){return this.unitRef.transformation=this.unitRef.transformation||[],this.unitRef.transformation.push({type:t,args:e}),this},t.prototype.isCoordinates=function(){return 0===(this.unitRef.type||"").toUpperCase().indexOf("COORDS.")},t.prototype.isElementOf=function(t){if(this.isCoordinates())return!1;var e=(this.unitRef.type||"").split("/");return 1===e.length&&e.unshift("RECT"),e[0].toUpperCase()===t.toUpperCase()},t}(),Ga=function(){function t(t){this.specRef=t}return t.prototype.value=function(){return this.specRef},t.prototype.unit=function(t){return t&&(this.specRef.unit=t),new Wa(this.specRef.unit)},t.prototype.addTransformation=function(t,e){return this.specRef.transformations=this.specRef.transformations||{},this.specRef.transformations[t]=e,this},t.prototype.getSettings=function(t){return this.specRef.settings[t]},t.prototype.setSettings=function(t,e){return this.specRef.settings=this.specRef.settings||{},this.specRef.settings[t]=e,this},t.prototype.getScale=function(t){return this.specRef.scales[t]},t.prototype.addScale=function(t,e){return this.specRef.scales[t]=e,this},t.prototype.regSource=function(t,e){return this.specRef.sources[t]=e,this},t.prototype.getSourceData=function(t){return(this.specRef.sources[t]||{data:[]}).data},t.prototype.getSourceDim=function(t,e){return(this.specRef.sources[t]||{dims:{}}).dims[e]||{}},t}(),Ua={},Xa=function(){function t(){}return t.unit=function(t){return new Wa(t)},t.spec=function(t){return new Ga(t)},t.cloneObject=function(t){return JSON.parse(JSON.stringify(t))},t.depthFirstSearch=function(e,n){if(n(e))return e;for(var r=e.hasOwnProperty("frames")?e.frames:[{units:e.units}],i=0;i<r.length;i++)for(var a=r[i].units||[],o=0;o<a.length;o++){var s=t.depthFirstSearch(a[o],n);if(s)return s}},t.traverseSpec=function(t,e){var n=function(t,e,r){e(t,r),(t.units||[]).map(function(r){return n(r,e,t)})};n(t.unit,e,null)},t.extractFieldsFormatInfo=function(e){var n=e.scales,r=function(t){return!n[t].dim},i=function(t,e,r){var i=e.guide||{},a=n[e[r]],o=i[r]||{};t[a.dim]=t[a.dim]||{label:[],format:[],nullAlias:[],tickLabel:[]};var s=o.label,u=o.label||{};t[a.dim].label.push("string"==typeof s?s:u._original_text||u.text);var l=o.tickFormat||o.tickPeriod;t[a.dim].format.push(l),t[a.dim].nullAlias.push(o.tickFormatNullAlias),t[a.dim].tickLabel.push(o.tickLabel)},a=[];t.traverseSpec(e,function(t){a.push(t)});var o=a.reduce(function(t,e){return"COORDS.RECT"===e.type&&e.hasOwnProperty("x")&&!r(e.x)&&i(t,e,"x"),"COORDS.RECT"===e.type&&e.hasOwnProperty("y")&&!r(e.y)&&i(t,e,"y"),e.hasOwnProperty("color")&&!r(e.color)&&i(t,e,"color"),e.hasOwnProperty("size")&&!r(e.size)&&i(t,e,"size"),e.hasOwnProperty("label")&&!r(e.label)&&i(t,e,"label"),t},{}),s=function(t,e){return t.filter(function(t){return t})[0]||e};return Object.keys(o).reduce(function(t,n){t[n]={},t[n].label=s(o[n].label,n);var r=s(o[n].format,null);t[n].nullAlias=s(o[n].nullAlias,"No "+t[n].label),t[n].tickLabel=s(o[n].tickLabel,null);var i="x-time-auto"===r?e.settings.utcTime?"day-utc":"day":r,a=t[n].nullAlias,u=i?Mn.get(i,a):function(t){return null==t?a:String(t)};if(t[n].format=u,t[n].tickLabel){var l=n.replace("."+t[n].tickLabel,"");t[l]={label:t[n].label,nullAlias:t[n].nullAlias,tickLabel:t[n].tickLabel,format:function(e){return u(e&&e[t[l].tickLabel])},isComplexField:!0},t[n].parentField=l}return t},{})},t.getFieldFormatters=function(e,n){var r=t.extractFieldsFormatInfo(e);Object.keys(r).forEach(function(t){r[t].parentField&&delete r[t]});return Object.keys(n).forEach(function(t){var e,i,a=(e=n[t],i={},"function"==typeof e||"string"==typeof e?i={format:e}:Ot(e)&&(i=ne(e,"label","format","nullAlias")),i);r[t]=Object.assign({label:t,nullAlias:"No "+t},r[t]||{},ne(a,"label","nullAlias")),a.hasOwnProperty("format")?r[t].format="function"==typeof a.format?a.format:Mn.get(a.format,r[t].nullAlias):r[t].format=r[t].hasOwnProperty("format")?r[t].format:Mn.get(null,r[t].nullAlias)}),Object.keys(r).reduce(function(t,e){var n=r[e];return t[e]={label:n.label,format:n.format},t},{})},t.tokens=function(){return{reg:function(t,e){return Ua[t]=e,this},get:function(t){return Ua[t]||t}}},t.getParentUnit=function(t,e){var n=null,r=function(t,i){return t.uid===e.uid?(n=i,!0):(t.frames?t.frames.some(function(e){return(e.units||[]).some(function(e){return r(e,t)})}):(t.units||[]).some(function(e){return r(e,t)}),!1)};return r(t.unit,null),n},t}();n(16);n.d(e,"api",function(){return $a}),n.d(e,"version",function(){return Ja}),n.d(e,"GPL",function(){return Ue}),n.d(e,"Plot",function(){return or}),n.d(e,"Chart",function(){return dr});var qa={},Ya={},$a={errorCodes:E,unitsRegistry:nn,scalesRegistry:on,grammarRegistry:M,tickFormat:Mn,isChartElement:de,utils:r,svgUtils:a,domUtils:i,tickPeriod:x,colorBrewers:{add:function(t,e){qa.hasOwnProperty(t)||(qa[t]=e)},get:function(t){return qa[t]}},d3_animationInterceptor:st,pluginsSDK:Xa,plugins:{add:function(t,e){if(Ya.hasOwnProperty(t))throw new Error("Plugin is already registered.");Ya[t]=e},get:function(t){return Ya[t]||function(e){throw new Error('"'+t+'" plugin is not defined')}}},chartTypesRegistry:cr,globalSettings:{animationSpeed:750,renderingTimeout:1e4,asyncRendering:!0,syncRenderingInterval:50,syncPointerEvents:!1,handleRenderingErrors:!1,experimentalShouldAnimate:function(t){var e=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach(function(t){return n.setAttribute(t,String(e[t]))}),n},n=document.createElement("div");n.style.position="absolute",n.style.visibility="hidden",document.body.appendChild(n);var r=e("svg",{width:100,height:100});n.appendChild(r);var i,a,o,s=performance.now();for(i=0;i<10;i++)for(a=0;a<10;a++)o=e("circle",{fill:"black",r:5,cx:10*i,cy:10*a}),r.appendChild(o);var u=performance.now()-s;return document.body.removeChild(n),t.sources["/"].data.length*u<500},defaultNiceColor:!0,defaultColorBrewer:["#fde725","#fbe723","#f8e621","#f6e620","#f4e61e","#f1e51d","#efe51c","#ece51b","#eae51a","#e7e419","#e5e419","#e2e418","#dfe318","#dde318","#dae319","#d8e219","#d5e21a","#d2e21b","#d0e11c","#cde11d","#cae11f","#c8e020","#c5e021","#c2df23","#c0df25","#bddf26","#bade28","#b8de29","#b5de2b","#b2dd2d","#b0dd2f","#addc30","#aadc32","#a8db34","#a5db36","#a2da37","#a0da39","#9dd93b","#9bd93c","#98d83e","#95d840","#93d741","#90d743","#8ed645","#8bd646","#89d548","#86d549","#84d44b","#81d34d","#7fd34e","#7cd250","#7ad151","#77d153","#75d054","#73d056","#70cf57","#6ece58","#6ccd5a","#69cd5b","#67cc5c","#65cb5e","#63cb5f","#60ca60","#5ec962","#5cc863","#5ac864","#58c765","#56c667","#54c568","#52c569","#50c46a","#4ec36b","#4cc26c","#4ac16d","#48c16e","#46c06f","#44bf70","#42be71","#40bd72","#3fbc73","#3dbc74","#3bbb75","#3aba76","#38b977","#37b878","#35b779","#34b679","#32b67a","#31b57b","#2fb47c","#2eb37c","#2db27d","#2cb17e","#2ab07f","#29af7f","#28ae80","#27ad81","#26ad81","#25ac82","#25ab82","#24aa83","#23a983","#22a884","#22a785","#21a685","#21a585","#20a486","#20a386","#1fa287","#1fa187","#1fa188","#1fa088","#1f9f88","#1f9e89","#1e9d89","#1e9c89","#1e9b8a","#1f9a8a","#1f998a","#1f988b","#1f978b","#1f968b","#1f958b","#1f948c","#20938c","#20928c","#20928c","#21918c","#21908d","#218f8d","#218e8d","#228d8d","#228c8d","#228b8d","#238a8d","#23898e","#23888e","#24878e","#24868e","#25858e","#25848e","#25838e","#26828e","#26828e","#26818e","#27808e","#277f8e","#277e8e","#287d8e","#287c8e","#297b8e","#297a8e","#29798e","#2a788e","#2a778e","#2a768e","#2b758e","#2b748e","#2c738e","#2c728e","#2c718e","#2d718e","#2d708e","#2e6f8e","#2e6e8e","#2e6d8e","#2f6c8e","#2f6b8e","#306a8e","#30698e","#31688e","#31678e","#31668e","#32658e","#32648e","#33638d","#33628d","#34618d","#34608d","#355f8d","#355e8d","#365d8d","#365c8d","#375b8d","#375a8c","#38598c","#38588c","#39568c","#39558c","#3a548c","#3a538b","#3b528b","#3b518b","#3c508b","#3c4f8a","#3d4e8a","#3d4d8a","#3e4c8a","#3e4a89","#3e4989","#3f4889","#3f4788","#404688","#404588","#414487","#414287","#424186","#424086","#423f85","#433e85","#433d84","#443b84","#443a83","#443983","#453882","#453781","#453581","#463480","#46337f","#46327e","#46307e","#472f7d","#472e7c","#472d7b","#472c7a","#472a7a","#482979","#482878","#482677","#482576","#482475","#482374","#482173","#482071","#481f70","#481d6f","#481c6e","#481b6d","#481a6c","#48186a","#481769","#481668","#481467","#471365","#471164","#471063","#470e61","#470d60","#460b5e","#460a5d","#46085c","#46075a","#450559","#450457","#440256","#440154"],defaultClassBrewer:Gt(20).map(function(t){return"color20-"+(1+t)}),log:function(t,e){e=e||"INFO",Array.isArray(t)||(t=[t]),console[e.toLowerCase()].apply(console,t)},facetLabelDelimiter:"  ",excludeNull:!0,minChartWidth:300,minChartHeight:200,minFacetWidth:150,minFacetHeight:100,specEngine:[{name:"COMPACT",width:600,height:400},{name:"AUTO",width:Number.MAX_VALUE,height:Number.MAX_VALUE}],fitModel:"normal",layoutEngine:"EXTRACT",autoRatio:!0,defaultSourceMap:["https://raw.githubusercontent.com","TargetProcess/tauCharts/master/src/addons","world-countries.json"].join("/"),getAxisTickLabelSize:te(we,function(t){return String(String(t).length)}),getScrollbarSize:ye,avoidScrollAtRatio:1.5,xAxisTickLabelLimit:150,yAxisTickLabelLimit:150,xTickWordWrapLinesLimit:2,yTickWordWrapLinesLimit:2,xTickWidth:9,yTickWidth:9,distToXAxisLabel:10,distToYAxisLabel:10,xAxisPadding:20,yAxisPadding:20,xFontLabelDescenderLineHeight:4,xFontLabelHeight:10,yFontLabelHeight:10,xDensityPadding:2,yDensityPadding:2,"xDensityPadding:measure":8,"yDensityPadding:measure":8,utcTime:!1,defaultFormats:{measure:"x-num-auto","measure:time":"x-time-auto"}}};or.__api__=$a,or.globalSettings=$a.globalSettings,$a.unitsRegistry.reg("COORDS.RECT",Er).reg("COORDS.MAP",jr).reg("COORDS.PARALLEL",Ar).reg("ELEMENT.GENERIC.CARTESIAN",ht).reg("ELEMENT.POINT",ai,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.LINE",zi,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.PATH",Di,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.AREA",Fi,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL",Vi,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",Vi,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",Vi,"ELEMENT.GENERIC.CARTESIAN").reg("PARALLEL/ELEMENT.LINE",Gi),$a.scalesRegistry.reg("identity",qi,function(t,e){return Qt(t,{references:e.references,refCounter:e.refCounter})}).reg("color",Ji,function(t,e){return Qt(t,{nice:e.defaultNiceColor,brewer:"measure"===t.dimType?e.defaultColorBrewer:e.defaultClassBrewer})}).reg("fill",La).reg("size",ta).reg("ordinal",na).reg("period",oa,function(t,e){return Qt(t,{utcTime:e.utcTime})}).reg("time",fa,function(t,e){return Qt(t,{utcTime:e.utcTime})}).reg("linear",ba).reg("logarithmic",Ea).reg("value",ka);var Ka=[function(t){return t.data?[]:["[data] must be specified"]}];$a.chartTypesRegistry.add("scatterplot",function(t){return Ba("ELEMENT.POINT",za(t))},Ka).add("line",function(t){var e=za(t),n=e.data,r=e.settings.log,i={none:function(){return null},horizontal:function(t){return t.x[t.x.length-1]},vertical:function(t){return t.y[t.y.length-1]},auto:function(t){var e,i=t.x,a=t.y,o=i[i.length-1],s=i.slice(0,i.length-1),u=a[a.length-1],l=a.slice(0,a.length-1),c=t.color,f=s.concat(l).concat([c]).filter(function(t){return null!==t}),d=-1,h=[[[o].concat(f),u],[[u].concat(f),o]];return h.some(function(t,e){var i=t[0],a=t[1],o=un(n,i,[a]);return o.result?d=e:r(["Attempt to find a functional relation between",t[0]+" and "+t[1]+" is failed.","There are several "+o.error.keyY+" values (e.g. "+o.error.errY.join(",")+")","for ("+o.error.keyX+" = "+o.error.valX+")."].join(" ")),o.result})?e=h[d][0][0]:(r(["All attempts are failed.","Will orient line horizontally by default.","NOTE: the [scatterplot] chart is more convenient for that data."].join(" ")),e=o),e}},a=(e.lineOrientation||"").toLowerCase(),o=(i.hasOwnProperty(a)?i[a]:i.auto)(e);return null!==o&&(e.data=dn(n,o,e.dimensions[o])),Ba("ELEMENT.LINE",e)},Ka).add("area",Ha,Ka).add("stacked-area",function(t){return Ha(Qt(t,{stack:!0}))},Ka).add("bar",function(t){return Va(Qt(t,{flip:!1}))},Ka).add("horizontalBar",function(t){return Va(Qt({flip:!0},t))},Ka).add("horizontal-bar",function(t){return Va(Qt({flip:!0},t))},Ka).add("stacked-bar",function(t){return Va(Qt({flip:!1,stack:!0},t))},Ka).add("horizontal-stacked-bar",function(t){return Va(Qt({flip:!0,stack:!0},t))},Ka).add("map",function(t){var e=Object.assign({sourcemap:t.settings.defaultSourceMap},t.guide||{});e.size=Qt(e.size||{},{min:1,max:10}),e.code=Qt(e.code||{},{georole:"countries"});var n={},r=function(t,e,r){var i;void 0===r&&(r={});var a,o=e;return e?(i=t+"_"+e,a="/"):(i=t+":default",a="?"),n.hasOwnProperty(i)||(n[i]=Object.assign({type:t,source:a,dim:o},r)),i};return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(t.dimensions).reduce(function(e,n){return e[n]={type:t.dimensions[n].type},e},{}),data:t.data}},scales:n,unit:{type:"COORDS.MAP",expression:{operator:"none",source:"/"},code:r("value",t.code,e.code),fill:r("fill",t.fill,e.fill),size:r("size",t.size,e.size),color:r("color",t.color,e.color),latitude:r("linear",t.latitude,{nice:!1}),longitude:r("linear",t.longitude,{nice:!1}),guide:e},plugins:t.plugins||[]}},Ka.concat([function(t){var e=t.fill&&t.code;if(t.fill&&!e)return"[code] must be specified when using [fill]"},function(t){var e=t.latitude&&t.longitude;if((t.latitude||t.longitude)&&!e)return"[latitude] and [longitude] both must be specified"}])).add("parallel",function(t){var e=Object.assign({columns:{}},t.guide||{}),n={},r=function(t,e,r){var i;void 0===r&&(r={});var a,o=e;return e?(i=t+"_"+e,a="/"):(i=t+":default",a="?"),n.hasOwnProperty(i)||(n[i]=Object.assign({type:t,source:a,dim:o},r)),i},i=t.columns.map(function(n){return r(t.dimensions[n].scale,n,e.columns[n])});return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(t.dimensions).reduce(function(e,n){return e[n]={type:t.dimensions[n].type},e},{}),data:t.data}},scales:n,unit:{type:"COORDS.PARALLEL",expression:{operator:"none",source:"/"},columns:i,guide:e,units:[{type:"PARALLEL/ELEMENT.LINE",color:r("color",t.color,e.color),columns:i,expression:{operator:"none",source:"/"}}]},plugins:t.plugins||[]}},Ka.concat([function(t){if(!(t.columns&&t.columns.length>1))return"[columns] property must contain at least 2 dimensions"}]));var Ja="2.7.2";e.default={GPL:Ue,Plot:or,Chart:dr,api:$a,version:"2.7.2"}},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=i},function(t,e){t.exports=a},function(t,e){t.exports=o},function(t,e){t.exports=s},function(t,e){t.exports=u},function(t,e,n){var r,i,a;i=[],void 0===(a="function"==typeof(r=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){return t.indexOf(e)},r=window,i=r.document,a=i.documentElement,o=["top","bottom"];function s(t,e){for(var n in e)t[n]=e[n];return t}function u(t){var e,n=r.pageYOffset||a.scrollTop,i=r.pageXOffset||a.scrollLeft,o={left:0,right:0,top:0,bottom:0,width:0,height:0};if((e=t)&&null!=e.setInterval)o.width=r.innerWidth||a.clientWidth,o.height=r.innerHeight||a.clientHeight;else{if(!a.contains(t)||null==t.getBoundingClientRect)return o;s(o,t.getBoundingClientRect()),o.width=o.right-o.left,o.height=o.bottom-o.top}return o.top=o.top+n-a.clientTop,o.left=o.left+i-a.clientLeft,o.right=o.left+o.width,o.bottom=o.top+o.height,o}var l=function(t,e){return r.getComputedStyle(t)[e]};function c(t){var e=String(l(t,c.propName)),n=e.match(/([0-9.]+)([ms]{1,2})/);return n&&(e=Number(n[1]),"s"===n[2]&&(e*=1e3)),0|e}c.propName=function(){for(var t=i.createElement("div"),e=["transitionDuration","webkitTransitionDuration"],n=0;n<e.length;n++)if(t.style[e[n]]="1s","1s"===t.style[e[n]])return e[n]}();var f=Object.create;function d(t,e){if(!(this instanceof d))return new d(t,e);this.hidden=1,this.options=s(f(d.defaults),e),this._createElement(),t&&this.content(t)}d.prototype._createElement=function(){var t,e;this.element=i.createElement("div"),this.classes=(t=this.element,{add:function(e){t.classList.add(e)},remove:function(e){t.classList.remove(e)}}),this.classes.add(this.options.baseClass);for(var n=0;n<d.classTypes.length;n++)e=d.classTypes[n]+"Class",this.options[e]&&this.classes.add(this.options[e])},d.prototype.type=function(t){return this.changeClassType("type",t)},d.prototype.effect=function(t){return this.changeClassType("effect",t)},d.prototype.changeClassType=function(t,e){return t+="Class",this.options[t]&&this.classes.remove(this.options[t]),this.options[t]=e,e&&this.classes.add(e),this},d.prototype.updateSize=function(){var t;return this.hidden&&(this.element.style.visibility="hidden",i.body.appendChild(this.element)),this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,null==this.spacing&&(this.spacing=null!=this.options.spacing?this.options.spacing:(t=l(this.element,"top"),0|Math.round(String(t).replace(/[^\-0-9.]/g,"")))),this.hidden?(i.body.removeChild(this.element),this.element.style.visibility=""):this.position(),this},d.prototype.content=function(t){return"object"==typeof t?(this.element.innerHTML="",this.element.appendChild(t)):this.element.innerHTML=t,this.updateSize(),this},d.prototype.place=function(t){return this.options.place=t,this.hidden||this.position(),this},d.prototype.attach=function(t){return this.attachedTo=t,this.hidden||this.position(),this},d.prototype.detach=function(){return this.hide(),this.attachedTo=null,this},d.prototype._pickPlace=function(t){if(!this.options.auto)return this.options.place;var e=u(r),i=this.options.place.split("-"),a=this.spacing;if(-1!==n(o,i[0]))switch(t.top-this.height-a<=e.top?i[0]="bottom":t.bottom+this.height+a>=e.bottom&&(i[0]="top"),i[1]){case"left":t.right-this.width<=e.left&&(i[1]="right");break;case"right":t.left+this.width>=e.right&&(i[1]="left");break;default:t.left+t.width/2+this.width/2>=e.right?i[1]="left":t.right-t.width/2-this.width/2<=e.left&&(i[1]="right")}else switch(t.left-this.width-a<=e.left?i[0]="right":t.right+this.width+a>=e.right&&(i[0]="left"),i[1]){case"top":t.bottom-this.height<=e.top&&(i[1]="bottom");break;case"bottom":t.top+this.height>=e.bottom&&(i[1]="top");break;default:t.top+t.height/2+this.height/2>=e.bottom?i[1]="top":t.bottom-t.height/2-this.height/2<=e.top&&(i[1]="bottom")}return i.join("-")},d.prototype.position=function(t,e){this.attachedTo&&(t=this.attachedTo),null==t&&this._p?(t=this._p[0],e=this._p[1]):this._p=arguments;var n,r,i="number"==typeof t?{left:0|t,right:0|t,top:0|e,bottom:0|e,width:0,height:0}:u(t),a=this.spacing,o=this._pickPlace(i);switch(o!==this.curPlace&&(this.curPlace&&this.classes.remove(this.curPlace),this.classes.add(o),this.curPlace=o),this.curPlace){case"top":n=i.top-this.height-a,r=i.left+i.width/2-this.width/2;break;case"top-left":n=i.top-this.height-a,r=i.right-this.width;break;case"top-right":n=i.top-this.height-a,r=i.left;break;case"bottom":n=i.bottom+a,r=i.left+i.width/2-this.width/2;break;case"bottom-left":n=i.bottom+a,r=i.right-this.width;break;case"bottom-right":n=i.bottom+a,r=i.left;break;case"left":n=i.top+i.height/2-this.height/2,r=i.left-this.width-a;break;case"left-top":n=i.bottom-this.height,r=i.left-this.width-a;break;case"left-bottom":n=i.top,r=i.left-this.width-a;break;case"right":n=i.top+i.height/2-this.height/2,r=i.right+a;break;case"right-top":n=i.bottom-this.height,r=i.right+a;break;case"right-bottom":n=i.top,r=i.right+a}return this.element.style.top=Math.round(n)+"px",this.element.style.left=Math.round(r)+"px",this},d.prototype.show=function(t,e){return t=this.attachedTo?this.attachedTo:t,clearTimeout(this.aIndex),null!=t&&this.position(t,e),this.hidden&&(this.hidden=0,i.body.appendChild(this.element)),this.attachedTo&&this._aware(),this.options.inClass&&(this.options.effectClass&&this.element.clientHeight,this.classes.add(this.options.inClass)),this},d.prototype.getElement=function(){return this.element},d.prototype.hide=function(){if(!this.hidden){var t=this,e=0;return this.options.inClass&&(this.classes.remove(this.options.inClass),this.options.effectClass&&(e=c(this.element))),this.attachedTo&&this._unaware(),clearTimeout(this.aIndex),this.aIndex=setTimeout(function(){t.aIndex=0,i.body.removeChild(t.element),t.hidden=1},e),this}},d.prototype.toggle=function(t,e){return this[this.hidden?"show":"hide"](t,e)},d.prototype.destroy=function(){clearTimeout(this.aIndex),this._unaware(),this.hidden||i.body.removeChild(this.element),this.element=this.options=null},d.prototype._aware=function(){-1===n(d.winAware,this)&&d.winAware.push(this)},d.prototype._unaware=function(){var t=n(d.winAware,this);-1!==t&&d.winAware.splice(t,1)},d.reposition=function(){var t,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,17)};function n(){t=0;for(var e=0,n=d.winAware.length;e<n;e++)d.winAware[e].position()}return function(){!t&&d.winAware.length&&(t=e(n))}}(),d.winAware=[],window.addEventListener("resize",d.reposition),window.addEventListener("scroll",d.reposition),d.classTypes=["type","effect"],d.defaults={baseClass:"tooltip",typeClass:null,effectClass:null,inClass:"in",place:"top",spacing:null,auto:0},e.Tooltip=d}])})?r.apply(e,i):r)||(t.exports=a)},function(t,e){t.exports=l},function(t,e){t.exports=c},function(t,e){t.exports=f},function(t,e){t.exports=d},function(t,e){t.exports=h},function(t,e,n){"use strict";var r,i,a,o,s;if(window.requestAnimationFrame||(r=0,window.requestAnimationFrame=function(t){var e=Date.now(),n=Math.max(0,16-e+r);return r=e+n,setTimeout(function(){t.call(null,e+n)},n)},window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.requestIdleCallback||(window.requestIdleCallback=function(t,e){return setTimeout(t,e&&e.timeout?e.timeout:0)},window.cancelIdleCallback=function(t){clearTimeout(t)}),Number.isFinite||Object.defineProperty(Number,"isFinite",{value:function(t){return"number"==typeof t&&isFinite(t)},configurable:!0,enumerable:!1,writable:!0}),Number.isNaN||Object.defineProperty(Number,"isNaN",{value:function(t){return"number"==typeof t&&isNaN(t)},configurable:!0,enumerable:!1,writable:!0}),Number.isInteger||Object.defineProperty(Number,"isInteger",{value:function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},configurable:!0,enumerable:!1,writable:!0}),Number.MAX_SAFE_INTEGER||Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:9007199254740991,configurable:!1,enumerable:!1,writable:!1}),Math.sign||(Math.sign=function(t){return(t>0)-(t<0)||Number(t)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,i=arguments[1],a=0;a<r;a++)if(e=n[a],t.call(i,e,a,n))return e},configurable:!0,enumerable:!1,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,i=arguments[1],a=0;a<r;a++)if(e=n[a],t.call(i,e,a,n))return a;return-1},configurable:!0,enumerable:!1,writable:!0}),!Array.from){Object.defineProperty(Array,"from",{value:(i=Object.prototype.toString,a=function(t){return"function"==typeof t||"[object Function]"===i.call(t)},o=Math.pow(2,53)-1,s=function(t){var e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),o)},function(t){var e=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!a(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(n=arguments[2])}for(var i,o=s(e.length),u=a(this)?Object(new this(o)):new Array(o),l=0;l<o;)i=e[l],u[l]=r?void 0===n?r(i,l):r.call(n,i,l):i,l+=1;return u.length=o,u}),configurable:!0,enumerable:!1,writable:!0});var u=Map.prototype.set;Object.defineProperty(Map.prototype,"set",{value:function(){return u.apply(this,arguments),this},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"values",{value:function(){var t={},e=0;return this.forEach(function(n){return t[String(e++)]=n}),t.length=e,t},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"entries",{value:function(){var t={},e=0;return this.forEach(function(n,r){return t[String(e++)]=[r,n]}),t.length=e,t},configurable:!0,enumerable:!1,writable:!0})}Object.assign||Object.defineProperty(Object,"assign",{value:function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e},configurable:!0,enumerable:!1,writable:!0}),Element.prototype.matches||Object.defineProperty(Element.prototype,"matches",{value:Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,configurable:!0,enumerable:!0,writable:!0})},function(t,e,n){t.exports=function(t,e){"use strict";var n;return t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,function(n){var r;function i(){return document.createElement("canvas")}n.exports,(r=window).DOMParser=window.DOMParser;var a,o=function(n,s,u){if(null!=n||null!=s||null!=u){var l=function(n){var o={opts:n,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,rootEmSize:12,emSize:12,log:function(t){}};1==o.opts.log&&"undefined"!=typeof console&&(o.log=function(t){console.log(t)}),o.init=function(t){var e=0;o.UniqueId=function(){return"canvg"+ ++e},o.Definitions={},o.Styles={},o.StylesSpecificity={},o.Animations=[],o.Images=[],o.ctx=t,o.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(t,e){this.viewPorts.push({width:t,height:e})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(t){return null!=t&&"number"==typeof t?t:"x"==t?this.width():"y"==t?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},o.init(),o.ImagesLoaded=function(){for(var t=0;t<o.Images.length;t++)if(!o.Images[t].loaded)return!1;return!0},o.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},o.compressSpaces=function(t){return t.replace(/(?!\u3000)\s+/gm," ")},o.ajax=function(t){var e;return(e=r.XMLHttpRequest?new r.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(e.open("GET",t,!1),e.send(null),e.responseText):null},o.parseXml=function(t){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var e=new Windows.Data.Xml.Dom.XmlDocument,i=new Windows.Data.Xml.Dom.XmlLoadSettings;return i.prohibitDtd=!1,e.loadXml(t,i),e}if(!r.DOMParser){t=t.replace(/<!DOCTYPE svg[^>]*>/,"");var e=new ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e}try{var a=n.xmldom?new r.DOMParser(n.xmldom):new r.DOMParser;return a.parseFromString(t,"image/svg+xml")}catch(e){return(a=n.xmldom?new r.DOMParser(n.xmldom):new r.DOMParser).parseFromString(t,"text/xml")}},o.Property=function(t,e){this.name=t,this.value=e},o.Property.prototype.getValue=function(){return this.value},o.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},o.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var t=parseFloat(this.value);return(this.value+"").match(/%$/)&&(t/=100),t},o.Property.prototype.valueOrDefault=function(t){return this.hasValue()?this.value:t},o.Property.prototype.numValueOrDefault=function(t){return this.hasValue()?this.numValue():t},o.Property.prototype.addOpacity=function(e){var n=this.value;if(null!=e.value&&""!=e.value&&"string"==typeof this.value){var r=new t(this.value);r.ok&&(n="rgba("+r.r+", "+r.g+", "+r.b+", "+e.numValue()+")")}return new o.Property(this.name,n)},o.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),o.Definitions[t]},o.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},o.Property.prototype.getFillStyleDefinition=function(t,e){var n=this.getDefinition();if(null!=n&&n.createGradient)return n.createGradient(o.ctx,t,e);if(null!=n&&n.createPattern){if(n.getHrefAttribute().hasValue()){var r=n.attribute("patternTransform");n=n.getHrefAttribute().getDefinition(),r.hasValue()&&(n.attribute("patternTransform",!0).value=r.value)}return n.createPattern(o.ctx,t)}return null},o.Property.prototype.getDPI=function(t){return 96},o.Property.prototype.getREM=function(t){return o.rootEmSize},o.Property.prototype.getEM=function(t){return o.emSize},o.Property.prototype.getUnits=function(){var t=this.value+"";return t.replace(/[0-9\.\-]/g,"")},o.Property.prototype.isPixels=function(){if(!this.hasValue())return!1;var t=this.value+"";return!!t.match(/px$/)||!!t.match(/^[0-9]+$/)},o.Property.prototype.toPixels=function(t,e){if(!this.hasValue())return 0;var n=this.value+"";if(n.match(/rem$/))return this.numValue()*this.getREM(t);if(n.match(/em$/))return this.numValue()*this.getEM(t);if(n.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(n.match(/px$/))return this.numValue();if(n.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(n.match(/pc$/))return 15*this.numValue();if(n.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(n.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(n.match(/in$/))return this.numValue()*this.getDPI(t);if(n.match(/%$/))return this.numValue()*o.ViewPort.ComputeSize(t);var r=this.numValue();return e&&r<1?r*o.ViewPort.ComputeSize(t):r},o.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/s$/)?1e3*this.numValue():(t.match(/ms$/),this.numValue())},o.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/deg$/)?this.numValue()*(Math.PI/180):t.match(/grad$/)?this.numValue()*(Math.PI/200):t.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var s={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return o.Property.prototype.toTextBaseline=function(){return this.hasValue()?s[this.value]:null},o.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,e,n,r,i,a){var s=null!=a?this.Parse(a):this.CreateFont("","","","","",o.ctx.font);return{fontFamily:i=i||s.fontFamily,fontSize:r||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:n||s.fontWeight,fontVariant:e||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(e){for(var n={},r=o.trim(o.compressSpaces(e||"")).split(" "),i={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<r.length;s++)i.fontStyle||-1==t.Styles.indexOf(r[s])?i.fontVariant||-1==t.Variants.indexOf(r[s])?i.fontWeight||-1==t.Weights.indexOf(r[s])?i.fontSize?"inherit"!=r[s]&&(a+=r[s]):("inherit"!=r[s]&&(n.fontSize=r[s].split("/")[0]),i.fontStyle=i.fontVariant=i.fontWeight=i.fontSize=!0):("inherit"!=r[s]&&(n.fontWeight=r[s]),i.fontStyle=i.fontVariant=i.fontWeight=!0):("inherit"!=r[s]&&(n.fontVariant=r[s]),i.fontStyle=i.fontVariant=!0):("inherit"!=r[s]&&(n.fontStyle=r[s]),i.fontStyle=!0);return""!=a&&(n.fontFamily=a),n}},o.ToNumberArray=function(t){for(var e=o.trim(o.compressSpaces((t||"").replace(/,/g," "))).split(" "),n=0;n<e.length;n++)e[n]=parseFloat(e[n]);return e},o.Point=function(t,e){this.x=t,this.y=e},o.Point.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},o.Point.prototype.applyTransform=function(t){var e=this.x*t[0]+this.y*t[2]+t[4],n=this.x*t[1]+this.y*t[3]+t[5];this.x=e,this.y=n},o.CreatePoint=function(t){var e=o.ToNumberArray(t);return new o.Point(e[0],e[1])},o.CreatePath=function(t){for(var e=o.ToNumberArray(t),n=[],r=0;r<e.length;r+=2)n.push(new o.Point(e[r],e[r+1]));return n},o.BoundingBox=function(t,e,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},this.addX=function(t){this.addPoint(t,null)},this.addY=function(t){this.addPoint(null,t)},this.addBoundingBox=function(t){this.addPoint(t.x1,t.y1),this.addPoint(t.x2,t.y2)},this.addQuadraticCurve=function(t,e,n,r,i,a){var o=t+2/3*(n-t),s=e+2/3*(r-e),u=o+1/3*(i-t),l=s+1/3*(a-e);this.addBezierCurve(t,e,o,u,s,l,i,a)},this.addBezierCurve=function(t,e,n,r,i,a,o,s){var u=[t,e],l=[n,r],c=[i,a],f=[o,s];this.addPoint(u[0],u[1]),this.addPoint(f[0],f[1]);for(var d=0;d<=1;d++){var h=function(t){return Math.pow(1-t,3)*u[d]+3*Math.pow(1-t,2)*t*l[d]+3*(1-t)*Math.pow(t,2)*c[d]+Math.pow(t,3)*f[d]},p=6*u[d]-12*l[d]+6*c[d],g=-3*u[d]+9*l[d]-9*c[d]+3*f[d],m=3*l[d]-3*u[d];if(0!=g){var y=Math.pow(p,2)-4*m*g;if(!(y<0)){var v=(-p+Math.sqrt(y))/(2*g);0<v&&v<1&&(0==d&&this.addX(h(v)),1==d&&this.addY(h(v)));var b=(-p-Math.sqrt(y))/(2*g);0<b&&b<1&&(0==d&&this.addX(h(b)),1==d&&this.addY(h(b)))}}else{if(0==p)continue;var x=-m/p;0<x&&x<1&&(0==d&&this.addX(h(x)),1==d&&this.addY(h(x)))}}},this.isPointInBox=function(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2},this.addPoint(t,e),this.addPoint(n,r)},o.Transform=function(t){var e=this;this.Type={},this.Type.translate=function(t){this.p=o.CreatePoint(t),this.apply=function(t){t.translate(this.p.x||0,this.p.y||0)},this.unapply=function(t){t.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(t){t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var e=o.ToNumberArray(t);this.angle=new o.Property("angle",e[0]),this.cx=e[1]||0,this.cy=e[2]||0,this.apply=function(t){t.translate(this.cx,this.cy),t.rotate(this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.unapply=function(t){t.translate(this.cx,this.cy),t.rotate(-1*this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.applyToPoint=function(t){var e=this.angle.toRadians();t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),t.applyTransform([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0]),t.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=o.CreatePoint(t),this.apply=function(t){t.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(t){t.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(t){t.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=o.ToNumberArray(t),this.apply=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(t){var e=this.m[0],n=this.m[2],r=this.m[4],i=this.m[1],a=this.m[3],o=this.m[5],s=1/(e*(1*a-0*o)-n*(1*i-0*o)+r*(0*i-0*a));t.transform(s*(1*a-0*o),s*(0*o-1*i),s*(0*r-1*n),s*(1*e-0*r),s*(n*o-r*a),s*(r*i-e*o))},this.applyToPoint=function(t){t.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=e.Type.matrix,this.base(t),this.angle=new o.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(t)},this.unapply=function(t){for(var e=this.transforms.length-1;0<=e;e--)this.transforms[e].unapply(t)},this.applyToPoint=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].applyToPoint(t)};for(var n=o.trim(o.compressSpaces(t)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),r=0;r<n.length;r++)if("none"!==n[r]){var i=o.trim(n[r].split("(")[0]),a=n[r].split("(")[1].replace(")",""),s=this.Type[i];if(void 0!==s){var u=new s(a);u.type=i,this.transforms.push(u)}}},o.AspectRatio=function(t,e,n,r,i,a,s,u,l,c){var f=(e=(e=o.compressSpaces(e)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",d=e.split(" ")[1]||"meet",h=n/r,p=i/a,g=Math.min(h,p),m=Math.max(h,p);"meet"==d&&(r*=g,a*=g),"slice"==d&&(r*=m,a*=m),l=new o.Property("refX",l),c=new o.Property("refY",c),l.hasValue()&&c.hasValue()?t.translate(-g*l.toPixels("x"),-g*c.toPixels("y")):(f.match(/^xMid/)&&("meet"==d&&g==p||"slice"==d&&m==p)&&t.translate(n/2-r/2,0),f.match(/YMid$/)&&("meet"==d&&g==h||"slice"==d&&m==h)&&t.translate(0,i/2-a/2),f.match(/^xMax/)&&("meet"==d&&g==p||"slice"==d&&m==p)&&t.translate(n-r,0),f.match(/YMax$/)&&("meet"==d&&g==h||"slice"==d&&m==h)&&t.translate(0,i-a)),"none"==f?t.scale(h,p):"meet"==d?t.scale(g,g):"slice"==d&&t.scale(m,m),t.translate(null==s?0:-s,null==u?0:-u)},o.Element={},o.EmptyProperty=new o.Property("EMPTY",""),o.Element.ElementBase=function(t){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(t,e){var n=this.attributes[t];return null!=n?n:(1==e&&(n=new o.Property(t,""),this.attributes[t]=n),n||o.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if("href"==t||t.match(/:href$/))return this.attributes[t];return o.EmptyProperty},this.style=function(t,e,n){var r=this.styles[t];if(null!=r)return r;var i=this.attribute(t);if(null!=i&&i.hasValue())return this.styles[t]=i;if(1!=n){var a=this.parent;if(null!=a){var s=a.style(t);if(null!=s&&s.hasValue())return s}}return 1==e&&(r=new o.Property(t,""),this.styles[t]=r),r||o.EmptyProperty},this.render=function(t){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(t.save(),this.style("mask").hasValue()){var e=this.style("mask").getDefinition();null!=e&&e.apply(t,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").getDefinition();null!=n&&n.apply(t,this)}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}},this.setContext=function(t){},this.clearContext=function(t){},this.renderChildren=function(t){for(var e=0;e<this.children.length;e++)this.children[e].render(t)},this.addChild=function(t,e){var n=t;e&&(n=o.CreateElement(t)),n.parent=this,"title"!=n.type&&this.children.push(n)},this.addStylesFromStyleDefinition=function(){for(var e in o.Styles)if("@"!=e[0]&&a(t,e)){var n=o.Styles[e],r=o.StylesSpecificity[e];if(null!=n)for(var i in n){var s=this.stylesSpecificity[i];void 0===s&&(s="000"),s<r&&(this.styles[i]=n[i],this.stylesSpecificity[i]=r)}}};var e,n=new RegExp("^[A-Z-]+$");if(null!=t&&1==t.nodeType){for(var r=0;r<t.attributes.length;r++){var i=t.attributes[r],s=(e=i.nodeName,n.test(e)?e.toLowerCase():e);this.attributes[s]=new o.Property(s,i.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var u=this.attribute("style").value.split(";");for(r=0;r<u.length;r++)if(""!=o.trim(u[r])){var l=u[r].split(":"),c=o.trim(l[0]),f=o.trim(l[1]);this.styles[c]=new o.Property(c,f)}}for(this.attribute("id").hasValue()&&null==o.Definitions[this.attribute("id").value]&&(o.Definitions[this.attribute("id").value]=this),r=0;r<t.childNodes.length;r++){var d=t.childNodes[r];if(1==d.nodeType&&this.addChild(d,!0),this.captureTextNodes&&(3==d.nodeType||4==d.nodeType)){var h=d.value||d.text||d.textContent||"";""!=o.compressSpaces(h)&&this.addChild(new o.Element.tspan(d),!1)}}}},o.Element.RenderedElementBase=function(t){this.base=o.Element.ElementBase,this.base(t),this.calculateOpacity=function(){for(var t=1,e=this;null!=e;){var n=e.style("opacity",!1,!0);n.hasValue()&&(t*=n.numValue()),e=e.parent}return t},this.setContext=function(t,e){if(!e){var n;if(this.style("fill").isUrlDefinition())null!=(n=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(t.fillStyle=n);else if(this.style("fill").hasValue()){var r;"currentColor"==(r=this.style("fill")).value&&(r.value=this.style("color").value),"inherit"!=r.value&&(t.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value)}if(this.style("fill-opacity").hasValue()&&(r=(r=new o.Property("fill",t.fillStyle)).addOpacity(this.style("fill-opacity")),t.fillStyle=r.value),this.style("stroke").isUrlDefinition())null!=(n=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(t.strokeStyle=n);else if(this.style("stroke").hasValue()){var i;"currentColor"==(i=this.style("stroke")).value&&(i.value=this.style("color").value),"inherit"!=i.value&&(t.strokeStyle="none"==i.value?"rgba(0,0,0,0)":i.value)}if(this.style("stroke-opacity").hasValue()&&(i=(i=new o.Property("stroke",t.strokeStyle)).addOpacity(this.style("stroke-opacity")),t.strokeStyle=i.value),this.style("stroke-width").hasValue()){var a=this.style("stroke-width").toPixels();t.lineWidth=0==a?.001:a}if(this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("paint-order").hasValue()&&(t.paintOrder=this.style("paint-order").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var s=o.ToNumberArray(this.style("stroke-dasharray").value);void 0!==t.setLineDash?t.setLineDash(s):void 0!==t.webkitLineDash?t.webkitLineDash=s:void 0===t.mozDash||1==s.length&&0==s[0]||(t.mozDash=s);var u=this.style("stroke-dashoffset").toPixels();void 0!==t.lineDashOffset?t.lineDashOffset=u:void 0!==t.webkitLineDashOffset?t.webkitLineDashOffset=u:void 0!==t.mozDashOffset&&(t.mozDashOffset=u)}}if(void 0!==t.font){t.font=o.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();var l=this.style("font-size",!1,!1);l.isPixels()&&(o.emSize=l.toPixels())}if(this.style("transform",!1,!0).hasValue()&&new o.Transform(this.style("transform",!1,!0).value).apply(t),this.style("clip-path",!1,!0).hasValue()){var c=this.style("clip-path",!1,!0).getDefinition();null!=c&&c.apply(t)}t.globalAlpha=this.calculateOpacity()}},o.Element.RenderedElementBase.prototype=new o.Element.ElementBase,o.Element.PathElementBase=function(t){this.base=o.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new o.BoundingBox},this.renderChildren=function(t){this.path(t),o.Mouse.checkPath(this,t),""!=t.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?t.fill(this.style("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()&&(n=this.style("marker-start").getDefinition()).render(t,e[0][0],e[0][1]),this.style("marker-mid").isUrlDefinition())for(var n=this.style("marker-mid").getDefinition(),r=1;r<e.length-1;r++)n.render(t,e[r][0],e[r][1]);this.style("marker-end").isUrlDefinition()&&(n=this.style("marker-end").getDefinition()).render(t,e[e.length-1][0],e[e.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},o.Element.PathElementBase.prototype=new o.Element.RenderedElementBase,o.Element.svg=function(t){this.base=o.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),o.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){if(t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,t.canvas.style&&void 0!==t.font&&void 0!==r.getComputedStyle){t.font=r.getComputedStyle(t.canvas).getPropertyValue("font");var e=new o.Property("fontSize",o.Font.Parse(t.font).fontSize);e.hasValue()&&(o.rootEmSize=o.emSize=e.toPixels("y"))}this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var n=o.ViewPort.width(),i=o.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){n=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");var a=0,s=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(a=-this.attribute("refX").toPixels("x"),s=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(t.beginPath(),t.moveTo(a,s),t.lineTo(n,s),t.lineTo(n,i),t.lineTo(a,i),t.closePath(),t.clip())}if(o.ViewPort.SetCurrent(n,i),this.attribute("viewBox").hasValue()){var u=o.ToNumberArray(this.attribute("viewBox").value),l=u[0],c=u[1];n=u[2],i=u[3],o.AspectRatio(t,this.attribute("preserveAspectRatio").value,o.ViewPort.width(),n,o.ViewPort.height(),i,l,c,this.attribute("refX").value,this.attribute("refY").value),o.ViewPort.RemoveCurrent(),o.ViewPort.SetCurrent(u[2],u[3])}}},o.Element.svg.prototype=new o.Element.RenderedElementBase,o.Element.rect=function(t){this.base=o.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y"),a=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=s),a=Math.min(a,r/2),s=Math.min(s,i/2),null!=t){var u=(Math.sqrt(2)-1)/3*4;t.beginPath(),t.moveTo(e+a,n),t.lineTo(e+r-a,n),t.bezierCurveTo(e+r-a+u*a,n,e+r,n+s-u*s,e+r,n+s),t.lineTo(e+r,n+i-s),t.bezierCurveTo(e+r,n+i-s+u*s,e+r-a+u*a,n+i,e+r-a,n+i),t.lineTo(e+a,n+i),t.bezierCurveTo(e+a-u*a,n+i,e,n+i-s+u*s,e,n+i-s),t.lineTo(e,n+s),t.bezierCurveTo(e,n+s-u*s,e+a-u*a,n,e+a,n),t.closePath()}return new o.BoundingBox(e,n,e+r,n+i)}},o.Element.rect.prototype=new o.Element.PathElementBase,o.Element.circle=function(t){this.base=o.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(e,n,r,0,2*Math.PI,!1),t.closePath()),new o.BoundingBox(e-r,n-r,e+r,n+r)}},o.Element.circle.prototype=new o.Element.PathElementBase,o.Element.ellipse=function(t){this.base=o.Element.PathElementBase,this.base(t),this.path=function(t){var e=(Math.sqrt(2)-1)/3*4,n=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y"),i=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(i+n,a),t.bezierCurveTo(i+n,a+e*r,i+e*n,a+r,i,a+r),t.bezierCurveTo(i-e*n,a+r,i-n,a+e*r,i-n,a),t.bezierCurveTo(i-n,a-e*r,i-e*n,a-r,i,a-r),t.bezierCurveTo(i+e*n,a-r,i+n,a-e*r,i+n,a),t.closePath()),new o.BoundingBox(i-n,a-r,i+n,a+r)}},o.Element.ellipse.prototype=new o.Element.PathElementBase,o.Element.line=function(t){this.base=o.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new o.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new o.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var e=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)),new o.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)},this.getMarkers=function(){var t=this.getPoints(),e=t[0].angleTo(t[1]);return[[t[0],e],[t[1],e]]}},o.Element.line.prototype=new o.Element.PathElementBase,o.Element.polyline=function(t){this.base=o.Element.PathElementBase,this.base(t),this.points=o.CreatePath(this.attribute("points").value),this.path=function(t){var e=new o.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var n=1;n<this.points.length;n++)e.addPoint(this.points[n].x,this.points[n].y),null!=t&&t.lineTo(this.points[n].x,this.points[n].y);return e},this.getMarkers=function(){for(var t=[],e=0;e<this.points.length-1;e++)t.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);return 0<t.length&&t.push([this.points[this.points.length-1],t[t.length-1][1]]),t}},o.Element.polyline.prototype=new o.Element.PathElementBase,o.Element.polygon=function(t){this.base=o.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(t){var e=this.basePath(t);return null!=t&&(t.lineTo(this.points[0].x,this.points[0].y),t.closePath()),e}},o.Element.polygon.prototype=new o.Element.polyline,o.Element.path=function(t){this.base=o.Element.PathElementBase,this.base(t);var e=this.attribute("d").value;e=e.replace(/,/gm," ");for(var n=0;n<2;n++)e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");for(e=(e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2"),n=0;n<2;n++)e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),e=o.compressSpaces(e),e=o.trim(e),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new o.Point(0,0),this.control=new o.Point(0,0),this.current=new o.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new o.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var t=this.getPoint();return this.control=t},this.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new o.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x+=this.current.x,t.y+=this.current.y),t},this.addMarker=function(t,e,n){null!=n&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(t,null==e?null:e.angleTo(t))},this.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null==this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!=this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles}}(e),this.path=function(t){var e=this.PathParser;e.reset();var n=new o.BoundingBox;for(null!=t&&t.beginPath();!e.isEnd();)switch(e.nextCommand(),e.command){case"M":case"m":var r=e.getAsCurrentPoint();for(e.addMarker(r),n.addPoint(r.x,r.y),null!=t&&t.moveTo(r.x,r.y),e.start=e.current;!e.isCommandOrEnd();)r=e.getAsCurrentPoint(),e.addMarker(r,e.start),n.addPoint(r.x,r.y),null!=t&&t.lineTo(r.x,r.y);break;case"L":case"l":for(;!e.isCommandOrEnd();){var i=e.current;r=e.getAsCurrentPoint(),e.addMarker(r,i),n.addPoint(r.x,r.y),null!=t&&t.lineTo(r.x,r.y)}break;case"H":case"h":for(;!e.isCommandOrEnd();){var a=new o.Point((e.isRelativeCommand()?e.current.x:0)+e.getScalar(),e.current.y);e.addMarker(a,e.current),e.current=a,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y)}break;case"V":case"v":for(;!e.isCommandOrEnd();)a=new o.Point(e.current.x,(e.isRelativeCommand()?e.current.y:0)+e.getScalar()),e.addMarker(a,e.current),e.current=a,n.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y);break;case"C":case"c":for(;!e.isCommandOrEnd();){var s=e.current,u=e.getPoint(),l=e.getAsControlPoint(),c=e.getAsCurrentPoint();e.addMarker(c,l,u),n.addBezierCurve(s.x,s.y,u.x,u.y,l.x,l.y,c.x,c.y),null!=t&&t.bezierCurveTo(u.x,u.y,l.x,l.y,c.x,c.y)}break;case"S":case"s":for(;!e.isCommandOrEnd();)s=e.current,u=e.getReflectedControlPoint(),l=e.getAsControlPoint(),c=e.getAsCurrentPoint(),e.addMarker(c,l,u),n.addBezierCurve(s.x,s.y,u.x,u.y,l.x,l.y,c.x,c.y),null!=t&&t.bezierCurveTo(u.x,u.y,l.x,l.y,c.x,c.y);break;case"Q":case"q":for(;!e.isCommandOrEnd();)s=e.current,l=e.getAsControlPoint(),c=e.getAsCurrentPoint(),e.addMarker(c,l,l),n.addQuadraticCurve(s.x,s.y,l.x,l.y,c.x,c.y),null!=t&&t.quadraticCurveTo(l.x,l.y,c.x,c.y);break;case"T":case"t":for(;!e.isCommandOrEnd();)s=e.current,l=e.getReflectedControlPoint(),e.control=l,c=e.getAsCurrentPoint(),e.addMarker(c,l,l),n.addQuadraticCurve(s.x,s.y,l.x,l.y,c.x,c.y),null!=t&&t.quadraticCurveTo(l.x,l.y,c.x,c.y);break;case"A":case"a":for(;!e.isCommandOrEnd();){s=e.current;var f=e.getScalar(),d=e.getScalar(),h=e.getScalar()*(Math.PI/180),p=e.getScalar(),g=e.getScalar(),m=(c=e.getAsCurrentPoint(),new o.Point(Math.cos(h)*(s.x-c.x)/2+Math.sin(h)*(s.y-c.y)/2,-Math.sin(h)*(s.x-c.x)/2+Math.cos(h)*(s.y-c.y)/2)),y=Math.pow(m.x,2)/Math.pow(f,2)+Math.pow(m.y,2)/Math.pow(d,2);1<y&&(f*=Math.sqrt(y),d*=Math.sqrt(y));var v=(p==g?-1:1)*Math.sqrt((Math.pow(f,2)*Math.pow(d,2)-Math.pow(f,2)*Math.pow(m.y,2)-Math.pow(d,2)*Math.pow(m.x,2))/(Math.pow(f,2)*Math.pow(m.y,2)+Math.pow(d,2)*Math.pow(m.x,2)));isNaN(v)&&(v=0);var b=new o.Point(v*f*m.y/d,v*-d*m.x/f),x=new o.Point((s.x+c.x)/2+Math.cos(h)*b.x-Math.sin(h)*b.y,(s.y+c.y)/2+Math.sin(h)*b.x+Math.cos(h)*b.y),_=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},w=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(_(t)*_(e))},E=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(w(t,e))},S=E([1,0],[(m.x-b.x)/f,(m.y-b.y)/d]),M=[(m.x-b.x)/f,(m.y-b.y)/d],T=[(-m.x-b.x)/f,(-m.y-b.y)/d],C=E(M,T);w(M,T)<=-1&&(C=Math.PI),1<=w(M,T)&&(C=0);var k=1-g?1:-1,A=S+k*(C/2),O=new o.Point(x.x+f*Math.cos(A),x.y+d*Math.sin(A));if(e.addMarkerAngle(O,A-k*Math.PI/2),e.addMarkerAngle(c,A-k*Math.PI),n.addPoint(c.x,c.y),null!=t){w=d<f?f:d;var P=d<f?1:f/d,L=d<f?d/f:1;t.translate(x.x,x.y),t.rotate(h),t.scale(P,L),t.arc(0,0,w,S,S+C,1-g),t.scale(1/P,1/L),t.rotate(-h),t.translate(-x.x,-x.y)}}break;case"Z":case"z":null!=t&&n.x1!==n.x2&&n.y1!==n.y2&&t.closePath(),e.current=e.start}return n},this.getMarkers=function(){for(var t=this.PathParser.getMarkerPoints(),e=this.PathParser.getMarkerAngles(),n=[],r=0;r<t.length;r++)n.push([t[r],e[r]]);return n}},o.Element.path.prototype=new o.Element.PathElementBase,o.Element.pattern=function(t){this.base=o.Element.ElementBase,this.base(t),this.createPattern=function(t,e){var n=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),a=new o.Element.svg;a.attributes.viewBox=new o.Property("viewBox",this.attribute("viewBox").value),a.attributes.width=new o.Property("width",n+"px"),a.attributes.height=new o.Property("height",r+"px"),a.attributes.transform=new o.Property("transform",this.attribute("patternTransform").value),a.children=this.children;var s=i();s.width=n,s.height=r;var u=s.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&u.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var l=-1;l<=1;l++)for(var c=-1;c<=1;c++)u.save(),a.attributes.x=new o.Property("x",l*s.width),a.attributes.y=new o.Property("y",c*s.height),a.render(u),u.restore();return t.createPattern(s,"repeat")}},o.Element.pattern.prototype=new o.Element.ElementBase,o.Element.marker=function(t){this.base=o.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,e,n){if(e){t.translate(e.x,e.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(n),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var r=new o.Element.svg;r.attributes.viewBox=new o.Property("viewBox",this.attribute("viewBox").value),r.attributes.refX=new o.Property("refX",this.attribute("refX").value),r.attributes.refY=new o.Property("refY",this.attribute("refY").value),r.attributes.width=new o.Property("width",this.attribute("markerWidth").value),r.attributes.height=new o.Property("height",this.attribute("markerHeight").value),r.attributes.fill=new o.Property("fill",this.attribute("fill").valueOrDefault("black")),r.attributes.stroke=new o.Property("stroke",this.attribute("stroke").valueOrDefault("none")),r.children=this.children,r.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-n),t.translate(-e.x,-e.y)}}},o.Element.marker.prototype=new o.Element.ElementBase,o.Element.defs=function(t){this.base=o.Element.ElementBase,this.base(t),this.render=function(t){}},o.Element.defs.prototype=new o.Element.ElementBase,o.Element.GradientBase=function(t){this.base=o.Element.ElementBase,this.base(t),this.stops=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"stop"==n.type&&this.stops.push(n)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(t){for(var e=0;e<this.attributesToInherit.length;e++){var n=this.attributesToInherit[e];!this.attribute(n).hasValue()&&t.attribute(n).hasValue()&&(this.attribute(n,!0).value=t.attribute(n).value)}},this.createGradient=function(t,e,n){var r=this;this.getHrefAttribute().hasValue()&&(r=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(r));var a=function(t){return n.hasValue()?new o.Property("color",t).addOpacity(n).value:t},s=this.getGradient(t,e);if(null==s)return a(r.stops[r.stops.length-1].color);for(var u=0;u<r.stops.length;u++)s.addColorStop(r.stops[u].offset,a(r.stops[u].color));if(this.attribute("gradientTransform").hasValue()){var l=o.ViewPort.viewPorts[0],c=new o.Element.rect;c.attributes.x=new o.Property("x",-o.MAX_VIRTUAL_PIXELS/3),c.attributes.y=new o.Property("y",-o.MAX_VIRTUAL_PIXELS/3),c.attributes.width=new o.Property("width",o.MAX_VIRTUAL_PIXELS),c.attributes.height=new o.Property("height",o.MAX_VIRTUAL_PIXELS);var f=new o.Element.g;f.attributes.transform=new o.Property("transform",this.attribute("gradientTransform").value),f.children=[c];var d=new o.Element.svg;d.attributes.x=new o.Property("x",0),d.attributes.y=new o.Property("y",0),d.attributes.width=new o.Property("width",l.width),d.attributes.height=new o.Property("height",l.height),d.children=[f];var h=i();h.width=l.width,h.height=l.height;var p=h.getContext("2d");return p.fillStyle=s,d.render(p),p.createPattern(h,"no-repeat")}return s}},o.Element.GradientBase.prototype=new o.Element.ElementBase,o.Element.linearGradient=function(t){this.base=o.Element.GradientBase,this.base(t),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(t,e){var n="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox(t):null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var r="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),i="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),a="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),o="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return r==a&&i==o?null:t.createLinearGradient(r,i,a,o)}},o.Element.linearGradient.prototype=new o.Element.GradientBase,o.Element.radialGradient=function(t){this.base=o.Element.GradientBase,this.base(t),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(t,e){var n=e.getBoundingBox(t);this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var r="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),i="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),a=r,o=i;this.attribute("fx").hasValue()&&(a="objectBoundingBox"==this.gradientUnits()?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(o="objectBoundingBox"==this.gradientUnits()?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits()?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return t.createRadialGradient(a,o,0,r,i,s)}},o.Element.radialGradient.prototype=new o.Element.GradientBase,o.Element.stop=function(t){this.base=o.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);var e=this.style("stop-color",!0);""===e.value&&(e.value="#000"),this.style("stop-opacity").hasValue()&&(e=e.addOpacity(this.style("stop-opacity"))),this.color=e.value},o.Element.stop.prototype=new o.Element.ElementBase,o.Element.AnimateBase=function(t){this.base=o.Element.ElementBase,this.base(t),o.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var t=this.attribute("attributeType").value,e=this.attribute("attributeName").value;return"CSS"==t?this.parent.style(e,!0):this.parent.attribute(e,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(t){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+t;var e=!1;if(this.begin<this.duration){var n=this.calcValue();this.attribute("type").hasValue()&&(n=this.attribute("type").value+"("+n+")"),this.getProperty().value=n,e=!0}return e},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var e=t.progress*(this.values.value.length-1),n=Math.floor(e),r=Math.ceil(e);t.from=new o.Property("from",parseFloat(this.values.value[n])),t.to=new o.Property("to",parseFloat(this.values.value[r])),t.progress=(e-n)/(r-n)}else t.from=this.from,t.to=this.to;return t}},o.Element.AnimateBase.prototype=new o.Element.ElementBase,o.Element.animate=function(t){this.base=o.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress();return t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress+this.initialUnits}},o.Element.animate.prototype=new o.Element.AnimateBase,o.Element.animateColor=function(e){this.base=o.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress(),n=new t(e.from.value),r=new t(e.to.value);if(n.ok&&r.ok){var i=n.r+(r.r-n.r)*e.progress,a=n.g+(r.g-n.g)*e.progress,o=n.b+(r.b-n.b)*e.progress;return"rgb("+parseInt(i,10)+","+parseInt(a,10)+","+parseInt(o,10)+")"}return this.attribute("from").value}},o.Element.animateColor.prototype=new o.Element.AnimateBase,o.Element.animateTransform=function(t){this.base=o.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),e=o.ToNumberArray(t.from.value),n=o.ToNumberArray(t.to.value),r="",i=0;i<e.length;i++)r+=e[i]+(n[i]-e[i])*t.progress+" ";return r}},o.Element.animateTransform.prototype=new o.Element.animate,o.Element.font=function(t){this.base=o.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var e=0;e<this.children.length;e++){var n=this.children[e];"font-face"==n.type?(this.fontFace=n).style("font-family").hasValue()&&(o.Definitions[n.style("font-family").value]=this):"missing-glyph"==n.type?this.missingGlyph=n:"glyph"==n.type&&(""!=n.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[n.unicode]&&(this.glyphs[n.unicode]=[]),this.glyphs[n.unicode][n.arabicForm]=n):this.glyphs[n.unicode]=n)}},o.Element.font.prototype=new o.Element.ElementBase,o.Element.fontface=function(t){this.base=o.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},o.Element.fontface.prototype=new o.Element.ElementBase,o.Element.missingglyph=function(t){this.base=o.Element.path,this.base(t),this.horizAdvX=0},o.Element.missingglyph.prototype=new o.Element.path,o.Element.glyph=function(t){this.base=o.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},o.Element.glyph.prototype=new o.Element.path,o.Element.text=function(t){this.captureTextNodes=!0,this.base=o.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t);var e=this.style("dominant-baseline").toTextBaseline();null==e&&(e=this.style("alignment-baseline").toTextBaseline()),null!=e&&(t.textBaseline=e)},this.initializeCoordinates=function(t){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(t,this,0)},this.getBoundingBox=function(t){this.initializeCoordinates(t);for(var e=null,n=0;n<this.children.length;n++){var r=this.getChildBoundingBox(t,this,this,n);null==e?e=r:e.addBoundingBox(r)}return e},this.renderChildren=function(t){this.initializeCoordinates(t);for(var e=0;e<this.children.length;e++)this.renderChild(t,this,this,e)},this.getAnchorDelta=function(t,e,n){var r=this.style("text-anchor").valueOrDefault("start");if("start"!=r){for(var i=0,a=n;a<e.children.length;a++){var o=e.children[a];if(n<a&&o.attribute("x").hasValue())break;i+=o.measureTextRecursive(t)}return-1*("end"==r?i:i/2)}return 0},this.adjustChildCoordinates=function(t,e,n,r){var i=n.children[r];return i.attribute("x").hasValue()?(i.x=i.attribute("x").toPixels("x")+e.getAnchorDelta(t,n,r),i.attribute("dx").hasValue()&&(i.x+=i.attribute("dx").toPixels("x"))):(i.attribute("dx").hasValue()&&(e.x+=i.attribute("dx").toPixels("x")),i.x=e.x),e.x=i.x+i.measureText(t),i.attribute("y").hasValue()?(i.y=i.attribute("y").toPixels("y"),i.attribute("dy").hasValue()&&(i.y+=i.attribute("dy").toPixels("y"))):(i.attribute("dy").hasValue()&&(e.y+=i.attribute("dy").toPixels("y")),i.y=e.y),e.y=i.y,i},this.getChildBoundingBox=function(t,e,n,r){var i=this.adjustChildCoordinates(t,e,n,r),a=i.getBoundingBox(t);for(r=0;r<i.children.length;r++){var o=e.getChildBoundingBox(t,e,i,r);a.addBoundingBox(o)}return a},this.renderChild=function(t,e,n,r){var i=this.adjustChildCoordinates(t,e,n,r);for(i.render(t),r=0;r<i.children.length;r++)e.renderChild(t,e,i,r)}},o.Element.text.prototype=new o.Element.RenderedElementBase,o.Element.TextElementBase=function(t){this.base=o.Element.RenderedElementBase,this.base(t),this.getGlyph=function(t,e,n){var r=e[n],i=null;if(t.isArabic){var a="isolated";(0==n||" "==e[n-1])&&n<e.length-2&&" "!=e[n+1]&&(a="terminal"),0<n&&" "!=e[n-1]&&n<e.length-2&&" "!=e[n+1]&&(a="medial"),0<n&&" "!=e[n-1]&&(n==e.length-1||" "==e[n+1])&&(a="initial"),void 0!==t.glyphs[r]&&null==(i=t.glyphs[r][a])&&"glyph"==t.glyphs[r].type&&(i=t.glyphs[r])}else i=t.glyphs[r];return null==i&&(i=t.missingGlyph),i},this.renderChildren=function(t){var e=this.parent.style("font-family").getDefinition();if(null==e)"stroke"==t.paintOrder?(""!=t.strokeStyle&&t.strokeText(o.compressSpaces(this.getText()),this.x,this.y),""!=t.fillStyle&&t.fillText(o.compressSpaces(this.getText()),this.x,this.y)):(""!=t.fillStyle&&t.fillText(o.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(o.compressSpaces(this.getText()),this.x,this.y));else{var n=this.parent.style("font-size").numValueOrDefault(o.Font.Parse(o.ctx.font).fontSize),r=this.parent.style("font-style").valueOrDefault(o.Font.Parse(o.ctx.font).fontStyle),i=this.getText();e.isRTL&&(i=i.split("").reverse().join(""));for(var a=o.ToNumberArray(this.parent.attribute("dx").value),s=0;s<i.length;s++){var u=this.getGlyph(e,i,s),l=n/e.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(l,-l);var c=t.lineWidth;t.lineWidth=t.lineWidth*e.fontFace.unitsPerEm/n,"italic"==r&&t.transform(1,0,.4,1,0,0),u.render(t),"italic"==r&&t.transform(1,0,-.4,1,0,0),t.lineWidth=c,t.scale(1/l,-1/l),t.translate(-this.x,-this.y),this.x+=n*(u.horizAdvX||e.horizAdvX)/e.fontFace.unitsPerEm,void 0===a[s]||isNaN(a[s])||(this.x+=a[s])}}},this.getText=function(){},this.measureTextRecursive=function(t){for(var e=this.measureText(t),n=0;n<this.children.length;n++)e+=this.children[n].measureTextRecursive(t);return e},this.measureText=function(t){var e=this.parent.style("font-family").getDefinition();if(null!=e){var n=this.parent.style("font-size").numValueOrDefault(o.Font.Parse(o.ctx.font).fontSize),r=0,i=this.getText();e.isRTL&&(i=i.split("").reverse().join(""));for(var a=o.ToNumberArray(this.parent.attribute("dx").value),s=0;s<i.length;s++)r+=(this.getGlyph(e,i,s).horizAdvX||e.horizAdvX)*n/e.fontFace.unitsPerEm,void 0===a[s]||isNaN(a[s])||(r+=a[s]);return r}var u=o.compressSpaces(this.getText());if(!t.measureText)return 10*u.length;t.save(),this.setContext(t,!0);var l=t.measureText(u).width;return t.restore(),l},this.getBoundingBox=function(t){var e=this.parent.style("font-size").numValueOrDefault(o.Font.Parse(o.ctx.font).fontSize);return new o.BoundingBox(this.x,this.y-e,this.x+this.measureText(t),this.y)}},o.Element.TextElementBase.prototype=new o.Element.RenderedElementBase,o.Element.tspan=function(t){this.captureTextNodes=!0,this.base=o.Element.TextElementBase,this.base(t),this.text=o.compressSpaces(t.value||t.text||t.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},o.Element.tspan.prototype=new o.Element.TextElementBase,o.Element.tref=function(t){this.base=o.Element.TextElementBase,this.base(t),this.getText=function(){var t=this.getHrefAttribute().getDefinition();if(null!=t)return t.children[0].getText()}},o.Element.tref.prototype=new o.Element.TextElementBase,o.Element.a=function(t){this.base=o.Element.TextElementBase,this.base(t),this.hasText=0<t.childNodes.length;for(var e=0;e<t.childNodes.length;e++)3!=t.childNodes[e].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].value||t.childNodes[0].data:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var e=new o.Property("fontSize",o.Font.Parse(o.ctx.font).fontSize);o.Mouse.checkBoundingBox(this,new o.BoundingBox(this.x,this.y-e.toPixels("y"),this.x+this.measureText(t),this.y))}else if(0<this.children.length){var n=new o.Element.g;n.children=this.children,n.parent=this,n.render(t)}},this.onclick=function(){r.open(this.getHrefAttribute().value)},this.onmousemove=function(){o.ctx.canvas.style.cursor="pointer"}},o.Element.a.prototype=new o.Element.TextElementBase,o.Element.image=function(t){this.base=o.Element.RenderedElementBase,this.base(t);var e=this.getHrefAttribute().value;if(""!=e){var n=e.match(/\.svg$/);if(o.Images.push(this),this.loaded=!1,n)this.img=o.ajax(e),this.loaded=!0;else{this.img=document.createElement("img"),1==o.opts.useCORS&&(this.img.crossOrigin="Anonymous");var r=this;this.img.onload=function(){r.loaded=!0},this.img.onerror=function(){o.log('ERROR: image "'+e+'" not found'),r.loaded=!0},this.img.src=e}this.renderChildren=function(t){var e=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y");0!=a&&0!=s&&(t.save(),n?t.drawSvg(this.img,e,i,a,s):(t.translate(e,i),o.AspectRatio(t,this.attribute("preserveAspectRatio").value,a,this.img.width,s,this.img.height,0,0),r.loaded&&(void 0===this.img.complete||this.img.complete)&&t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");return new o.BoundingBox(t,e,t+n,e+r)}}},o.Element.image.prototype=new o.Element.RenderedElementBase,o.Element.g=function(t){this.base=o.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(t){for(var e=new o.BoundingBox,n=0;n<this.children.length;n++)e.addBoundingBox(this.children[n].getBoundingBox(t));return e}},o.Element.g.prototype=new o.Element.RenderedElementBase,o.Element.symbol=function(t){this.base=o.Element.RenderedElementBase,this.base(t),this.render=function(t){}},o.Element.symbol.prototype=new o.Element.RenderedElementBase,o.Element.style=function(t){this.base=o.Element.ElementBase,this.base(t);for(var e="",n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].data;e=e.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var r=(e=o.compressSpaces(e)).split("}");for(n=0;n<r.length;n++)if(""!=o.trim(r[n]))for(var i=r[n].split("{"),a=i[0].split(","),s=i[1].split(";"),u=0;u<a.length;u++){var l=o.trim(a[u]);if(""!=l){for(var c=o.Styles[l]||{},f=0;f<s.length;f++){var d=s[f].indexOf(":"),h=s[f].substr(0,d),g=s[f].substr(d+1,s[f].length-d);null!=h&&null!=g&&(c[o.trim(h)]=new o.Property(o.trim(h),o.trim(g)))}if(o.Styles[l]=c,o.StylesSpecificity[l]=p(l),"@font-face"==l)for(var m=c["font-family"].value.replace(/"/g,""),y=c.src.value.split(","),v=0;v<y.length;v++)if(0<y[v].indexOf('format("svg")'))for(var b=y[v].indexOf("url"),x=y[v].indexOf(")",b),_=y[v].substr(b+5,x-b-6),w=o.parseXml(o.ajax(_)).getElementsByTagName("font"),E=0;E<w.length;E++){var S=o.CreateElement(w[E]);o.Definitions[m]=S}}}},o.Element.style.prototype=new o.Element.ElementBase,o.Element.use=function(t){this.base=o.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.attribute("x").hasValue()&&t.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&t.translate(0,this.attribute("y").toPixels("y"))};var e=this.getHrefAttribute().getDefinition();this.path=function(t){null!=e&&e.path(t)},this.elementTransform=function(){if(null!=e&&e.style("transform",!1,!0).hasValue())return new o.Transform(e.style("transform",!1,!0).value)},this.getBoundingBox=function(t){if(null!=e)return e.getBoundingBox(t)},this.renderChildren=function(t){if(null!=e){var n=e;"symbol"==e.type&&((n=new o.Element.svg).type="svg",n.attributes.viewBox=new o.Property("viewBox",e.attribute("viewBox").value),n.attributes.preserveAspectRatio=new o.Property("preserveAspectRatio",e.attribute("preserveAspectRatio").value),n.attributes.overflow=new o.Property("overflow",e.attribute("overflow").value),n.children=e.children),"svg"==n.type&&(this.attribute("width").hasValue()&&(n.attributes.width=new o.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(n.attributes.height=new o.Property("height",this.attribute("height").value)));var r=n.parent;n.parent=null,n.render(t),n.parent=r}}},o.Element.use.prototype=new o.Element.RenderedElementBase,o.Element.mask=function(t){this.base=o.Element.ElementBase,this.base(t),this.apply=function(t,e){var n=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y");if(0==a&&0==s){for(var u=new o.BoundingBox,l=0;l<this.children.length;l++)u.addBoundingBox(this.children[l].getBoundingBox(t));n=Math.floor(u.x1),r=Math.floor(u.y1),a=Math.floor(u.width()),s=Math.floor(u.height())}var c=e.attribute("mask").value;e.attribute("mask").value="";var f=i();f.width=n+a,f.height=r+s;var d=f.getContext("2d");this.renderChildren(d);var h=i();h.width=n+a,h.height=r+s;var p=h.getContext("2d");e.render(p),p.globalCompositeOperation="destination-in",p.fillStyle=d.createPattern(f,"no-repeat"),p.fillRect(0,0,n+a,r+s),t.fillStyle=p.createPattern(h,"no-repeat"),t.fillRect(0,0,n+a,r+s),e.attribute("mask").value=c},this.render=function(t){}},o.Element.mask.prototype=new o.Element.ElementBase,o.Element.clipPath=function(t){this.base=o.Element.ElementBase,this.base(t),this.apply=function(t){var e="undefined"!=typeof CanvasRenderingContext2D,n=t.beginPath,r=t.closePath;e&&(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath=function(){}),n.call(t);for(var i=0;i<this.children.length;i++){var a=this.children[i];if(void 0!==a.path){var s=void 0!==a.elementTransform&&a.elementTransform();!s&&a.style("transform",!1,!0).hasValue()&&(s=new o.Transform(a.style("transform",!1,!0).value)),s&&s.apply(t),a.path(t),e&&(CanvasRenderingContext2D.prototype.closePath=r),s&&s.unapply(t)}}r.call(t),t.clip(),e&&(CanvasRenderingContext2D.prototype.beginPath=n,CanvasRenderingContext2D.prototype.closePath=r)},this.render=function(t){}},o.Element.clipPath.prototype=new o.Element.ElementBase,o.Element.filter=function(t){this.base=o.Element.ElementBase,this.base(t),this.apply=function(t,e){var n=e.getBoundingBox(t),r=Math.floor(n.x1),a=Math.floor(n.y1),o=Math.floor(n.width()),s=Math.floor(n.height()),u=e.style("filter").value;e.style("filter").value="";for(var l=0,c=0,f=0;f<this.children.length;f++){var d=this.children[f].extraFilterDistance||0;l=Math.max(l,d),c=Math.max(c,d)}var h=i();h.width=o+2*l,h.height=s+2*c;var p=h.getContext("2d");for(p.translate(-r+l,-a+c),e.render(p),f=0;f<this.children.length;f++)"function"==typeof this.children[f].apply&&this.children[f].apply(p,0,0,o+2*l,s+2*c);t.drawImage(h,0,0,o+2*l,s+2*c,r-l,a-c,o+2*l,s+2*c),e.style("filter",!0).value=u},this.render=function(t){}},o.Element.filter.prototype=new o.Element.ElementBase,o.Element.feMorphology=function(t){this.base=o.Element.ElementBase,this.base(t),this.apply=function(t,e,n,r,i){}},o.Element.feMorphology.prototype=new o.Element.ElementBase,o.Element.feComposite=function(t){this.base=o.Element.ElementBase,this.base(t),this.apply=function(t,e,n,r,i){}},o.Element.feComposite.prototype=new o.Element.ElementBase,o.Element.feColorMatrix=function(t){this.base=o.Element.ElementBase,this.base(t);var e=o.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var n=e[0];e=[.213+.787*n,.715-.715*n,.072-.072*n,0,0,.213-.213*n,.715+.285*n,.072-.072*n,0,0,.213-.213*n,.715-.715*n,.072+.928*n,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=e[0]*Math.PI/180,i=function(t,e,n){return t+Math.cos(r)*e+Math.sin(r)*n};e=[i(.213,.787,-.213),i(.715,-.715,-.715),i(.072,-.072,.928),0,0,i(.213,-.213,.143),i(.715,.285,.14),i(.072,-.072,-.283),0,0,i(.213,-.213,-.787),i(.715,-.715,.715),i(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function a(t,e,n,r,i,a){return t[n*r*4+4*e+a]}function s(t,e,n,r,i,a,o){t[n*r*4+4*e+a]=o}function u(t,n){var r=e[t];return r*(r<0?n-255:n)}this.apply=function(t,e,n,r,i){var o=t.getImageData(0,0,r,i);for(n=0;n<i;n++)for(e=0;e<r;e++){var l=a(o.data,e,n,r,0,0),c=a(o.data,e,n,r,0,1),f=a(o.data,e,n,r,0,2),d=a(o.data,e,n,r,0,3);s(o.data,e,n,r,0,0,u(0,l)+u(1,c)+u(2,f)+u(3,d)+u(4,1)),s(o.data,e,n,r,0,1,u(5,l)+u(6,c)+u(7,f)+u(8,d)+u(9,1)),s(o.data,e,n,r,0,2,u(10,l)+u(11,c)+u(12,f)+u(13,d)+u(14,1)),s(o.data,e,n,r,0,3,u(15,l)+u(16,c)+u(17,f)+u(18,d)+u(19,1))}t.clearRect(0,0,r,i),t.putImageData(o,0,0)}},o.Element.feColorMatrix.prototype=new o.Element.ElementBase,o.Element.feGaussianBlur=function(t){this.base=o.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,n,r,i,a){e&&void 0!==e.canvasRGBA?(t.canvas.id=o.UniqueId(),t.canvas.style.display="none",document.body.appendChild(t.canvas),e.canvasRGBA(t.canvas,n,r,i,a,this.blurRadius),document.body.removeChild(t.canvas)):o.log("ERROR: StackBlur.js must be included for blur to work")}},o.Element.feGaussianBlur.prototype=new o.Element.ElementBase,o.Element.title=function(t){},o.Element.title.prototype=new o.Element.ElementBase,o.Element.desc=function(t){},o.Element.desc.prototype=new o.Element.ElementBase,o.Element.MISSING=function(t){o.log("ERROR: Element '"+t.nodeName+"' not yet implemented.")},o.Element.MISSING.prototype=new o.Element.ElementBase,o.CreateElement=function(t){var e=t.nodeName.replace(/^[^:]+:/,"");e=e.replace(/\-/g,"");var n=null;return(n=void 0!==o.Element[e]?new o.Element[e](t):new o.Element.MISSING(t)).type=t.nodeName,n},o.load=function(t,e){o.loadXml(t,o.ajax(e))},o.loadXml=function(t,e){o.loadXmlDoc(t,o.parseXml(e))},o.loadXmlDoc=function(t,e){o.init(t);var n=function(e){for(var n=t.canvas;n;)e.x-=n.offsetLeft,e.y-=n.offsetTop,n=n.offsetParent;return r.scrollX&&(e.x+=r.scrollX),r.scrollY&&(e.y+=r.scrollY),e};1!=o.opts.ignoreMouse&&(t.canvas.onclick=function(t){var e=n(new o.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));o.Mouse.onclick(e.x,e.y)},t.canvas.onmousemove=function(t){var e=n(new o.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));o.Mouse.onmousemove(e.x,e.y)});var i=o.CreateElement(e.documentElement);i.root=!0,i.addStylesFromStyleDefinition();var a=!0,s=function(){o.ViewPort.Clear(),t.canvas.parentNode?o.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight):o.ViewPort.SetCurrent(800,600),1!=o.opts.ignoreDimensions&&(i.style("width").hasValue()&&(t.canvas.width=i.style("width").toPixels("x"),t.canvas.style&&(t.canvas.style.width=t.canvas.width+"px")),i.style("height").hasValue()&&(t.canvas.height=i.style("height").toPixels("y"),t.canvas.style&&(t.canvas.style.height=t.canvas.height+"px")));var n=t.canvas.clientWidth||t.canvas.width,r=t.canvas.clientHeight||t.canvas.height;if(1==o.opts.ignoreDimensions&&i.style("width").hasValue()&&i.style("height").hasValue()&&(n=i.style("width").toPixels("x"),r=i.style("height").toPixels("y")),o.ViewPort.SetCurrent(n,r),null!=o.opts.offsetX&&(i.attribute("x",!0).value=o.opts.offsetX),null!=o.opts.offsetY&&(i.attribute("y",!0).value=o.opts.offsetY),null!=o.opts.scaleWidth||null!=o.opts.scaleHeight){var s=null,u=null,l=o.ToNumberArray(i.attribute("viewBox").value);null!=o.opts.scaleWidth&&(i.attribute("width").hasValue()?s=i.attribute("width").toPixels("x")/o.opts.scaleWidth:isNaN(l[2])||(s=l[2]/o.opts.scaleWidth)),null!=o.opts.scaleHeight&&(i.attribute("height").hasValue()?u=i.attribute("height").toPixels("y")/o.opts.scaleHeight:isNaN(l[3])||(u=l[3]/o.opts.scaleHeight)),null==s&&(s=u),null==u&&(u=s),i.attribute("width",!0).value=o.opts.scaleWidth,i.attribute("height",!0).value=o.opts.scaleHeight,i.style("transform",!0,!0).value+=" scale("+1/s+","+1/u+")"}1!=o.opts.ignoreClear&&t.clearRect(0,0,n,r),i.render(t),a&&(a=!1,"function"==typeof o.opts.renderCallback&&o.opts.renderCallback(e))},u=!0;o.ImagesLoaded()&&(u=!1,s()),o.intervalID=setInterval(function(){var t=!1;if(u&&o.ImagesLoaded()&&(t=!(u=!1)),1!=o.opts.ignoreMouse&&(t|=o.Mouse.hasEvents()),1!=o.opts.ignoreAnimation)for(var e=0;e<o.Animations.length;e++)t|=o.Animations[e].update(1e3/o.FRAMERATE);"function"==typeof o.opts.forceRedraw&&1==o.opts.forceRedraw()&&(t=!0),t&&(s(),o.Mouse.runEvents())},1e3/o.FRAMERATE)},o.stop=function(){o.intervalID&&clearInterval(o.intervalID)},o.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(t,e){this.events.push({type:"onclick",x:t,y:e,run:function(t){t.onclick&&t.onclick()}})},this.onmousemove=function(t,e){this.events.push({type:"onmousemove",x:t,y:e,run:function(t){t.onmousemove&&t.onmousemove()}})},this.eventElements=[],this.checkPath=function(t,e){for(var n=0;n<this.events.length;n++){var r=this.events[n];e.isPointInPath&&e.isPointInPath(r.x,r.y)&&(this.eventElements[n]=t)}},this.checkBoundingBox=function(t,e){for(var n=0;n<this.events.length;n++){var r=this.events[n];e.isPointInBox(r.x,r.y)&&(this.eventElements[n]=t)}},this.runEvents=function(){o.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var e=this.events[t],n=this.eventElements[t];n;)e.run(n),n=n.parent;this.events=[],this.eventElements=[]}},o}(u||{});"string"==typeof n&&(n=document.getElementById(n)),null!=n.svg&&n.svg.stop(),n.childNodes&&1==n.childNodes.length&&"OBJECT"==n.childNodes[0].nodeName||(n.svg=l);var c=n.getContext("2d");void 0!==s.documentElement?l.loadXmlDoc(c,s):"<"==s.substr(0,1)?l.loadXml(c,s):l.load(c,s)}else for(var f=document.querySelectorAll("svg"),d=0;d<f.length;d++){var h=f[d],g=document.createElement("canvas");g.width=h.clientWidth,g.height=h.clientHeight,h.parentNode.insertBefore(g,h),h.parentNode.removeChild(h);var m=document.createElement("div");m.appendChild(h),o(g,m.innerHTML)}};"undefined"==typeof Element||(void 0!==Element.prototype.matches?a=function(t,e){return t.matches(e)}:void 0!==Element.prototype.webkitMatchesSelector?a=function(t,e){return t.webkitMatchesSelector(e)}:void 0!==Element.prototype.mozMatchesSelector?a=function(t,e){return t.mozMatchesSelector(e)}:void 0!==Element.prototype.msMatchesSelector?a=function(t,e){return t.msMatchesSelector(e)}:void 0!==Element.prototype.oMatchesSelector?a=function(t,e){return t.oMatchesSelector(e)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(a=function(t,e){return $(t).is(e)}),void 0===a&&"undefined"!=typeof Sizzle&&(a=Sizzle.matchesSelector)));var s=/(\[[^\]]+\])/g,u=/(#[^\s\+>~\.\[:]+)/g,l=/(\.[^\s\+>~\.\[:]+)/g,c=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,f=/(:[\w-]+\([^\)]*\))/gi,d=/(:[^\s\+>~\.\[:]+)/g,h=/([^\s\+>~\.\[:]+)/g;function p(t){var e=[0,0,0],n=function(n,r){var i=t.match(n);null!=i&&(e[r]+=i.length,t=t.replace(n," "))};return t=(t=t.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[\s\S]*/gm," "),n(s,1),n(u,0),n(l,1),n(c,2),n(f,1),n(d,1),t=(t=t.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),n(h,2),e.join("")}"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(t,e,n,r,i,a){var s={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:e,offsetY:n,scaleWidth:r,scaleHeight:i};for(var u in a)a.hasOwnProperty(u)&&(s[u]=a[u]);o(this.canvas,t,s)}),n.exports=o}(n={exports:{}}),n.exports}(n(22),n(23))},function(t,e,n){(function(n){var r,i,a;i=[],void 0===(a="function"==typeof(r=function(){"use strict";function e(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){o(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function r(t){var e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),200<=e.status&&299>=e.status}function i(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,o=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(t,n,o){var s=a.URL||a.webkitURL,u=document.createElement("a");n=n||t.name||"download",u.download=n,u.rel="noopener","string"==typeof t?(u.href=t,u.origin===location.origin?i(u):r(u.href)?e(t,n,o):i(u,u.target="_blank")):(u.href=s.createObjectURL(t),setTimeout(function(){s.revokeObjectURL(u.href)},4e4),setTimeout(function(){i(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,n,a){if(n=n||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,a),n);else if(r(t))e(t,n,a);else{var o=document.createElement("a");o.href=t,o.target="_blank",setTimeout(function(){i(o)})}}:function(t,n,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,r);var o="application/octet-stream"===t.type,s=/constructor/i.test(a.HTMLElement)||a.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||o&&s)&&"object"==typeof FileReader){var l=new FileReader;l.onloadend=function(){var t=l.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=t:location=t,i=null},l.readAsDataURL(t)}else{var c=a.URL||a.webkitURL,f=c.createObjectURL(t);i?i.location=f:location.href=f,i=null,setTimeout(function(){c.revokeObjectURL(f)},4e4)}});a.saveAs=o.saveAs=o,t.exports=o})?r.apply(e,i):r)||(t.exports=a)}).call(this,n(24))},function(t,e,n){(t.exports=n(25)(!1)).push([t.i,"body > * {\n    visibility: hidden;\n}\nbody {\n    overflow: hidden;\n}\nbody * {\n    visibility: hidden !important;\n}\n\n.tau-chart__print-block {\n    position: absolute;\n    top: 0;\n    left: 0;\n    visibility: visible !important;\n    display: block !important;\n    width: 100%;\n    /*height: 100%;*/\n}\n",""])},,function(t,e,n){t.exports=n(26)},function(t,e){t.exports=function(t){this.ok=!1,this.alpha=1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t=(t=t.replace(/ /g,"")).toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};t=e[t]||t;for(var n=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseFloat(t[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],r=0;r<n.length;r++){var i=n[r].re,a=n[r].process,o=i.exec(t);if(o){var s=a(o);this.r=s[0],this.g=s[1],this.b=s[2],s.length>3&&(this.alpha=s[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),n=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==n.length&&(n="0"+n),"#"+t+e+n},this.getHelpXML=function(){for(var t=new Array,r=0;r<n.length;r++)for(var i=n[r].example,a=0;a<i.length;a++)t[t.length]=i[a];for(var o in e)t[t.length]=o;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(r=0;r<t.length;r++)try{var u=document.createElement("li"),l=new RGBColor(t[r]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+l.toHex()+"; color:"+l.toHex(),c.appendChild(document.createTextNode("test"));var f=document.createTextNode(" "+t[r]+" -> "+l.toRGB()+" -> "+l.toHex());u.appendChild(c),u.appendChild(f),s.appendChild(u)}catch(t){}return s}}},function(t,e){var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function i(t,e,n,r,i){if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLCanvasElement&&!t instanceof HTMLCanvasElement)return;var a,o=t.getContext("2d");try{try{a=o.getImageData(e,n,r,i)}catch(t){throw new Error("unable to access local image data: "+t)}}catch(t){throw new Error("unable to access image data: "+t)}return a}function a(t,e,n,r,a,s){if(!(isNaN(s)||s<1)){s|=0;var u=i(t,e,n,r,a);u=o(u,e,n,r,a,s),t.getContext("2d").putImageData(u,e,n)}}function o(t,e,i,a,o,s){var u,c,f,d,h,p,g,m,y,v,b,x,_,w,E,S,M,T,C,k,A,O,P,L,N=t.data,R=s+s+1,F=a-1,D=o-1,j=s+1,I=j*(j+1)/2,z=new l,B=z;for(f=1;f<R;f++)if(B=B.next=new l,f==j)var V=B;B.next=z;var H=null,W=null;g=p=0;var G=n[s],U=r[s];for(c=0;c<o;c++){for(S=M=T=C=m=y=v=b=0,x=j*(k=N[p]),_=j*(A=N[p+1]),w=j*(O=N[p+2]),E=j*(P=N[p+3]),m+=I*k,y+=I*A,v+=I*O,b+=I*P,B=z,f=0;f<j;f++)B.r=k,B.g=A,B.b=O,B.a=P,B=B.next;for(f=1;f<j;f++)d=p+((F<f?F:f)<<2),m+=(B.r=k=N[d])*(L=j-f),y+=(B.g=A=N[d+1])*L,v+=(B.b=O=N[d+2])*L,b+=(B.a=P=N[d+3])*L,S+=k,M+=A,T+=O,C+=P,B=B.next;for(H=z,W=V,u=0;u<a;u++)N[p+3]=P=b*G>>U,0!=P?(P=255/P,N[p]=(m*G>>U)*P,N[p+1]=(y*G>>U)*P,N[p+2]=(v*G>>U)*P):N[p]=N[p+1]=N[p+2]=0,m-=x,y-=_,v-=w,b-=E,x-=H.r,_-=H.g,w-=H.b,E-=H.a,d=g+((d=u+s+1)<F?d:F)<<2,m+=S+=H.r=N[d],y+=M+=H.g=N[d+1],v+=T+=H.b=N[d+2],b+=C+=H.a=N[d+3],H=H.next,x+=k=W.r,_+=A=W.g,w+=O=W.b,E+=P=W.a,S-=k,M-=A,T-=O,C-=P,W=W.next,p+=4;g+=a}for(u=0;u<a;u++){for(M=T=C=S=y=v=b=m=0,x=j*(k=N[p=u<<2]),_=j*(A=N[p+1]),w=j*(O=N[p+2]),E=j*(P=N[p+3]),m+=I*k,y+=I*A,v+=I*O,b+=I*P,B=z,f=0;f<j;f++)B.r=k,B.g=A,B.b=O,B.a=P,B=B.next;for(h=a,f=1;f<=s;f++)p=h+u<<2,m+=(B.r=k=N[p])*(L=j-f),y+=(B.g=A=N[p+1])*L,v+=(B.b=O=N[p+2])*L,b+=(B.a=P=N[p+3])*L,S+=k,M+=A,T+=O,C+=P,B=B.next,f<D&&(h+=a);for(p=u,H=z,W=V,c=0;c<o;c++)N[(d=p<<2)+3]=P=b*G>>U,P>0?(P=255/P,N[d]=(m*G>>U)*P,N[d+1]=(y*G>>U)*P,N[d+2]=(v*G>>U)*P):N[d]=N[d+1]=N[d+2]=0,m-=x,y-=_,v-=w,b-=E,x-=H.r,_-=H.g,w-=H.b,E-=H.a,d=u+((d=c+j)<D?d:D)*a<<2,m+=S+=H.r=N[d],y+=M+=H.g=N[d+1],v+=T+=H.b=N[d+2],b+=C+=H.a=N[d+3],H=H.next,x+=k=W.r,_+=A=W.g,w+=O=W.b,E+=P=W.a,S-=k,M-=A,T-=O,C-=P,W=W.next,p+=a}return t}function s(t,e,n,r,a,o){if(!(isNaN(o)||o<1)){o|=0;var s=i(t,e,n,r,a);s=u(s,e,n,r,a,o),t.getContext("2d").putImageData(s,e,n)}}function u(t,e,i,a,o,s){var u,c,f,d,h,p,g,m,y,v,b,x,_,w,E,S,M,T,C,k,A=t.data,O=s+s+1,P=a-1,L=o-1,N=s+1,R=N*(N+1)/2,F=new l,D=F;for(f=1;f<O;f++)if(D=D.next=new l,f==N)var j=D;D.next=F;var I=null,z=null;g=p=0;var B=n[s],V=r[s];for(c=0;c<o;c++){for(w=E=S=m=y=v=0,b=N*(M=A[p]),x=N*(T=A[p+1]),_=N*(C=A[p+2]),m+=R*M,y+=R*T,v+=R*C,D=F,f=0;f<N;f++)D.r=M,D.g=T,D.b=C,D=D.next;for(f=1;f<N;f++)d=p+((P<f?P:f)<<2),m+=(D.r=M=A[d])*(k=N-f),y+=(D.g=T=A[d+1])*k,v+=(D.b=C=A[d+2])*k,w+=M,E+=T,S+=C,D=D.next;for(I=F,z=j,u=0;u<a;u++)A[p]=m*B>>V,A[p+1]=y*B>>V,A[p+2]=v*B>>V,m-=b,y-=x,v-=_,b-=I.r,x-=I.g,_-=I.b,d=g+((d=u+s+1)<P?d:P)<<2,m+=w+=I.r=A[d],y+=E+=I.g=A[d+1],v+=S+=I.b=A[d+2],I=I.next,b+=M=z.r,x+=T=z.g,_+=C=z.b,w-=M,E-=T,S-=C,z=z.next,p+=4;g+=a}for(u=0;u<a;u++){for(E=S=w=y=v=m=0,b=N*(M=A[p=u<<2]),x=N*(T=A[p+1]),_=N*(C=A[p+2]),m+=R*M,y+=R*T,v+=R*C,D=F,f=0;f<N;f++)D.r=M,D.g=T,D.b=C,D=D.next;for(h=a,f=1;f<=s;f++)p=h+u<<2,m+=(D.r=M=A[p])*(k=N-f),y+=(D.g=T=A[p+1])*k,v+=(D.b=C=A[p+2])*k,w+=M,E+=T,S+=C,D=D.next,f<L&&(h+=a);for(p=u,I=F,z=j,c=0;c<o;c++)A[d=p<<2]=m*B>>V,A[d+1]=y*B>>V,A[d+2]=v*B>>V,m-=b,y-=x,v-=_,b-=I.r,x-=I.g,_-=I.b,d=u+((d=c+N)<L?d:L)*a<<2,m+=w+=I.r=A[d],y+=E+=I.g=A[d+1],v+=S+=I.b=A[d+2],I=I.next,b+=M=z.r,x+=T=z.g,_+=C=z.b,w-=M,E-=T,S-=C,z=z.next,p+=a}return t}function l(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}t.exports={image:function(t,e,n,r){if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLImageElement&&!t instanceof HTMLImageElement)return;var i=t.naturalWidth,o=t.naturalHeight;if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLCanvasElement&&!e instanceof HTMLCanvasElement)return;e.style.width=i+"px",e.style.height=o+"px",e.width=i,e.height=o;var u=e.getContext("2d");u.clearRect(0,0,i,o),u.drawImage(t,0,0),isNaN(n)||n<1||(r?a(e,0,0,i,o,n):s(e,0,0,i,o,n))},canvasRGBA:a,canvasRGB:s,imageDataRGBA:o,imageDataRGB:u}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=(o=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),a=r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"});return[n].concat(a).concat([i]).join("\n")}var o;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var a=this[i][0];null!=a&&(r[a]=!0)}for(i=0;i<t.length;i++){var o=t[i];null!=o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},function(t,e,n){"use strict";n.r(e);var r=n(1),i=n(9);function a(t,e){return t.replace(/\{\{\s*(.+?)\s*\}\}/g,function(t,n){return e.hasOwnProperty(n)?e[n]:""})}var o=r.default.api.utils,s=r.default.api.pluginsSDK,u=function(t,e,n){"front"===n?t.push(e):t.unshift(e)},l=function(t){return function(e){var n={},i=[{dim:e.scaleX.dim,scale:e.scaleY,method:"yi"},{dim:e.scaleY.dim,scale:e.scaleX,method:"xi"},{dim:null,scale:null,method:null,k:null}].find(function(e){return Array.isArray(t.dim)?t.dim.indexOf(e.dim)>=0:e.dim===t.dim});if(null===i.method)return n;var a={l:-.5,r:.5},o=i.method,s=i.scale;return n[o]=function(t){var n=a[t.__pos__]||0;if(s.discrete)return e[o](t)+s.stepSize(t[s.dim])*n;if(s.period){for(var i=r.default.api.tickPeriod.get(s.period,{utc:s.utcTime}),u=s.domain(),l=i.cast(u[0]);l<u[0];)l=i.next(l);var c=i.cast(u[1]),f=(s(c)-s(l))/(c-l);switch(t.__pos__){case"l":var d=Math.min(0,u[0]-l);return s(l)+f*d;case"r":d=Math.max(0,u[1]-c);return s(c)+f*d}}return e[o](t)},n}};function c(t){var e=o.defaults(t||{},{items:[],formatters:{}});return{init:function(t){var e=this;this._chart=t;var n=t.getSpec();n.scales.annotation_text={type:"value",dim:"text",source:"?"},n.transformations=n.transformations||{};var i=function(t){return n.settings.log(t,"LOG")};this._dataRefs={},n.transformations.dataRange=function(o,s){var u=s.from,l=s.to,c=t.getScaleInfo(s.primaryScale),f=c.domain();if(c.period){var d=r.default.api.tickPeriod.get(c.period,{utc:n.settings.utcTime});u=d.cast(new Date(s.from)),l=d.cast(new Date(s.to))}u=null===u?f[0]:u,l=null===l?f[f.length-1]:l;var h=!c.isInDomain(u),p=!c.isInDomain(l);if(c.discrete?h||p:h&&p)return i("Annotation is out of domain"),[];var g=t.getScaleInfo(s.secondaryScale),m=g.domain(),y=[m[0],m[m.length-1]],v=c.dim,b=g.dim,x="__pos__",_={},w={},E={},S={};_[x]="l",_[v]=u,_[b]=y[0],w[x]="l",w[v]=l,w[b]=y[0],E[x]="r",E[v]=l,E[b]=y[1],S[x]="r",S[v]=u,S[b]=y[1];var M="y"===s.axis?E:S,T="y"===s.axis?S:E,C=e._getFormat(v);return s.startText&&(M.text=a(s.startText,{value:C(M[v])})),s.endText&&(T.text=a(s.endText,{value:C(T[v])})),e._useSavedDataRefs([_,w,E,S],String([v,u,l]))},n.transformations.dataLimit=function(o,s){var u=s.primaryScale,l=s.secondaryScale,c=t.getScaleInfo(u),f=c.period?r.default.api.tickPeriod.get(c.period,{utc:n.settings.utcTime}).cast(new Date(s.from)):s.from;if(!c.isInDomain(f))return i("Annotation is out of domain"),[];var d=t.getScaleInfo(l),h=d.domain(),p=[h[0],h[h.length-1]],g={},m={},y=c.dim,v=d.dim,b="__pos__",x=e._getFormat(y);return g[y]=f,g[v]=p[0],g[b]="l",s.startText&&(g.text=a(s.startText,{value:x(f)})),m[y]=f,m[v]=p[1],m[b]="r",s.endText&&(m.text=a(s.endText,{value:x(f)})),e._useSavedDataRefs([g,m],String([y,v,f]))},n.transformations.lineNoteData=function(n,o){var s=o.xScale,u=o.yScale,l=t.getScaleInfo(s),c=t.getScaleInfo(u),f=l.period?r.default.api.tickPeriod.get(l.period,{utc:l.utcTime}):null,d=c.period?r.default.api.tickPeriod.get(c.period,{utc:c.utcTime}):null,h=o.points.map(function(t){return[f?f.cast(t[0]):t[0],d?d.cast(t[1]):t[1]]});if(h.some(function(t){return!l.isInDomain(t[0])||!c.isInDomain(t[1])}))return i("Annotation is out of domain"),[];var p=l.dim,g=c.dim,m=[p,g].map(function(t){return e._getFormat(t)}),y=h.map(function(t,e){0===e||h.length;var n,r=0===e?o.startText:e===h.length-1?o.endText:"";return(n={})[p]=t[0],n[g]=t[1],n.text=r?a(r,{x:m[0](t[0]),y:m[1](t[1])}):null,n});return e._useSavedDataRefs(y,JSON.stringify([p,g,o.points]))}},addAreaNote:function(t,e,n){var r,i=t.scales[e.x],a=t.scales[e.y],o=n.dim===i.dim?["x","y"]:n.dim===a.dim?["y","x"]:null;if(null===o)return r="Annotation doesn't match any data field",void t.settings.log(r,"LOG");var s=n.val[0],c=n.val[1],f=n.text,d={type:"ELEMENT.PATH",namespace:"annotations",x:e.x,y:e.y,color:n.colorScaleName,label:"annotation_text",expression:{inherit:!1,operator:"none",params:[],source:"/"},transformModel:[l(n)],transformation:[{type:"dataRange",args:{axis:o[0],startText:"string"==typeof f?f:f.start,endText:"string"==typeof f?"":f.end,from:s,to:c,primaryScale:e[o[0]],secondaryScale:e[o[1]]}}],guide:{animationSpeed:e.guide.animationSpeed,showAnchors:"never",cssClass:"tau-chart__annotation-area",label:{fontColor:n.color,position:["r","b","keep-in-box"]}}};u(e.units,d,n.position)},addLineNote:function(t,e,n){var r,i,a=t.scales[e.x],o=t.scales[e.y],s=null,c=!0;if(Array.isArray(n.dim)?(c=!1,((r=n.dim)[0]===a.dim&&r[1]===o.dim||r[0]===o.dim&&r[1]===a.dim)&&(s=["x","y"])):n.dim===a.dim?s=["x","y"]:n.dim===o.dim&&(s=["y","x"]),null===s)return i="Annotation doesn't match any field",void t.settings.log(i,"LOG");var f=n.text,d={type:"ELEMENT.LINE",namespace:"annotations",x:e.x,y:e.y,label:"annotation_text",color:n.colorScaleName,expression:{inherit:!1,operator:"none",params:[],source:"/"},guide:{animationSpeed:e.guide.animationSpeed,showAnchors:"never",widthCssClass:"tau-chart__line-width-2",cssClass:"tau-chart__annotation-line",label:{fontColor:n.color,position:c?["r","b","keep-in-box"]:["auto:avoid-label-edges-overlap","auto:adjust-on-label-overflow","keep-in-box"]},x:{fillGaps:!1},y:{fillGaps:!1}}},h=c?{transformModel:[l(n)],transformation:[{type:"dataLimit",args:{from:n.val,startText:"string"==typeof f?"":f.start,endText:"string"==typeof f?f:f.end,primaryScale:e[s[0]],secondaryScale:e[s[1]]}}]}:{transformation:[{type:"lineNoteData",args:{points:r[0]===a.dim?n.val:n.val.map(function(t){return t.slice().reverse()}),startText:"string"==typeof f?"":f.start,endText:"string"==typeof f?f:f.end,xScale:e.x,yScale:e.y}}]};Object.assign(d,h),u(e.units,d,n.position)},onRender:function(){this._clearUnusedDataRefs()},onSpecReady:function(t,n){var r=this,a=[];this._setupAdditionalSeries(),this._startWatchingDataRefs(),t.traverseSpec(n,function(t){t&&"COORDS.RECT"===t.type&&t.units&&a.push(t)}),this._formatters=s.getFieldFormatters(n,e.formatters);var o=s.spec(n);a.forEach(function(t){e.items.map(function(t,e){var n=(t.color||"#BD10E0").toLowerCase(),r=i.rgb(n).toString();"black"!==n&&"rgb(0, 0, 0)"===r&&(r=null);var a=r||n,s="annotation_color_"+e;return o.addScale(s,{type:"color",source:"?",brewer:[a]}),{dim:t.dim,val:t.val,text:t.text,color:a,position:t.position,colorScaleName:s}}).forEach(function(e){var i;Array.isArray(e.dim)?Array.isArray(e.val)&&e.val.every(Array.isArray)?r.addLineNote(n,t,e):(i="Point annotation is not implemented yet",n.settings.log(i,"LOG")):Array.isArray(e.val)?r.addAreaNote(n,t,e):r.addLineNote(n,t,e)})})},_setupAdditionalSeries:function(){var t=this._chart,n=t.getSpec(),r=t.getDataSources()["/"].data,i=this._getAnnotatedDimValues(e.items);Object.keys(i).forEach(function(t){["x_"+t,"y_"+t].forEach(function(e){if(e in n.scales){var a=n.scales[e],s=r.map(function(e){return e[t]}),u=["period","time"].indexOf(a.type)>=0?i[t].map(function(t){return new Date(t)}):i[t];a.series=o.unique(s.concat(u))}})})},_getFormat:function(t){return this._formatters[t]?this._formatters[t].format:function(t){return String(t)}},_useSavedDataRefs:function(t,e){var n=this._dataRefs;return this._usedDataRefsKeys.add(e),e in n?(n[e].forEach(function(e,n){return Object.assign(e,t[n])}),n[e]):(n[e]=t,t)},_startWatchingDataRefs:function(){var t=this._dataRefs;this._initialDataRefsKeys=new Set(Object.keys(t)),this._usedDataRefsKeys=new Set},_clearUnusedDataRefs:function(){var t=this._dataRefs,e=this._initialDataRefsKeys,n=this._usedDataRefsKeys;Array.from(e).filter(function(t){return!n.has(t)}).forEach(function(e){return delete t[e]}),this._initialDataRefsKeys=null,this._usedDataRefsKeys=null},_getDataRowsFromItems:function(t){var e=function(t,e){return t.reduce(function(t,n,r){return t[n]=e[r],t},{})};return t.reduce(function(t,n){return Array.isArray(n.dim)?Array.isArray(n.val)&&n.val.every(Array.isArray)&&n.val.forEach(function(r){t.push(e(n.dim,r))}):Array.isArray(n.val)?n.val.forEach(function(r){t.push(e([n.dim],[r]))}):t.push(e([n.dim],[n.val])),t},[])},_getAnnotatedDimValues:function(t){var e=this._getDataRowsFromItems(t),n={};return e.forEach(function(t){Object.keys(t).forEach(function(e){n[e]=n[e]||[],n[e].push(t[e])})}),n}}}r.default.api.plugins.add("annotations",c);var f=r.default.api.utils;function d(t){var e=t.x0,n=t.y0,r=null==t.collapse||t.collapse,i=function(t){return{y0:function(n){return t.scaleY.value(n[e])}}},a=function(t){return{y0:function(e){return t.scaleY.value(e[n])}}},o=function(t){var r=t.data();if(0===r.length)return{};var i=t.scaleY,a=Number.MAX_VALUE,o=Number.MIN_VALUE,s=t.flip?e:n,u=i.dim;return r.forEach(function(t){var e=t[s],n=t[u],r=e<n?e:n,i=n>e?n:e;a=r<a?r:a,o=i>o?i:o}),i.fixup(function(t){var e={};return(!t.hasOwnProperty("max")||t.max<o)&&(e.max=o),(!t.hasOwnProperty("min")||t.min>a)&&(e.min=a),e}),{}},s={},u={},l=function(t){var i=t.data().slice(),a=t.scaleX,o=t.scaleY;if(0===i.length||!a.discrete)return{};var l=t.flip?e:n,c=o.dim;i.sort(f.createMultiSorter(function(t,e){return t[l]-e[l]},function(t,e){return t[c]-e[c]}));var d=a.dim,h=a.domain().reduce(function(t,e){return t[e]=[],t},{}),p=new Map;return i.forEach(r?function(t){var e=t[d],n=h[e],r=n.findIndex(function(e){return e[e.length-1][c]<=t[l]});r<0&&(r=n.length,n.push([])),n[r].push(t),p.set(t,r)}:function(t){var e=t[d],n=h[e],r=r=n.length;n.push([]),n[r].push(t),p.set(t,r)}),Object.keys(h).forEach(function(t){s[t]=h[t]}),a.fixup(function(t){var e={},n=a.domain().reduce(function(t,e){return t+s[e].length},0);return a.domain().forEach(function(t){u[t]=n}),e.ratio=function(t){return s[t].length/u[t]},e}),{xi:function(e){var n=e[d],r=a.stepSize(n);return t.xi(e)-r/2+r/s[n].length*(p.get(e)+.5)}}};return{onSpecReady:function(t,e){t.traverseSpec(e,function(t,e){"ELEMENT.INTERVAL"===t.type&&(t.transformModel=[t.flip?i:a,l],t.adjustScales=[o],t.guide.enableColorToBarPosition=!1,t.guide.label=t.guide.label||{},t.guide.label.position=t.guide.label.position||(t.flip?["inside-start-then-outside-end-horizontal","hide-by-label-height-horizontal"]:["inside-start-then-outside-end-vertical"]))})}}}r.default.api.plugins.add("bar-as-span",d);var h=n(0),p=r.default.api.utils,g="minimum",m="maximum",y={MIN:g,MAX:m,MEDIAN:"median",Q1:"Q1",Q3:"Q3"};function v(t,e){var n=t.length-1,r=e/100*n,i=Math.floor(r);if(0===i)return{pos:0,value:t[0]};if(i===n)return{pos:n,value:t[n]};var a=r-i;return a?{pos:r,value:t[i]+a*(t[i+1]-t[i])}:{pos:r,value:t[r]}}function b(t,e,n){for(var r=t.sort(function(t,e){return t-e}),i=v(r,25),a=v(r,50),o=v(r,75),s=o.value-i.value,u=i.value-1.5*s,l=o.value+1.5*s,c=r[0],f=r[r.length-1],d=0;d<=i.pos;d++){var h=r[d];if(h>u){c=h;break}}for(var p=r.length-1;p>=o.pos;p--){var g=r[p];if(g<l){f=g;break}}return e[n.MIN]=c,e[n.MAX]=f,e[n.MEDIAN]=a.value,e[n.Q1]=i.value,e[n.Q3]=o.value,e}function x(t){return t=p.defaults(t||{},{mode:"outliers-only"}),{init:function(t){this._chart=t},onSpecReady:function(e,n){var r=!0===t.flip;n.transformations=n.transformations||{},n.transformations.empty=function(){return[]},n.transformations.outliers=function(t,e){var n=e.x.dim,r=e.y.dim,i=t.reduce(function(t,e){var i=e[n];return t[i]=t[i]||[],t[i].push(e[r]),t},{}),a=Object.keys(i).reduce(function(t,e){var a=b(i[e],{},y),o=a[y.MAX],s=a[y.MIN];return t.concat(function(t){return t[n]!==e||(t[r]>o||t[r]<s)})},[]);return t.filter(function(t){return!a.some(function(e){return!e(t)})})},e.traverseSpec(n,function(e,i){if("ELEMENT.POINT"===e.type){var a=JSON.parse(JSON.stringify(e));a.type="ELEMENT.BOX-WHISKERS",a.flip=r,a.namespace="boxwhiskers",a.guide=a.guide||{},a.guide.fitScale="hide-scatter"===t.mode;var o={"show-scatter":[],"hide-scatter":[{type:"empty"}],"outliers-only":[{type:"outliers",args:{x:n.scales[r?e.y:e.x],y:n.scales[r?e.x:e.y]}}]};e.transformation=e.transformation||[],e.transformation=e.transformation.concat(o[t.mode]),i.units.push(a)}})}}}r.default.api.unitsRegistry.reg("ELEMENT.BOX-WHISKERS",{getAdjustScalesRules:function(){var t=this,e=[];return t.node().config.guide.fitScale&&e.push(function(e){t.fixScale(e,t.calcStat(e))}),e},fixScale:function(t,e){var n=e.reduce(function(t,e){return t.concat([e[y.MIN],e[y.MAX]])},[]).sort(function(t,e){return t-e}),r=n[0],i=n[n.length-1];t.scaleY.fixup(function(t){var e={};if(t.hasOwnProperty("series")){var n=Math.min(t.series[0],r),a=Math.max(t.series[1],i);e.series=[n,a]}else e.series=[r,i];return e})},calcStat:function(t){var e=t.data().reduce(function(e,n){var r=n[t.scaleX.dim];return e[r]=e[r]||[],e[r].push(n[t.scaleY.dim]),e},{});return Object.keys(e).reduce(function(n,r){var i={};return i[t.scaleX.dim]=r,n.concat(b(e[r],i,y))},[])},buildRangeModel:function(t,e){var n=t.flip,r=n?"y":"x",i=n?"x":"y",a=n?"height":"width",o=n?"width":"height",s=n?e.y1:e.y0,u=n?e.y0:e.y1,l=e.size,c=t.model.scaleX,f=t.model.scaleY,d={class:e.class};return d[r]=function(t){return c(t[c.dim])-.5*l},d[i]=function(t){return f(t[u])},d[a]=function(){return l},d[o]=function(t){return Math.max(e.minHeight||1,Math.abs(f(t[s])-f(t[u])))},Object.assign(d,{fill:function(){return e.color||"rgba(0,0,256, 0.5)"}})},draw:function(){var t=this.node().config,e=t.options.slot(t.uid),n=this.calcStat(this.node().screenModel.model);this.drawElement(e,n)},drawElement:function(t,e){var n=this,i=this.node().screenModel,a=r.default.api.d3_animationInterceptor,o=function(t,e){var r=n.node().config.guide.animationSpeed,o=t.selectAll("."+e.class).data(function(t){return[t]},i.id);o.exit().call(a(r,null,{width:0},function(t){h.select(t).remove()})),o.call(a(r,null,e)),o.enter().append("rect").style("stroke-width",0).call(a(r,{width:0},e))},s=function(t){o(t,n.buildRangeModel(i,{size:2,y0:g,y1:"Q1",class:"range-min-Q1"})),o(t,n.buildRangeModel(i,{size:2,y0:"Q3",y1:m,class:"range-Q3-max"})),o(t,n.buildRangeModel(i,{size:20,y0:"Q1",y1:"Q3",class:"range-Q1-Q3"})),o(t,n.buildRangeModel(i,{size:20,minHeight:1,y0:m,y1:m,class:"limit-max"})),o(t,n.buildRangeModel(i,{size:20,minHeight:1,y0:g,y1:g,class:"limit-min"})),o(t,n.buildRangeModel(i,{size:20,minHeight:2,y0:"median",y1:"median",color:"#ff0000",class:"limit-median"}))},u=t.selectAll(".box-whiskers-node").data(e);u.exit().remove(),u.call(s),u.enter().append("g").attr("class","box-whiskers-node").call(s)}},"ELEMENT.GENERIC.CARTESIAN"),r.default.api.plugins.add("box-whiskers",x);var _=r.default.api.utils,w=r.default.api.pluginsSDK,E="tau-chart__category-filter",S=E+"__value",M=S+"_checked",T=S+"__toggle",C=function(t){return t.join("\n")},k=function(t){var e=t.label,n=t.values;return'\n    <div class="'+E+'__category">\n        <div class="'+E+'__category__label">'+e+'</div>\n        <div class="'+E+'__category__values">\n            '+C(n.map(function(t){return A(t)}))+"\n    </div>\n\n"},A=function(t){var e=t.key,n=t.label,r=t.checked;return'\n    <div class="'+S+(r?" "+M:"")+'" data-key="'+e+'">\n        '+O()+'\n        <span class="'+S+'__label">'+n+"</span>\n    </div>\n"},O=function(){return['<span class="'+T+'">','<span class="'+T+'__icon"></span>',"</span>"].join("")},P=function(t,e,n,r){t.addEventListener(e,function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.matches(n)&&r(t,e),e=e.parentNode})},L=function(t,e){var n=function(t){return JSON.stringify(function(t){return null==t||""===t}(t)?null:t)},r=n(e);return function(e){var i=e[t],a=n(i);return r===a}},N=function(){function t(t){this.settings=_.defaults(t||{},{formatters:{},fields:null,skipColorDim:!0}),this._filters={},this.onRender=this._createRenderHandler()}return t.prototype.init=function(t){var e=this;this._chart=t;var n=function(e){var n=t.getSpec().scales;return Object.keys(n).map(function(t){return{name:t,config:n[t]}}).filter(e)},r=n(function(t){var e=t.config;t.name;return"ordinal"===e.type&&e.dim}),i=_.unique(r.map(function(t){return t.config.dim}));if(this.settings.fields&&(i=i.filter(function(t){return e.settings.fields.indexOf(t)>=0})),this.settings.skipColorDim){var a=n(function(t){var e=t.config;t.name;return"color"===e.type&&e.dim}).map(function(t){return t.config.dim});i=i.filter(function(t){return a.indexOf(t)<0})}r=r.filter(function(t){return i.indexOf(t.config.dim)>=0}),this._categoryScales=r,this._render()},t.prototype.destroy=function(){var t=this._filters,e=this._chart;Object.keys(t).forEach(function(n){return e.removeFilter(t[n])});var n;(n=this._node)&&n.parentElement&&n.parentElement.removeChild(n)},t.prototype._createRenderHandler=function(){return function(){if(this._lastClickedScrollInfo){var t=this._lastClickedScrollInfo.key,e=this._node.querySelector('[data-key="'+t+'"]');if(e){var n=this._lastClickedScrollInfo.top,r=e.getBoundingClientRect().top,i=this._getScrollContainer(),a=i.getBoundingClientRect().top;i.scrollTop=i.scrollTop-n-a+r}this._lastClickedScrollInfo=null}}},t.prototype._getContent=function(t){return function(t){var e=t.categories;return'\n    <div class="'+E+'">\n        '+C(e.map(function(t){return k(t)}))+"\n    </div>\n"}({categories:t})},t.prototype._getCategoriesInfo=function(){var t=this;return this._categoryScales.map(function(e){var n=e.name;return t._chart.getScaleInfo(n)}).map(function(e){var n=e.dim,r=t._getFieldLabel(n),i=t._getFieldFormat(n),a=t._chart.getDataSources({excludeFilter:["category-filter"]}),o=_.unique(a[e.source].data.map(function(t){return t[n]})).map(function(e){var r=i(e),a=t._getFilterKey(n,e);return{label:r,checked:!t._filters[a],key:a,value:e}});return{dim:n,label:r,values:o}})},t.prototype._render=function(){this._clear(),this._formatters=w.getFieldFormatters(this._chart.getSpec(),this.settings.formatters);var t,e,n=this._getCategoriesInfo(),r=this._getContent(n),i=(t=r,(e=document.createElement("div")).innerHTML=t,e.firstElementChild);this._node=i,this._chart.insertToRightSidebar(i),this._subscribeToEvents(),this._filterKeys=n.reduce(function(t,e){var n=e.dim;return e.values.forEach(function(e){var r=e.key,i=e.value;t[r]={dim:n,value:i}}),t},{})},t.prototype._subscribeToEvents=function(){var t=this,e=this._node;P(e,"click","."+S,function(e,n){var r=n.getAttribute("data-key"),i=e.target.matches("."+T);t._toggleCategory(r,i?"toggle":"focus")}),P(e,"mouseover","."+S,function(e,n){var r=n.getAttribute("data-key");t._toggleHighlight(r,!0)}),P(e,"mouseout","."+S,function(e,n){var r=n.getAttribute("data-key");t._toggleHighlight(r,!1)})},t.prototype._isFilteredOut=function(t){return t in this._filters},t.prototype._toggleCategory=function(t,e){var n=this,r=Array.from(this._node.querySelectorAll("."+S)).reduce(function(t,e){return t[e.getAttribute("data-key")]=e,t},{}),i=Object.keys(this._filterKeys).map(function(t){var e=n._filterKeys[t],i=e.dim,a=e.value;return{node:r[t],key:t,dim:i,value:a,isChecked:!n._isFilteredOut(t)}}),a=i.reduce(function(t,e){return t[e.key]=e,t},{})[t],o=i.filter(function(t){return t.dim===a.dim}),s=function(t,e){e?t.classList.add(M):t.classList.remove(M)};switch(e){case"toggle":a.isChecked?(this._addFilter(t),s(a.node,!1)):(this._removeFilter(t),s(a.node,!0));break;case"focus":a.isChecked&&o.every(function(t){return t===a||!t.isChecked})?o.forEach(function(t){t.isChecked||(s(t.node,!0),n._removeFilter(t.key))}):(o.forEach(function(t){t!==a&&t.isChecked&&(s(t.node,!1),n._addFilter(t.key))}),a.isChecked||(s(a.node,!0),this._removeFilter(a.key)))}this._lastClickedScrollInfo={key:t,top:a.node.getBoundingClientRect().top-this._getScrollContainer().getBoundingClientRect().top},this._chart.refresh()},t.prototype._toggleHighlight=function(t,e){if(!this._isFilteredOut(t)){var n=this._filterKeys[t],r=n.dim,i=n.value,a=e?L(r,i):function(t){return null};this._chart.select(function(t){return!0}).forEach(function(t){return t.fire("highlight",a)})}},t.prototype._clear=function(){var t=this._node;t&&t.parentElement&&t.parentElement.removeChild(t)},t.prototype._getScrollContainer=function(){return this._node.parentElement.parentElement},t.prototype._getFilterKey=function(t,e){return t+"__"+e},t.prototype._addFilter=function(t){var e=this._filterKeys[t],n=e.dim,r=e.value,i=L(n,r);this._filters[t]=this._chart.addFilter({tag:"category-filter",predicate:function(t){return!i(t)}})},t.prototype._removeFilter=function(t){var e=this._filters[t];delete this._filters[t],this._chart.removeFilter(e)},t.prototype._getFieldLabel=function(t){return this._formatters[t]?this._formatters[t].label:t},t.prototype._getFieldFormat=function(t){return this._formatters[t]?this._formatters[t].format:function(t){return String(t)}},t}();r.default.api.plugins.add("category-filter",function(t){return new N(t)});var R="http://www.w3.org/2000/svg",F=r.default.api.utils,D=r.default.api.svgUtils,j=r.default.api.pluginsSDK;function I(t){t=t||{};var e=document.createElementNS(R,"g"),n=h.select(e).attr("class","tau-crosshair__label");n.append("rect").attr("class","tau-crosshair__label__box"),n.append("text").attr("class","tau-crosshair__label__text-shadow"),n.append("text").attr("class","tau-crosshair__label__text");var r={options:function(e){return t=Object.assign(t,e),r},show:function(i){return t.container.appendChild(e),function(e){var r=e.x,i=e.y,a=e.text,o=e.color,s=e.colorCls;n.attr("class","tau-crosshair__label "+s);var u=t.halign,l=t.valign,c=t.hpad,f=t.vpad,d={left:"end",middle:"middle",right:"start"}[u],h={left:-c,middle:0,right:c}[u],p=n.select(".tau-crosshair__label__text").attr("fill",o),g=n.selectAll(".tau-crosshair__label__text, .tau-crosshair__label__text-shadow").attr("text-anchor",d).attr("x",r+h).attr("y",0).text(a),m=p.node().getBBox(),y={top:-f-m.height/2,middle:0,bottom:f+m.height/2}[l]-m.height/2-m.y;g.attr("y",i+y);var v=m.width+2*c,b=m.height+2*f,x={left:-v,middle:-v/2,right:0}[u],_={top:-b,middle:-b/2,bottom:0}[l];n.select(".tau-crosshair__label__box").attr("fill",o).attr("rx",t.boxCornerRadius).attr("ry",t.boxCornerRadius).attr("x",r+x).attr("y",i+_).attr("width",v).attr("height",b)}(i),function(){n.attr("transform","");var r=t.chart.getLayout().contentContainer.getBoundingClientRect(),i=t.chart.getSVG().getBoundingClientRect(),a=e.getBoundingClientRect(),o=Math.max(0,Math.max(r.left,i.left)-a.left)||Math.min(0,Math.min(r.right,i.right)-a.right),s=Math.max(0,Math.max(r.top,i.top)-a.top)||Math.min(0,Math.min(r.bottom,i.bottom)-a.bottom);n.attr("transform","translate("+o+","+s+")")}(),r},hide:function(){return e.parentNode&&e.parentNode.removeChild(e),r}};return r}function z(t){var e=F.defaults(t||{},{xAxis:!0,yAxis:!0,formatters:{},labelBoxHPadding:5,labelBoxVPadding:3,labelBoxCornerRadius:3,axisHPadding:22,axisVPadding:22});return{init:function(t){this._chart=t,this._formatters={},this._createNode()},_createNode:function(){var t=h.select(document.createElementNS(R,"g")).attr("class","tau-crosshair");this._labels={x:null,y:null};var n=function(n){var r=t.append("g").attr("class","tau-crosshair__group "+n);r.append("line").attr("class","tau-crosshair__line-shadow"),r.append("line").attr("class","tau-crosshair__line"),this._labels[n]=I({container:r.node(),chart:this._chart,halign:"x"===n?"middle":"left",valign:"x"===n?"bottom":"middle",boxCornerRadius:e.labelBoxCornerRadius,hpad:e.labelBoxHPadding,vpad:e.labelBoxVPadding})}.bind(this);e.xAxis&&n("x"),e.yAxis&&n("y"),this._element=t},_setValues:function(t,n,r){var i=function(t){var n=this._element.select(".tau-crosshair__group."+t.dir);n.select(".tau-crosshair__line").attr("class","tau-crosshair__line "+r.cls).attr("stroke",r.color),n.selectAll(".tau-crosshair__line, .tau-crosshair__line-shadow").attr("x1",t.startPt.x).attr("x2",t.valuePt.x).attr("y1",t.startPt.y).attr("y2",t.valuePt.y),("x"===t.dir&&e.xAxis||"y"===t.dir&&e.yAxis)&&this._labels[t.dir].options({halign:t.labelHAlign,valign:t.labelVAlign}).show({x:t.startPt.x,y:t.startPt.y,text:t.label,color:r.color,colorCls:r.cls})}.bind(this);i({dir:"x",startPt:{x:t.value,y:n.start+(t.minMode?0:e.axisVPadding)},valuePt:{x:t.value,y:n.value+n.crossPadding},label:t.label,labelHAlign:"middle",labelVAlign:"bottom"}),i({dir:"y",startPt:{x:t.start-(n.minMode?0:e.axisHPadding),y:n.value},valuePt:{x:t.value-t.crossPadding,y:n.value},label:n.label,labelHAlign:"left",labelVAlign:"middle"})},_showCrosshair:function(t,e,n){var r=this._chart.getSVG(),i=e.config.options.container.node(),a=D.getDeepTransformTranslate(i);this._element.attr("transform",D.translate(a.x,a.y)),r.appendChild(this._element.node());var o=e.getScale("x"),s=e.getScale("y"),u=e.getScale("color"),l=u(t.data[u.dim]),c=t.data[o.dim],f=t.data[s.dim],d=e.screenModel.x(t.data),h=e.screenModel.y(t.data);if(e.config.stack)if(e.config.flip){var p=e.data().filter(function(n){var r=n[s.dim];return n===t.data||(r===f||r-f==0)&&(e.screenModel.x(t.data)-e.screenModel.x(n))*n[o.dim]>0});d=(c<0?Math.min:Math.max).apply(null,p.map(function(t){return e.screenModel.x(t)},0)),c=p.reduce(function(t,e){return t+e[o.dim]},0)}else{var g=e.data().filter(function(n){var r=n[o.dim];return n===t.data||(r===c||r-c==0)&&(e.screenModel.y(n)-e.screenModel.y(t.data))*n[s.dim]>0});h=(f<0?Math.max:Math.min).apply(null,g.map(function(t){return e.screenModel.y(t)},0)),f=g.reduce(function(t,e){return t+e[s.dim]},0)}var m=t.node.getBBox(),y=["ELEMENT.AREA","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED"].indexOf(e.config.type)>=0?{x:m.width*(e.config.flip?c>0?1:0:.5),y:m.height*(e.config.flip?.5:f>0?1:0)}:{x:m.width/2,y:m.height/2};this._setValues({label:this._getFormat(o.dim)(c),start:0,value:d,crossPadding:y.x,minMode:n&&n.guide.x.hide},{label:this._getFormat(s.dim)(f),start:e.config.options.height,value:h,crossPadding:y.y,minMode:n&&n.guide.y.hide},{cls:u.toColor(l)?"":l,color:u.toColor(l)?l:""})},_hideCrosshair:function(){var t=this._element.node();t.parentNode&&t.parentNode.removeChild(t)},destroy:function(){this._hideCrosshair()},_subscribeToHover:function(){var t=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(function(e){return t.indexOf(e.config.type)>=0}).forEach(function(t){t.on("data-hover",function(t,e){if(e.data){if(t===e.unit){var n=j.getParentUnit(this._chart.getSpec(),t.config);this._showCrosshair(e,t,n)}}else this._hideCrosshair()}.bind(this))},this)},_getFormat:function(t){return this._formatters[t]?this._formatters[t].format:function(t){return String(t)}},onRender:function(){this._formatters=j.getFieldFormatters(this._chart.getSpec(),e.formatters),this._subscribeToHover()}}}r.default.api.plugins.add("crosshair",z);var B="tau-chart__tooltip";function V(t,e){return{render:function(t){return this.args=t,t=Object.assign({},t,{fields:this.filterFields(t.fields)}),this.rootTemplate(t)},rootTemplate:function(t){return['<div class="'+B+"__buttons "+B+'__clickable">',this.buttonsTemplate(),"</div>",'<div class="i-role-content '+B+'__content">',this.contentTemplate(t),"</div>"].join("\n")},contentTemplate:function(t){return this.fieldsTemplate(t)},filterFields:function(t){return t},getLabel:function(e){return t.getFieldLabel(e)},getFormatter:function(e){return t.getFieldFormat(e)},fieldsTemplate:function(t){var e=this,n=t.data;return t.fields.map(function(t){return e.itemTemplate({data:n,field:t})}).join("\n")},itemTemplate:function(t){var e=t.data,n=t.field,r=this.getLabel(n),i=this.getFormatter(n)(e[n]);return['<div class="'+B+'__list__item">','  <div class="'+B+'__list__elem">'+r+"</div>",'  <div class="'+B+'__list__elem">'+i+"</div>","</div>"].join("\n")},buttonsTemplate:function(){return[this.buttonTemplate({cls:"i-role-exclude",text:"Exclude",icon:function(){return'<span class="tau-icon-close-gray"></span>'}})].join("\n")},buttonTemplate:function(t){var e=t.icon,n=t.text,r=t.cls;return['<div class="'+B+"__button "+r+'">','  <div class="'+B+'__button__wrap">',"    "+(e?e()+" ":"")+n,"  </div>","</div>"].join("\n")},didMount:function(){var e=t.getDomNode().querySelector(".i-role-exclude");e&&e.addEventListener("click",function(){t.excludeHighlightedElement(),t.setState({highlight:null,isStuck:!1})})}}}var H=r.default.api.utils,W=r.default.api.domUtils,G=r.default.api.pluginsSDK,U="tau-chart__tooltip",X=function(){function t(t){this.settings=H.defaults(t||{},{align:"bottom-right",clickable:!0,clsClickable:U+"__clickable",clsStuck:"stuck",clsTarget:U+"-target",escapeHtml:!0,fields:null,formatters:{},getTemplate:null,spacing:24,winBound:12,onExclude:function(){}}),this.onRender=this._getRenderHandler()}return t.prototype.init=function(t){this._chart=t,this._tooltip=this._chart.addBalloon({spacing:this.settings.spacing,winBound:this.settings.winBound,auto:!0,effectClass:"fade"}),this._initDomEvents(),this.state={highlight:null,isStuck:!1},this.setState(this.state),this._template=this._getTemplate()},t.prototype._getTemplate=function(){var t=V(this,this.settings);return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(t,this,this.settings):t},t.prototype._renderTemplate=function(t,e){return this._template.render({data:t,fields:e})},t.prototype._initDomEvents=function(){var t=this;this._scrollHandler=function(){t.setState({highlight:null,isStuck:!1})},window.addEventListener("scroll",this._scrollHandler,!0),this.settings.clickable&&(this._outerClickHandler=function(e){var n=Array.from(document.querySelectorAll("."+t.settings.clsClickable)).concat(t.getDomNode()).map(function(t){return t.getBoundingClientRect()}),r=Math.min.apply(Math,n.map(function(t){return t.top})),i=Math.min.apply(Math,n.map(function(t){return t.left})),a=Math.max.apply(Math,n.map(function(t){return t.right})),o=Math.max.apply(Math,n.map(function(t){return t.bottom}));(e.clientX<i||e.clientX>a||e.clientY<r||e.clientY>o)&&t.setState({highlight:null,isStuck:!1})})},t.prototype.getDomNode=function(){return this._tooltip.getElement()},t.prototype.setState=function(t){var e=this,n=this.settings,r=this.state,i=this.state=Object.assign({},r,t);r.highlight=r.highlight||{data:null,cursor:null,unit:null},i.highlight=i.highlight||{data:null,cursor:null,unit:null},i.isStuck&&r.highlight.data&&(i.highlight=r.highlight),i.highlight.data!==r.highlight.data&&(i.highlight.data?(this._hideTooltip(),this._showTooltip(i.highlight.data,i.highlight.cursor),this._setTargetSvgClass(!0),requestAnimationFrame(function(){e._setTargetSvgClass(!0)})):i.isStuck||!r.highlight.data||i.highlight.data||(this._removeFocus(),this._hideTooltip(),this._setTargetSvgClass(!1))),!i.highlight.data||r.highlight.cursor&&i.highlight.cursor.x===r.highlight.cursor.x&&i.highlight.cursor.y===r.highlight.cursor.y||(this._tooltip.position(i.highlight.cursor.x,i.highlight.cursor.y),this._tooltip.updateSize());var a=this.getDomNode();this.settings.clickable&&i.isStuck!==r.isStuck&&(i.isStuck?(window.addEventListener("click",this._outerClickHandler,!0),a.classList.add(n.clsStuck),this._setTargetEventsEnabled(!1),this._accentFocus(i.highlight.data),this._tooltip.updateSize()):(window.removeEventListener("click",this._outerClickHandler,!0),a.classList.remove(n.clsStuck),requestAnimationFrame(function(){e._setTargetEventsEnabled(!0);var t=e._chart.getSVG();t&&W.dispatchMouseEvent(t,"mouseleave")})))},t.prototype._showTooltip=function(t,e){var n=this.settings,r=n.fields||"function"==typeof n.getFields&&n.getFields(this._chart)||Object.keys(t),i=this._renderTemplate(t,r);this._tooltip.content(i).position(e.x,e.y).place(n.align).show().updateSize(),this._template.didMount&&this._template.didMount()},t.prototype._hideTooltip=function(){window.removeEventListener("click",this._outerClickHandler,!0),this._template.willUnmount&&this._template.willUnmount(),this._tooltip.hide()},t.prototype.destroy=function(){window.removeEventListener("scroll",this._scrollHandler,!0),this._setTargetSvgClass(!1),this.setState({highlight:null,isStuck:!1}),this._tooltip.destroy()},t.prototype._subscribeToHover=function(){var t=this,e=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(function(t){return e.indexOf(t.config.type)>=0}).forEach(function(e){e.on("data-hover",function(e,n){var r=document.body.getBoundingClientRect();t.setState({highlight:n.data?{data:n.data,cursor:{x:n.event.clientX-r.left,y:n.event.clientY-r.top},unit:n.unit}:null})}),t.settings.clickable&&e.on("data-click",function(e,n){var r=document.body.getBoundingClientRect();t.setState(n.data?{highlight:{data:n.data,cursor:{x:n.event.clientX-r.left,y:n.event.clientY-r.top},unit:n.unit},isStuck:!0}:{highlight:null,isStuck:null})})})},t.prototype.getFieldFormat=function(t){var e=this._formatters[t]?this._formatters[t].format:function(t){return String(t)};return this.settings.escapeHtml?function(t){return H.escapeHtml(e(t))}:e},t.prototype.getFieldLabel=function(t){var e=this._formatters[t]?this._formatters[t].label:t;return this.settings.escapeHtml?H.escapeHtml(e):e},t.prototype._accentFocus=function(t){var e=function(e){return e===t};this._chart.select(function(){return!0}).forEach(function(t){t.fire("highlight",e)})},t.prototype._removeFocus=function(){var t=function(){return null};this._chart.select(function(){return!0}).forEach(function(e){e.fire("highlight",t),e.fire("highlight-data-points",t)})},t.prototype.excludeHighlightedElement=function(){var t=this.state.highlight.data;this._chart.addFilter({tag:"exclude",predicate:function(e){return e!==t}}),this.settings.onExclude(t),this._chart.refresh()},t.prototype._getRenderHandler=function(){return function(){this._formatters=G.getFieldFormatters(this._chart.getSpec(),this.settings.formatters),this._subscribeToHover(),this.setState({highlight:null,isStuck:!1})}},t.prototype._setTargetSvgClass=function(t){h.select(this._chart.getSVG()).classed(this.settings.clsTarget,t)},t.prototype._setTargetEventsEnabled=function(t){t?this._chart.enablePointerEvents():this._chart.disablePointerEvents()},t}(),q="diff-tooltip",Y=q+"__item",$=q+"__header";var K,J=r.default.api.utils,Q={draw:function(){var t=this.node().config;this._container=t.options.slot(t.uid)},addInteraction:function(){var t=this;this.node().on("interval-highlight",function(e,n){t._drawRange(n)})},_drawRange:function(t){var e=this.node(),n=e.config,r=e.screenModel.flip,i=this._container,a="interval-highlight",o=a+"__gradient",s=t?t[0]:null,u=t?t[1]:null,l=r?n.options.width:n.options.height;J.take(function(){var e=i.selectAll("."+a).data(t?[1]:[]);e.exit().remove();var n=e.enter().append("g").attr("class",a).attr("pointer-events","none");return{g:e,gEnter:n}}()).then(function(e){var c,f,d,p,g,m,y,v,b,x,_;!function(){for(var e=a+"__defs",s=a+"__gradient-start",u=a+"__gradient-end",l=i.node();"svg"!==(l=l.parentNode).tagName;);var c=e+"__"+n.uid,f=h.select(l).selectAll("#"+c).data(t?[1]:[]);f.exit().remove();var d=f.enter().append("defs").attr("class",e).attr("id",c).append("linearGradient").attr("id",o).attr("x1","0%").attr("y1",r?"100%":"0%").attr("x2",r?"0%":"100%").attr("y2","0%");d.append("stop").attr("class",s).attr("offset","0%"),d.append("stop").attr("class",u).attr("offset","100%")}(),f=(c=e).g,d=c.gEnter,p=a+"__range",g=f.select("."+p),m=d.append("rect").attr("class",p).attr("fill","url(#"+o+")"),v=(y=r?{x:0,y:u,width:l,height:s-u}:{x:s,y:0,width:u-s,height:l}).x,b=y.y,x=y.width,_=y.height,m.merge(g).attr("x",v).attr("y",b).attr("width",Math.abs(x)).attr("height",Math.abs(_)),function(t){var e=t.g,n=t.gEnter,i=a+"__range-start",o=e.select("."+i),u=n.append("line").attr("class",i),c=r?{x1:0,y1:s,x2:l,y2:s}:{x1:s,y1:0,x2:s,y2:l},f=c.x1,d=c.y1,h=c.x2,p=c.y2;u.merge(o).attr("x1",f).attr("y1",d).attr("x2",h).attr("y2",p)}(e),function(t){var e=t.g,n=t.gEnter,i=a+"__range-end",o=e.select("."+i),s=n.append("line").attr("class",i),c=r?{x1:0,y1:u,x2:l,y2:u}:{x1:u,y1:0,x2:u,y2:l},f=c.x1,d=c.y1,h=c.x2,p=c.y2;s.merge(o).attr("x1",f).attr("y1",d).attr("x2",h).attr("y2",p)}(e)})}},Z=(K=function(t,e){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}K(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),tt=r.default.api.utils,et=function(t){function e(e){var n=t.call(this,e)||this;return n.onSpecReady=n._getSpecReadyHandler(),n}return Z(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e),this._unitsGroupedData=new Map},e.prototype._getTemplate=function(){var t,e,n=(t=this,this.settings,e=V(t),Object.assign({},e,{hasColor:function(){return null!=this.args.colorField},contentTemplate:function(t){return[this.fieldsTemplate(t),this.tableTemplate(t)].join("\n")},filterFields:function(n){var r=t.state.highlight.unit.screenModel.model,i=r.scaleColor,a=r.scaleX,o=r.scaleY,s=n.filter(function(t){return t!==i.dim&&t!==a.dim&&t!==o.dim}),u=function(){return s.push(a.dim)};return this.shouldShowColorTable()?u():(u(),i.dim&&s.push(i.dim),s.push(o.dim)),e.filterFields.call(this,s)},itemTemplate:function(t){var e=t.data,n=t.field,r=this.getLabel(n),i=this.getFormatter(n)(e[n]),a=this.args.prev,o=(this.args.valueField,this.shouldShowDiff(n)),s=['<span class="'+Y+'__value">',""+i,o?" "+this.fieldUpdownTemplate(this.getDiff({data:e,prev:a,field:n})):"","</span>"].join("");return['<div class="'+B+'__list__item">','  <div class="'+B+'__list__elem">'+r+"</div>","  "+s,"</div>"].join("\n")},shouldShowDiff:function(t){return t===this.args.valueField},getDiff:function(t){var e=t.data,n=t.prev,r=t.field,i=this.getFormatter(r),a=(e?e[r]:0)-(n?n[r]:0);return{diff:i(a),sign:Math.sign(a)}},fieldUpdownTemplate:function(t){var e=t.diff,n=t.sign,r=q+"__field__updown";return['<span class="'+r+" "+r+"_"+(n>0?"positive":"negative")+'">',(n>0?"&#x25B2;":n<0?"&#x25BC;":"")+(0===n?"":e),"</span>"].join("")},shouldShowColorTable:function(){var t=this.args.groups;return this.hasColor()&&t.length>1},tableTemplate:function(t){return this.shouldShowColorTable()?['<div class="'+q+'__table">',this.tableHeaderTemplate(t),this.tableBodyTemplate(t),"</div>"].join("\n"):""},tableHeaderTemplate:function(t){var e=t.colorField,n=t.valueField,r=this.getLabel(e),i=this.getLabel(n);return['<div class="'+$+'">','  <span class="'+$+'__text">'+r+"</span>",'  <span class="'+$+'__value">'+i+"</span>",'  <span class="'+$+'__updown">&#x25BC;&#x25B2;</span>',"</div>"].join("\n")},tableBodyTemplate:function(t){var e=this,n=t.data,r=t.groups,i=t.valueField,a=t.colorField,o=n,s=r.map(function(t){var e=t.data;return e?e[i]:0}),u=Math.min.apply(Math,s),l=Math.max.apply(Math,s);return['<div class="'+q+'__body">','<div class="'+q+'__body__content">',r.map(function(t){var n=t.data,r=t.prev;return e.tableRowTemplate({data:n,prev:r,highlighted:o,valueField:i,colorField:a,min:u,max:l})}).join("\n"),"</div>","</div>"].join("\n")},tableRowTemplate:function(t){var e=t.data,n=t.prev,r=t.highlighted,i=t.valueField,a=t.colorField,o=t.min,s=t.max,u=e?e[i]:0,l=this.getFormatter(a)((e||n)[a]),c=this.getFormatter(i)(u),f=e===r,d=this.getDiff({data:e,prev:n,field:i}),h=d.diff,p=d.sign,g=this.getColor(e||n),m=g.color,y=g.colorCls;return['<div class="'+Y+(f?" "+Y+"_highlighted":"")+'">',"  "+this.valueBarTemplate({min:o,max:s,v:u,color:m,colorCls:y}),'  <span class="'+Y+'__text">'+l+"</span>",'  <span class="'+Y+'__value">'+c+"</span>","  "+this.updownTemplate({diff:h,sign:p}),"</div>"].join("\n")},valueBarTemplate:function(t){var e=t.min,n=t.max,r=t.v,i=t.color,a=t.colorCls;e=Math.min(e,0);var o=(n=Math.max(0,n))-e;return["<span",'    class="'+Y+"__bg"+(a?" "+a:"")+'"','    style="left: '+100*(0===o?0:(r<0?r-e:-e)/o)+"%; width: "+100*(0===o?0:(r<0?-r:r)/o)+"%; background-color: "+i+';"',"    ></span>"].join("\n")},getColor:function(e){var n=t.state.highlight.unit.screenModel;return{color:n.color(e),colorCls:n.class(e)}},updownTemplate:function(t){var e=t.diff,n=t.sign,r=Y+"__updown";return['<span class="'+r+" "+r+"_"+(n>0?"positive":"negative")+'">',(n>0?"&#x25B2;":n<0?"&#x25BC;":"")+(0===n?"":e),"</span>"].join("")},didMount:function(){e.didMount.call(this),this._scrollToHighlighted(),this._reserveSpaceForUpdown()},_scrollToHighlighted:function(){var e=t.getDomNode(),n=e.querySelector("."+q+"__body"),r=e.querySelector("."+q+"__body__content"),i=e.querySelector("."+Y+"_highlighted");if(n&&r&&i){var a=n.getBoundingClientRect(),o=r.getBoundingClientRect(),s=i.getBoundingClientRect(),u=0;if(s.bottom>a.bottom){var l=s.bottom-a.bottom+s.height,c=o.bottom-a.bottom;u=-Math.min(l,c),r.style.transform="translateY("+u+"px)"}o.top+u<a.top&&n.classList.add(q+"__body_overflow-top"),o.bottom+u>a.bottom&&n.classList.add(q+"__body_overflow-bottom")}},_reserveSpaceForUpdown:function(){var e=t.getDomNode(),n=e.querySelector("."+q+"__body"),r=e.querySelector("."+$);if(n&&r){var i="."+Y+"__updown:not(:empty)",a=Array.from(e.querySelectorAll(i)).map(function(t){return t.scrollWidth}),o=Math.max.apply(Math,a),s=Math.max(0,Math.ceil(o-15));n.style.paddingRight=s+"px",r.style.paddingRight=s+"px"}}}));return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(n,this,this.settings):n},e.prototype._renderTemplate=function(t,e){var n,r=this.state.highlight.unit,i=r.screenModel,a=i.model,o=a.scaleColor,s=(a.scaleX,a.scaleY),u=this._unitsGroupedData.get(r),l=this._getHighlightRange(t,r),c=l[0],f=l[1],d=function(t){var e=i.model.color(t);return isFinite(c)&&u[c][e]?u[c][e][0]:null},h=d(t),p=r.config.stack,g=!(!r.config.flip&&r.config.guide.obsoleteVerticalStackOrder&&r.config.stack),m=(n=o.domain().slice().reduce(function(t,e,n){return t[e]=n,t},{}),g?function(t,e){return n[t[o.dim]]-n[e[o.dim]]}:function(t,e){return n[e[o.dim]]-n[t[o.dim]]}),y=g?function(t,e){return s(t[s.dim])-s(e[s.dim])}:function(t,e){return s(e[s.dim])-s(t[s.dim])},v=function(t){return Object.keys(u[t]).reduce(function(e,n){return e.concat(u[t][n])},[]).sort(p?m:y)},b=v(f).map(function(t){i.model.color(t);return{data:t,prev:d(t)}});if(isFinite(c)){var x=v(c),_=b.reduce(function(t,e){return t[i.model.color(e.data)]=!0,t},{});x.forEach(function(t){var e=i.model.color(t);_[e]||b.push({data:null,prev:t})}),p&&b.sort(function(t,e){return m(t.data||t.prev,e.data||e.prev)})}return this._template.render({data:t,prev:h,fields:e,groups:b,valueField:s.dim,colorField:o.dim})},e.prototype._getRenderHandler=function(){var e=t.prototype._getRenderHandler.call(this);return function(){var t=this;e.call(this);var n=this._chart,r=n.select(function(t){return"chart"===t.config.namespace&&0===t.config.type.indexOf("ELEMENT.")&&"ELEMENT.INTERVAL_HIGHLIGHT"!==t.config.type}),i=n.select(function(t){return"ELEMENT.INTERVAL_HIGHLIGHT"===t.config.type}).reduce(function(t,e,n){return t[n]=e,t},{});r.forEach(function(e,n){var r=e.data();t._unitsGroupedData.set(e,t._getGroupedData(r,e)),e.on("data-hover",function(r,a){var o=i[n],s=a.unit&&a.unit===e?t._getHighlightRange(a.data,a.unit):null;o.fire("interval-highlight",s)})})}},e.prototype._getSpecReadyHandler=function(){return function(t,e){t.traverseSpec(e,function(t,e){if(0===t.type.indexOf("ELEMENT.")){var n=JSON.parse(JSON.stringify(t));n.type="ELEMENT.INTERVAL_HIGHLIGHT",n.namespace="highlight";var r=e.units.indexOf(t);e.units.splice(r,0,n)}})}},e.prototype._getGroupedData=function(t,e){var n=e.screenModel.model.scaleX,i=tt.groupBy(t,function(t){return n(t[n.dim]).toString()}),a=e.config.guide.x.tickPeriod||e.config.guide.x.timeInterval;if(a){var o=n.domain(),s=e.config.guide.utcTime;r.default.api.tickPeriod.generate(o[0],o[1],a,{utc:s}).filter(function(t){return t>=o[0]&&t<=o[1]}).forEach(function(t){var e=n(t);i[e]||(i[e]=[])})}return Object.keys(i).reduce(function(t,n){return t[n]=tt.groupBy(i[n],function(t){return e.screenModel.model.color(t)}),t},{})},e.prototype._getHighlightRange=function(t,e){var n=e.screenModel.flip,r=e.screenModel.model.scaleX,i=r(t[r.dim]),a=this._unitsGroupedData.get(e),o=Object.keys(a).map(Number).sort(n?function(t,e){return e-t}:function(t,e){return t-e}),s=o.indexOf(i);return 0===s?[i,i]:[o[s-1],i]},e}(X);function nt(t){return new et(t)}r.default.api.unitsRegistry.reg("ELEMENT.INTERVAL_HIGHLIGHT",Q,"ELEMENT.GENERIC.CARTESIAN"),r.default.api.plugins.add("diff-tooltip",nt);var rt=n(17),it=n.n(rt),at=n(18),ot=n(19),st=n.n(ot),ut="Taucharts Export Plug-in:",lt=r.default.api.utils,ct=r.default.api.pluginsSDK,ft=ct.tokens(),dt=function(t,e){return t.replace(new RegExp("^"+e+"+|"+e+"+$","g"),"")},ht=function(t){return(t=Math.round(t))%2?t+1:t},pt=function(t){return null===t||""===t||void 0===t};var gt,mt={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},yt=function(t,e){e=e||"all";var n=document.createElement("style");return n.setAttribute("media",e),n.innerHTML=t,n},vt=yt(st.a,"print"),bt=function(){vt&&vt.parentNode&&vt.parentNode.removeChild(vt),gt&&gt.parentNode&&gt.parentNode.removeChild(gt)};/PhantomJS/.test(navigator.userAgent)||("onafterprint"in window?window.addEventListener("afterprint",bt):window.matchMedia("screen").addListener(function(t){t.matches&&bt()}));var xt=function(t,e,n){var r="data:"+e+";charset=UTF-8,%ef%bb%bf"+encodeURIComponent(n),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",t),i.setAttribute("target","_new"),document.body.appendChild(i),i.click(),document.body.removeChild(i),i=null},_t=function(t){return[].slice.call(t.querySelectorAll("text.label")).forEach(function(t){t.innerHTML=[].slice.call(t.querySelectorAll("tspan")).reduce(function(t,e){var n=e.value||e.text||e.textContent||"";return t+(n=n.charAt(0).toUpperCase()+n.substr(1))},"")}),t},wt=function(t,e,n){n=null==n?"":String(n);var r=(t||{})[e]||{};return(lt.isObject(r.label)?r.label.text:r.label)||n};function Et(t){return{onRender:function(){this._info=ct.extractFieldsFormatInfo(this._chart.getSpec())},_normalizeExportFields:function(t,e){var n=this._info;return t.map(function(t){var e=t,r=n[t]||{};return"string"==typeof t&&(e={field:t,title:r.label||t}),"function"!=typeof e.value&&(e.value=function(t){var e=t[this.field];return r.isComplexField?(e||{})[r.tickLabel]:e}),e}).filter(function(t){return!e.find(function(e){return t.field===e})})},_handleError:function(t){r.default.api.globalSettings.log([ut,t],"error")},_createDataUrl:function(t,e){var n=this;(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.slice(0,t.length-1),r=t[t.length-1];if(0===n.length)return void setTimeout(function(){return r(null,[])},0);var i=lt.range(0,n.length).map(function(){return null}),a=n.map(function(t,e){var n=new XMLHttpRequest;n.onload=function(){if(n.status>=200&&n.status<300){var t=n.responseText;i[e]=t,a.splice(a.indexOf(n),1),0===a.length&&r(null,i)}else a.forEach(function(t){return t.abort()}),r(new Error(n.status+": "+n.statusText),null)},n.onerror=function(t){a.forEach(function(t){return t.abort()}),r(t.error,null)},n.open("GET",t,!0),n.send(null)})}).apply(void 0,this._cssPaths.concat([function(i,a){if(i)e(i,null);else try{var o=a.join(" ").replace(/&/g,""),s=yt(o),u=document.createElement("div");t.fire("beforeExportSVGNode");var l=t.getSVG().cloneNode(!0);t.fire("afterExportSVGNode"),u.appendChild(_t(l)),h.select(l).attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg"),l.insertBefore(s,l.firstChild),n._renderAdditionalInfo(l,t),n._addBackground(l,n._backgroundColor);var c=document.createElement("canvas");c.height=l.getAttribute("height"),c.width=l.getAttribute("width"),it()(c,l.parentNode.innerHTML,{renderCallback:function(t){var n=(new XMLSerializer).serializeToString(t);"<html"===n.substring(0,5).toLowerCase()&&(r.default.api.globalSettings.log("[export plugin]: canvg error","error"),r.default.api.globalSettings.log(n,"error")),e(null,c.toDataURL("image/png"))}})}catch(i){e(i,null)}}]))},_findUnit:function(t){var e=t.getSpec(),n=t.getSpec(),r=function(t){var e=n.scales[t];return e&&e.dim&&e.source&&n.sources[e.source].dims[e.dim]};return ct.depthFirstSearch(e.unit,function(t){if(r(t.color))return!0;if(r(t.size)){var e=n.scales[t.size];return"measure"===n.sources[e.source].dims[e.dim].type}})},_toPng:function(t){var e=this;this._createDataUrl(t,function(t,n){if(t)e._handleError(t);else{for(var r=atob(n.substring("data:image/png;base64,".length)),i=new Uint8Array(r.length),a=0,o=r.length;a<o;++a)i[a]=r.charCodeAt(a);var s=new Blob([i.buffer],{type:"image/png"});Object(at.saveAs)(s,(e._fileName||"export")+".png")}})},_toPrint:function(t){var e=this;this._createDataUrl(t,function(t,n){if(t)e._handleError(t);else{(gt=document.createElement("img")).classList.add("tau-chart__print-block");var r=gt;document.body.appendChild(r),r.src=n,document.head.appendChild(vt),r.onload=function(){window.print()}}})},_toJson:function(t){var e=this._exportFields,n=t.getData(),r=t.getDataDims(),i=e.length?e:Object.keys(r),a=this._normalizeExportFields(i.concat(this._appendFields),this._excludeFields),o=n.map(function(t){return a.reduce(function(e,n){return e[n.title]=n.value(t),e},{})}),s=JSON.stringify(o,null,2),u=(this._fileName||"export")+".json";xt(u,"application/json",s)},_toCsv:function(t){var e=this._csvSeparator,n=this._exportFields,r=t.getData(),i=t.getDataDims(),a=n.length?n:Object.keys(i),o=this._normalizeExportFields(a.concat(this._appendFields),this._excludeFields),s=r.reduce(function(t,n){return t.concat(o.reduce(function(t,e){var r=e.value(n),i=JSON.stringify(r);if(!lt.isDate(r)&&lt.isObject(r))i='"'+i.replace(/"/g,'""')+'"';else{var a=dt(i,'"').replace(/"/g,'""');i=Boolean(['"',",",";","\n","\r"].find(function(t){return a.indexOf(t)>=0}))?'"'+a+'"':a}return t.concat(i)},[]).join(e))},[o.map(function(t){return t.title}).join(e)]).join("\r\n"),u=(this._fileName||"export")+".csv";xt(u,"text/csv",s)},_renderFillLegend:function(e,n,r,i){var a=function(t,e){var n=t[0],r=t[1],i=(r-n)/(e-1),a=lt.range(e-2).map(function(t){return n+i*(t+1)});return[n].concat(a).concat(r)},o=this._unit.getScale("color"),s=wt(e.guide,"color",o.dim).toUpperCase(),u="text-transform:uppercase;font-weight:600;font-size:"+t.fontSize+"px",l=o.domain().sort(function(t,e){return t-e}),c=o.brewer.length,f=t.fontSize,d=a(l,c).reverse().map(function(t,e){return'<stop offset="'+e/(c-1)*100+'%"      style="stop-color:'+o(t)+';stop-opacity:1" />'}),h=a(l,3).reverse().map(function(t,e,n){return'<text x="25" y="'+(100*(e/2)+.5*(0===e?f:e===n.length-1?-f:0)+f/2)+'">'+t+"</text>"}),p=['<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="120" width="100%">',"   <defs>",'       <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">',d.join(""),"       </linearGradient>","   </defs>",'   <text x="0" y="10" style="'+u+'">'+s+"</text>",'   <g transform="translate(0,20)">','       <rect x="0" y="0" height="100" width="20" fill="url(#grad1)">',"       </rect>",h.join(""),"   </g>","   Sorry, your browser does not support inline SVG.","</svg>"].join(""),g=(new DOMParser).parseFromString(p,"application/xml").documentElement;return document.body.appendChild(g),n.append("g").attr("class","legend").attr("transform","translate("+(i+10)+","+t.paddingTop+")").node().appendChild(g),{h:120,w:0}},_renderColorLegend:function(e,n,r,i){var a=this._unit.getScale("color"),o=wt(e.guide,"color",a.dim).toUpperCase(),s=this._getColorMap(r.getChartModelData({excludeFilter:["legend"]}),a,a.dim).values,u=n.append("g").attr("class","legend").attr("transform","translate("+(i+10)+","+t.paddingTop+")");return u.append("text").text(o.toUpperCase()).style({"text-transform":"uppercase","font-weight":"600","font-size":t.fontSize+"px"}),u.selectAll("g").data(s).enter().append("g").call(function(e){e.attr("transform",function(t,e){return"translate(5,"+20*(e+1)+")"}),e.append("circle").attr("r",6).attr("fill",function(t){return a.toColor(t.color)}).attr("class",function(t){return a.toClass(t.color)}),e.append("text").attr("x",12).attr("y",5).text(function(t){return lt.escape(pt(t.label)?"No "+o:t.label)}).style({"font-size":t.fontSize+"px"})}),{h:20*s.length,w:0}},_renderSizeLegend:function(e,n,r,i,a){var o,s,u=this._unit.getScale("size"),l=wt(e.guide,"size",u.dim).toUpperCase(),c=r.getChartModelData().sort(function(t,e){return u(t[u.dim])-u(e[u.dim])}),f=c.length,d=c[0][u.dim],h=c[f-1][u.dim];if(h-d){var p=(s=h-d,Math.log(s)/Math.LN10),g=4-p<0?0:Math.round(4-p),m=Math.pow(10,g),y=(h-d)/5;o=lt.unique([d,d+y,d+2*y,d+3*y,h].map(function(t){return t===h||t===d?t:Math.round(t*m)/m}))}else o=[d];var v=o.map(function(t){var n=u(t),r=n/2;return{diameter:ht(n+2),radius:r,value:t,className:e.color?"color-definite":""}}.bind(this)).reverse(),b=Math.max.apply(null,v.map(function(t){return t.diameter})),x=t.fontSize,_=0,w=n.append("g").attr("class","legend").attr("transform","translate("+(i+10)+","+(t.paddingTop+a.h+20)+")");w.append("text").text(l.toUpperCase()).style({"text-transform":"uppercase","font-weight":"600","font-size":x+"px"}),w.selectAll("g").data(v).enter().append("g").call(function(t){t.attr("transform",function(){var t="translate(5,"+(_+=b)+")";return _+=10,t}),t.append("circle").attr("r",function(t){return t.radius}).attr("class",function(t){return t.className}).style({opacity:.4}),t.append("g").attr("transform",function(){return"translate("+b+","+x/2+")"}).append("text").attr("x",0).attr("y",0).text(function(t){return t.value}).style({"font-size":x+"px"})})},_renderAdditionalInfo:function(t,e){var n=this._findUnit(e);if(n){var r={h:0,w:0};t=h.select(t);var i=parseInt(t.attr("width"),10);t.attr("height");t.attr("width",i+160);var a=e.getScaleInfo(n.color);if(a.dim&&!a.discrete){var o=this._renderFillLegend(n,t,e,i);r.h=o.h+20,r.w=o.w}if(a.dim&&a.discrete){var s=this._renderColorLegend(n,t,e,i);r.h=s.h+20,r.w=s.w}var u=e.getScaleInfo(n.size);u.dim&&!u.discrete&&this._renderSizeLegend(n,t,e,i,r)}},_addBackground:function(t,e){if(e&&"transparent"!==e){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("fill",e),n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height")),t.insertBefore(n,t.firstChild)}},onUnitDraw:function(t,e){r.default.api.isChartElement(e)&&"chart"===e.config.namespace&&(this._unit=e)},_getColorMap:function(t,e,n){return lt.unique(t.map(function(t){var r=t[n];return{color:e(r),value:r,label:r}}),function(t){return t.value}).reduce(function(t,e){return t.brewer[e.value]=e.color,t.values.push(e),t},{brewer:{},values:[]})},_select:function(t,e){var n=this["_to"+(t=t||"").charAt(0).toUpperCase()+t.slice(1)];n&&n.call(this,e)},_handleMenu:function(t,e,n){t.addEventListener("click",function(t){if("a"===t.target.tagName.toLowerCase()){var r=t.target.getAttribute("data-value");this._select(r,e),n.hide()}}.bind(this)),t.addEventListener("mouseover",function(t){"a"===t.target.tagName.toLowerCase()&&t.target.focus()}.bind(this)),t.addEventListener("keydown",function(t){if(t.keyCode===mt.ESCAPE&&n.hide(),t.keyCode===mt.DOWN&&(t.target.parentNode.nextSibling?t.target.parentNode.nextSibling.childNodes[0].focus():t.target.parentNode.parentNode.firstChild.childNodes[0].focus()),t.keyCode===mt.UP&&(t.target.parentNode.previousSibling?t.target.parentNode.previousSibling.childNodes[0].focus():t.target.parentNode.parentNode.lastChild.childNodes[0].focus()),t.keyCode===mt.ENTER){var r=t.target.getAttribute("data-value");this._select(r,e)}t.preventDefault()}.bind(this));var r=null,i=function(){r=setTimeout(function(){n.hide()},100)},a=function(){clearTimeout(r)},o=function(){n.toggle(),n.hidden||t.querySelectorAll("a")[0].focus()};t.addEventListener("blur",i,!0),t.addEventListener("focus",a,!0),this._container.addEventListener("click",o),this._onDestroy(function(){t.removeEventListener("blur",i,!0),t.removeEventListener("focus",a,!0),this._container.removeEventListener("click",o),clearTimeout(r)})},init:function(e){t=t||{},t=lt.defaults(t,{backgroundColor:"white",visible:!0,fontSize:13,paddingTop:30}),this._chart=e,this._info={},this._cssPaths=t.cssPaths,this._fileName=t.fileName,this._backgroundColor=t.backgroundColor||"white",this._destroyListeners=[],this._csvSeparator=t.csvSeparator||",",this._exportFields=t.exportFields||[],this._appendFields=t.appendFields||[],this._excludeFields=t.excludeFields||[],this._cssPaths||(this._cssPaths=[],r.default.api.globalSettings.log('[export plugin]: the "cssPath" parameter should be specified for correct operation',"warn"));var n=t.visible?"":"display:none";this._container=e.insertToHeader('<a class="tau-chart__export" style="'+n+'">Export</a>');var i=e.addBalloon({place:"bottom-left"});i.content(['<ul class="tau-chart__export__list">','<li class="tau-chart__export__item">','   <a data-value="print" tabindex="1">'+ft.get("Print")+"</a>","</li>",'<li class="tau-chart__export__item">','   <a data-value="png" tabindex="2">'+ft.get("Export to png")+"</a>","</li>",'<li class="tau-chart__export__item">','   <a data-value="csv" tabindex="3">'+ft.get("Export to CSV")+"</a>","</li>",'<li class="tau-chart__export__item">','   <a data-value="json" tabindex="4">'+ft.get("Export to JSON")+"</a>","</li>","</ul>"].join("")),i.attach(this._container);var a=i.getElement();a.setAttribute("tabindex","-1"),this._handleMenu(a,e,i);var o=e.on("export-to",function(t,e){var n=e.type,r=e.fileName;this._fileName=r||this._fileName,this._select(n,t)}.bind(this)),s=e.on("exportTo",function(t,e){r.default.api.globalSettings.log([ut,"`exportTo` event is deprecated, use `export-to` instead."],"warn"),this._select(e,t)}.bind(this));this._onDestroy(function(){i.destroy(),e.removeHandler(o),e.removeHandler(s)})},_onDestroy:function(t){this._destroyListeners.push(t)},destroy:function(){this._destroyListeners.forEach(function(t){t.call(this)},this);var t;(t=this._container)&&t.parentElement&&t.parentElement.removeChild(t)}}}r.default.api.plugins.add("export-to",Et);var St=function(){return(St=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Mt=St({},h),Tt=r.default.api.domUtils,Ct=r.default.api.utils,kt=16,At="#E5E7EB",Ot="#FFFFFF",Pt=1,Lt=0,Nt="__transitionAttrs__",Rt="__floatingAxesSrcParent__",Ft="__floatingAxesSrcTransform__",Dt=0,jt=function(){return++Dt};function It(t){var e=Ct.defaults(t||{},{detectBackground:!0,bgcolor:"#fff"});return{init:function(t){this.instanceId=jt(),this.chart=t,this.rootNode=t.getLayout().contentContainer,this.beforeExportHandler=t.on("beforeExportSVGNode",function(){this.removeFloatingLayout()},this),this.afterExportHandler=t.on("afterExportSVGNode",function(){this.createFloatingLayout()},this)},onBeforeRender:function(){this.removeFloatingLayout()},onRender:function(){if(e.detectBackground){var t=this.detectChartBackgroundColor();t&&(e.bgcolor=t)}Ot=e.bgcolor;var n=!0;this.chart.traverseSpec(this.chart.getSpec(),function(t){t&&0===t.type.indexOf("COORDS.")&&("COORDS.RECT"!==t.type?n=!1:"extract-axes"!==(t.guide||{}).autoLayout&&(n=!1))}),n&&this.createFloatingLayout()},destroy:function(){this.removeFloatingLayout(),this.chart.removeHandler(this.beforeExportHandler,this),this.chart.removeHandler(this.afterExportHandler,this)},createFloatingLayout:function(){var t,n,i=this.instanceId,a=this.rootNode,o=this.chart.getSVG(),s=Mt.select(o),u=this.chart.configGPL.settings.animationSpeed,l=this.scrollManager=new Ht(a),c=(t=function(t){var e="> ."+t+".axis.tau-active";return[".frame-root.tau-active "+e,".frame-root.tau-active .cell.tau-active "+e].join(", ")},{x:Array.from(o.querySelectorAll(t("x"))),y:Array.from(o.querySelectorAll(t("y")))}),f=function(){function t(t){return{axis:t,parentTransform:function(t){var e,n={translate0:{x:0,y:0},translate:{x:0,y:0}},r=t;for(;r&&"SVG"!==r.nodeName.toUpperCase();)e=Vt(r),n.translate0.x+=e.translate0.x,n.translate0.y+=e.translate0.y,n.translate.x+=e.translate.x,n.translate.y+=e.translate.y,r=r.parentNode;return n}(t.parentNode),axisTransform:Vt(t)}}return{x:c.x.map(t),y:c.y.map(t)}}(),d=(n=f.y.map(function(t){return t.axisTransform.translate.x+t.parentTransform.translate.x}),Math.max.apply(null,n)+1),p=function(t){return Math.min.apply(null,t)}(f.x.map(function(t){return t.axisTransform.translate.y+t.parentTransform.translate.y}))-1,g=r.default.api.globalSettings.getScrollbarSize(a);var m={scrollLeft:a.scrollLeft,scrollTop:a.scrollTop,visibleWidth:a.clientWidth,visibleHeight:a.clientHeight,scrollbarWidth:g.width,scrollbarHeight:g.height,svgWidth:Number(s.attr("width")),svgHeight:Number(s.attr("height")),minXAxesY:p,maxYAxesX:d},y=function(){var t=s.append("defs").attr("class","floating-axes floating-axes__defs"),e={ns:{x1:0,y1:0,x2:0,y2:1},ew:{x1:1,y1:0,x2:0,y2:0},sn:{x1:0,y1:1,x2:0,y2:0},we:{x1:0,y1:0,x2:1,y2:0}};return Object.keys(e).forEach(function(n){var r=e[n],a=t.append("linearGradient").attr("id","shadow-gradient-"+n+"-"+i).attr("x1",r.x1).attr("y1",r.y1).attr("x2",r.x2).attr("y2",r.y2);a.append("stop").attr("class","floating-axes__shadow-start").attr("offset","0%").attr("stop-color",At).attr("stop-opacity",Pt),a.append("stop").attr("class","floating-axes__shadow-end").attr("offset","100%").attr("stop-color",Ot).attr("stop-opacity",Lt)}),t}();function v(t,e){e.forEach(function(e){e.axis[Rt]=e.axis.parentNode;var n=t.append("g");u?n.attr("transform",zt(e.parentTransform.translate0.x,e.parentTransform.translate0.y)).transition().duration(u).attr("transform",zt(e.parentTransform.translate.x,e.parentTransform.translate.y)):n.attr("transform",zt(e.parentTransform.translate.x,e.parentTransform.translate.y)),n.node().appendChild(e.axis),Array.prototype.forEach.call(e.axis.querySelectorAll(".label"),function(t){t[Ft]=t.getAttribute("transform")})})}var b,x,_=function(){var t=m.svgHeight-m.minXAxesY+1+m.scrollbarHeight,e=s.append("g").attr("class","floating-axes floating-axes__x").call(S,m.svgWidth,t,0,m.minXAxesY);v(e,f.x);var n=e.selectAll(".label");return l.handleVisibilityFor(e,"y").handleVisibilityFor(n,"x").onScroll(function(t,r){var i=Math.min(m.visibleHeight+r-m.svgHeight-m.scrollbarHeight,0);e.attr("transform",zt(0,i)),n.each(function(){var e=Bt(this[Ft]),n=-m.svgWidth+m.visibleWidth+t-10;this.setAttribute("transform","translate("+(e.x+n)+","+e.y+") rotate("+e.r+")")})}),e}(),w=function(){var t=s.append("g").attr("class","floating-axes floating-axes__y").call(S,m.maxYAxesX,m.svgHeight);v(t,f.y);var e=t.selectAll(".label");return l.handleVisibilityFor(t,"x").handleVisibilityFor(e,"y").onScroll(function(n,r){var i=Math.max(n,0);t.attr("transform",zt(i,0)),e.each(function(){var t=Bt(this[Ft]),e=r+10;this.setAttribute("transform","translate("+t.x+","+(t.y+e)+") rotate("+t.r+")")})}),t}(),E=(b=m.svgHeight-m.minXAxesY+m.scrollbarHeight,x=s.append("g").attr("class","floating-axes floating-axes__corner").call(S,m.maxYAxesX,b),l.handleVisibilityFor(x,"xy").onScroll(function(t,e){var n=Math.max(t,0),r=m.minXAxesY,i=Math.min(e+m.visibleHeight-b,r);x.attr("transform",zt(n,i))}),x);function S(t,n,r,i,a){i=i||0,a=a||0,t.append("rect").attr("class","i-role-bg").attr("x",i-1).attr("y",a-1).attr("width",Math.max(0,n+2)).attr("height",Math.max(0,r+2)).attr("fill",e.bgcolor)}var M=function(){var t=m.maxYAxesX,e=m.svgHeight-m.minXAxesY+m.scrollbarHeight,n=s.append("g").attr("class","floating-axes floating-axes__shadows").attr("pointer-events","none"),r=function(t,e,r,a,o){return n.append("rect").attr("fill","url(#shadow-gradient-"+t+"-"+i+")").attr("x",e).attr("y",r).attr("width",Math.max(0,a)).attr("height",Math.max(0,o))},a=r("ns",0,0,t,kt),o=r("ew",m.visibleWidth-kt,m.visibleHeight-e,kt,e),u=r("sn",0,m.visibleHeight-e-kt,t,kt),c=r("we",t,m.visibleHeight-e,kt,e);l.handleVisibilityFor(a,"xy").handleVisibilityFor(o,"xy").handleVisibilityFor(u,"xy").handleVisibilityFor(c,"xy").onScroll(function(t,e){var r=t,i=e;n.attr("transform",zt(r,i));var s=function(t,e){t.style("visibility",e?"":"hidden")};s(a,e>0&&m.svgHeight>m.visibleHeight),s(o,t+m.visibleWidth<m.svgWidth&&m.svgWidth>m.visibleWidth),s(u,e+m.visibleHeight<m.svgHeight&&m.svgHeight>m.visibleHeight),s(c,t>0&&m.svgWidth>m.visibleWidth)})}(),T=_.node(),C=w.node(),k=E.node();l.onScroll(function(t){o.insertBefore(T,0===t?k.nextElementSibling:C)}),l.fireScroll(),this.floatingLayout={defs:y,xAxes:_,yAxes:w,shadows:M},s.selectAll(".floating-axes").on("mouseenter",function(){Tt.dispatchMouseEvent(o,"mouseleave")}).on("mousemove",function(){h.event.stopPropagation()}).on("click",function(){h.event.stopPropagation()})},removeFloatingLayout:function(){function t(t){t.selectAll(".axis").each(function(){this[Rt].appendChild(this),delete this[Rt],Array.prototype.forEach.call(this.querySelectorAll(".label"),function(t){t.setAttribute("transform",t[Ft]),delete t[Ft]})})}this.floatingLayout&&(this.floatingLayout.xAxes.call(t),this.floatingLayout.yAxes.call(t),this.scrollManager.destroy(),this.floatingLayout=null),Mt.select(this.chart.getSVG()).selectAll(".floating-axes").remove()},detectChartBackgroundColor:function(){var t,e=this.chart.getLayout().layout;do{if("none"!==(t=window.getComputedStyle(e)).backgroundImage)return null;if("transparent"!==t.backgroundColor&&"rgba(0, 0, 0, 0)"!==t.backgroundColor)return t.backgroundColor}while(e=e.parentElement);return null}}}function zt(t,e){return"translate("+t+","+e+")"}function Bt(t){var e={x:0,y:0,r:0};if(!t)return e;var n=t.indexOf("translate(");if(n>=0){var r=t.indexOf(")",n+10),i=t.substring(n+10,r).trim().replace(","," ").replace(/\s+/," ").split(" ");e.x=parseFloat(i[0]),i.length>1&&(e.y=parseFloat(i[1]))}var a=t.indexOf("rotate(");if(a>=0){var o=t.indexOf(")",a+7),s=t.substring(a+7,o);e.r=parseFloat(s.trim())}return e}function Vt(t){var e=t[Nt]&&t[Nt].transform,n=Bt(t.getAttribute("transform"));return{translate0:n,translate:e?Bt(t[Nt].transform):n}}function Ht(t){var e={x:[],y:[]},n={x:0,y:0},r={x:null,y:null},i=t,a=[];this.onScroll=function(t){return a.push(t),this},this.handleVisibilityFor=function(t,n){return n.indexOf("x")>=0&&e.x.push(t),n.indexOf("y")>=0&&e.y.push(t),this};var o=function(){var t=i.scrollLeft,o=i.scrollTop;a.forEach(function(e){e.call(null,t,o)});var u=function(i){var a="x"===i?t:o;a!==n[i]&&(clearTimeout(r[i]),s(e[i],function(t){t.transition("floatingAxes_scrollVisibility"),t.attr("opacity",1e-6)}),r[i]=setTimeout(function(){s(e[i],function(t){r[i]=null,t.transition("floatingAxes_scrollVisibility").duration(256).attr("opacity",1)})},128)),n[i]=a};u("x"),u("y")};function s(t,e,n){t.forEach(function(t){e.call(n,t)})}i.addEventListener("scroll",o),this.fireScroll=function(){o.call(null,i.scrollLeft,i.scrollTop)},this.destroy=function(){i.removeEventListener("scroll",o)}}r.default.api.plugins.add("floating-axes",It);var Wt=r.default.api.utils;function Gt(t){Wt.defaults(t||{},{});var e=function(t,e,n,r){t.addEventListener(e,function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.classList.contains(n)&&r(t,e),e=e.parentNode})};return{init:function(t){this._chart=t,this._currentFilters={},this._legendColorByScaleId={};var n=this._chart.getSpec(),r=function(t){return function(e,r){var i=n.scales[r];return i.type===t&&i.dim&&e.push(r),e}};this._color=Object.keys(n.scales).reduce(r("color"),[]),this._fill=Object.keys(n.scales).reduce(r("fill"),[]);var i=this._color.length>0,a=this._fill.length>0;(i||a)&&(this._container=this._chart.insertToRightSidebar(this._containerTemplate),i&&(e(this._container,"click","tau-chart__legend__item-color",function(t,e){this._toggleLegendItem(e)}.bind(this)),e(this._container,"mouseover","tau-chart__legend__item-color",function(t,e){this._highlightToggle(e,!0)}.bind(this)),e(this._container,"mouseout","tau-chart__legend__item-color",function(t,e){this._highlightToggle(e,!1)}.bind(this))))},onSpecReady:function(){this._assignStaticBrewersOrEx()},onRender:function(){this._clearPanel(),this._drawColorLegend(),this._drawFillLegend()},_containerTemplate:'<div class="tau-chart__legend"></div>',_template:Wt.template('<div class="tau-chart__legend"><div class="tau-chart__legend__title"><%=name%></div><%=items%></div>'),_itemTemplate:Wt.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">",'<div class="tau-chart__legend__guide__wrap">','<div class="tau-chart__legend__guide <%=color%>"></div>',"</div>","<%=label%>","</div>"].join("")),_itemFillTemplate:Wt.template(['<div data-value=\'<%=value%>\' class="tau-chart__legend__item tau-chart__legend__item-color" style="padding: 6px 0px 10px 40px;margin-left:10px;">','<div class="tau-chart__legend__guide__wrap" style="top:0;left:0;">','   <span class="tau-chart__legend__guide" style="background-color:<%=color%>;border-radius:0"></span>','   <span style="padding-left: 20px"><%=label%></span>',"</div>","</div>"].join("")),_clearPanel:function(){this._container&&(this._container.innerHTML="")},_drawColorLegend:function(){var t=this;t._color.forEach(function(e){var n=t._chart.select(function(t){return t.config.color===e})[0];if(n){var r=n.getScale("color"),i=t._chart.getDataSources({excludeFilter:["legend"]}),a=Wt.unique(i[r.source].data.map(function(t){return t[r.dim]})).map(function(n){var i=Wt.escape(n),a=r.dim+i;return{scaleId:e,dim:r.dim,color:r(n),disabled:t._currentFilters.hasOwnProperty(a),label:n,value:i}});t._legendColorByScaleId[e]=a,t._container.insertAdjacentHTML("beforeend",t._template({items:a.map(function(e){return t._itemTemplate({scaleId:e.scaleId,dim:e.dim,color:e.color,classDisabled:e.disabled?"disabled":"",label:e.label,value:e.value})}).join(""),name:(((n.guide||{}).color||{}).label||{}).text||r.dim}))}})},_drawFillLegend:function(){var t=this;t._fill.forEach(function(e){var n=t._chart.select(function(t){return"COORDS.MAP"===t.config.type&&t.config.fill===e});if(n.length>0){var r=n[0].getScale("fill"),i=r.brewer,a=r.domain(),o=(a[1]-a[0])/i.length,s=Wt.range(i.length).map(function(e){var n=a[0]+e*o,s="";return 0===e&&(s=a[0]),e===i.length-1&&(s=a[1]),t._itemFillTemplate({color:r(n),label:s,value:Wt.escape(n)})});t._container.insertAdjacentHTML("beforeend",t._template({items:s.join(""),name:(((n[0].guide||{}).fill||{}).label||{}).text||r.dim}))}})},_toggleLegendItem:function(t){var e=t.getAttribute("data-scale-id"),n=t.getAttribute("data-dim"),r=t.getAttribute("data-value"),i=n+r,a=this._legendColorByScaleId[e].filter(function(t){return!t.disabled});if(1!==a.length||e!==a[0].scaleId||r!==a[0].value){var o=this._currentFilters;if(o.hasOwnProperty(i)){var s=o[i];delete o[i],t.classList.remove("disabled"),this._chart.removeFilter(s)}else t.classList.add("disabled"),o[i]=this._chart.addFilter({tag:"legend",predicate:function(t){return t[n]!=r}});this._chart.refresh()}},_highlightToggle:function(t,e){var n=t.getAttribute("data-scale-id"),r=t.getAttribute("data-dim"),i=t.getAttribute("data-value");this._chart.select(function(t){return t.config.color===n}).forEach(function(t){t.fire("highlight",function(t){return!e||t[r]==i})})},_generateColorMap:function(t){var e=Wt.range(20).map(function(t){return"color20-"+(1+t)});return t.reduce(function(t,n,r){return t[n]=e[r%20],t},{})},_assignStaticBrewersOrEx:function(){var t=this;t._color.forEach(function(e){var n=t._chart.getSpec().scales[e],r=t._chart.getDataSources({excludeFilter:["legend"]}),i=t._chart.getScaleFactory(r).createScaleInfoByName(e).domain();n.brewer||(n.brewer="measure"!==n.dimType?t._generateColorMap(i):["#e5f5e0","#a1d99b","#31a354"])})}}}r.default.api.plugins.add("geomap-legend",Gt);var Ut=r.default.api.utils;function Xt(t){Ut.defaults(t||{},{});var e=function(){return!1};return{init:function(t){this._currNode=null,this._currData=null,this._chart=t,this._tooltip=t.addBalloon({spacing:3,auto:!0,effectClass:"fade"}),this._tooltip.content(this.template),this._tooltip.getElement().addEventListener("click",function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.classList.contains("i-role-exclude")&&(n._exclude(),n._tooltip.hide(),n._blurSelection()),e=e.parentNode},!1);var e,n=this;this._showTooltip=function(t){clearTimeout(e),n._currData=t.data;var r="No data";null!==t.data&&(r=Object.keys(t.data).map(function(e){return n.itemTemplate({label:e,value:t.data[e]})}).join(""));var i=n._tooltip.getElement().querySelectorAll(".i-role-content");i[0]&&(i[0].innerHTML=r);var a=n._tooltip.getElement().querySelectorAll(".i-role-exclude");if(a[0]){var o=t.data&&n._chart.getChartModelData().length>1;a[0].style.visibility=o?"visible":"hidden"}n._tooltip.show(t.event.pageX,t.event.pageY).updateSize()},this._hideTooltip=function(t){e=setTimeout(function(){n._tooltip.hide()},t?0:1e3)},this._tooltip.getElement().addEventListener("mouseover",function(t){clearTimeout(e)},!1),this._tooltip.getElement().addEventListener("mouseleave",function(t){n._hideTooltip(!0),n._blurSelection()},!1)},onRender:function(){var t=this;this._chart.select(function(t){return"COORDS.MAP"===t.config.type}).forEach(function(e){t._subscribeToPoints(e),t._subscribeToArea(e)})},template:['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">','<div class="tau-chart__tooltip__button i-role-exclude">','<div class="tau-chart__tooltip__button__wrap">','<span class="tau-icon-close-gray"></span>',"Exclude","</div>","</div>","</div>",'<div class="i-role-content tau-chart__tooltip__content"></div>'].join(""),itemTemplate:Ut.template(['<div class="tau-chart__tooltip__list__item">','<div class="tau-chart__tooltip__list__elem"><%=label%></div>','<div class="tau-chart__tooltip__list__elem"><%=value%></div>',"</div>"].join("")),_exclude:function(){var t;this._chart.addFilter({tag:"exclude",predicate:(t=this._currData,function(e){return JSON.stringify(e)!==JSON.stringify(t)})}),this._chart.refresh()},_blurSelection:function(){this._chart.select(function(t){return"COORDS.MAP"===t.config.type}).forEach(function(t){t.fire("highlight-area",e)}),this._currNode=null,this._currData=null},_subscribeToPoints:function(t){var e=this;t.on("point-mouseover",function(t,n){e._showTooltip(n)}),t.on("point-mouseout",function(t,n){e._hideTooltip()})},_subscribeToArea:function(t){var e=this;!t.getScale("code").dim||t.on("area-click",function(n,r){var i,a;e._currNode=n,r.data?e._currData===r.data?(e._hideTooltip(!0),e._blurSelection()):(t.fire("highlight-area",(i=r.data,a=JSON.stringify(i),function(t){return JSON.stringify(t)===a})),e._showTooltip(r)):(e._showTooltip(r),e._hideTooltip(!1),e._blurSelection())})}}}r.default.api.plugins.add("geomap-tooltip",Xt);var qt=n(2),Yt=r.default.api.utils,$t=r.default.api.pluginsSDK,Kt=$t.tokens();function Jt(t){var e=Yt.defaults(t||{},{title:"Layers",label:"Layer Type",showPanel:!0,showLayers:!0,mode:"merge",axisWidth:45,layers:[]});e.layers.forEach(function(t){t.guide=Yt.defaults(t.guide||{},{scaleOrient:"left",textAnchor:"end",hide:!1})});var n=function(t){return function(e){return Object.assign(e,t)}},r={line:n({type:"ELEMENT.LINE"}),area:n({type:"ELEMENT.AREA"}),dots:n({type:"ELEMENT.POINT"}),scatterplot:n({type:"ELEMENT.POINT"}),bar:n({type:"ELEMENT.INTERVAL"}),"stacked-bar":n({type:"ELEMENT.INTERVAL",stack:!0})};return{init:function(t){this._chart=t;var n=$t.spec(this._chart.getSpec()),r=this.checkIfApplicable(n);if(this._isApplicable=0===r.length,n.addTransformation("defined-only",function(t,e){var n=e.key;return t.filter(function(t){return null!==t[n]&&void 0!==t[n]})}),this._isApplicable){this.isFacet=this.checkIsFacet(n),this.primaryY=this.findPrimaryLayer(n);var i=this.getLayersText(),a=this.getLayersGroup(),o=e.label;this.fieldColorScale=o,n.setSettings("excludeNull",!1).setSettings("fitModel",null).addScale(o,{type:"color",source:"/",dim:o,brewer:e.brewer}).addTransformation("slice-layer",function(t,e){var n=e.key,r=e.group;return r?t.filter(function(t){var e=t[r],n=t[e];return e&&null!=n}):t.filter(function(t){return t[o]===i[n]&&null!==t[n]&&void 0!==t[n]})});var s=[this.primaryY].concat(e.layers).reduce(function(t,e){return t.concat(e.y)},[]);t.setupChartSourceModel(function(t){var e={};e[o]={type:"category"};var n={"/":{dims:e,data:[]}};return n["/"].dims=Object.assign(e,t["/"].dims),n["/"].data=t["/"].data.reduce(function(t,e){return t.concat(s.map(function(t){var n={};n[o]=i[t];var r=a[t];return r&&(n[r]=e[t],n.subLayer=r),Object.assign(n,e)}))},[]),Object.assign(n,Yt.omit(t,"/"))}),e.showPanel&&(this._container=t.insertToRightSidebar(this.containerTemplate),this._container.classList.add("applicable-true"),this.uiChangeEventsDispatcher=function(t){var n=t.target,r=n.classList;r.contains("i-role-show-layers")&&(e.showLayers=n.checked),r.contains("i-role-change-mode")&&(e.mode=n.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1))}else{n.getSettings("log")("[layers plugin]: is not applicable. "+r.join(" / "))}},getLayersText:function(){return[this.primaryY].concat(e.layers).reduce(function(t,e){return(Array.isArray(e.y)?e.y:[e.y]).reduce(function(t,n){return t[n]=this.extractLabelForKey(e,n),t}.bind(this),t)}.bind(this),{})},getLayersGroup:function(){return[this.primaryY].concat(e.layers).reduce(function(t,e){var n=null;return Array.isArray(e.y)&&(n=e.y.join(", ")),Yt.flatten([e.y]).reduce(function(t,e){return t[e]=n,t},t)}.bind(this),{})},checkIsFacet:function(t){return t.unit().reduce(function(t,e,n){return t||(n&&"COORDS.RECT"===n.type&&"COORDS.RECT"===e.type?t=!0:t)},!1)},checkIfApplicable:function(t){return t.unit().reduce(function(e,n,r){if(r&&"COORDS.RECT"!==r.type)return e.concat("Chart specification contains non-rectangular coordinates");if(r&&"COORDS.RECT"===r.type&&"COORDS.RECT"!==n.type){var i=t.getScale(n.y);if("measure"!==t.getSourceDim(i.source,i.dim).type)return e.concat("Y scale is not a measure")}return e},[])},isLeafElement:function(t,e){return e&&"COORDS.RECT"===e.type&&"COORDS.RECT"!==t.type},isFirstCoordNode:function(t,e){return!e&&t&&"COORDS.RECT"===t.type},isFinalCoordNode:function(t,e){return t&&"COORDS.RECT"===t.type&&t.units.every(function(t){return"COORDS.RECT"!==t.type})},buildLayersLayout:function(t){return t.regSource("$",{dims:{x:{type:"category"},y:{type:"category"}},data:[{x:1,y:1}]}).addScale("xLayoutScale",{type:"ordinal",source:"$",dim:"x"}).addScale("yLayoutScale",{type:"ordinal",source:"$",dim:"y"}).unit({type:"COORDS.RECT",x:"xLayoutScale",y:"yLayoutScale",expression:{source:"$",inherit:!1,operator:!1},guide:{showGridLines:"",x:{cssClass:"facet-axis"},y:{cssClass:"facet-axis"}}})},findPrimaryLayer:function(t){var e=this,n=t.unit().reduce(function(n,r){return n.concat(e.isFinalCoordNode(r)?{y:t.getScale(r.y).dim,isPrimary:!0,guide:r.guide.y,scaleName:r.y}:[])},[]);return $t.cloneObject(n[0])},createPrimaryUnitReducer:function(t,n,r,i){var a=this;return function(o,s,u){var l=function(t){return!0!==t.guide.hide};if(a.isFacet&&a.isFirstCoordNode(s,u)){s.guide.y.label=s.guide.y.label||{};var c=s.guide.y.label._original_text||s.guide.y.label.text;s.guide.y.label.text=[c,n.filter(l).map(a.extractLayerLabel.bind(a)).join(", ")].join(t.getSettings("facetLabelDelimiter")),"dock"===e.mode&&(s.guide.y.label.padding-=15,s.guide.y.padding+=15,s.guide.y.rotate=-90,s.guide.y.textAnchor="middle")}return a.isLeafElement(s,u)&&(u.units=u.units.filter(function(t){return t!==s})),a.isFinalCoordNode(s)&&(s.guide.y.label=s.guide.y.label||{},"dock"===e.mode&&(s.guide.padding.l=r,s.guide.padding.r=i,s.guide.y.hide=!0),"merge"===e.mode&&(s.guide.y.label.text=a.isFacet?"":n.filter(l).map(a.extractLayerLabel.bind(a)).join(", "))),o}},createSecondaryUnitReducer:function(t,n,i,a,o,s,u,l){var c=this,f=c.getScaleName(n.scaleName||n.y),d=n.guide.scaleOrient,h=Array.isArray(n.y),p=n.isPrimary;return function(g,m,y){if(c.isFacet&&c.isFirstCoordNode(m,y)&&(m.guide.y.label.text="",m.guide.x.hide=!0,m.guide.y.hide=!0),c.isLeafElement(m,y)){(n.type?r[n.type]:function(t){return t})(m),m.y=f;var v=t.getScale(m.size).dim;if(p&&v);else{var b="size_null"+l;t.addScale(b,{type:"size",source:"?",mid:1}),m.size=b}var x=t.getScale(m.color).dim;p&&x||(m.color=c.fieldColorScale,m.expression.operator="groupBy",m.expression.params=h?["subLayer"]:[c.fieldColorScale]);var _=h?{group:"subLayer"}:{key:n.y};$t.unit(m).addTransformation("slice-layer",_)}if(c.isFinalCoordNode(m)){if(m.y=f,m.guide.y=Object.assign(m.guide.y,n.guide||{}),m.guide.y.label=m.guide.y.label||{},m.guide.y.label.text=c.extractLayerLabel(n),m.guide.x.hide=!0,"dock"===e.mode){m.guide.showGridLines="",m.guide.padding.l=i,m.guide.padding.r=a,m.guide.y.label.textAnchor="end",m.guide.y.label.dock="right",m.guide.y.label.padding="right"===d?1:-10,m.guide.y.label.cssClass="label inline";var w="right"===d?u:s;m.guide.y.padding+=o*w}"merge"===e.mode&&(m.guide.showGridLines="",m.guide.y.hide=!0)}return g}},getScaleName:function(t){return Array.isArray(t)?t.join(", "):t},extractLabelForKey:function(t,e){var n=t.guide||{};n.label="string"==typeof n.label?{text:n.label}:n.label;var r=n.label||{},i=r.byKeys||{};return Array.isArray(t.y)?i[e]||e:r.text||r._original_text||t.y},extractLayerLabel:function(t){var e=this;return(Array.isArray(t.y)?t.y:[t.y]).map(function(n){return e.extractLabelForKey(t,n)}).join(", ")},onSpecReady:function(t,n){var r=this,i=$t.spec(n);if(e.showLayers&&r._isApplicable){i=e.layers.reduce(function(t,e){var n=r.getScaleName(e.y);return t.addScale(n,Object.assign({type:"linear",source:"/",dim:n,autoScale:!0},Yt.pick(e.guide||{},"min","max","autoScale","nice","niceInterval")))},i);var a,o=[this.primaryY].concat(e.layers).sort(function(t,e){return(t.guide.zIndex||0)-(e.guide.zIndex||0)}),s=i.unit(),u=e.axisWidth,l=function(t){return function(e){var n=e.guide.scaleOrient||"left";return!0!==e.guide.hide&&n===t}},c=l("left"),f=l("right"),d=o.filter(c).length*u,h=o.filter(f).length*u,p=r.buildLayersLayout(i).addFrame({key:{x:1,y:1},units:[(a=$t.unit(s.clone())).reduce(r.createPrimaryUnitReducer(i,o,d,h),a).value()]}),g=-1,m=-1;o.reduce(function(t,e,n){return g=c(e)?g+1:g,m=f(e)?m+1:m,t.addFrame({key:{x:1,y:1},units:[(a=$t.unit(s.clone())).reduce(r.createSecondaryUnitReducer(i,e,d,h,u,g,m,n),a).value()]})},p)}else i.unit().traverse(function(t,e){r.isLeafElement(t,e)&&$t.unit(t).addTransformation("defined-only",{key:i.getScale(t.y).dim})})},onUnitsStructureExpanded:function(){var t=this;if(t._isApplicable&&"merge"===e.mode){var n=$t.spec(t._chart.getSpec()),r=t.primaryY.scaleName,i=e.layers.map(function(e){return t.getScaleName(e.y)}).filter(function(t){return n.getScale(t)}).concat(r),a=i.reduce(function(e,n){var r=t._chart.getScaleInfo(n);return e[n]=r.domain().filter(function(t){return Number.isFinite(t)}),e},{}),o=qt.extent(Yt.flatten(Object.keys(a).map(function(t){return a[t]})));i.forEach(function(t){var e=n.getScale(t);e.min=o[0],e.max=o[1],e.nice=!1})}},containerTemplate:'<div class="tau-chart__trendlinepanel"></div>',template:Yt.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">','   <input type="checkbox"','          class="tau-chart__checkbox__input i-role-show-layers"','          <%= (showLayers ? "checked" : "") %>',"   />",'   <span class="tau-chart__checkbox__icon"></span>','   <span class="tau-chart__checkbox__text"><%= title %></span>',"</label>","<div>",'<select class="i-role-change-mode tau-chart__select tau-chart__trendlinepanel__control">','   <option <%= ((mode === "dock")  ? "selected" : "") %> value="dock">'+Kt.get("Dock")+"</option>",'   <option <%= ((mode === "merge") ? "selected" : "") %> value="merge">'+Kt.get("Merge")+"</option>","</select>","</div>"].join("")),onRender:function(){this._isApplicable&&e.showPanel&&(this._container.innerHTML=this.template({title:e.title,mode:e.mode,showLayers:e.showLayers}))}}}r.default.api.plugins.add("layers",Jt);var Qt,Zt,te=n(6),ee=r.default.api.utils,ne=r.default.api.pluginsSDK,re=".tau-chart__legend__reset",ie=".tau-chart__legend__item-color",ae=".tau-chart__legend__guide--color__overlay",oe=4,se=13,ue=0,le=function(){return++ue},ce=r.default.api.utils.xml,fe=function(t,e){var n=t[0],r=t[1],i=(r-n)/(e-1),a=ee.range(e-2).map(function(t){return n+i*(t+1)});return[n].concat(a).concat(r)},de=function(t,e,n){if(t.length<3)return t.slice(0);if(e<3)return[t[0],t[t.length-1]];var r,i=t[0]<0?Math.abs(t[0]):0,a=function(t){return t},o="sqrt"===n?function(t){return Math.sqrt(t+i)}:a,s="sqrt"===n?function(t){return Math.pow(t,2)-i}:a,u=[(t=t.map(o))[0]],l=t[t.length-1]-t[0],c=.5*l/(e-1),f=ee.range(1,e-1).map(function(t){var n=l*t/(e-1);return{min:n-c,mid:n,max:n+c,diff:Number.MAX_VALUE,closest:null}}),d=0,h=function(){if(d!==f.length){var t=r;(r=f[d++]).min=Math.max(r.min,(t&&null!==t.closest?t.closest:u[0])+c)}};return h(),t.forEach(function(t){if(!(t<r.min)){t>r.max&&h();var e=Math.abs(t-r.mid);e<r.diff&&e<c?(r.diff=e,r.closest=t):h(),0===e&&h()}}),f.forEach(function(t){null!==t.closest&&u.push(t.closest)}),u.push(t[t.length-1]),u=u.map(s)},he=function(t){return Math.log(t)/Math.LN10},pe=function(t){return 0===t?0:Math.floor(he(Math.abs(t)))},ge=(Qt=/\.0+([^\d].*)?$/,Zt=/(\.\d+?)0+([^\d].*)?$/,function(t){return t.replace(Qt,"$1").replace(Zt,"$1$2")}),me=te.format(".3s"),ye=function(t){return ge(me(t))},ve=function(t,e){var n=Math.max(Math.abs(t),Math.abs(e)),r=pe(n),i=t*e>0?Math.abs(e-t):n,a=pe(i),o=Math.abs(r-a);return Math.abs(r)>3&&o<=3?ye:function(t){var e=pe(n-t),r=Math.min((a<0?Math.abs(a):0)+(e<a?1:0),20);return ge(t.toFixed(r))}};function be(t){var e=!0,n=ee.defaults(t||{},{formatters:{},onSelect:function(){}}),r=function(t){return null===t||""===t||void 0===t},i=function(t){return t.every(function(t){return ee.isDate(t)})},a=function(t,e){return function(n){var i=n[t],a=JSON.stringify(r(i)?null:i);return e===a}},o=function(t,e,n,r){t.addEventListener(e,function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.matches(n)&&r(t,e),e=e.parentNode})};return{init:function(t){var e=this;this.instanceId=le(),this._chart=t,this._currentFilters={},this._legendColorByScaleId={},this._legendOrderState={};var r=this._chart.getSpec(),i=function(t){return function(e,n){var i=r.scales[n];return i.type===t&&i.dim&&e.push(n),e}};this._color=Object.keys(r.scales).reduce(i("color"),[]).filter(function(e){return t.getScaleInfo(e).discrete}),this._fill=Object.keys(r.scales).reduce(i("color"),[]).filter(function(e){return!t.getScaleInfo(e).discrete}),this._size=Object.keys(r.scales).reduce(i("size"),[]);var a=this._color.length>0,s=this._fill.length>0,u=this._size.length>0;if(this._assignStaticBrewersOrEx(),a||s||u){switch(n.position){case"left":this._container=this._chart.insertToLeftSidebar(this._containerTemplate);break;case"right":this._container=this._chart.insertToRightSidebar(this._containerTemplate);break;case"top":this._container=this._chart.insertToHeader(this._containerTemplate);break;case"bottom":this._container=this._chart.insertToFooter(this._containerTemplate);break;default:this._container=this._chart.insertToRightSidebar(this._containerTemplate)}a&&(o(this._container,"click",re,function(t,n){e._toggleLegendItem(n,"reset")}),o(this._container,"click",ie,function(t,n){var r=t.ctrlKey||t.target.matches(ae)?"leave-others":"focus-single";e._toggleLegendItem(n,r)}),o(this._container,"mouseover",ie,function(t,n){e._highlightToggle(n,!0)}),o(this._container,"mouseout",ie,function(t,n){e._highlightToggle(n,!1)}))}},destroy:function(){var t=this._currentFilters,e=this._chart;Object.keys(t).forEach(function(n){return e.removeFilter(t[n])}),this._container&&this._container.parentElement&&(this._clearPanel(),this._container.parentElement.removeChild(this._container))},onSpecReady:function(t,e){this._formatters=ne.getFieldFormatters(e,n.formatters)},_getFormat:function(t){return this._formatters[t]?this._formatters[t].format:function(t){return String(t)}},onRender:function(){var t=this;if(e&&n.selectedCategories&&0!==n.selectedCategories.length){var r=this._getLegendColorByScales();return Object.keys(r).forEach(function(e){r[e].legendColorItems.forEach(function(e){var r=e.value,i=e.dim;if(-1===n.selectedCategories.indexOf(JSON.parse(r))){var o=i+r,s=a(i,r);t._currentFilters[o]=t._chart.addFilter({tag:"legend",predicate:function(t){return!s(t)}})}})}),e=!1,void this._chart.refresh()}this._clearPanel(),this._drawColorLegend(),this._drawFillLegend(),this._drawSizeLegend()},_containerTemplate:'<div class="tau-chart__legend"></div>',_template:ee.template(['<div class="tau-chart__legend__wrap">',"<%=top%>",'<div class="tau-chart__legend__title"><%=name%></div>',"<%=items%>","</div>"].join("")),_itemTemplate:ee.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">",'   <div class="tau-chart__legend__guide__wrap">','   <div class="tau-chart__legend__guide tau-chart__legend__guide--color <%=cssClass%>"','        style="background-color: <%=cssColor%>; border-color: <%=borderColor%>;">','       <div class="tau-chart__legend__guide--color__overlay">',"       </div>","   </div>","   </div>",'   <span class="tau-chart__legend__guide__label"><%=label%></span>',"</div>"].join("")),_resetTemplate:ee.template(['<div class="tau-chart__legend__reset <%=classDisabled%>">','    <div role="button" class="tau-chart__button">Reset</div>',"</div>"].join("")),_clearPanel:function(){this._container&&(clearTimeout(this._scrollTimeout),this._getScrollContainer().removeEventListener("scroll",this._scrollListener),this._container.innerHTML="")},_drawFillLegend:function(){var t=this;t._fill.forEach(function(e){var n,r,a,o=t._chart.select(function(t){return t.config.color===e})[0];if(o){var s=o.config.guide||{},u=o.getScale("color"),l=u.domain().sort(function(t,e){return t-e}),c=i(l),f=c?l.map(Number):l,d=ve(f[0],f[f.length-1]),h=function(){var e=t._chart.getSpec(),n=ne.extractFieldsFormatInfo(e)[u.dim].format;return n||(n=function(t){return new Date(t)}),function(t){return String(n(t))}}(),p=c?h:d,g=u.brewer.length,m=((s.color||{}).label||{}).text||u.dim,y=function(t){return t.length*se*.618},v=u.isInteger?(f[1]-f[0])%3==0?4:(f[1]-f[0])%2==0?3:2:3,b=fe(f,v),x=(c?b.map(function(t){return new Date(t)}):b).map(p);x[0]===x[x.length-1]&&(x=[x[0]]),t._container.insertAdjacentHTML("beforeend",t._template({name:ee.escape(m),top:null,items:'<div class="tau-chart__legend__gradient-wrapper"></div>'}));var _=t._container.lastElementChild.querySelector(".tau-chart__legend__gradient-wrapper"),w=_.getBoundingClientRect().width,E=!1;x.reduce(function(t,e){return t+y(e)},0)>w&&(x.length>1&&y(x[0])+y(x[x.length-1])>w?E=!0:x=[x[0],x[x.length-1]]);var S=E?(a=-.382*se/2,{width:w,height:120,barX:0,barY:0,barWidth:20,barHeight:120,textAnchor:"start",textX:ee.range(v).map(function(){return 25}),textY:1===x.length?60+.618*se:x.map(function(t,e){var n=(x.length-1-e)/(x.length-1);return se*(1-n)+120*n+a})}):(n=y(x[0])/2,r=y(x[x.length-1])/2,{width:w,height:28+se,barX:0,barY:0,barWidth:w,barHeight:20,textAnchor:"middle",textX:1===x.length?[w/2]:x.map(function(t,e){var i=e/(x.length-1);return n*(1-i)+(w-r)*i}),textY:ee.range(v).map(function(){return 28+se})}),M=fe(f,g).map(function(t,e){return ce("stop",{offset:e/(g-1)*100+"%",style:"stop-color:"+u(t)+';stop-opacity:1"'})}),T="legend-gradient-"+t.instanceId,C=ce.apply(void 0,["svg",{class:"tau-chart__legend__gradient",width:S.width,height:S.height},ce("defs",ce.apply(void 0,["linearGradient",{id:T,x1:"0%",y1:E?"100%":"0%",x2:E?"0%":"100%",y2:"0%"}].concat(M))),ce("rect",{class:"tau-chart__legend__gradient__bar",x:S.barX,y:S.barY,width:S.barWidth,height:S.barHeight,fill:"url(#"+T+")"})].concat(x.map(function(t,e){return ce("text",{x:S.textX[e],y:S.textY[e],"text-anchor":S.textAnchor},t)})));_.insertAdjacentHTML("beforeend",C)}})},_drawSizeLegend:function(){var t=this;t._size.forEach(function(e){var n=t._chart.select(function(t){return t.config.size===e})[0];if(n){var r=n.config.guide||{},i=n.getScale("size"),a=i.domain().sort(function(t,e){return t-e});if(!Array.isArray(a)||!a.every(isFinite))return;var o=((r.size||{}).label||{}).text||i.dim,s=a[0],u=a[a.length-1],l=[s];if(u-s){var c=he(u-s),f=Math.round(4-c),d=Math.pow(10,f),h=ee.unique(t._chart.getDataSources({excludeFilter:["legend"]})[i.source].data.map(function(t){return t[i.dim]}).filter(function(t){return t>=s&&t<=u})).sort(function(t,e){return t-e}),p=de(h,oe,i.funcType);l=ee.unique(p.map(function(t){return Math.round(t*d)/d}))}var g=ve(l[0],l[l.length-1]),m=function(t){return t.length*se*.618};l.reverse();var y=l.map(i),v=Math.max.apply(null,y),b=l.map(g);t._container.insertAdjacentHTML("beforeend",t._template({name:ee.escape(o),top:null,items:'<div class="tau-chart__legend__size-wrapper"></div>'}));var x=t._container.lastElementChild.querySelector(".tau-chart__legend__size-wrapper"),_=x.getBoundingClientRect().width,w=!1;(Math.max.apply(null,b.map(m))>_/4||1===b.length)&&(w=!0);var E=w?function(){for(var t=se,e=y[0]/2,n=y[y.length-1]/2,r=[e],i=1,a=void 0,o=void 0;i<y.length;i++)o=y[i-1]/2,a=y[i]/2,r.push(r[i-1]+Math.max(1.618*se,o+t+a));var s=.618*se/2;return{width:_,height:r[r.length-1]+Math.max(n,se/2),circleX:ee.range(y.length).map(function(){return v/2}),circleY:r,textAnchor:"start",textX:ee.range(b.length).map(function(){return v+8}),textY:r.map(function(t){return t+s})}}():function(){for(var t=Math.max(m(b[0])/2,y[0]/2),e=Math.max(m(b[b.length-1])/2,y[y.length-1]/2),n=(_-y.reduce(function(t,e,n){return t+(0===n||n===y.length-1?e/2:e)},0)-t-e)/(oe-1),r=[t],i=1,a=void 0,o=void 0;i<y.length;i++)o=y[i-1]/2,a=y[i]/2,r.push(r[i-1]+o+n+a);var s=y.map(function(t){return v-t/2});return{width:_,height:v+8+se,circleX:r,circleY:s,textAnchor:"middle",textX:r,textY:ee.range(b.length).map(function(){return v+8+se})}}(),S=ce.apply(void 0,["svg",{class:"tau-chart__legend__size",width:E.width,height:E.height}].concat(y.map(function(t,e){return ce("circle",{class:"tau-chart__legend__size__item__circle "+(n.config.color?"color-definite":"color-default-size"),cx:E.circleX[e],cy:E.circleY[e],r:t/2})}),b.map(function(t,e){return ce("text",{class:"tau-chart__legend__size__item__label",x:E.textX[e],y:E.textY[e],"text-anchor":E.textAnchor},t)})));x.insertAdjacentHTML("beforeend",S)}})},_getLegendColorByScales:function(){var t=this;return t._color.reduce(function(e,n){var a=t._chart.select(function(t){return t.config.color===n})[0];if(a){var o=a.config.guide||{},s=a.getScale("color"),u=t._chart.getDataSources({excludeFilter:["legend"]}),l=ee.unique(u[s.source].data.map(function(t){return t[s.dim]})),c=t._chart.getSpec().scales[n],f=i(l);if(c.order)l=ee.union(ee.intersection(c.order,l),l);else if("order"===c.dimType&&f)l=l.sort(function(t,e){return new Date(t)-new Date(e)});else{var d=t._legendOrderState[n];l=l.sort(function(t,e){var n=d[t]-d[e];return n&&n/Math.abs(n)})}var h=((o.color||{}).label||{}).text||s.dim,p=(o.color||{}).tickFormatNullAlias||"No "+h,g=t._getFormat(s.dim),m=l.map(function(e){var i=JSON.stringify(r(e)?null:e),a=s.dim+i;return{scaleId:n,dim:s.dim,color:s(e),disabled:t._currentFilters.hasOwnProperty(a),label:g(e),value:i}});e[n]={legendColorItems:m,title:h,colorScale:s,noVal:p}}return e},{})},_drawColorLegend:function(){var t=this,e=this._getLegendColorByScales();Object.keys(e).forEach(function(n){var i=e[n],a=i.legendColorItems,o=i.title,s=i.colorScale,u=i.noVal;t._container.insertAdjacentHTML("beforeend",t._template({name:ee.escape(o),top:t._resetTemplate({classDisabled:a.some(function(t){return t.disabled})?"":"disabled"}),items:a.map(function(e){return t._itemTemplate({scaleId:e.scaleId,dim:ee.escape(e.dim),color:e.color,cssClass:s.toClass(e.color),cssColor:e.disabled?"transparent":s.toColor(e.color),borderColor:s.toColor(e.color),classDisabled:e.disabled?"disabled":"",label:ee.escape(r(e.label)?u:e.label),value:ee.escape(e.value)})}).join("")}))}),t._color.length>0&&(t._updateResetButtonPosition(),t._scrollTimeout=null,t._scrollListener=function(){var e=t._container.querySelector(re);e.style.display="none",t._scrollTimeout&&clearTimeout(t._scrollTimeout),t._scrollTimeout=setTimeout(function(){t._updateResetButtonPosition(),e.style.display="",t._scrollTimeout=null},250)},t._getScrollContainer().addEventListener("scroll",t._scrollListener))},_toggleLegendItem:function(t,e){var r=this,i=this._currentFilters,o=t?Array.prototype.filter.call(t.parentNode.childNodes,function(t){return t.matches(ie)}):null,s=function(t){var e=t.getAttribute("data-dim"),n=t.getAttribute("data-value");return{sid:t.getAttribute("data-scale-id"),dim:e,val:n,key:e+n}},u=function(t){return t in i},l=function(t,e){var n=s(t);if(u(n.key)===e)if(e){var o=i[n.key];delete i[n.key],t.classList.remove("disabled"),r._chart.removeFilter(o)}else{t.classList.add("disabled");var l=a(n.dim,n.val);i[n.key]=r._chart.addFilter({tag:"legend",predicate:function(t){return!l(t)}})}},c=function(e){return e===t},f=!!t&&u(s(t).key),d=function(t,e){t.querySelector(".tau-chart__legend__guide").style.backgroundColor=e?"":"transparent"};if("reset"===e)o.forEach(function(t){l(t,!0),d(t,!0)});else if("leave-others"===e)o.forEach(function(t){c(t)&&l(t,f)}),d(t,f);else if("focus-single"===e){var h=!f&&o.every(function(t){return c(t)||u(s(t).key)});o.forEach(function(t){var e=c(t)||h;l(t,e)}),f&&d(t,!0)}var p=o.filter(function(t){return!u(s(t).key)}).map(function(t){return JSON.parse(s(t).val)});n.onSelect({type:e,selectedCategories:p}),this._chart.refresh()},_highlightToggle:function(t,e){if(!t.matches(".disabled")){var n=t.getAttribute("data-dim"),r=t.getAttribute("data-value"),i=e?a(n,r):function(t){return null};this._chart.select(function(t){return!0}).forEach(function(t){t.fire("highlight",i)})}},_getScrollContainer:function(){return this._container.parentNode.parentNode},_updateResetButtonPosition:function(){this._container.querySelector(re).style.top=this._getScrollContainer().scrollTop+"px"},_generateColorMap:function(t,e){var n=e.length;return t.reduce(function(t,r,i){return t[r]=e[i%n],t},{})},_assignStaticBrewersOrEx:function(){var t=this;t._color.forEach(function(e){var n=t._chart.getSpec().scales[e],r=t._chart.getDataSources({excludeFilter:["legend"]}),i=t._chart.getScaleFactory(r).createScaleInfoByName(e).domain();if(!n.brewer||Array.isArray(n.brewer)){var a=n.brewer||ee.range(20).map(function(t){return"color20-"+(1+t)});n.brewer=t._generateColorMap(i,a)}t._legendOrderState[e]=i.reduce(function(t,e,n){return t[e]=n,t},{})})}}}r.default.api.plugins.add("legend",be);var xe=r.default.api.utils;function _e(t){var e=xe.defaults(t||{},{verbose:!1,forceBrush:{}}),n={init:function(t){e.verbose&&(this.panel=t.insertToRightSidebar(this.template())),t.traverseSpec(t.getSpec(),function(t){t&&"COORDS.PARALLEL"===t.type&&(t.guide=t.guide||{},t.guide.enableBrushing=!0)}),n.forceBrush=e.forceBrush||{}},onRender:function(t){var r=t.getSpec().scales,i=Object.keys(r).reduce(function(t,e){var i=r[e].dim;return n.forceBrush[i]&&(t[e]=n.forceBrush[i]),t},{}),a=t.select(function(t){return"PARALLEL/ELEMENT.LINE"===t.config.type});a.forEach(function(t,r){t.parentUnit.on("brush",function(i,a){n.forceBrush={};var o=a.map(function(t){var e=t.dim,r=t.func,i=t.args;n.forceBrush[e]=i;var a=function(){return!0};return"between"===r&&(a=function(t){return t[e]>=i[0]&&i[1]>=t[e]}),"inset"===r&&(a=function(t){return i.indexOf(t[e])>=0}),a}),s=0;if(t.fire("highlight",function(t){var e=o.every(function(e){return e(t)});return s+=e?1:0,e}),e.verbose){var u=n.panel.getElementsByClassName("i-"+r);if(0===u.length){var l=document.createElement("div");l.className="i-"+r,n.panel.appendChild(l),u[0]=l}u[0].innerHTML=a.reduce(function(t,e){return t+"<div>"+e.dim+": ["+e.args.join(",")+"]</div>"},"<div>Matched: "+s+"</div>")}})}),a.forEach(function(t){t.parentUnit.fire("force-brush",i)})},template:xe.template('<div class="tau-chart__chart_brushing_panel"></div>')};return n}r.default.api.plugins.add("parallel-brushing",_e);var we=r.default.api.utils;function Ee(t){we.defaults(t||{},{});return{init:function(t){this._cursor=null,this._chart=t,this._tooltip=t.addBalloon({spacing:3,auto:!0,effectClass:"fade"}),this._tooltip.content(this.template),this._tooltip.getElement().addEventListener("click",function(t){for(var e=t.target;e!==t.currentTarget&&null!==e;)e.classList.contains("i-role-exclude")&&n._exclude(),e=e.parentNode;n._tooltip.hide()},!1);var e,n=this;this.showTooltip=function(t){clearTimeout(e),n._cursor=t.data;var r=n._tooltip.getElement().querySelectorAll(".i-role-content");r[0]&&(r[0].innerHTML=Object.keys(t.data).map(function(e){return n.itemTemplate({label:e,value:t.data[e]})}).join("")),n._tooltip.show(t.event.pageX,t.event.pageY).updateSize()},this.hideTooltip=function(t){e=setTimeout(function(){n._tooltip.hide()},1e3)},this._tooltip.getElement().addEventListener("mouseover",function(t){clearTimeout(e)},!1),this._tooltip.getElement().addEventListener("mouseleave",function(t){n._tooltip.hide()},!1)},_exclude:function(){var t;this._chart.addFilter({tag:"exclude",predicate:(t=this._cursor,function(e){return JSON.stringify(e)!==JSON.stringify(t)})}),this._chart.refresh()},onRender:function(t){var e=this;t.select(function(t){return"PARALLEL/ELEMENT.LINE"===t.config.type}).forEach(function(t){t.on("mouseout",function(t,n){e.hideTooltip(n)}),t.on("mouseover",function(t,n){e.showTooltip(n)})})},template:['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">','<div class="tau-chart__tooltip__button i-role-exclude">','<div class="tau-chart__tooltip__button__wrap">','<span class="tau-icon-close-gray"></span>',"Exclude","</div>","</div>","</div>",'<div class="i-role-content tau-chart__tooltip__content"></div>'].join(""),itemTemplate:we.template(['<div class="tau-chart__tooltip__list__item">','<div class="tau-chart__tooltip__list__elem"><%=label%></div>','<div class="tau-chart__tooltip__list__elem"><%=value%></div>',"</div>"].join(""))}}r.default.api.plugins.add("parallel-tooltip",Ee);var Se=n(8),Me=n(3),Te=n(7),Ce=function(){return(Ce=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ke=Ce({},qt,Se,Me,h,Te),Ae=r.default.api.utils,Oe=0;function Pe(t){void 0===t&&(t={});return{init:function(e){this._chart=e,this._currentFilters={},this._data={},this._bounds={},this._filter={},this._container={},this._layout=this._chart.getLayout().layout;var n=this,r=this._chart.getSpec(),i=r.sources["/"],a=t.fields||t;this._fields=Array.isArray(a)&&a.length>0?a:Object.keys(i.dims),this._fieldBounds=t.fieldBounds||{},this._applyImmediately=Boolean(t.applyImmediately);var o=n._chart.getChartModelData();this._filtersContainer=n._chart.insertToRightSidebar(n._filtersContainer),this._filtersContainer.style.maxHeight="0px",n._fields.filter(function(t){var e="measure"===i.dims[t].type;return e||r.settings.log("The ["+t+"] isn't measure so Quick Filter plugin skipped it"),e}).forEach(function(t){n._data[t]=o.map(function(e){return e[t]});var e=n._fieldBounds[t];n._bounds[t]=e?[e.min,e.max]:ke.extent(n._data[t]),n._filter[t]=n._bounds[t],n._filtersContainer.insertAdjacentHTML("beforeend",n._filterWrapper({name:t})),n._container[t]=n._filtersContainer.lastChild,n._drawFilter(t)})},onRender:function(){this._filtersContainer.style.maxHeight="none"},_filtersContainer:'<div class="tau-chart__filter"></div>',_filterWrapper:Ae.template('<div class="tau-chart__filter__wrap"><div class="tau-chart__legend__title"><%=name%></div></div>'),_drawFilter:function(t){var e=this._data[t],n=this._bounds[t],r=this._filter[t],i=Ae.isDate(n[0])||Ae.isDate(n[1]),a=this,o=0,s=24,u=21,l=12,c=180-l-s,f=41-o-u-8,d=ke.scaleLinear().domain(n).range([0,c]),p=ke.brushX().extent([[0,0],[c,20]]).on("start",function(){a._layout.style["overflow-y"]="hidden"}).on("brush",this._applyImmediately?E:w).on("end",function(){a._layout.style["overflow-y"]="",E()}),g=ke.select(this._container[t]).append("svg").attr("width",c+l+s).attr("height",f+o+u+4).append("g").attr("transform","translate("+l+","+o+")"),m=(g.append("g").selectAll("rect").data(e).enter().append("rect").attr("transform",function(t){return"translate("+d(t)+","+(o+4)+")"}).attr("height",f).attr("width",1),g.append("g").attr("class","brush").call(p));m.append("g").attr("class","resize e").attr("cursor","ew-resize").attr("pointer-events","none"),m.append("g").attr("class","resize w").attr("cursor","ew-resize").attr("pointer-events","none"),m.selectAll(".resize").append("line").attr("transform","translate(0, 0)").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",f+8),m.selectAll(".resize").append("text").attr("x",0).attr("y",2*(f+4)),m.selectAll("rect").attr("height",f+8);var y=g.append("text").attr("x",c/2).attr("y",2*(f+4)).attr("class","date-label"),v=function(t){return Math.log(t)/Math.LN10}(a._filter[t][1]-a._filter[t][0]),b=Math.round(3-v),x=Math.pow(10,b);if(i){var _=function(t){var e=t.findIndex(function(t){var e=ke.timeFormat(t);return e(new Date(n[0]))!==e(new Date(n[1]))});return e=e<0?t.length:e,{comm:t.slice(0,e),diff:t.slice(e)}}(["%y","&thinsp;%b","%d","%H",":%M",":%S"]);_.comm.length<3?(_.diff.splice(-3),_.diff.reverse(),_.comm.reverse()):(_.comm.length<5&&_.diff.pop(),_.diff=_.comm.splice(3,_.comm.length-3).concat(_.diff),_.comm.reverse())}function w(){var e=h.event;if(e&&Array.isArray(e.selection)){var n=e.selection.map(d.invert);r=n,a._filter[t]=n}else r=a._filter[t];var o=i?new Date(r[0]).getTime():r[0],s=i?new Date(r[1]).getTime():r[1],u=Math.round(parseFloat(o)*x)/x,l=Math.round(parseFloat(s)*x)/x;m.select(".handle--w"),m.select(".handle--e");m.select(".resize.w").attr("transform","translate("+d(r[0])+",0)"),m.select(".resize.e").attr("transform","translate("+d(r[1])+",0)");var c=m.selectAll(".w text"),f=m.selectAll(".e text");if(i){var p=ke.timeFormat(_.comm.join("")),g=ke.timeFormat(_.diff.join(""));y.html(g(new Date(u))+"&thinsp;..&thinsp;"+g(new Date(l))+' <tspan class="common">'+p(new Date(l))+"</tspan>")}else c.text(u),f.text(l)}function E(){w(),a._applyFilter(t)}E(),p.move(m,r.map(d))},destroy:function(){var t=this._currentFilters,e=this._chart;Object.keys(t).forEach(function(n){return e.removeFilter(t[n])});var n;(n=this._filtersContainer)&&n.parentElement&&n.parentElement.removeChild(n)},_applyFilter:function(t){var e=this._currentFilters,n=function(t,e,n){return function(r){var i=r[t];return i<e||i>n}}(t,this._filter[t][0],this._filter[t][1]),r=e[t];delete e[t],this._chart.removeFilter(r),e[t]=this._chart.addFilter({tag:"quick-filter",predicate:function(t){return!n(t)}}),Oe<0?this._chart.refresh():(this._refreshRequestId&&clearTimeout(this._refreshRequestId),this._refreshRequestId=setTimeout(function(){this._refreshRequestId=null,this._chart.refresh()}.bind(this),Oe))}}}r.default.api.plugins.add("quick-filter",Pe);var Le=r.default.api.utils;function Ne(t){var e=Le.defaults(t||{},{show:!0,modes:["normal","entire-view","fit-width","fit-height","minimal"]});return{init:function(t){e.show&&(e.selectedMode=t.getSpec().settings.fitModel,t.insertToHeader(this.template({modes:e.modes.map(function(t){return"<option "+(e.selectedMode===t?"selected":"")+' value="'+t+'">'+t+"</option>"})})).addEventListener("change",function(n){var r=n.target;r.classList.contains("i-role-fit-model")&&(e.selectedMode=r.value,t.getSpec().settings.fitModel=e.selectedMode,t.refresh())},!1))},template:Le.template(['<div class="tau-chart__chartsettingspanel">',"    <div>","        <span>View Mode:&nbsp;</span>",'        <select class="i-role-fit-model tau-chart__select">',"        <%= modes %> />","        </select>","    </div>","</div>"].join(""))}}r.default.api.plugins.add("settings",Ne);function Re(t){return new X(t)}r.default.api.plugins.add("tooltip",Re);var Fe,De=(Fe={linear:function(t){for(var e=[0,0,0,0,0],n=0,r=[];n<t.length;n++)t[n][1]&&(e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][0]*t[n][0],e[3]+=t[n][0]*t[n][1],e[4]+=t[n][1]*t[n][1]);var i=(n*e[3]-e[0]*e[1])/(n*e[2]-e[0]*e[0]);i=isNaN(i)?0:i;for(var a=e[1]/n-i*e[0]/n,o=0,s=t.length;o<s;o++){var u=[t[o][0],t[o][0]*i+a];r.push(u)}return{equation:[i,a],points:r,string:"y = "+Math.round(100*i)/100+"x + "+Math.round(100*a)/100}},exponential:function(t){var e=[0,0,0,0,0,0],n=0,r=[];for(u=t.length;n<u;n++)t[n][1]&&(e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][0]*t[n][0]*t[n][1],e[3]+=t[n][1]*Math.log(t[n][1]),e[4]+=t[n][0]*t[n][1]*Math.log(t[n][1]),e[5]+=t[n][0]*t[n][1]);for(var i=e[1]*e[2]-e[5]*e[5],a=Math.pow(Math.E,(e[2]*e[3]-e[5]*e[4])/i),o=(e[1]*e[4]-e[5]*e[3])/i,s=0,u=t.length;s<u;s++){var l=[t[s][0],a*Math.pow(Math.E,o*t[s][0])];r.push(l)}return{equation:[a,o],points:r,string:"y = "+Math.round(100*a)/100+"e^("+Math.round(100*o)/100+"x)"}},logarithmic:function(t){var e=[0,0,0,0],n=0,r=[];for(s=t.length;n<s;n++)t[n][1]&&(e[0]+=Math.log(t[n][0]),e[1]+=t[n][1]*Math.log(t[n][0]),e[2]+=t[n][1],e[3]+=Math.pow(Math.log(t[n][0]),2));for(var i=(n*e[1]-e[2]*e[0])/(n*e[3]-e[0]*e[0]),a=(e[2]-i*e[0])/n,o=0,s=t.length;o<s;o++){var u=[t[o][0],a+i*Math.log(t[o][0])];r.push(u)}return{equation:[a,i],points:r,string:"y = "+Math.round(100*a)/100+" + "+Math.round(100*i)/100+" ln(x)"}},power:function(t){var e=[0,0,0,0],n=0,r=[];for(s=t.length;n<s;n++)t[n][1]&&(e[0]+=Math.log(t[n][0]),e[1]+=Math.log(t[n][1])*Math.log(t[n][0]),e[2]+=Math.log(t[n][1]),e[3]+=Math.pow(Math.log(t[n][0]),2));for(var i=(n*e[1]-e[2]*e[0])/(n*e[3]-e[0]*e[0]),a=Math.pow(Math.E,(e[2]-i*e[0])/n),o=0,s=t.length;o<s;o++){var u=[t[o][0],a*Math.pow(t[o][0],i)];r.push(u)}return{equation:[a,i],points:r,string:"y = "+Math.round(100*a)/100+"x^"+Math.round(100*i)/100}},polynomial:function(t,e){void 0===e&&(e=2);for(var n=[],r=[],i=[],a=0,o=0,s=0,u=e+1;s<u;s++){for(var l=0,c=t.length;l<c;l++)t[l][1]&&(a+=Math.pow(t[l][0],s)*t[l][1]);n.push(a),a=0;for(var f=[],d=0;d<u;d++){for(l=0,c=t.length;l<c;l++)t[l][1]&&(o+=Math.pow(t[l][0],s+d));f.push(o),o=0}r.push(f)}r.push(n);var h=function(t,e){var n=0,r=0,i=0,a=0,o=0,s=t.length-1,u=new Array(e);for(n=0;n<s;n++){for(a=n,r=n+1;r<s;r++)Math.abs(t[n][r])>Math.abs(t[n][a])&&(a=r);for(i=n;i<s+1;i++)o=t[i][n],t[i][n]=t[i][a],t[i][a]=o;for(r=n+1;r<s;r++)for(i=s;i>=n;i--)t[i][r]-=t[i][n]*t[n][r]/t[n][n]}for(r=s-1;r>=0;r--){for(o=0,i=r+1;i<s;i++)o+=t[i][r]*u[i];u[r]=(t[s][r]-o)/t[r][r]}return u}(r,u);for(s=0,c=t.length;s<c;s++){for(var p=0,g=0;g<h.length;g++)p+=h[g]*Math.pow(t[s][0],g);i.push([t[s][0],p])}var m="y = ";for(s=h.length-1;s>=0;s--)m+=s>1?Math.round(100*h[s])/100+"x^"+s+" + ":1==s?Math.round(100*h[s])/100+"x + ":Math.round(100*h[s])/100;return{equation:h,points:i,string:m}},lastvalue:function(t){for(var e=[],n=null,r=0;r<t.length;r++)t[r][1]?(n=t[r][1],e.push([t[r][0],t[r][1]])):e.push([t[r][0],n]);return{equation:[n],points:e,string:""+n}},loess:function(t){return{equation:"loess",points:(e=t,n=.5,r=e.map(function(t){return t[0]}),i=function(t,e,n){function r(t){var e=1-t*t*t;return e*e*e}for(var i=[],a=0,o=Math.floor(n*t.length)-1,s=0;s<t.length;s++){var u,l=t[s];s>0&&o<t.length-1&&t[o+1]-t[s]<t[s]-t[a]&&(a++,o++),u=t[s]-t[a]>t[o]-t[s]?a:o;for(var c=Math.abs(1/(t[u]-l)),f=0,d=0,h=0,p=0,g=0,m=a;m<=o;){var y=t[m],v=e[m],b=r((m<s?l-y:y-l)*c),x=y*b;f+=b,d+=x,h+=y*x,p+=v*b,g+=v*x,m++}var _,w=d/f,E=p/f,S=g/f,M=h/f,T=E-(_=M==w*w?0:(S-w*E)/(M-w*w))*w;i[s]=_*l+T}return i}(r,e.map(function(t){return t[1]}),n),r.map(function(t,e){return[t,i[e]]})),string:"loess"};var e,n,r,i}},function(t,e,n){if("string"==typeof t)return Fe[t](e,n)}),je=r.default.api.utils;function Ie(t){var e=je.defaults(t||{},{type:"linear",hideError:!1,showPanel:!0,showTrend:!0,models:["linear","exponential","logarithmic"]});return{init:function(t){if(this._chart=t,this._applicableElements=["ELEMENT.POINT","ELEMENT.LINE","ELEMENT.AREA","ELEMENT.INTERVAL"],this._isApplicable=this.checkIfApplicable(t),e.showPanel){this._container=t.insertToRightSidebar(this.containerTemplate);var n="applicable-true";this._isApplicable||(n="applicable-false",this._error=["Trend line can't be computed for categorical data.","Each axis should be either a measure or a date."].join(" ")),this._container.classList.add(n),e.hideError&&this._container.classList.add("hide-trendline-error"),this.uiChangeEventsDispatcher=function(t){var n=t.target,r=n.classList;r.contains("i-role-show-trend")&&(e.showTrend=n.checked),r.contains("i-role-change-model")&&(e.type=n.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1)}},checkIfApplicable:function(t){var e=this,n=t.getSpec(),r=!1;return t.traverseSpec(n,function(t,i){e.predicateIsApplicable(n,t,i)&&(r=!0)}),r},predicateIsApplicable:function(t,e,n){if(n&&"COORDS.RECT"!==n.type)return!1;if(n&&!n.units)return!1;if(-1===this._applicableElements.indexOf(e.type)||e.stack||"chart"!==e.namespace)return!1;var r=t.scales[e.x],i=t.scales[e.y];return!("ordinal"===r.type||"ordinal"===i.type)},onSpecReady:function(t,n){var i=this;if(e.showTrend){var a=r.default.api.tickPeriod,o=function(t){var e=a.get(t,{utc:n.settings.utcTime});return function(t){return e.cast(new Date(t))}};n.transformations=n.transformations||{},n.transformations.regression=function(t,e){var n=e.x.dim,r=e.y.dim,i=e.g.dim,a=Boolean(e.x.period),s=Boolean(e.y.period),u=a?o(e.x.period):function(t){return t},l=s?o(e.y.period):function(t){return t},c=t.map(function(t){return[je.isDate(t[n])?t[n].getTime():t[n],je.isDate(t[r])?t[r].getTime():t[r],t[i]]}),f=je.groupBy(c,function(t){return t[2]});return Object.keys(f).reduce(function(t,o){var c=f[o],d=De(e.type,c).points.filter(function(t){return null!==t[0]&&null!==t[1]}).sort(function(t,e){return t[0]-e[0]}).map(function(t){var e={};return e[n]=u(t[0]),e[r]=l(t[1]),i&&(e[i]=o),e});return d.length>1&&(a||s)&&(d=[d[0],d[d.length-1]]),t.concat(d.length>1?d:[])},[])},t.traverseSpec(n,function(t,r){if(i.predicateIsApplicable(n,t,r)){var a=n.scales[t.x],o=n.scales[t.y],s=n.scales[t.color]||{},u=JSON.parse(JSON.stringify(t));u.type="ELEMENT.LINE",u.size="size_null",u.namespace="trendline",u.transformation=u.transformation||[],u.transformation.push({type:"regression",args:{type:e.type,x:a,y:o,g:s}});u.guide=je.defaults({},u.guide||{}),u.guide.interpolate="linear",u.guide.showAnchors="never",u.guide.cssClass="tau-chart__trendline",u.guide.widthCssClass="tau-chart__line-width-1",u.guide.x=u.guide.x||{},u.guide.x.fillGaps=!1,delete u.guide.label,delete u.label,r.units.push(u)}})}},containerTemplate:'<div class="tau-chart__trendlinepanel"></div>',template:je.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">','<input type="checkbox" class="tau-chart__checkbox__input i-role-show-trend" <%= showTrend %> />','<span class="tau-chart__checkbox__icon"></span>','<span class="tau-chart__checkbox__text">',"<%= title %>","</span>","</label>","<div>",'<select class="i-role-change-model tau-chart__select tau-chart__trendlinepanel__control">',"<%= models %>","</select>","</div>",'<div class="tau-chart__trendlinepanel__error-message"><%= error %></div>'].join("")),onRender:function(t){if(this._container){this._container.innerHTML=this.template({title:"Trend line",error:this._error,showTrend:e.showTrend&&this._isApplicable?"checked":"",models:e.models.map(function(t){return"<option "+(e.type===t?"selected":"")+' value="'+t+'">'+t+"</option>"})});var n=function(t){return function(){h.select(this).classed({active:t,"tau-chart__line-width-1":!t,"tau-chart__line-width-3":t})}};h.select(t.getSVG()).selectAll(".tau-chart__trendline").on("mouseenter",n(!0)).on("mouseleave",n(!1))}}}}r.default.api.plugins.add("trendline",Ie);var ze={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},Be=function(t,e){return ze[t][e].map(function(n,r){return t+" q"+r+"-"+e})};r.default.api.colorBrewers.add("tauBrewer",Be);n.d(e,"GPL",function(){return Ve}),n.d(e,"Plot",function(){return He}),n.d(e,"Chart",function(){return We}),n.d(e,"api",function(){return Ge}),n.d(e,"version",function(){return Ue});var Ve=r.default.GPL,He=r.default.Plot,We=r.default.Chart,Ge=r.default.api,Ue=r.default.version}])});