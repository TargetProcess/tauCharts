/*!
 * /*
 * taucharts@2.7.0 (2019-03-08)
 * Copyright 2019 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 * 
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("taucharts"),require("d3-selection"),require("d3-array"),require("d3-brush"),require("d3-scale"),require("d3-time-format"));else if("function"==typeof define&&define.amd)define(["taucharts","d3-selection","d3-array","d3-brush","d3-scale","d3-time-format"],e);else{var r="object"==typeof exports?e(require("taucharts"),require("d3-selection"),require("d3-array"),require("d3-brush"),require("d3-scale"),require("d3-time-format")):e(t.Taucharts,t.d3,t.d3,t.d3,t.d3,t.d3);for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,function(t,e,r,n,i,a){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=31)}({0:function(e,r){e.exports=t},1:function(t,r){t.exports=e},10:function(t,e){t.exports=n},11:function(t,e){t.exports=i},12:function(t,e){t.exports=a},31:function(t,e,r){"use strict";r.r(e);var n=r(0),i=r.n(n),a=r(4),s=r(10),o=r(11),l=r(1),c=r(12);const u={...a,...s,...o,...l,...c};var f=i.a.api.utils,d=0;function h(t={}){return{init:function(e){this._chart=e,this._currentFilters={},this._data={},this._bounds={},this._filter={},this._container={},this._layout=this._chart.getLayout().layout;var r=this,n=this._chart.getSpec(),i=n.sources["/"],a=t.fields||t;this._fields=Array.isArray(a)&&a.length>0?a:Object.keys(i.dims),this._fieldBounds=t.fieldBounds||{},this._applyImmediately=Boolean(t.applyImmediately);var s=r._chart.getChartModelData();this._filtersContainer=r._chart.insertToRightSidebar(r._filtersContainer),this._filtersContainer.style.maxHeight="0px",r._fields.filter(function(t){var e="measure"===i.dims[t].type;return e||n.settings.log("The ["+t+"] isn't measure so Quick Filter plugin skipped it"),e}).forEach(function(t){r._data[t]=s.map(function(e){return e[t]});const e=r._fieldBounds[t];r._bounds[t]=e?[e.min,e.max]:u.extent(r._data[t]),r._filter[t]=r._bounds[t],r._filtersContainer.insertAdjacentHTML("beforeend",r._filterWrapper({name:t})),r._container[t]=r._filtersContainer.lastChild,r._drawFilter(t)})},onRender:function(){this._filtersContainer.style.maxHeight="none"},_filtersContainer:'<div class="tau-chart__filter"></div>',_filterWrapper:f.template('<div class="tau-chart__filter__wrap"><div class="tau-chart__legend__title"><%=name%></div></div>'),_drawFilter:function(t){var e=this._data[t],r=this._bounds[t],n=this._filter[t],i=f.isDate(r[0])||f.isDate(r[1]),a=this,s=0,o=24,c=21,d=12,h=180-d-o,p=41-s-c-8,m=u.scaleLinear().domain(r).range([0,h]),_=u.brushX().extent([[0,0],[h,20]]).on("start",function(){a._layout.style["overflow-y"]="hidden"}).on("brush",this._applyImmediately?F:j).on("end",function(){a._layout.style["overflow-y"]="",F()}),y=u.select(this._container[t]).append("svg").attr("width",h+d+o).attr("height",p+s+c+4).append("g").attr("transform","translate("+d+","+s+")"),v=(y.append("g").selectAll("rect").data(e).enter().append("rect").attr("transform",function(t){return"translate("+m(t)+","+(s+4)+")"}).attr("height",p).attr("width",1),y.append("g").attr("class","brush").call(_));v.append("g").attr("class","resize e").attr("cursor","ew-resize").attr("pointer-events","none"),v.append("g").attr("class","resize w").attr("cursor","ew-resize").attr("pointer-events","none"),v.selectAll(".resize").append("line").attr("transform","translate(0, 0)").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",p+8),v.selectAll(".resize").append("text").attr("x",0).attr("y",2*(p+4)),v.selectAll("rect").attr("height",p+8);var g=y.append("text").attr("x",h/2).attr("y",2*(p+4)).attr("class","date-label"),b=function(t){return Math.log(t)/Math.LN10}(a._filter[t][1]-a._filter[t][0]),x=Math.round(3-b),w=Math.pow(10,x);if(i){var q=function(t){var e=t.findIndex(function(t){var e=u.timeFormat(t);return e(new Date(r[0]))!==e(new Date(r[1]))});return e=e<0?t.length:e,{comm:t.slice(0,e),diff:t.slice(e)}}(["â€™%y","&thinsp;%b","%d","%H",":%M",":%S"]);q.comm.length<3?(q.diff.splice(-3),q.diff.reverse(),q.comm.reverse()):(q.comm.length<5&&q.diff.pop(),q.diff=q.comm.splice(3,q.comm.length-3).concat(q.diff),q.comm.reverse())}function j(){const e=l.event;if(e&&Array.isArray(e.selection)){const r=e.selection.map(m.invert);n=r,a._filter[t]=r}else n=a._filter[t];var r=i?new Date(n[0]).getTime():n[0],s=i?new Date(n[1]).getTime():n[1],o=Math.round(parseFloat(r)*w)/w,c=Math.round(parseFloat(s)*w)/w;v.select(".handle--w"),v.select(".handle--e");v.select(".resize.w").attr("transform",`translate(${m(n[0])},0)`),v.select(".resize.e").attr("transform",`translate(${m(n[1])},0)`);var f=v.selectAll(".w text"),d=v.selectAll(".e text");if(i){var h=u.timeFormat(q.comm.join("")),p=u.timeFormat(q.diff.join(""));g.html(p(new Date(o))+"&thinsp;..&thinsp;"+p(new Date(c))+' <tspan class="common">'+h(new Date(c))+"</tspan>")}else f.text(o),d.text(c)}function F(){j(),a._applyFilter(t)}F(),_.move(v,n.map(m))},destroy(){const t=this._currentFilters,e=this._chart;Object.keys(t).forEach(r=>e.removeFilter(t[r]));(t=>t&&t.parentElement&&t.parentElement.removeChild(t))(this._filtersContainer)},_applyFilter:function(t){var e=this._currentFilters,r=function(t,e,r){return function(n){var i=n[t];return i<e||i>r}}(t,this._filter[t][0],this._filter[t][1]),n=e[t];delete e[t],this._chart.removeFilter(n),e[t]=this._chart.addFilter({tag:"quick-filter",predicate:function(t){return!r(t)}}),d<0?this._chart.refresh():(this._refreshRequestId&&clearTimeout(this._refreshRequestId),this._refreshRequestId=setTimeout(function(){this._refreshRequestId=null,this._chart.refresh()}.bind(this),d))}}}i.a.api.plugins.add("quick-filter",h),e.default=h},4:function(t,e){t.exports=r}})});