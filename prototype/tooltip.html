<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <script src="//google.github.io/traceur-compiler/bin/traceur.js"></script>
    <script src="//rawgit.com/ModuleLoader/es6-module-loader/v0.9.4/dist/es6-module-loader.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <style>
        #tooltipTarget {
            position: relative;
            width: 100px;
            /*height: 50px;*/
            line-height: 50px;
            margin: 10px 5px;
            text-align: center;
            text-shadow: 1px 1px rgba(255,255,255,.5);
            border: 1px dashed rgba(255,255,255,.8);
            border-radius: 4px;
            background: inherit;
            margin: 0 auto; cursor: move;
        }
    </style>
    <link rel="stylesheet" href="../css/tooltip.css"/>
    <title>

    </title>
</head>
<body >
<div id="template">
    <div>tooltip content</div>
</div>
<a id="tooltipTarget">show tooltip</a>


<script>
    // Helpers
    var rAF = window.requestAnimationFrame || window.webkitRequestAnimationFrame || function (callback) {
                return setTimeout(callback, 17);
            };
    var getProp = window.getComputedStyle ? function getProp(element, name) {
        return window.getComputedStyle(element, null)[name];
    } : function getProp(element, name) {
        return element.currentStyle[name];
    };
    function parsePx(value) {
        return 0 | Math.round(String(value).replace(/[^\-0-9.]/g, ''));
    }
    function DragAndReset(element) {
        if (!(this instanceof DragAndReset)) {
            return new DragAndReset(element);
        }

        var self = this;
        var $document = $(document);
        var frameID = 0;
        self.element = element;
        self.initialized = 0;
        self.path = {
            left: 0,
            top: 0
        };

        function move(event) {
            self.path.left = event.pageX - self.origin.left;
            self.path.top = event.pageY - self.origin.top;
            if (!self.initialized && (Math.abs(self.path.left) > 10 || Math.abs(self.path.top) > 10)) {
                self.initialized = 1;
            }
            if (self.initialized) {
                requestReposition();
            }
            return false;
        }

        function requestReposition() {
            if (!frameID) {
                frameID = rAF(reposition);
            }
        }

        function reposition() {
            frameID = 0;
            element.style.left = (self.originPos.left + self.path.left) + 'px';
            element.style.top = (self.originPos.top + self.path.top) + 'px';
            if (self.onMove) {
                self.onMove();
            }
        }

        function init(event) {
            self.origin = {
                left: event.pageX,
                top: event.pageY
            };
            self.originPos = {
                left: parsePx(getProp(element, 'left')),
                top: parsePx(getProp(element, 'top'))
            };
            $document.on('mousemove', move);
            $document.on('mouseup', self.end);
            return false;
        }

        self.end = function () {
            self.initialized = 0;
            self.path.top = self.path.left = 0;
            requestReposition();
            $document.off('mousemove', move);
            $document.off('mouseup', self.end);
        };

        (function () {
            $(element).on('mousedown', init);
        }());
    }
    System.baseURL = location.pathname.replace(/(.+)(prototype\/\w+\.html)/, '$1src/');
    System.import('api/tooltip').then(function (m) {
        var s = document.getElementById('tooltipTarget');
        var dragger = new DragAndReset(s);
        var tip = new m.Tooltip(document.getElementById('template').innerHTML,{place:'top',auto:1,spacing:10});
        tip.attach(s).show();

        dragger.onMove = function reposition() {
            tip.position();
        };


    });


</script>
</body>
</html>