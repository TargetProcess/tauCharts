<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.2/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>

    <!--<script src="../node_modules/underscore/underscore-min.js"></script>-->
    <!--<script src="../node_modules/jquery/dist/jquery.min.js"></script>-->
    <!--<script src="../node_modules/d3/d3.min.js"></script>-->

    <!-- core -->
    <script src="http://localhost:9000/tauCharts.js"></script>
    <!-- plugins -->
    <script src="../plugins/tooltip.js"></script>
    <script src="../build/development/plugins/tauCharts.export.js"></script>
    <script src="../plugins/layers.js"></script>
    <script src="../plugins/legend.js"></script>
    <script src="../plugins/trendline.js"></script>
    <script src="../plugins/settings.js"></script>
    <script src="../plugins/annotations.js"></script>
    <script src="../plugins/parallel-brushing.js"></script>
    <script src="../plugins/parallel-tooltip.js"></script>
    <script src="../plugins/geomap-tooltip.js"></script>
    <script src="../plugins/geomap-legend.js"></script>
    <script src="../plugins/quick-filter.js"></script>
    <script src="../plugins/floating-axes.js"></script>
    <script src="../plugins/box-whiskers.js"></script>

    <!-- test data -->
    <script src="data-cars.js"></script>
    <script src="data.js"></script>
    <script src="countries.js"></script>
    <script src="tpStories.js"></script>

    <!-- css -->
    <link href="../css/tauCharts.default.css" rel="stylesheet"/>
    <!--<link href="../css/layout.css" rel="stylesheet"/>-->
    <!--<link href="../css/base.css" rel="stylesheet"/>-->
    <!--<link href="../css/tauCharts.css" rel="stylesheet"/>-->
    <link href="../css/export.default.css" rel="stylesheet"/>
    <link href="../css/legend.default.css" rel="stylesheet"/>
    <link href="../css/tooltip.default.css" rel="stylesheet"/>
    <link href="../css/trendline.default.css" rel="stylesheet"/>
    <link href="../css/annotations.default.css" rel="stylesheet"/>
    <link href="../css/quick-filter.default.css" rel="stylesheet"/>
    <style>
        body{
            /*background-color: #D8D9D1;*/
        }
        .cc {
            display:inline-block;
            margin: 5px;
            float: left;
            width: 100%;
            height: 400px;
            overflow: auto;
        }

        svg {
            /*background-color: #eee;*/
        }
    </style>

    <script>
        rawData = _.map(
                getUserStories(),
                function (r, i) {
                    r.cycleTime = r.name.length;
                    var k = i % 2;
                    r.priority = {
                        key: k,
                        val: k ? 'High': 'Low'
                    };

                    r.priorityName = k ? 'High': 'Low';

                    r.severity = k ? 'Must Have': 'Nice to have';

                    if (i === 7) {
                        r.severity = 'Out of index';
                    }

                    return r;
                });

        window.samples = [];
        window.drops = [];
    </script>

    <script src="dev-quick-test/ex-000.js"></script>
    <script src="dev-quick-test/ex-001.js"></script>
    <script src="dev-quick-test/ex-002.js"></script>
    <script src="dev-quick-test/ex-003.js"></script>
    <script src="dev-quick-test/ex-004.js"></script>
    <script src="dev-quick-test/ex-005.js"></script>
    <script src="dev-quick-test/ex-006.js"></script>
    <script src="dev-quick-test/ex-007.js"></script>
    <script src="dev-quick-test/ex-008.js"></script>
    <script src="dev-quick-test/ex-009.js"></script>
    <script src="dev-quick-test/ex-010.js"></script>
    <script src="dev-quick-test/ex-011.js"></script>
    <script src="dev-quick-test/ex-012.js"></script>
    <script src="dev-quick-test/ex-013.js"></script>
    <script src="dev-quick-test/ex-014.js"></script>
    <script src="dev-quick-test/ex-015.js"></script>
    <script src="dev-quick-test/ex-016.js"></script>
    <script src="dev-quick-test/ex-017.js"></script>
    <script src="dev-quick-test/ex-018.js"></script>
    <script src="dev-quick-test/ex-019.js"></script>
    <script src="dev-quick-test/ex-020.js"></script>
    <script src="dev-quick-test/ex-021.js"></script>
    <script src="dev-quick-test/ex-022.js"></script>
    <script src="dev-quick-test/ex-023.js"></script>
    <script src="dev-quick-test/ex-024.js"></script>
    <script src="dev-quick-test/ex-025.js"></script>
    <script src="dev-quick-test/ex-026.js"></script>
    <script src="dev-quick-test/ex-027.js"></script>
    <script src="dev-quick-test/ex-028.js"></script>
    <script src="dev-quick-test/ex-029.js"></script>
    <script src="dev-quick-test/ex-030.js"></script>
    <script src="dev-quick-test/ex-031.js"></script>
    <script src="dev-quick-test/ex-040.js"></script>
    <script src="dev-quick-test/ex-041.js"></script>
    <script src="dev-quick-test/ex-042.js"></script>
    <script src="dev-quick-test/ex-043.js"></script>
    <script src="dev-quick-test/ex-044.js"></script>
    <script src="dev-quick-test/ex-045.js"></script>
    <script src="dev-quick-test/ex-046.js"></script>
    <script src="dev-quick-test/ex-047.js"></script>
    <script src="dev-quick-test/ex-048.js"></script>
    <script src="dev-quick-test/ex-049.js"></script>
    <script src="dev-quick-test/ex-050.js"></script>
    <script src="dev-quick-test/ex-051.js"></script>
    <script src="dev-quick-test/ex-052.js"></script>
    <script src="dev-quick-test/ex-053.js"></script>
    <script src="dev-quick-test/ex-054.js"></script>

</head>
<body>

<script>

    window.charts = [];

    var xdrops = function (dropCfg) {
        var spec = dropCfg.spec;
        spec.data = dropCfg.data.map(function (row) {
            return dropCfg.header.reduce(function (memo, h, i) {
                memo[h] = row[i];
                return memo;
            }, {});
        });

        return spec;
    };

    // n = 6 gives a good enough approximation
    function rnd2() {
        return ((Math.random() + Math.random() + Math.random() + Math.random() + Math.random() + Math.random()) - 3) / 3;
    }

    window
            .samples
            .concat(window.drops.map(xdrops))
            .filter(_.identity)
            .filter(function (r) {
                return true;
            })
            //.slice(0, 1)
            .concat({
                type: 'scatterplot',
                y: 'distribution',
                x: 'y',
                color: 'distribution',
                data: _.times(100, _.identity)
                        .reduce(function (memo, i) {

                            var outlierKoeff = function (lim) {
                                return (Math.random() >= lim) ? 100 : 1;
                            };

                            return memo.concat([
                                {
                                    y: rnd2(),
                                    distribution: 'A'
                                },
                                {
                                    y: rnd2() * outlierKoeff(0.95),
                                    distribution: 'B'
                                }
                            ]);
                        }, [])
                        .filter(function () {
                            var rand = Math.random();
                            return rand > 0.5 && rand < 0.75;
                        }),

                plugins: [
                    tauCharts.api.plugins.get('legend')(),
                    tauCharts.api.plugins.get('tooltip')(),
                    tauCharts.api.plugins.get('box-whiskers')({
                        flip: true,
                        //mode: 'show-scatter',
                        //mode: 'hide-scatter',
                        mode: 'outliers-only'
                    })
                ]
            })
            .forEach(function (cfg, i) {
                $('body').append('<div class="cc" id="div' + i + '"></div>');

                cfg.settings = cfg.settings || {};
                // cfg.settings.layoutEngine = 'NONE';
                cfg.settings.fitModel = cfg.settings.fitModel || 'normal'; // 'entire-view'

                cfg.plugins = cfg.plugins || [];
                cfg.plugins.push(tauCharts.api.plugins.get('floating-axes')());

//                cfg.plugins.push(tauCharts.api.plugins.get('exportTo')({
//                    cssPaths: [
//                        "../css/test-taucharts.css",
//                        "../css/test-entitycolors.css"
//                    ]
//                }));

                var chart = (cfg.hasOwnProperty('type')) ?
                        (new tauCharts.Chart(cfg)) :
                        (new tauCharts.Plot(cfg));
                chart.renderTo('#div' + i, cfg.xsize);

                window.charts.push(chart);
            });

</script>
</body>
</html>