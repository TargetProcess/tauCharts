/*! tauCharts - v0.0.1 - 2014-04-22
* https://github.com/TargetProcess/tauCharts
* Copyright (c) 2014 Taucraft Limited; Licensed MIT */
!function(){var a=function(){};a.new=function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c},a.extend=function(a){function b(){!d&&this.init&&this.init.apply(this,arguments)}var c=this.prototype,d=!0,e=new this;d=!1;for(var f in a)e[f]="function"==typeof a[f]&&"function"==typeof c[f]?function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);return this._super=d,e}}(f,a[f]):a[f];return b.prototype=e,b.prototype.constructor=b,b.extend=arguments.callee,b},window.Class=a,window.tau={}}(),function(){var a=Class.extend({init:function(a){this._plugins=a},_call:function(a,b){for(var c=0;c<this._plugins.length;c++)"function"==typeof this._plugins[c][a]&&this._plugins[c][a].apply(this._plugins[c],b)},render:function(){this._call("render",arguments)},click:function(){this._call("click",arguments)},mouseover:function(){this._call("mouseover",arguments)},mouseout:function(){this._call("mouseout",arguments)},mousemove:function(){this._call("mousemove",arguments)}}),b=Class.extend({init:function(a){this._dataSource=a},map:function(a){return this._mapper=(new tau.data.MapperBuilder).config(a).build(this._meta),this},plugins:function(){return this._plugins=new a(arguments),this},render:function(){throw new Error("Not implemented")}}),c={padding:10},d=Class.extend({init:function(a){this._mapper=a},render:function(){}}),e=d.extend({render:function(a){var b=d3.svg.axis().scale(this._mapper._scale).orient("bottom");a.svg.append("g").attr("class","x axis").attr("transform","translate(0, "+c.padding+")").call(b).append("text").attr("class","label").attr("x",a.svg.layout("width")).attr("y",-b.tickSize()).style("text-anchor","end").text(this._mapper.caption()),a.html.append("div").attr("class","x axis").html(this._mapper.caption())}}),f=d.extend({render:function(a){var b=d3.svg.axis().scale(this._mapper._scale).orient("left");a.svg.append("g").attr("class","y axis").attr("transform","translate(-"+c.padding+", 0)").call(b).append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",b.tickSize()).attr("y",b.tickSize()+a.svg.layout("width")).attr("dy",".71em").style("text-anchor","end").text(this._mapper.caption()),a.svg.selectAll(".tick line").attr("x1",a.svg.layout("width")-6).attr("x2",a.svg.layout("width")),a.svg.selectAll(".tick text").attr("dx",a.svg.layout("width")),a.svg.select(".domain").attr("transform","translate("+a.svg.layout("width")+", 0)"),a.html.append("div").attr("class","y axis").html(this._mapper.caption())}}),g=Class.extend({init:function(a,b){this._mapperX=a,this._mapperY=b},render:function(a){var b=d3.svg.axis().scale(this._mapperX._scale).orient("bottom").tickSize(a.layout("height")),c=d3.svg.axis().scale(this._mapperY._scale).orient("left").tickSize(-a.layout("width")),d=a.insert("g",":first-child").attr("class","grid");d.append("g").call(b),d.append("g").call(c),d.selectAll("text").remove()}}),h={top:20,right:20,bottom:30,left:40},i='<div class="html html-left"></div><div class="html html-chart"></div><svg></svg><div class="html html-right"></div><div class="html html-above"></div><div class="html html-below"></div>',j=Class.extend({init:function(a){var b=d3.select(a).classed("tau-chart",!0).html(i);this.html={left:b.select(".html-left"),right:b.select(".html-right"),above:b.select(".html-above"),below:b.select(".html-below")},this.svg=tau.svg.paddedBox(b.select("svg"),h);var c=new tau.svg.Layout(this.svg);c.row(-30),this.yAxis={svg:c.col(20),html:b.select(".html-chart")},this.data=c.col(),c.row(),c.col(20),this.xAxis={svg:c.col(),html:b.select(".html-chart")},this.width=this.data.layout("width"),this.height=this.data.layout("height")}}),k=function(a){return function(){this.on("click",function(b){a.click(new p(b),new n(d3.select(this)))}).on("mouseover",function(b){a.mouseover(new p(b),new n(d3.select(this)))}).on("mouseout",function(b){a.mouseout(new p(b),new n(d3.select(this)))}).on("mousemove",function(b){a.mousemove(new p(b),new n(d3.select(this)))})}},l=b.extend({init:function(a){this._super.call(this,a)},_renderData:function(){throw new Error("Not implemented")},render:function(a){var b=new j(a);this._mapper.binder("x").range([0,b.width]),this._mapper.binder("y").range([b.height,0]),this._dataSource.get(function(a){this._mapper.domain(a);var c=function(a){this._renderData(b.data,a),b.data.selectAll(".i-role-datum").call(k(this._plugins))}.bind(this);c(a),this._dataSource.update(c),new f(this._mapper.binder("y")).render(b.yAxis),new e(this._mapper.binder("x")).render(b.xAxis),new g(this._mapper.binder("x"),this._mapper.binder("y")).render(b.data),tau.svg.bringOnTop(b.data),this._plugins.render(new o(this._dataSource),new m(b,this._mapper))}.bind(this))}}),m=Class.extend({init:function(a,b){this.svg=a.svg,this.html=a.html,this.mapper=b},elements:function(){return this.svg.selectAll(".i-role-datum")}}),n=Class.extend({init:function(a){this.element=a}}),o=Class.extend({init:function(a){this.data=a}}),p=Class.extend({init:function(a){this.datum=a}});tau.charts={Base:l,add:function(a,b){tau.charts[a]=b}}}(),function(){var a=function(a,b,c){return a[b]=c,a},b=function(b,c){return a({},b,c)},c=function(){},d=function(a,b){return function(){a.apply(a,arguments),b.apply(b,arguments)}},e=Class.extend({init:function(){this._observers={update:c}},get:function(){throw new Error("not implemented")},filter:function(){throw new Error("not implemented")},update:function(a){this._on("update",a)},_on:function(a,b){this._observers[a]=d(this._observers[a],b)},_trigger:function(a,b){this._observers[a](b)}}),f=e.extend({init:function(a){this._data=a,this._super()},get:function(a){a(this._predicate?this._data.filter(this._predicate):this._data)},filter:function(a){this._predicate=a,this._trigger("update",this._predicate?this._data.filter(this._predicate):this._data)}}),g=Class.extend({init:function(a){this._propertyMappers=a},binder:function(a){return this._propertyMappers[a]},_getDomain:function(a){return this.binder(a).domain()},_setDomain:function(a){for(var b in this._propertyMappers)this._propertyMappers[b]._setDomain(a)},domain:function(a){return"string"==typeof a?this._getDomain(a):void this._setDomain(a)},_bind:function(a,b,c){var d=/%[^%]*%/g;return d.test(a)?function(e){return a.replace(d,function(a){var d=a.substr(1,a.length-2);return b.call(c,d,e)})}:function(d){return b.call(c,a,d)}},map:function(a){return this._bind(a,function(a,b){return this.binder(a).map(b)},this)},raw:function(a){return this._bind(a,function(a,b){return this.binder(a).raw(b)},this)},alias:function(a,b){this._propertyMappers[a].alias(b)}}),h=Class.extend({init:function(a){this._names=[a],this._caption=a,this._scale=d3.scale.linear()},alias:function(a){this._names.push(a)},_getOwnProperty:function(a){return this._names.filter(function(b){return a.hasOwnProperty(b)})[0]},raw:function(a){return a[this._getOwnProperty(a)]},map:function(a){var b=this._getOwnProperty(a);return this._scale(b?a[b]:this._default)},domain:function(){return this._scale.domain().map(b.bind(null,this._names[0]))},range:function(){this._scale.range.apply(this._scale,arguments)},caption:function(){return this._caption}}),i=Class.extend({init:function(a,b){this._name=a,this._dataType=b,this._scale=null},linear:function(){return this._scale=d3.scale.linear(),this},range:function(){return this._scale.range.apply(this._scale.range,arguments),this},time:function(){return this._scale=d3.time.scale(),this},color10:function(){return this._scale=tau.data.scale.color10(),this},caption:function(a){return this._caption=a,this},domain:function(){return this._scale.domain.apply(this._scale.domain,arguments),this},build:function(a){var b=new h(this._name);return b._scale=this._scale||a.type.defaultScale(),this._dataType=this._dataType||a.type,b._setDomain=this._dataType.setDomain.bind(b),b._default=a.default,b._caption=this._caption||this._name,b}}),j=Class.extend({init:function(){},config:function(a){return this._config=a,this},build:function(a){var b={};for(var c in a){var d=this._config[c];"undefined"==typeof d&&(d=c),"string"==typeof d&&(d=new i(d)),b[c]=d.build(a[c])}return new g(b)}}),k=Class.extend({color10:function(){return d3.scale.ordinal().range(["color10-1","color10-2","color10-3","color10-4","color10-5","color10-6","color10-7","color10-8","color10-9","color10-10"])}});tau.data={Array:function(a){return new f(a)},MapperBuilder:j,map:function(a,b){return new i(a,b)},scale:new k,identity:function(a){return a}}}(),function(){var a=function(){throw new Error("Not implemented")},b=Class.extend({defaultScale:a,setDomain:a}),c=b.extend({defaultScale:function(){return d3.scale.linear()},setDomain:function(a){var b=a.length&&this._getOwnProperty(a[0]);return b?void(this._scale=this._scale.domain([0,d3.max(a,this.raw.bind(this))])):void(this._scale=this._scale.domain([0,this._default]))}}),d=b.extend({defaultScale:function(){return d3.scale.time()},setDomain:function(a){var b=a.length&&this._getOwnProperty(a[0]);return b?void(this._scale=this._scale.domain([d3.min(a,function(a){return a[b]}),d3.max(a,function(a){return a[b]})])):void(this._scale=this._scale.domain([0,this._default]))}}),e=b.extend({defaultScale:function(){return tau.data.scale.color10()},setDomain:function(){}});tau.data.types={quantitative:new c,categorical:new e,time:new d}}(),function(){var a=Class.extend({init:function(){},render:function(){},click:function(){},mouseover:function(){},mouseout:function(){},mousemove:function(){}});tau.plugins={add:function(b,c){c=a.extend(c),tau.plugins[b]=function(){return Class.new(c,arguments)}}}}(),function(){function a(a,b){return a>0?a:b+a}var b=Class.extend({init:function(a,b){this._svg=a,b?(this._width=b.width,this._height=b.height):(this._width=a.layout("width"),this._height=a.layout("height")),this._x=0,this._y=0,this._translateX=0,this._translateY=0},_translate:function(a){(this._translateX||this._translateY)&&a.attr("transform","translate("+(this._translateX||0)+","+(this._translateY||0)+")")},_extend:function(b){var c={width:a(this._x-this._translateX,this._width),height:a(this._y-this._translateY,this._height)};b.layout=function(a){return c[a]}},row:function(b){this._translateX=0,this._translateY=this._y,this._y=b?this._y+a(b-this._y,this._height):null},col:function(b){return this._translateX=this._x,this._x=b?this._x+a(b-this._x,this._width):null,this._svg.append("g").call(this._translate.bind(this)).call(this._extend.bind(this))}}),c=function(a){a.node().parentNode.appendChild(a.node())},d=function(a,b){var c=a[b].baseVal;switch(c.unitType){case 1:return c.value;case 2:return(a.parentNode[b]||a.parentNode.getBoundingClientRect()[b])*c.valueInSpecifiedUnits/100;default:throw new Error("unitType "+c.unitType+" is not supported")}},e=function(a){return{width:d(a,"width"),height:d(a,"height")}},f=function(a,b){var c=new tau.svg.Layout(a,e(a.node()));return c.row(b.top),c.row(-b.bottom),c.col(b.left),c.col(-b.right)};tau.svg={getBBox:e,bringOnTop:c,paddedBox:f,Layout:b}}(),function(){var a=tau.charts.Base.extend({_meta:{x:{type:tau.data.types.quantitative},y:{type:tau.data.types.quantitative},color:{type:tau.data.types.categorical,"default":1}},map:function(a){return this._super(a),this._mapper.alias("color","key"),this},_renderData:function(a,b){var c=this._mapper,d=d3.nest().key(c.raw("color")).entries(b),e=function(){this.attr("class",c.map("line %color%"));var a=this.selectAll("path").data(function(a){return[a.values]});a.call(g),a.enter().append("path").call(g),a.exit().remove();var b=this.selectAll(".dot").data(function(a){return a.values});b.call(h),b.enter().append("circle").attr("class","dot i-role-datum").call(h),b.exit().remove()},f=d3.svg.line().x(c.map("x")).y(c.map("y")),g=function(){this.attr("d",f)},h=function(){return this.attr("cx",c.map("x")).attr("cy",c.map("y")).attr("r",function(){return 3})},i=a.selectAll(".line").data(d);i.call(e),i.enter().append("g").call(e),i.exit().remove()}});tau.charts.add("Line",function(b){return new a(b)})}(),function(){var a=tau.charts.Base.extend({_meta:{x:{type:tau.data.types.quantitative},y:{type:tau.data.types.quantitative},color:{type:tau.data.types.categorical,"default":1},size:{type:tau.data.types.quantitative,"default":10}},_renderData:function(a,b){this._mapper.binder("size").range([0,a.layout("width")/100]);var c=this._mapper,d=function(){return this.attr("class",c.map("dot i-role-datum %color%")).attr("r",c.map("size")).attr("cx",c.map("x")).attr("cy",c.map("y"))},e=a.selectAll(".dot").data(b);e.call(d),e.enter().append("circle").call(d),e.exit().remove()}});tau.charts.add("Scatterplot",function(b){return new a(b)})}(),function(){var a={render:function(a,b){var c=b.html.right.append("div").attr("class","datatable");c.append("a").attr("href","#").html("Show data table").on("click",function(){e(),f(c),d3.event.preventDefault()});var d=c.append("div"),e=function(){var b=d.append("table"),c=b.append("thead"),f=b.append("tbody"),g=Object.keys(a.data._data[0]);b.attr("class",function(){return"col-"+g.length}),c.selectAll("th").data(g).enter().append("th").text(tau.data.identity);var h=f.selectAll("tr").data(a.data._data).enter().append("tr");h.selectAll("td").data(function(a){return d3.values(a)}).enter().append("td").text(function(a){return a}),e=function(){}},f=function(a){"datatable"==a.attr("class")?a.attr("class","datatable show"):a.attr("class","datatable")}}};tau.plugins.add("datatable",a)}(),function(){var a={init:function(){this._header=arguments[0],this._description=arguments[1]},render:function(a,b){var c=this._header,d=this._description,e=b.html.above.append("header").attr("class","title");e.append("h1").html(c),e.append("p").html(d)}};tau.plugins.add("header",a)}(),function(){var a={mouseover:function(a,b){b.element.classed("highlighted",!0)},mouseout:function(a,b){b.element.classed("highlighted",!1)}};tau.plugins.add("highlighter",a)}(),function(){var a={render:function(a,b){function c(a){n.each(d(a.alpha)),g.node().checked&&n.each(e(a.alpha)),n.attr("cx",function(a,b){return m[b].x}).attr("cy",function(a,b){return m[b].y})}function d(a){return function(b,c){m[c].x+=.1*(m[c].initialX-m[c].x)*a,m[c].y+=.1*(m[c].initialY-m[c].y)*a}}function e(a){var b=d3.geom.quadtree(m);return function(c,d){var e=m[d],f=e.radius+k+l,g=e.x-f,h=e.x+f,i=e.y-f,j=e.y+f;b.visit(function(b,c,d,f,k){if(b.point&&b.point!==e){var m=e.x-b.point.x,n=e.y-b.point.y,o=Math.sqrt(m*m+n*n),p=e.radius+b.point.radius+(e.color!==b.point.color)*l;p>o&&(o=(o-p)/o*a,e.x-=m*=o,e.y-=n*=o,b.point.x+=m,b.point.y+=n)}return c>h||g>f||d>j||i>k})}}var f=b.html.right.append("div").attr("class","jittering").append("label"),g=f.insert("input",":first-child").attr("type","checkbox").attr("id","applyjittering"),h=b.mapper.map("x"),i=b.mapper.map("y"),j=b.mapper.map("size"),k=(b.mapper.map("color"),5),l=1;f.append("span").text("Jittering");var m=a.data._data.map(function(a){return{initialX:h(a),initialY:i(a),x:h(a),y:i(a),radius:j(a)}}),n=b.elements(),o=d3.layout.force().nodes(m).size([b.svg.layout("width"),b.svg.layout("height")]).on("tick",c).charge(0).gravity(0).chargeDistance(500);d3.select("#applyjittering").on("change",function(){o.resume()}),o.start()}};tau.plugins.add("jittering",a)}(),function(){function a(a){return function(b){return a!=b}}var b={render:function(b,c){var d=(c.svg.layout("width"),c.mapper.domain("color")),e=[],f=c.html.right.append("ul").attr("class","legend"),g=f.selectAll("li").data(d).enter().append("li");g.attr("class",c.mapper.map("color")).on("click",function(d){var f=c.mapper.raw("color")(d);-1==e.indexOf(f)?(e.push(f),d3.select(this).classed("disabled",!0)):(e=e.filter(a(f)),d3.select(this).classed("disabled",!1)),b.data.filter(function(a){return-1==e.indexOf(c.mapper.raw("color")(a))})}).on("mouseover",function(a){var b=c.mapper.raw("color")(a);c.elements().classed("highlighted",function(a){return c.mapper.raw("color")(a)===b})}).on("mouseout",function(){c.elements().classed("highlighted",!1)}),g.text(c.mapper.raw("color"))}};tau.plugins.add("legend",b)}(),function(){var a={init:function(){this._axises=0===arguments.length?["x","y"]:Array.prototype.slice.call(arguments,0)},render:function(a,b){var c=20,d=30,e=10,f=(b.svg.layout("width"),b.svg.layout("height")),g=b.mapper,h=this._axises;b.svg.append("defs").html('<filter x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" id="outline"><feMorphology operator="dilate" in="SourceGraphic" result="Outline" radius="3"/><feColorMatrix result="Outline" in="Outline" type="matrix" values="0 0 0 0 1   0 0 0 0 1   0 0 0 0 1  0 0 0 0.95 0" /><feMerge><feMergeNode in="Outline"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'),this.mouseover=function(a){var i=b.svg.selectAll(".projections").data([a.datum]).enter().append("g").attr("transform","translate("+c+", 0)").attr("class",g.map("color")).classed("projections",!0);h.indexOf("x")>-1&&(i.append("g").attr("class","y").append("line").attr("x1",g.map("x")).attr("y1",f-d+e).attr("x2",g.map("x")).attr("y2",function(a){return g.map("y")(a)+g.map("size")(a)}),i.select(".y").append("text").attr("transform","translate(0, 18)").attr("filter","url(#outline)").attr("dx",g.map("x")).attr("dy",f-d+10).text(g.raw("x"))),h.indexOf("y")>-1&&(i.append("g").attr("class","x").append("line").attr("x1",-e).attr("y1",g.map("y")).attr("x2",function(a){return g.map("x")(a)-g.map("size")(a)}).attr("y2",g.map("y")),i.select(".x").append("text").attr("transform","translate(-19, 4)").attr("filter","url(#outline)").attr("dx",0).attr("dy",g.map("y")).text(g.raw("y")))},this.mouseout=function(){b.svg.selectAll(".projections").remove()}}};tau.plugins.add("projection",a)}(),function(){var a={init:function(){this._dataFields=arguments,this._container=d3.select("body").append("div")},mouseover:function(a){for(var b="",c=this._dataFields.length-1;c>=0;c--){var d=this._dataFields[c];b+='<p class="tooltip-'+d+'"><em>'+d+":</em> "+a.datum[d]+"</p>"}this._container.classed("tooltip",!0).style("top",d3.mouse(this._container[0].parentNode)[1]-10+"px").style("left",d3.mouse(this._container[0].parentNode)[0]+10+"px").style("display","block").html(b)},mousemove:function(){this._container.style("display","block")&&this._container.style("top",d3.mouse(this._container[0].parentNode)[1]-10+"px").style("left",d3.mouse(this._container[0].parentNode)[0]+10+"px")},mouseout:function(){this._container.style("display","none")}};tau.plugins.add("tooltip",a)}(),function(){function a(a,b,c){function d(a){var b=1-a*a*a;return b*b*b}var e=[],f=0,g=Math.floor(c*a.length)-1;for(var h in a){var i=a[h];h>0&&g<a.length-1&&a[g+1]-a[h]<a[h]-a[f]&&(f++,g++);var j;j=a[h]-a[f]>a[g]-a[h]?f:g;for(var k=Math.abs(1/(a[j]-i)),l=0,m=0,n=0,o=0,p=0,q=f;g>=q;){var r,s=a[q],t=b[q];r=h>q?i-s:s-i;var u=d(r*k),v=s*u;l+=u,m+=v,n+=s*v,o+=t*u,p+=t*v,q++}var w,x=m/l,y=o/l,z=p/l,A=n/l;w=A==x*x?0:(z-x*y)/(A-x*x);var B=y-w*x;e[h]=w*i+B}return e}var b={init:function(){},render:function(b,c){var d=c.mapper;d.alias("color","key");var e=d3.nest().key(d.raw("color")).entries(b.data._data),f=d3.svg.line().interpolate("basis").y(function(a){return a[1]}).x(function(a){return a[0]}),g=c.svg.selectAll(".category").data(e).enter().append("g").attr("transform","translate(20, 0)").attr("class","trend-category");g.append("path").attr("class",function(a){return"line trend-line "+d.map("color")(a)}).attr("d",function(b){for(var c={x:[],y:[]},e=function(a,b){var e=d.map(a)(b);c[a].push(Math.round(e))},g=0;g<b.values.length;g++)e("x",b.values[g]),e("y",b.values[g]);return c.x.length<4?void 0:f(d3.zip(c.x,a(c.x,c.y,.5)))})}};tau.plugins.add("trend",b)}();